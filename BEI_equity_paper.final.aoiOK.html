<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="B. Thierry, Spherelab" />


<title>BEI and equity paper analyses | FINAL | AOI ok | Hurdle models</title>

<script src="BEI_equity_paper.final.aoiOK_files/header-attrs-2.20/header-attrs.js"></script>
<script src="BEI_equity_paper.final.aoiOK_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="BEI_equity_paper.final.aoiOK_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="BEI_equity_paper.final.aoiOK_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="BEI_equity_paper.final.aoiOK_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="BEI_equity_paper.final.aoiOK_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="BEI_equity_paper.final.aoiOK_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="BEI_equity_paper.final.aoiOK_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="BEI_equity_paper.final.aoiOK_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="BEI_equity_paper.final.aoiOK_files/navigation-1.1/tabsets.js"></script>
<script src="BEI_equity_paper.final.aoiOK_files/navigation-1.1/codefolding.js"></script>
<link href="BEI_equity_paper.final.aoiOK_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="BEI_equity_paper.final.aoiOK_files/highlightjs-9.12.0/highlight.js"></script>
<link href="BEI_equity_paper.final.aoiOK_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="BEI_equity_paper.final.aoiOK_files/pagedtable-1.1/js/pagedtable.js"></script>
<script src="BEI_equity_paper.final.aoiOK_files/kePrint-0.0.1/kePrint.js"></script>
<link href="BEI_equity_paper.final.aoiOK_files/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">BEI and equity paper analyses | FINAL | AOI ok | Hurdle models</h1>
<h4 class="author">B. Thierry, Spherelab</h4>
<h4 class="date">21 March, 2023</h4>

</div>


<pre class="r"><code># Clean up dataframe to keep only meaningful vars and drop NA, ready for LM
tidy_df &lt;- function(src_df, ct, f, drop_islands=TRUE) {
  clean_bei_df &lt;- src_df %&gt;%
    select(CT_UID, all_of(all.vars(f))) %&gt;%
    drop_na() %&gt;%
    units::drop_units()
  
  # Join geom from CT dataframe
  df &lt;- ct %&gt;%
    transmute(CT_UID = GeoUID) %&gt;%
    inner_join(clean_bei_df, by=&quot;CT_UID&quot;)
  
  # Build neighborhood (with islands) and extract island IDs
  ct_nb &lt;- poly2nb(df)
  
  if (drop_islands) {
    islands &lt;- lapply(ct_nb, min) %&gt;% lapply(function(e) e == 0) %&gt;% unlist %&gt;% which()

    # Cleanup subset DF to drop islands and NA
    df &lt;- df %&gt;%
      filter(!row_number() %in% islands) %&gt;%
      mutate(ct_no = row_number()) # Add CT number, matching row number
  
    # Recompute neighborhood
    ct_nb &lt;- poly2nb(df)
    
    # Clean up final dataframe (no island, no NA&#39;s, pure dataframe)
    clean_df &lt;- df %&gt;%
      as.data.frame() %&gt;%
      select(CT_UID, ct_no, all_of(all.vars(f)))
  }

  nbw = nb2listw(ct_nb, zero.policy = !drop_islands)
  nbmatx = nb2mat(ct_nb, style = &quot;B&quot;, zero.policy = !drop_islands)
  
  list(df=clean_df, nbmatx=nbmatx, nbw=nbw, island_dropped=drop_islands)
}</code></pre>
<p>This document builds on <code>BEI_equity_paper.Rmd</code> doc, which started as an analysis for the equity paper and moved to an exploration of the best modeling framework (simple OLS, spatial auto-regressive linear regression, spatial random effect model and INLA) to assess the relation between interventions and equity metrics. The conclusions of this exploration led to the following decisions:</p>
<ol style="list-style-type: decimal">
<li>go with quintiles instead of absolute numbers (easier to interpret)</li>
<li>use [zero inflated] Poisson distribution where fit (<em>ie</em> Bike lane ratio)</li>
<li>use <code>spaMM</code> package to model association; <code>INLA</code> could be the focus of another methodological paper which would compare both approaches</li>
<li>use non-buffered dependent variable, as spatial dependency is already taken care of through the spatial random effect</li>
</ol>
<p>This document contains the analyses to be included in the BEI and equity paper.</p>
<div id="proposal" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Proposal</h1>
<div id="original-grant-proposal-for-census-tract-level-analyses" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Original grant proposal for Census tract level analyses</h2>
<div id="objective-1-socio-spatial-inequalities-in-urban-interventions" class="section level3" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Objective 1: Socio-spatial inequalities in urban interventions:</h3>
<ul>
<li>To test if urban interventions tend to be located in low SES neighborhoods (H1a); we will run the following model: <span class="math display">\[Log(ùîº(UI_{ùëñ} \mid X_{ùëñ})) = \alpha + \beta_{1} * SES_{ùëñ}\]</span> a Poisson regression model with <span class="math inline">\(UI\)</span> = the number of Urban Interventions between 2016 and 2021, <span class="math inline">\(SES\)</span> = the socio-economic status of the census track at 2016.</li>
<li>To test the reduction in socio-economic inequalities in urban conditions (e.g.¬†length and type of bicycle lanes, NDVI) between 2006 and 2020 (H1b), we will run the following model: <span class="math display">\[ùîº(UC_{ij} \mid X_{ij}) = \beta_{0j} + \beta_{1j} ‚àó SES + \beta_{2j} ‚àó Time + \beta_{3j} ‚àó SES ‚àó Time + \epsilon_{ij}\]</span> a multilevel linear model with <span class="math inline">\(UC\)</span> = the Urban condition, <span class="math inline">\(SES\)</span> = the socio-economic status of the census track.</li>
</ul>
</div>
<div id="objective-2-examining-causal-pathways-and-directionality-of-interventiongentrification-relation" class="section level3" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Objective 2: Examining causal pathways and directionality of intervention/gentrification relation:</h3>
<ul>
<li>To test if urban interventions occur before gentrification or if gentrification occurs before the implementation of new urban interventions, we will run two models : (1) <span class="math display">\[Logit(ùîº(G_{i} \mid X_{i})) = \alpha + \beta_{1} ‚àó UI_{i} + + \beta_{2} ‚àó PG_{i} + \beta ‚àó X_{control_{i}}\]</span> a logistic regression model among low SES census tracts (2006) with <span class="math inline">\(G\)</span> = Gentrification between 2006 and 2016, <span class="math inline">\(UI\)</span> = the number of Urban Interventions between 2001 and 2006, and <span class="math inline">\(PG\)</span> = SES status 2006; and (2) <span class="math display">\[Logit(ùîº(UI_{i} \mid X_{i})) = \alpha + \beta_{1} ‚àó G_{i} + \beta_{2} ‚àó UC_{i} + \beta ‚àó X_{control_{i}}\]</span> a Poisson regression model, with <span class="math inline">\(UI\)</span> = the number of Urban Interventions between 2016 and 2023, <span class="math inline">\(G\)</span> = Gentrification between 2006 and 2016, and <span class="math inline">\(UC\)</span> = Urban Conditions in 2016.</li>
</ul>
</div>
</div>
<div id="paper-objective" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Paper objective</h2>
<p>We focus on obj #1: are urban interventions tend to be located in low SES neighborhoods. Here, the urban interventions considered are bike lanes and canopy/tree coverage and low SES ~ high Pampalon deprivation index. In a second step, we will look at the variations of UI and SES and their association.</p>
<p>Data extraction and pre-analyses for the paper looking at BEI and equity. BEI comprise bike lanes and canopy changes while equity is measured through Pampalon deprivation index. (Partially adapted from original work on BEI bike lanes ‚Äì see <code>bike_lane_stats.R</code> and <code>ReadMe.md</code>.)</p>
<p>Paper is available <a href="https://docs.google.com/document/d/1m7axqojha0YGud4rWQ1zsWaxufim7lvk5DDQ-h5VSfE/edit">here</a>.</p>
<p><strong>General processing steps:</strong></p>
<ul>
<li>Get CT 2016 boundaries (from Cancensus API)</li>
<li>Get BEI interventions (canopy / bike lanes) for the selected years (2011 / 2015 / 2016 / 2019)</li>
<li>Compute changes between years
<ul>
<li>for the original CT boundaries</li>
<li>for buffered CTs (250 / 500 / 750m)</li>
</ul></li>
</ul>
<p>In a second phase, these BEI changes will be linked to Pampalon index for 2016 (and 2011 ?)</p>
</div>
<div id="revision-history" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Revision history</h2>
<p><strong>UPDATE 2021-12-02</strong> Following discussion with <span class="citation">@Yan</span>, add normalized bike line changes:</p>
<ul>
<li>by CT/buffer area</li>
<li>by street length within CT/buffer</li>
</ul>
<p><strong>UPDATE 2021-12-08</strong> Following discussion with <span class="citation">@Yan</span></p>
<ul>
<li>Keep only normalized variation of bike lane length</li>
<li>Reverse relation: BEI metric = f(Equity metric (Pampalon / gentrification))</li>
<li>Display association at baseline, then add delta over time</li>
<li>Canopy : distinguish between high and low canopy</li>
</ul>
<p><strong>UPDATE 2022-01-14</strong> Following discussion with <span class="citation">@Ruben</span> and <span class="citation">@Yan</span></p>
<ul>
<li>Test model with UC 2011 when modeling UI</li>
<li>Models with <em>random slope</em> probably not pertinent (see model 6, section 7.1.6)</li>
<li>Try to define <code>Year</code> variable as continuous instead of category in LME</li>
<li>Check if range of <code>wSCOREMAT</code> matches theoretical range of x-axis in graph (-.2 &gt;&gt; .2), might ponder the magnitude of the observed trend</li>
<li>Test three-way interaction instead of 2 times two-way interactions (interactions might be complicated to interpret‚Ä¶)</li>
<li>For gentrification and multilevel model, use GEE (logit)</li>
</ul>
<p><strong>UPDATE 2022-02-10</strong> Following gentrification meeting</p>
<ul>
<li>Add correlation matrix of SES variables (Caislin)</li>
<li>Drop <code>wSCORESOC</code>, which does not capture equity dimension (Meghan) [replaced by visible minority]</li>
<li>Paper focus should be on gentrification</li>
</ul>
<p><strong>UPDATE 2022-02-15</strong></p>
<ul>
<li>Add spatial autocorrelation test (Moran‚Äôs I)</li>
<li>Add Lagrange Multipliers to test best spatial model</li>
<li>Add comparison of OLS/SAR/SEM models</li>
</ul>
<p><strong>UPDATE 2022-06-28</strong></p>
<ul>
<li>Add categorical SES variables (instead of ordinal coding) to better explain the Q5 vs other effect (see Behzad and Yan‚Äôs comments); this is particularly true for bike lanes changes, as no significant effect found yet graph shows clearly a Q5 vs.¬†other effect</li>
<li>Build maps of SES (?) and BEI / BEC (might be better in ArcGIS)</li>
</ul>
<p><strong>UPDATE 2022-07-07</strong></p>
<ul>
<li>Fix quintile computation (which was previously based on the whole CMA and now uses the actual AOI)</li>
<li>Dropped a few useless chunks (mostly bike lane, no hurdle model)</li>
</ul>
<p><strong>UPDATE 2023-01-16</strong></p>
<ul>
<li>Decided to split the paper in two (gentrif + greenness) after reviews from the paper submission</li>
<li>As per reviewer‚Äôs suggestion, gentrification now distinguishes between 3 states: gentrified / not-gontrified/non-eligible to gentrification</li>
</ul>
<p><strong>UPDATE 2023-02-20</strong></p>
<ul>
<li>Fix study area to exclude Boucherville</li>
</ul>
<p><strong>UPDATE 2023-03-16</strong></p>
<ul>
<li>Discard true hurdle model approach by processing separately the change in bike lanes (no change vs.¬†having a bike lane in 2026 when no bike lanes existed in 2011) and the amount of change when there is a bike lane in 2016. || <em>NB</em>: this does not improve the model convergence</li>
<li>Added manual CI computation when not converging with <code>confint</code> function</li>
</ul>
</div>
<div id="a-few-references" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> A few references‚Ä¶</h2>
<ul>
<li>General resources on GLMM
<ul>
<li><a href="http://bbolker.github.io/mixedmodels-misc/glmmFAQ.html">GLMM FAQ</a></li>
</ul></li>
<li>Count and rate models:
<ul>
<li><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3513584/">A tutorial on count regression and zero-altered count models for longitudinal substance use data</a></li>
<li><a href="https://psycnet.apa.org/fulltext/1996-93539-001.html">Regression Analyses of Counts and Rates: Poisson, Overdispersed Poisson, and Negative Binomial Models</a></li>
<li><a href="https://www.tandfonline.com/doi/full/10.1080/00223890802634175?journalCode=hjpa20">The Analysis of Count Data: A Gentle Introduction to Poisson Regression and Its Alternatives</a></li>
</ul></li>
<li>Spatial models:
<ul>
<li><a href="https://rspatial.org/raster/analysis/7-spregression.html" class="uri">https://rspatial.org/raster/analysis/7-spregression.html</a></li>
<li><a href="https://rpubs.com/quarcs-lab/tutorial-spatial-regression" class="uri">https://rpubs.com/quarcs-lab/tutorial-spatial-regression</a></li>
<li><a href="https://www.r-bloggers.com/2019/09/spatial-regression-in-r-part-1-spamm-vs-glmmtmb/" class="uri">https://www.r-bloggers.com/2019/09/spatial-regression-in-r-part-1-spamm-vs-glmmtmb/</a></li>
<li><a href="https://crd230.github.io/lab8.html" class="uri">https://crd230.github.io/lab8.html</a></li>
<li><a href="http://labs.bio.unc.edu/Buckley/documents/AnselinIntroSpatRegres.pdf" class="uri">http://labs.bio.unc.edu/Buckley/documents/AnselinIntroSpatRegres.pdf</a></li>
</ul></li>
<li>Interactions:
<ul>
<li><a href="https://stats.oarc.ucla.edu/r/seminars/interactions-r/#s4d">Decomposing, Probing, and Plotting Interactions in R</a></li>
<li><a href="https://cran.r-project.org/web/packages/emmeans/vignettes/sophisticated.html">Sophisticated models in emmeans</a></li>
<li><a href="https://tysonbarrett.com/Rstats/chapter-6-multilevel-modeling.html">R for Researchers: An Introduction</a></li>
<li><a href="https://academic.oup.com/ije/article/41/2/514/692957">Recommendations for presenting analyses of effect modification and interaction</a></li>
<li><a href="https://stats.stackexchange.com/questions/94888/p-value-for-interaction-term-in-mixed-effects-models-using-lme4">Testing interact terms</a></li>
</ul></li>
</ul>
</div>
</div>
<div id="built-environment-intervention-extraction" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Built Environment Intervention Extraction</h1>
<div id="bike-lane-changes" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Bike lane changes</h2>
<p>We use data categorized by Philippe Apparicio‚Äôs team who manually identified bike lanes for each census year since 1991. For this study, we limit ourselves to 2016, 2011 and 2006 census years.</p>
<p>On top of the original CT boundaries, three levels of buffer have been applied to the CT ‚Äì 250m, 500m &amp; 750m. Then the same series of processing steps (see above) have been applied to the buffers.</p>
<pre class="r"><code># Bike lanes, from Ph. Apparicio
reseau &lt;- st_read(dsn=&quot;data/ReseauCyclableFinal.gdb&quot;, layer = &quot;Reseau&quot;) # Already in NAD83 / MTM zone 8</code></pre>
<pre><code>## Reading layer `Reseau&#39; from data source 
##   `/Users/benoit/WORKSPACE/gentrification_BEI_equity/data/ReseauCyclableFinal.gdb&#39; 
##   using driver `OpenFileGDB&#39;
## Simple feature collection with 82166 features and 72 fields
## Geometry type: GEOMETRY
## Dimension:     XYZ, XYZM
## Bounding box:  xmin: 266985.5 ymin: 5029251 xmax: 320986.1 ymax: 5062652
## z_range:       zmin: 0 zmax: 43
## m_range:       mmin: 0 mmax: 43
## Projected CRS: NAD83 / MTM zone 8</code></pre>
<pre class="r"><code>bike_lane &lt;- reseau %&gt;%
  filter(An2016 == 1 | An2011 == 1) %&gt;%
  select(IdRte, ClsRte, Zone, starts_with(&quot;An&quot;), starts_with(&quot;Typo_&quot;)) %&gt;%
  st_cast(&quot;MULTILINESTRING&quot;) # Get rid of a few MULTICURVE geometries

# CT boundaries for Montreal
CT16 &lt;- get_census(dataset=&#39;CA16&#39;, regions=list(CMA=&#39;24462&#39;), level=&#39;CT&#39;, geo_format = &quot;sf&quot;) %&gt;%
  filter(Type == &quot;CT&quot;) %&gt;%
  mutate(interact_aoi = (CD_UID %in% c(2466, 2465, 2458)) &amp; !(CSD_UID %in% c(2458033, 2458037))) %&gt;% # Flag Montr√©al island, Laval and the South shore (Longueuil, St-Lambert, Brossard) and drop Boucherville and St-Bruno
  st_transform(st_crs(bike_lane))</code></pre>
<pre><code>## Reading geo data from local cache.</code></pre>
<pre class="r"><code>CT11 &lt;- get_census(dataset=&#39;CA11&#39;, regions=list(CMA=&#39;24462&#39;), level=&#39;CT&#39;, geo_format = &quot;sf&quot;) %&gt;%
  filter(Type == &quot;CT&quot;) %&gt;%
  st_transform(st_crs(bike_lane))</code></pre>
<pre><code>## Reading geo data from local cache.</code></pre>
<pre class="r"><code>compute_bikelane_by_area &lt;- function(sf_areas, year_fld, typo_fld) {
  # Compute length of bike lanes within each area.
  # --
  # Parameters:
  #   - sf_areas: sf class object defining the areas of interest, must have a GeoUID field
  #   - year_fld: field name specifying the year of interest, e.g. An2016
  #   - typo_fld: field name specifying the typology for the year of interest, e.g. Typo_2016
  
  year_fld &lt;- enquo(year_fld)
  typo_fld &lt;- enquo(typo_fld)
  
  # Compute intersection of bike lanes with areas
  bk &lt;- bike_lane %&gt;%
    filter(!!year_fld == 1) %&gt;%
    st_intersection(sf_areas) %&gt;%
    mutate(bike_lane_length = st_length(.)) %&gt;%
    as.data.frame() %&gt;%
    group_by(GeoUID, !!typo_fld) %&gt;%
    summarise(bike_lane_length = sum(bike_lane_length)) %&gt;%
    ungroup() %&gt;%
    pivot_wider(names_from = !!typo_fld, names_prefix = &quot;Bike_class&quot;, names_sort = TRUE,
                values_from = bike_lane_length, values_fill = units::set_units(0, m)) %&gt;%
    mutate(Bike_lane_total = units::set_units(rowSums(select(., starts_with(&quot;Bike_class&quot;))), m))
  
  # Merge back into original sf_areas
  bk &lt;- sf_areas %&gt;%
    left_join(bk)
  
  # Replace NA by 0, which occur in Bike_class length
  bk[is.na(bk)] &lt;- 0
  
  return(bk)
}

compute_streetlength_by_area &lt;- function(sf_areas) {
  # Compute length of streets within each area.
  # --
  # Parameters:
  #   - sf_areas: sf class object defining the areas of interest, must have a GeoUID field

  # Compute intersection of streets with areas
  bk &lt;- reseau  %&gt;%
    st_cast(&quot;MULTILINESTRING&quot;) %&gt;% # Get rid of a few MULTICURVE geometries
    st_intersection(sf_areas) %&gt;%
    mutate(street_length = st_length(.)) %&gt;%
    as.data.frame() %&gt;%
    group_by(GeoUID) %&gt;%
    summarise(street_length = sum(street_length)) %&gt;%
    ungroup()
  
  # Merge back into original sf_areas
  bk &lt;- sf_areas %&gt;%
    mutate(shape_area_km2 = units::set_units(st_area(.), &#39;km^2&#39;)) %&gt;%
    left_join(bk)
  
  # Replace NA by 0
  bk[is.na(bk)] &lt;- 0
  
  return(bk)
}


# Compute year 2016 and year 2011 bike lanes within 2016 CTs
# NB: contrary to the original work, we keep the same area of reference, i.e. 2016
bike_lane_by_CT16 &lt;- compute_bikelane_by_area(CT16, An2016, Typo_2016)
bike_lane_by_CT11 &lt;- compute_bikelane_by_area(CT16, An2011, Typo_2011)
bike_lane_by_CT06 &lt;- compute_bikelane_by_area(CT16, An2006, Typo_2006)

# Compute total street length within CT/buffer
street_length_by_CT16 &lt;- compute_streetlength_by_area(CT16)

# Reorganize data to have all data in one dataframe
bike_lane_changes &lt;- CT16 %&gt;%
  left_join(select(as.data.frame(street_length_by_CT16), GeoUID, street_length, shape_area_km2), by=&quot;GeoUID&quot;) %&gt;%
  left_join(select(as.data.frame(bike_lane_by_CT16), GeoUID, starts_with(&quot;Bike_&quot;)), by=&quot;GeoUID&quot;) %&gt;%
  left_join(select(as.data.frame(bike_lane_by_CT11), GeoUID, starts_with(&quot;Bike_&quot;)), by=&quot;GeoUID&quot;, suffix=c(&quot;.2016ct&quot;, &quot;.2011ct&quot;)) %&gt;%
  left_join(select(as.data.frame(bike_lane_by_CT06), GeoUID, starts_with(&quot;Bike_&quot;)), by=&quot;GeoUID&quot;)

# Compute ratio of bike lane vs street length
bike_lane_changes &lt;- bike_lane_changes %&gt;%
  transmute(GeoUID = GeoUID,
            interact_aoi = interact_aoi,
            street_length = street_length,
            street_length.hm = street_length / 100, # in hectometers, can be kept as float (not a dependent variable following a Poisson distribution)
            Bike_lane_total.2016ct = Bike_lane_total.2016ct,
            Bike_lane_total.2011ct = Bike_lane_total.2011ct,
            Bike_lane_total.2006ct = Bike_lane_total,
            Bike_lane_total.hm.2016ct = as.integer(round(Bike_lane_total.2016ct/100)),
            Bike_lane_total.hm.2011ct = as.integer(round(Bike_lane_total.2011ct/100)),
            Bike_lane_total.hm.2006ct = as.integer(round(Bike_lane_total/100)),
            Bike_lane.by.street.2016ct = 100 * Bike_lane_total.2016ct / street_length, # In percents
            Bike_lane.by.street.2011ct = 100 * Bike_lane_total.2011ct / street_length,
            Bike_lane.by.street.2006ct = 100 * Bike_lane_total / street_length)

# Compute change between 2011 and 2016 (only for total bike lane length)
bike_lane_changes &lt;- bike_lane_changes %&gt;%
  mutate(Bike_lane_diff.2011.2016ct = Bike_lane_total.2016ct - Bike_lane_total.2011ct)

# Normalize bike lane change by (i) street length and (ii) area
bike_lane_changes &lt;- bike_lane_changes %&gt;%
  mutate(Bike_lane_diff.by.street.2011.2016ct = 100 * Bike_lane_diff.2011.2016ct / street_length)

# Save results
st_write(bike_lane_changes, dsn = &quot;data/bike_length_changes.gpkg&quot;, delete_layer = TRUE)</code></pre>
<pre><code>## Deleting layer `bike_length_changes&#39; using driver `GPKG&#39;
## Writing layer `bike_length_changes&#39; to data source 
##   `data/bike_length_changes.gpkg&#39; using driver `GPKG&#39;
## Writing 970 features with 15 fields and geometry type Multi Polygon.</code></pre>
<pre class="r"><code># Clean up
rm(buf_CT16)
rm(bike_lane_by_CT11, bike_lane_by_CT16, bike_lane_by_CT06)
rm(street_length_by_CT16)</code></pre>
<div id="illustration-of-bike-lane-metrics" class="section level3 tabset" number="2.1.1">
<h3 class="tabset"><span class="header-section-number">2.1.1</span> Illustration of bike lane metrics</h3>
<p>Check output for one specific dataset (Census tracts 2016, no buffer)</p>
<div id="raw-length" class="section level4" number="2.1.1.1">
<h4><span class="header-section-number">2.1.1.1</span> Raw length</h4>
<p>Bike lane length in 2016 within CTs, measured in meters</p>
<pre class="r"><code>ggplot() +
   geom_sf(data=filter(bike_lane_changes, interact_aoi), mapping = aes(fill=as.numeric(Bike_lane_total.2016ct)), lwd=0) +
  scale_fill_continuous(name = &quot;Total length (m)&quot;)+ 
  labs(title = &quot;Length of bike lanes within 2016 CTs&quot;)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/carte-controle-1.png" /><!-- --></p>
</div>
<div id="absolute-length-change" class="section level4" number="2.1.1.2">
<h4><span class="header-section-number">2.1.1.2</span> Absolute length change</h4>
<p>Absolute bike lane length change between 2011 and 2016, in meters</p>
<pre class="r"><code>ggplot() +
   geom_sf(data=filter(bike_lane_changes, interact_aoi), mapping = aes(fill=as.numeric(Bike_lane_diff.2011.2016ct)), lwd=0) +
  scale_fill_gradient2(name = &quot;Length (m)&quot;)+ 
  labs(title = &quot;Changes in bike lane between 2011 and 2016&quot;)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/carte-controle-1-1.png" /><!-- --></p>
</div>
<div id="normalized-length-change-by-street" class="section level4" number="2.1.1.3">
<h4><span class="header-section-number">2.1.1.3</span> Normalized length change (by street)</h4>
<p>Relative bike lane length change between 2011 and 2016, normalized by street length within CT in 2016, expressed in %</p>
<p><span class="math display">\[Variation = \frac{Bike Lane_{2016}}{Street Length_{2016}} - \frac{Bike Lane_{2011}}{Street Length_{2016}}\]</span></p>
<pre class="r"><code>ggplot() +
   geom_sf(data=filter(bike_lane_changes, interact_aoi), mapping = aes(fill=as.numeric(Bike_lane_diff.by.street.2011.2016ct)), lwd=0) +
  scale_fill_gradient2(name = &quot;Variation (%)&quot;)+ 
  labs(title = &quot;Changes in bike lane between 2011 and 2016, normalized by street&quot;)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/carte-controle-2-1.png" /><!-- --></p>
</div>
</div>
<div id="basic-stats-on-each-layer" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Basic stats on each layer</h3>
<p>At the Census Tract level.</p>
<pre class="r"><code># CT level
ggplot(bike_lane_changes) +
  geom_histogram(aes(as.numeric(Bike_lane_diff.2011.2016ct)), binwidth = 250) + 
  xlab(&quot;Difference of bike lane length between 2016 and 2011 | CT level&quot;)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/bike-lane-stats-ct-1.png" /><!-- --></p>
<pre class="r"><code>summary(bike_lane_changes$Bike_lane_diff.2011.2016ct)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## -1377.7     0.0     0.0   262.1   189.7 14463.8</code></pre>
<pre class="r"><code>ggplot(bike_lane_changes) +
  geom_histogram(aes(as.numeric(Bike_lane_diff.by.street.2011.2016ct))) + 
  xlab(&quot;Difference of bike lane length between 2016 and 2011, normalized by street&quot;)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/bike-lane-stats-ct-2.png" /><!-- --></p>
<pre class="r"><code>summary(bike_lane_changes$Bike_lane_diff.by.street.2011.2016ct)</code></pre>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA&#39;s 
## -100.000    0.000    0.000    3.665    4.496  100.000      252</code></pre>
</div>
</div>
<div id="canopy-changes" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Canopy changes</h2>
<p>Canopy changes is based on <a href="http://observatoire.cmm.qc.ca/fileadmin/user_upload/geomatique/IndiceCanopee/2015/CMM_indiceCanopee_2015_methodologie.pdf">data produced by CMM</a>, using multispectral aerial imagery and lidar. In order to sync the observations with the census years, we focus on 2011 and 2019 with one extra observation point in 2015.</p>
<p>The processing steps are similar to the ones for the bike lanes:</p>
<ul>
<li>Import the raster for each of the 3 years</li>
<li>Compute proportion of canopy within each CT for the 3 years</li>
</ul>
<pre class="r"><code># Codes du raster &quot;espace vert&quot;
# 0. No data (hors CMM)
# 1. NDVI &lt; 0,3 et MNH &lt; 3,0m = Min√©ral bas (route, stationnement, etc.)
# 2. NDVI &lt; 0,3 et MNH ‚â• 3,0m = Min√©ral haut (constructions)
# 3. NDVI ‚â• 0,3 et MNH &lt; 3,0m = V√©g√©tal bas (culture, gazon, etc.)
# 4. NDVI ‚â• 0,3 et MNH ‚â• 3,0m = V√©g√©tal haut (canop√©e)
# 5. Aquatique

# Load rasters into pg database for further processing
system(&#39;psql -d gentrif_bei -c &quot;CREATE EXTENSION IF NOT EXISTS postgis&quot;&#39;)
system(&#39;psql -d gentrif_bei -c &quot;CREATE EXTENSION IF NOT EXISTS postgis_raster&quot;&#39;)

if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2019&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/2019/*.tif -F -t 1000x1000 canopee2019 | psql -d gentrif_bei&quot;, intern = TRUE)
} else { message(&quot;PG Raster &#39;canopee2019&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2019&#39; already imported</code></pre>
<pre class="r"><code>if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2017&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/2017/*.tif -F -t 1000x1000 canopee2017 | psql -d gentrif_bei&quot;, intern = TRUE)
} else { message(&quot;PG Raster &#39;canopee2017&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2017&#39; already imported</code></pre>
<pre class="r"><code>if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2015&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/2015/*.tif -F -t 1000x1000 canopee2015 | psql -d gentrif_bei&quot;, intern = TRUE)
} else { message(&quot;PG Raster &#39;canopee2015&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2015&#39; already imported</code></pre>
<pre class="r"><code>if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2011&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/2011/*.tif -F -t 1000x1000 canopee2011 | psql -d gentrif_bei&quot;, intern = TRUE)
} else { message(&quot;PG Raster &#39;canopee2011&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2011&#39; already imported</code></pre>
<pre class="r"><code># Resample to 10m as the original rasters have a 1m resolution, which is too high to allow for a swift processing
if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2019_10m&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;gdal_translate -of GTiff PG:\&quot;host=localhost dbname=gentrif_bei table=canopee2019 mode=2\&quot; -r mode -tr 10 10 data/canopy/canopee2019_10m.tif&quot;)
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/canopee2019_10m.tif -F -t 100x100 canopee2019_10m | psql -d gentrif_bei&quot;)
} else { message(&quot;PG Raster &#39;canopee2019_10m&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2019_10m&#39; already imported</code></pre>
<pre class="r"><code>if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2017_10m&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;gdal_translate -of GTiff PG:\&quot;host=localhost dbname=gentrif_bei table=canopee2017 mode=2\&quot; -r mode -tr 10 10 data/canopy/canopee2017_10m.tif&quot;)
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/canopee2017_10m.tif -F -t 100x100 canopee2017_10m | psql -d gentrif_bei&quot;)
} else { message(&quot;PG Raster &#39;canopee2017_10m&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2017_10m&#39; already imported</code></pre>
<pre class="r"><code>if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2015_10m&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;gdal_translate -of GTiff PG:\&quot;host=localhost dbname=gentrif_bei table=canopee2015 mode=2\&quot; -r mode -tr 10 10 data/canopy/canopee2015_10m.tif&quot;)
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/canopee2015_10m.tif -F -t 100x100 canopee2015_10m | psql -d gentrif_bei&quot;)
} else { message(&quot;PG Raster &#39;canopee2015_10m&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2015_10m&#39; already imported</code></pre>
<pre class="r"><code>if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2011_10m&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;gdal_translate -of GTiff PG:\&quot;host=localhost dbname=gentrif_bei table=canopee2011 mode=2\&quot; -r mode -tr 10 10 data/canopy/canopee2011_10m.tif&quot;)
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/canopee2011_10m.tif -F -t 100x100 canopee2011_10m | psql -d gentrif_bei&quot;)
} else { message(&quot;PG Raster &#39;canopee2011_10m&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2011_10m&#39; already imported</code></pre>
<pre class="r"><code># Push CT16 to pg
if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;ct16&#39;) IS NOT NULL;&quot;)) == 0) {
  CT16 %&gt;%
    st_transform(crs = 32188) %&gt;%
    st_write(con_bei, &quot;ct16&quot;,
             layer_options = c(&quot;OVERWRITE=yes&quot;, &quot;LAUNDER=true&quot;, &quot;SPATIAL_INDEX=gist&quot;, &quot;GEOMETRY_NAME=geom&quot;))
  system(&quot;psql -d gentrif_bei -c &#39;CREATE INDEX ON  ct16 USING gist (geometry)&#39;&quot;)
} else { message(&quot;PG Layer CT16 already imported&quot;) }</code></pre>
<pre><code>## PG Layer CT16 already imported</code></pre>
<pre class="sql"><code>WITH cnt19 AS (
    SELECT &quot;GeoUID&quot;, &quot;Population&quot;
        ,(pvc).value, SUM((pvc).count) As total
    FROM (SELECT &quot;GeoUID&quot;, &quot;Population&quot;
            ,ST_ValueCount(ST_Clip(rast, geometry)) As pvc
        FROM canopee2019_10m
        JOIN ct16 ON ST_Intersects(geometry, rast)
    ) As foo
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;, (pvc).value
),
canopee19 AS (
    SELECT &quot;GeoUID&quot;
        ,round(.1*.1 * sum(total) FILTER (WHERE value in (3, 4))) AS area_esp_vert_2019 -- area expressed in hectares
        ,round(100. * sum(total) FILTER (WHERE value in (3, 4)) / sum(total), 1) AS pct_esp_vert_2019
        ,round(.1*.1 * sum(total) FILTER (WHERE value = 4)) AS area_esp_vert_high_2019
        ,round(100. * sum(total) FILTER (WHERE value = 4) / sum(total), 1) AS pct_esp_vert_high_2019
    FROM cnt19
    WHERE value &gt; 0 -- discard no data, including postgis raster no data
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;
),
cnt17 AS (
    SELECT &quot;GeoUID&quot;, &quot;Population&quot;
        ,(pvc).value, SUM((pvc).count) As total
    FROM (SELECT &quot;GeoUID&quot;, &quot;Population&quot;
            ,ST_ValueCount(ST_Clip(rast, geometry)) As pvc
        FROM canopee2017_10m
        JOIN ct16 ON ST_Intersects(geometry, rast)
    ) As foo
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;, (pvc).value
),
canopee17 AS (
    SELECT &quot;GeoUID&quot;
        ,round(.1*.1 * sum(total) FILTER (WHERE value in (3, 4))) AS area_esp_vert_2017
        ,round(100. * sum(total) FILTER (WHERE value in (3, 4)) / sum(total), 1) AS pct_esp_vert_2017
        ,round(.1*.1 * sum(total) FILTER (WHERE value = 4)) AS area_esp_vert_high_2017
        ,round(100. * sum(total) FILTER (WHERE value = 4) / sum(total), 1) AS pct_esp_vert_high_2017
    FROM cnt17
    WHERE value &gt; 0 -- discard no data, including postgis raster no data
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;
),
cnt15 AS (
    SELECT &quot;GeoUID&quot;, &quot;Population&quot;
        ,(pvc).value, SUM((pvc).count) As total
    FROM (SELECT &quot;GeoUID&quot;, &quot;Population&quot;
            ,ST_ValueCount(ST_Clip(rast, geometry)) As pvc
        FROM canopee2015_10m
        JOIN ct16 ON ST_Intersects(geometry, rast)
    ) As foo
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;, (pvc).value
),
canopee15 AS (
    SELECT &quot;GeoUID&quot;
        ,round(.1*.1 * sum(total) FILTER (WHERE value in (3, 4))) AS area_esp_vert_2015
        ,round(100. * sum(total) FILTER (WHERE value in (3, 4)) / sum(total), 1) AS pct_esp_vert_2015
        ,round(.1*.1 * sum(total) FILTER (WHERE value = 4)) AS area_esp_vert_high_2015
        ,round(100. * sum(total) FILTER (WHERE value = 4) / sum(total), 1) AS pct_esp_vert_high_2015
    FROM cnt15
    WHERE value &gt; 0 -- discard no data, including postgis raster no data
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;
),
cnt11 AS (
    SELECT &quot;GeoUID&quot;, &quot;Population&quot;
        ,(pvc).value, SUM((pvc).count) As total
    FROM (SELECT &quot;GeoUID&quot;, &quot;Population&quot;
            ,ST_ValueCount(ST_Clip(rast, geometry)) As pvc
        FROM canopee2011_10m
        JOIN ct16 ON ST_Intersects(geometry, rast)
    ) As foo
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;, (pvc).value
),
canopee11 AS (
    SELECT &quot;GeoUID&quot;
        ,round(.1*.1 * sum(total) FILTER (WHERE value in (3, 4))) AS area_esp_vert_2011
        ,round(100. * sum(total) FILTER (WHERE value in (3, 4)) / sum(total), 1) AS pct_esp_vert_2011
        ,round(.1*.1 * sum(total) FILTER (WHERE value = 4)) AS area_esp_vert_high_2011
        ,round(100. * sum(total) FILTER (WHERE value = 4) / sum(total), 1) AS pct_esp_vert_high_2011
    FROM cnt11
    WHERE value &gt; 0 -- discard no data, including postgis raster no data
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;
)
SELECT &quot;GeoUID&quot;
    ,round((st_area(geometry) / 10000)::numeric, 1) ct_area_h -- CT area in hectares
    ,COALESCE(area_esp_vert_2011, 0) area_esp_vert_2011
    ,coalesce(area_esp_vert_high_2011, 0) area_esp_vert_high_2011
    ,coalesce(pct_esp_vert_high_2011, 0) pct_esp_vert_high_2011
    ,coalesce(pct_esp_vert_2011, 0) pct_esp_vert_2011
    ,COALESCE(area_esp_vert_2015, 0) area_esp_vert_2015
    ,coalesce(area_esp_vert_high_2015, 0) area_esp_vert_high_2015
    ,coalesce(pct_esp_vert_high_2015, 0) pct_esp_vert_high_2015
    ,coalesce(pct_esp_vert_2015, 0) pct_esp_vert_2015
    ,COALESCE(area_esp_vert_2017, 0) area_esp_vert_2017
    ,coalesce(area_esp_vert_high_2017, 0) area_esp_vert_high_2017
    ,coalesce(pct_esp_vert_high_2017, 0) pct_esp_vert_high_2017
    ,coalesce(pct_esp_vert_2017, 0) pct_esp_vert_2017
    ,COALESCE(area_esp_vert_2019, 0) area_esp_vert_2019
    ,coalesce(area_esp_vert_high_2019, 0) area_esp_vert_high_2019
    ,coalesce(pct_esp_vert_high_2019, 0) pct_esp_vert_high_2019
    ,coalesce(pct_esp_vert_2019, 0) pct_esp_vert_2019
FROM ct16
FULL JOIN canopee19 USING (&quot;GeoUID&quot;)
FULL JOIN canopee17 USING (&quot;GeoUID&quot;)
FULL JOIN canopee15 USING (&quot;GeoUID&quot;)
FULL JOIN canopee11 USING (&quot;GeoUID&quot;);</code></pre>
<img src="BEI_equity_paper.final.aoiOK_files/figure-html/get-esp-vert-ct-display-1.png" /><!-- --><img src="BEI_equity_paper.final.aoiOK_files/figure-html/get-esp-vert-ct-display-2.png" /><!-- --><img src="BEI_equity_paper.final.aoiOK_files/figure-html/get-esp-vert-ct-display-3.png" /><!-- --><img src="BEI_equity_paper.final.aoiOK_files/figure-html/get-esp-vert-ct-display-4.png" /><!-- --><img src="BEI_equity_paper.final.aoiOK_files/figure-html/get-esp-vert-ct-display-5.png" /><!-- -->
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["GeoUID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["ct_area_h"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2011"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2011"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2011"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2011"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2015"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2015"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2015"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2015"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2017"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2017"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2017"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2017"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2019"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2019"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2019"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2019"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_2011.2015"],"name":[19],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_2011.2017"],"name":[20],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_2015.2017"],"name":[21],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_high_2011.2015"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_high_2011.2017"],"name":[23],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_high_2015.2017"],"name":[24],"type":["dbl"],"align":["right"]}],"data":[{"1":"4620001.00","2":"46.2","3":"21","4":"7","5":"14.6","6":"46.0","7":"22","8":"8","9":"17.4","10":"47.6","11":"22","12":"8","13":"18.2","14":"48.4","15":"23","16":"9","17":"19.7","18":"49.9","19":"1.6","20":"2.4","21":"0.8","22":"2.8","23":"3.6","24":"0.8","_rn_":"1"},{"1":"4620002.00","2":"38.9","3":"13","4":"7","5":"18.7","6":"34.7","7":"14","8":"8","9":"21.0","10":"35.3","11":"15","12":"8","13":"21.0","14":"37.6","15":"15","16":"8","17":"21.6","18":"38.5","19":"0.6","20":"2.9","21":"2.3","22":"2.3","23":"2.3","24":"0.0","_rn_":"2"},{"1":"4620003.00","2":"74.0","3":"27","4":"13","5":"17.9","6":"37.0","7":"28","8":"15","9":"20.8","10":"37.5","11":"30","12":"16","13":"21.7","14":"41.0","15":"30","16":"16","17":"21.1","18":"41.2","19":"0.5","20":"4.0","21":"3.5","22":"2.9","23":"3.8","24":"0.9","_rn_":"3"},{"1":"4620004.00","2":"44.8","3":"14","4":"9","5":"19.5","6":"31.7","7":"14","8":"9","9":"19.7","10":"31.5","11":"16","12":"10","13":"21.9","14":"35.9","15":"16","16":"10","17":"21.4","18":"36.0","19":"-0.2","20":"4.2","21":"4.4","22":"0.2","23":"2.4","24":"2.2","_rn_":"4"},{"1":"4620005.00","2":"56.4","3":"28","4":"12","5":"20.7","6":"49.0","7":"27","8":"11","9":"20.1","10":"47.3","11":"29","12":"13","13":"23.5","14":"51.2","15":"29","16":"14","17":"24.0","18":"52.0","19":"-1.7","20":"2.2","21":"3.9","22":"-0.6","23":"2.8","24":"3.4","_rn_":"5"},{"1":"4620006.00","2":"64.8","3":"26","4":"12","5":"19.1","6":"40.5","7":"25","8":"11","9":"17.7","10":"38.8","11":"27","12":"14","13":"21.0","14":"41.0","15":"27","16":"14","17":"21.1","18":"41.2","19":"-1.7","20":"0.5","21":"2.2","22":"-1.4","23":"1.9","24":"3.3","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="pampalon-index" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Pampalon index</h2>
<p>Get it <a href="https://www.inspq.qc.ca/en/deprivation/material-and-social-deprivation-index">here</a></p>
<pre class="r"><code>pampalon &lt;- read.xlsx(&quot;data/Canada2016Pampalon/A-MSDIData_Can2016_eng/1. EquivalenceTableCanada2016_ENG.xlsx&quot;, sheet = 2) %&gt;%
  mutate(DA = as.character(DA)) %&gt;%
  select(DA, SCOREMAT, SCORESOC)

# 2016 DA boundaries for Montreal
DA16 &lt;- get_census(dataset=&#39;CA16&#39;, regions=list(CMA=&#39;24462&#39;), level=&#39;DA&#39;, geo_format = &quot;sf&quot;) %&gt;%
  filter(Type == &quot;DA&quot;) %&gt;%
  st_transform(st_crs(bike_lane))</code></pre>
<pre><code>## Reading geo data from local cache.</code></pre>
<pre class="r"><code>pampalon &lt;- DA16 %&gt;%
  inner_join(pampalon, by = c(&quot;GeoUID&quot; = &quot;DA&quot;)) %&gt;%
  as.data.frame()

# Get Pampalon 2006
pampalon06 &lt;- read.xlsx(&quot;data/Canada2006Pampalon/A-MSDIData_Can2006_eng/1. CorrespondenceTable_Can2006_eng.xlsx&quot;, sheet = 2) %&gt;%
  mutate(DA = as.character(DA)) %&gt;%
  select(DA, DAPOP2006, SCOREMAT, SCORESOC)

# Get LUT DA2006 &lt;-&gt; DA2011 from StatCan
lut_da.1 &lt;- read.csv(&quot;data/2011_92-156_DA_AD_txt/2011_92-156_DA_AD.txt&quot;, colClasses = &quot;character&quot;, 
                     header = FALSE, col.names = c(&quot;DAUID2011.ADIDU2011&quot;, &quot;DAUID2006.ADIDU2006&quot;, &quot;DBUID2011&quot;, &quot;DA_rel_flag&quot;)) %&gt;%
  select(!c(DBUID2011, DA_rel_flag)) %&gt;%
  unique()

# Link Pampalon 2011 to LUT and compute weighted mean of scores of Pampalon 2011
# NB: population numbers will diverge from  reality when more than one DA is merged into one DA of next census
pampalon06.11 &lt;- pampalon06 %&gt;%
  inner_join(lut_da.1, by = c(&quot;DA&quot; = &quot;DAUID2006.ADIDU2006&quot;)) %&gt;%
  group_by(DAUID2011.ADIDU2011) %&gt;%
  summarise(pop2006 = sum(DAPOP2006),
            SCOREMAT.06 = weighted.mean(SCOREMAT, DAPOP2006, na.rm = TRUE),
            SCORESOC.06 = weighted.mean(SCORESOC, DAPOP2006, na.rm = TRUE))</code></pre>
<pre><code>## Warning in inner_join(., lut_da.1, by = c(DA = &quot;DAUID2006.ADIDU2006&quot;)): Each row in `x` is expected to match at most 1 row in `y`.
## ‚Ñπ Row 16 of `x` matches multiple rows.
## ‚Ñπ If multiple matches are expected, set `multiple = &quot;all&quot;` to silence this
##   warning.</code></pre>
<pre class="r"><code># Get Pampalon 2011
pampalon11 &lt;- read.xlsx(&quot;data/Canada2011Pampalon/A-MSDIData_Can2011_eng/1. CorrespondenceTable_Can2011_eng.xlsx&quot;, sheet = 2) %&gt;%
  mutate(DA = as.character(DA)) %&gt;%
  select(DA, DAPOP2011, SCOREMAT, SCORESOC)

# Get LUT DA2011 &lt;-&gt; DA2016 from StatCan
lut_da &lt;- read.csv(&quot;data/2016_92-156_DA_AD_csv/2016_92-156_DA_AD.csv&quot;, colClasses = &quot;character&quot;) %&gt;%
  select(!c(DBUID2016.IDIDU2016, DA_rel_flag.AD_ind_rel)) %&gt;%
  unique()

# Link Pampalon 2011 to LUT, then to Pampalon 06 and finally compute weighted mean of scores of Pampalon 2011
pampalon11.16 &lt;- pampalon11 %&gt;%
  inner_join(lut_da, by = c(&quot;DA&quot; = &quot;DAUID2011.ADIDU2011&quot;)) %&gt;%
  left_join(pampalon06.11, by =c(&quot;DA&quot; = &quot;DAUID2011.ADIDU2011&quot;)) %&gt;%
  group_by(DAUID2016.ADIDU2016) %&gt;%
  summarise(pop2011 = sum(DAPOP2011),
            SCOREMAT = weighted.mean(SCOREMAT, DAPOP2011, na.rm = TRUE),
            SCORESOC = weighted.mean(SCORESOC, DAPOP2011, na.rm = TRUE),
            SCOREMAT.06 = weighted.mean(SCOREMAT.06, pop2006, na.rm = TRUE),
            SCORESOC.06 = weighted.mean(SCORESOC.06, pop2006, na.rm = TRUE),
            pop2006 = sum(pop2006))</code></pre>
<pre><code>## Warning in inner_join(., lut_da, by = c(DA = &quot;DAUID2011.ADIDU2011&quot;)): Each row in `x` is expected to match at most 1 row in `y`.
## ‚Ñπ Row 655 of `x` matches multiple rows.
## ‚Ñπ If multiple matches are expected, set `multiple = &quot;all&quot;` to silence this
##   warning.</code></pre>
<pre class="r"><code># Then link Pampalon 2011 to 2016
pampalon &lt;- pampalon %&gt;%
  left_join(pampalon11.16, by = c(&quot;GeoUID&quot; = &quot;DAUID2016.ADIDU2016&quot;), suffix = c(&quot;.16&quot;, &quot;.11&quot;))

# Aggregate at the CT level
pampalon_CT &lt;- pampalon %&gt;%
  group_by(CT_UID) %&gt;%
  summarise(wSCOREMAT.2016 = weighted.mean(SCOREMAT.16, Population, na.rm = TRUE),
            wSCORESOC.2016 = weighted.mean(SCORESOC.16, Population, na.rm = TRUE),
            wSCOREMAT.2011 = weighted.mean(SCOREMAT.11, pop2011, na.rm = TRUE),
            wSCORESOC.2011 = weighted.mean(SCORESOC.11, pop2011, na.rm = TRUE),
            wSCOREMAT.2006 = weighted.mean(SCOREMAT.06, pop2006, na.rm = TRUE),
            wSCORESOC.2006 = weighted.mean(SCORESOC.06, pop2006, na.rm = TRUE))

# Clean up
rm(lut_da, lut_da.1, pampalon11.16, pampalon06.11, pampalon11, pampalon06)

# Display map
.pampalon_CT_geom &lt;- CT16 %&gt;%
  left_join(pampalon_CT, by = c(&quot;GeoUID&quot; = &quot;CT_UID&quot;)) %&gt;%
  filter(interact_aoi)

.pampalon_data &lt;- bi_class(.pampalon_CT_geom, x = wSCOREMAT.2016, y = wSCORESOC.2016, style = &quot;quantile&quot;, dim = 3)</code></pre>
<pre><code>## Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): var
## has missing values, omitted in finding classes</code></pre>
<pre><code>## Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): var
## has missing values, omitted in finding classes</code></pre>
<pre class="r"><code>.map &lt;- ggplot() + 
  geom_sf(data = .pampalon_data, mapping = aes(fill = bi_class), color = &quot;white&quot;, size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = &quot;DkBlue&quot;, dim = 3) +
  labs(title = &quot;Pampalon: material and social deprivation index&quot;) + 
  theme(panel.background = element_rect(fill = &quot;white&quot;),
        #axis.ticks = element_blank(),
        #axis.text = element_blank(),
        panel.grid = element_line(color = &quot;darkgray&quot;, size = 0.2))</code></pre>
<pre><code>## Warning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.
## ‚Ñπ Please use the `linewidth` argument instead.</code></pre>
<pre class="r"><code>.legend &lt;- bi_legend(pal = &quot;DkBlue&quot;,
                    dim = 3,
                    xlab = &quot;Material &quot;,
                    ylab = &quot;Social &quot;,
                    size = 8)
ggdraw() +
  draw_plot(.map, 0, 0, 1, 1) +
  draw_plot(.legend, 0.1, .7, 0.2, 0.2)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/read-pampalon-1.png" /><!-- --></p>
</div>
<div id="gentrification" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Gentrification</h2>
<p>Using Ding metric computed on 5 year span.</p>
<pre class="r"><code># Load gentrified CTs, 5 year span (from repo gentrification_metrics)
ding &lt;- list()
ding[[&quot;2016&quot;]] &lt;- st_read(&quot;data/gentrified_5years.gpkg&quot;, &quot;gentrified_ding_16&quot;, quiet=TRUE) %&gt;%
  filter(cma_uid_16 == &quot;24462&quot;) %&gt;%
  st_transform(st_crs(bike_lane))
ding[[&quot;2011&quot;]] &lt;- st_read(&quot;data/gentrified_5years.gpkg&quot;, &quot;gentrified_ding_11&quot;, quiet=TRUE) %&gt;%
  filter(cma_uid_11 == &quot;24462&quot;) %&gt;%
  st_transform(st_crs(bike_lane))
ding[[&quot;2006&quot;]] &lt;- st_read(&quot;data/gentrified_5years.gpkg&quot;, &quot;gentrified_ding_06&quot;, quiet=TRUE) %&gt;%
  filter(cma_uid_06 == &quot;24462&quot;) %&gt;%
  st_transform(st_crs(bike_lane))

.ding_map &lt;- ding[[&quot;2016&quot;]] %&gt;%
  mutate(gentrification_status = factor(case_when(!gentrifiable_2011 ~ &quot;Non eligible&quot;, 
                                           gentrifiable_2011 &amp; !gentrified_2016_2011 ~ &quot;Not gentrified&quot;,
                                           gentrified_2016_2011 ~ &quot;Gentrified&quot;), levels = c(&quot;Non eligible&quot;, &quot;Not gentrified&quot;, &quot;Gentrified&quot;))) %&gt;%
  left_join(select(as.data.frame(CT16), GeoUID, interact_aoi), by = c(&quot;ct_uid_16&quot; = &quot;GeoUID&quot;)) %&gt;%
  filter(interact_aoi)

ggplot(data = .ding_map) + 
  geom_sf(aes(fill = gentrification_status)) +
  scale_fill_manual(values = c(&quot;lightgray&quot;, &quot;yellow&quot;, &quot;red&quot;), name = &quot;Gentrification status in 2016&quot;) +
  #labs(title = &quot;Census tract gentrification status in 2016&quot;) +
  theme_void(base_size = 20)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/ding-load-1.png" /><!-- --></p>
</div>
<div id="equity-metrics-low-income-population-and-visible-minority" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Equity metrics | low-income population and visible minority</h2>
<p>Introduced here as a proposition, nothing acted (2022-02-04)</p>
<pre class="r"><code># Visible Minority
# - v_CA16_3954: Total - Visible minority for the population in private households - 25% sample data (Total)
# - v_CA16_3957: Total visible minority population (Total)

# Low income (LIM-AT)
# - v_CA16_2540: Prevalence of low income based on the Low-income measure, after tax (LIM-AT) (%) (Total)
equity_ct16 &lt;- get_census(dataset=&#39;CA16&#39;, regions=list(CMA=&#39;24462&#39;), level=&#39;CT&#39;, geo_format = &quot;sf&quot;,
                          vectors = c(&quot;v_CA16_3954&quot;, &quot;v_CA16_3957&quot;, &quot;v_CA16_2540&quot;)) %&gt;%
  filter(Type == &quot;CT&quot;) %&gt;%
  transmute(CT_UID = GeoUID,
            vis_minority_2016 = `v_CA16_3957: Total visible minority population` / `v_CA16_3954: Total - Visible minority for the population in private households - 25% sample data` * 100,
            low_income_2016 = `v_CA16_2540: Prevalence of low income based on the Low-income measure, after tax (LIM-AT) (%)`)</code></pre>
<pre><code>## Reading vectors data from local cache.</code></pre>
<pre><code>## Reading geo data from local cache.</code></pre>
<pre class="r"><code># Visible Minority
# - v_CA11N_457: CA 2011 NHS, Total population in private households by visible minority (Total)
# - v_CA11N_460: CA 2011 NHS, Total population in private households by visible minority, Total visible minority population (Total)

# Low income (LIM-AT)
# - v_CA11N_2606: CA 2011 NHS, Prevalence of low income in 2010 based on after-tax low-income measure % (Total)
equity_ct11 &lt;- get_census(dataset=&#39;CA11&#39;, regions=list(CMA=&#39;24462&#39;), level=&#39;CT&#39;, geo_format = &quot;sf&quot;,
                          vectors = c(&quot;v_CA11N_457&quot;, &quot;v_CA11N_460&quot;, &quot;v_CA11N_2606&quot;)) %&gt;%
  filter(Type == &quot;CT&quot;) %&gt;%
  transmute(CT_UID = GeoUID,
            vis_minority_2011 = `v_CA11N_460: Total visible minority population` / `v_CA11N_457: Total population in private households by visible minority` * 100,
            low_income_2011 = `v_CA11N_2606: Prevalence of low income in 2010 based on after-tax low-income measure %`)</code></pre>
<pre><code>## Reading vectors data from local cache.
## Reading geo data from local cache.</code></pre>
<pre class="r"><code># Visible Minority
# - v_CA06_1302: Total population by visible minority groups
# - v_CA06_1303: Total population by visible minority groups, Total visible minority population

# Low income (LIM-AT)
# - v_TX2006_551: After-tax low income status of tax filers and dependents (census family low income measure, CFLIM-AT) for couple and lone parent families by family composition, 2006 | All family units | Persons in Low Income | % - Total
equity_ct06 &lt;- get_census(dataset=&#39;CA06&#39;, regions=list(CMA=&#39;24462&#39;), level=&#39;CT&#39;, geo_format = &quot;sf&quot;,
                          vectors = c(&quot;v_CA06_1302&quot;, &quot;v_CA06_1303&quot;, &quot;v_TX2006_551&quot;)) %&gt;%
  filter(Type == &quot;CT&quot;) %&gt;%
  transmute(CT_UID = GeoUID,
            vis_minority_2006 = `v_CA06_1303: Total visible minority population` / `v_CA06_1302: Total population by visible minority groups - 20% sample data` * 100,
            low_income_2006 = `v_TX2006_551: % - Total`)</code></pre>
<pre><code>## Reading vectors data from local cache.
## Reading geo data from local cache.</code></pre>
<pre class="r"><code>equity_ct &lt;- st_join(equity_ct16, equity_ct11, left=TRUE, largest=TRUE, suffix=c(&quot;&quot;, &quot;_2011&quot;)) %&gt;% # join on largest overlap, to overcome mismatch in CT UID
  st_join(equity_ct06, left=TRUE, largest=TRUE, suffix=c(&quot;&quot;, &quot;_2006&quot;)) %&gt;%
  data.frame()</code></pre>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout all
## geometries

## Warning: attribute variables are assumed to be spatially constant throughout all
## geometries</code></pre>
<pre class="r"><code># cleanup
rm(equity_ct11, equity_ct16, equity_ct06)

# Display map
.equity_CT_geom &lt;- CT16 %&gt;%
  left_join(equity_ct, by = c(&quot;GeoUID&quot; = &quot;CT_UID&quot;)) %&gt;%
  filter(interact_aoi)

.equity_data &lt;- bi_class(.equity_CT_geom, x = vis_minority_2016, y = low_income_2016, style = &quot;quantile&quot;, dim = 3)</code></pre>
<pre><code>## Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): var
## has missing values, omitted in finding classes</code></pre>
<pre><code>## Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): var
## has missing values, omitted in finding classes</code></pre>
<pre class="r"><code>.map &lt;- ggplot() + 
  geom_sf(data = .equity_data, mapping = aes(fill = bi_class), color = &quot;white&quot;, size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = &quot;Brown&quot;, dim = 3) +
  labs(title = &quot;Equity metrics: % of visible minority and % of low-income household&quot;) + 
  theme(panel.background = element_rect(fill = &quot;white&quot;),
        #axis.ticks = element_blank(),
        #axis.text = element_blank(),
        panel.grid = element_line(color = &quot;darkgray&quot;, size = 0.2))
.legend &lt;- bi_legend(pal = &quot;Brown&quot;,
                    dim = 3,
                    xlab = &quot;Vis. Minority &quot;,
                    ylab = &quot;Low-Income &quot;,
                    size = 8)
ggdraw() +
  draw_plot(.map, 0, 0, 1, 1) +
  draw_plot(.legend, 0.1, .7, 0.2, 0.2)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/equity-metrics-1.png" /><!-- --></p>
</div>
<div id="build-complete-dataset" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Build complete dataset</h2>
<p>All variables + outcome linked at the CT level + quintiles of SES variables</p>
<pre class="r"><code>.bike_lane_changes &lt;- bike_lane_changes %&gt;%
  as.data.frame() %&gt;%
  select(GeoUID, starts_with(&quot;street_length&quot;), ends_with(&quot;ct&quot;, ignore.case = FALSE)) %&gt;%
  select(GeoUID, starts_with(&quot;street_length&quot;), starts_with(&quot;Bike_lane&quot;)) # Drop individual category lane length

bei_df &lt;- CT16 %&gt;%
  as.data.frame() %&gt;%
  transmute(CT_UID = GeoUID,
            CD_UID = CD_UID,
            CSD_UID = CSD_UID,
            interact_aoi = interact_aoi,
            zone = case_when(CD_UID == &quot;2466&quot; ~ &quot;Montreal&quot;,
                             CD_UID == &quot;2458&quot; ~ &quot;Longueuil&quot;,
                             CD_UID == &quot;2465&quot; ~ &quot;Laval&quot;,
                             TRUE ~ &quot;Other&quot;),
            Population = Population) %&gt;%
  left_join(pampalon_CT, by=&quot;CT_UID&quot;) %&gt;%
  left_join(select(as.data.frame(ding$`2016`), ct_uid_16, starts_with(&quot;gentrif&quot;)), by=c(&quot;CT_UID&quot; = &quot;ct_uid_16&quot;)) %&gt;%
  mutate(gentrif_status_2016 = factor(case_when(!gentrifiable_2011 ~ &quot;Non eligible&quot;, 
                                           gentrifiable_2011 &amp; !gentrified_2016_2011 ~ &quot;Not gentrified&quot;,
                                           gentrified_2016_2011 ~ &quot;Gentrified&quot;), levels = c(&quot;Non eligible&quot;, &quot;Not gentrified&quot;, &quot;Gentrified&quot;))) %&gt;%
  left_join(select(as.data.frame(ding$`2011`), ct_uid_11, starts_with(&quot;gentrif&quot;)), by=c(&quot;CT_UID&quot; = &quot;ct_uid_11&quot;)) %&gt;%
  mutate(gentrif_status_2011 = factor(case_when(!gentrifiable_2006 ~ &quot;Non eligible&quot;, 
                                           gentrifiable_2006 &amp; !gentrified_2011_2006 ~ &quot;Not gentrified&quot;,
                                           gentrified_2011_2006 ~ &quot;Gentrified&quot;), levels = c(&quot;Non eligible&quot;, &quot;Not gentrified&quot;, &quot;Gentrified&quot;))) %&gt;%
  left_join(select(as.data.frame(ding$`2006`), ct_uid_06, starts_with(&quot;gentrif&quot;)), by=c(&quot;CT_UID&quot; = &quot;ct_uid_06&quot;)) %&gt;%
  mutate(gentrif_status_2006 = factor(case_when(!gentrifiable_2001 ~ &quot;Non eligible&quot;, 
                                           gentrifiable_2001 &amp; !gentrified_2006_2001 ~ &quot;Not gentrified&quot;,
                                           gentrified_2006_2001 ~ &quot;Gentrified&quot;), levels = c(&quot;Non eligible&quot;, &quot;Not gentrified&quot;, &quot;Gentrified&quot;))) %&gt;%
  left_join(select(as.data.frame(equity_ct), !c(&quot;geometry&quot;, &quot;CT_UID_2011&quot;, &quot;CT_UID_2006&quot;)), by=&quot;CT_UID&quot;) %&gt;%
  left_join(.bike_lane_changes, by=c(&quot;CT_UID&quot; = &quot;GeoUID&quot;)) %&gt;%
  left_join(as.data.frame(rename_with(esp_vert_ct, ~ paste0(., &quot;ct&quot;))), by=c(&quot;CT_UID&quot; = &quot;GeoUIDct&quot;)) %&gt;%
  # Compute quintile of SES variables
  mutate(wSCOREMAT.2006.Q = ntile(wSCOREMAT.2006, 5),
         wSCOREMAT.2011.Q = ntile(wSCOREMAT.2011, 5),
         wSCOREMAT.2016.Q = ntile(wSCOREMAT.2016, 5),
         low_income_2006.Q = ntile(low_income_2006, 5),
         low_income_2011.Q = ntile(low_income_2011, 5),
         low_income_2016.Q = ntile(low_income_2016, 5),
         vis_minority_2006.Q = ntile(vis_minority_2006, 5),
         vis_minority_2011.Q = ntile(vis_minority_2011, 5),
         vis_minority_2016.Q = ntile(vis_minority_2016, 5)) %&gt;%
  units::drop_units() %&gt;%
  # UPDATE 2023-03-16: adding change dependent variables
  mutate(change.2011.2016.2states = case_when((Bike_lane_total.2011ct &gt; 0) &amp; (Bike_lane_total.2016ct &gt; 0) ~ FALSE,
                                              (Bike_lane_total.2011ct == 0) &amp; (Bike_lane_total.2016ct == 0) ~ FALSE,
                                              TRUE ~ TRUE),
         change.2011.2016.3states = case_when((Bike_lane_total.2011ct == 0) &amp; (Bike_lane_total.2016ct == 0) ~ &#39;No bike lane&#39;,
                                              (Bike_lane_total.2011ct == 0) &amp; (Bike_lane_total.2016ct &gt; 0) ~ &#39;New bike lanes&#39;,
                                              (Bike_lane_total.2011ct &gt; 0) &amp; (Bike_lane_total.2016ct &gt; 0) ~ &#39;No new bike lane&#39;))
  
  
head(bei_df)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["CT_UID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["CD_UID"],"name":[2],"type":["chr"],"align":["left"]},{"label":["CSD_UID"],"name":[3],"type":["chr"],"align":["left"]},{"label":["interact_aoi"],"name":[4],"type":["lgl"],"align":["right"]},{"label":["zone"],"name":[5],"type":["chr"],"align":["left"]},{"label":["Population"],"name":[6],"type":["int"],"align":["right"]},{"label":["wSCOREMAT.2016"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["wSCORESOC.2016"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["wSCOREMAT.2011"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["wSCORESOC.2011"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["wSCOREMAT.2006"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["wSCORESOC.2006"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["gentrified_2016_2011"],"name":[13],"type":["lgl"],"align":["right"]},{"label":["gentrifiable_2011"],"name":[14],"type":["lgl"],"align":["right"]},{"label":["gentrif_status_2016"],"name":[15],"type":["fct"],"align":["left"]},{"label":["gentrified_2011_2006"],"name":[16],"type":["lgl"],"align":["right"]},{"label":["gentrifiable_2006"],"name":[17],"type":["lgl"],"align":["right"]},{"label":["gentrif_status_2011"],"name":[18],"type":["fct"],"align":["left"]},{"label":["gentrified_2006_2001"],"name":[19],"type":["lgl"],"align":["right"]},{"label":["gentrifiable_2001"],"name":[20],"type":["lgl"],"align":["right"]},{"label":["gentrif_status_2006"],"name":[21],"type":["fct"],"align":["left"]},{"label":["vis_minority_2016"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["low_income_2016"],"name":[23],"type":["dbl"],"align":["right"]},{"label":["vis_minority_2011"],"name":[24],"type":["dbl"],"align":["right"]},{"label":["low_income_2011"],"name":[25],"type":["dbl"],"align":["right"]},{"label":["vis_minority_2006"],"name":[26],"type":["dbl"],"align":["right"]},{"label":["low_income_2006"],"name":[27],"type":["dbl"],"align":["right"]},{"label":["street_length"],"name":[28],"type":["dbl"],"align":["right"]},{"label":["street_length.hm"],"name":[29],"type":["dbl"],"align":["right"]},{"label":["Bike_lane_total.2016ct"],"name":[30],"type":["dbl"],"align":["right"]},{"label":["Bike_lane_total.2011ct"],"name":[31],"type":["dbl"],"align":["right"]},{"label":["Bike_lane_total.2006ct"],"name":[32],"type":["dbl"],"align":["right"]},{"label":["Bike_lane_total.hm.2016ct"],"name":[33],"type":["int"],"align":["right"]},{"label":["Bike_lane_total.hm.2011ct"],"name":[34],"type":["int"],"align":["right"]},{"label":["Bike_lane_total.hm.2006ct"],"name":[35],"type":["int"],"align":["right"]},{"label":["Bike_lane.by.street.2016ct"],"name":[36],"type":["dbl"],"align":["right"]},{"label":["Bike_lane.by.street.2011ct"],"name":[37],"type":["dbl"],"align":["right"]},{"label":["Bike_lane.by.street.2006ct"],"name":[38],"type":["dbl"],"align":["right"]},{"label":["Bike_lane_diff.2011.2016ct"],"name":[39],"type":["dbl"],"align":["right"]},{"label":["Bike_lane_diff.by.street.2011.2016ct"],"name":[40],"type":["dbl"],"align":["right"]},{"label":["ct_area_hct"],"name":[41],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2011ct"],"name":[42],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2011ct"],"name":[43],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2011ct"],"name":[44],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2011ct"],"name":[45],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2015ct"],"name":[46],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2015ct"],"name":[47],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2015ct"],"name":[48],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2015ct"],"name":[49],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2017ct"],"name":[50],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2017ct"],"name":[51],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2017ct"],"name":[52],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2017ct"],"name":[53],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2019ct"],"name":[54],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2019ct"],"name":[55],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2019ct"],"name":[56],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2019ct"],"name":[57],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_2011.2015ct"],"name":[58],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_2011.2017ct"],"name":[59],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_2015.2017ct"],"name":[60],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_high_2011.2015ct"],"name":[61],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_high_2011.2017ct"],"name":[62],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_high_2015.2017ct"],"name":[63],"type":["dbl"],"align":["right"]},{"label":["wSCOREMAT.2006.Q"],"name":[64],"type":["int"],"align":["right"]},{"label":["wSCOREMAT.2011.Q"],"name":[65],"type":["int"],"align":["right"]},{"label":["wSCOREMAT.2016.Q"],"name":[66],"type":["int"],"align":["right"]},{"label":["low_income_2006.Q"],"name":[67],"type":["int"],"align":["right"]},{"label":["low_income_2011.Q"],"name":[68],"type":["int"],"align":["right"]},{"label":["low_income_2016.Q"],"name":[69],"type":["int"],"align":["right"]},{"label":["vis_minority_2006.Q"],"name":[70],"type":["int"],"align":["right"]},{"label":["vis_minority_2011.Q"],"name":[71],"type":["int"],"align":["right"]},{"label":["vis_minority_2016.Q"],"name":[72],"type":["int"],"align":["right"]},{"label":["change.2011.2016.2states"],"name":[73],"type":["lgl"],"align":["right"]},{"label":["change.2011.2016.3states"],"name":[74],"type":["chr"],"align":["left"]}],"data":[{"1":"4620149.00","2":"2466","3":"2466023","4":"TRUE","5":"Montreal","6":"3161","7":"-0.049248759","8":"0.057190321","9":"-0.02978953","10":"0.0594421910","11":"-0.02369179","12":"0.037338622","13":"FALSE","14":"TRUE","15":"Not gentrified","16":"TRUE","17":"TRUE","18":"Gentrified","19":"TRUE","20":"TRUE","21":"Gentrified","22":"15.35948","23":"22.0","24":"15.54828","25":"30.8","26":"12.59843","27":"23.91","28":"3154.205","29":"31.54205","30":"1208.5717","31":"688.5246","32":"577.1925","33":"12","34":"7","35":"6","36":"38.31620","37":"21.82878","38":"18.29914","39":"520.0470959","40":"16.487419915","41":"13.8","42":"3","43":"3","44":"21.8","45":"24.8","46":"4","47":"4","48":"26.4","49":"28.7","50":"4","51":"4","52":"29.2","53":"31.4","54":"4","55":"4","56":"28.7","57":"32.1","58":"3.9","59":"6.6","60":"2.7","61":"4.6","62":"7.4","63":"2.8","64":"2","65":"1","66":"1","67":"4","68":"5","69":"4","70":"3","71":"3","72":"3","73":"FALSE","74":"No new bike lane","_rn_":"1"},{"1":"4620185.00","2":"2466","3":"2466023","4":"TRUE","5":"Montreal","6":"5217","7":"0.002586202","8":"0.052690760","9":"0.01135986","10":"0.0457714081","11":"0.02030788","12":"0.046134103","13":"TRUE","14":"TRUE","15":"Gentrified","16":"TRUE","17":"TRUE","18":"Gentrified","19":"FALSE","20":"TRUE","21":"Not gentrified","22":"16.13217","23":"20.1","24":"17.59082","25":"27.6","26":"12.25490","27":"23.29","28":"7641.672","29":"76.41672","30":"1069.1814","31":"1069.4042","32":"0.0000","33":"11","34":"11","35":"0","36":"13.99146","37":"13.99437","38":"0.00000","39":"-0.2227721","40":"-0.002915228","41":"39.3","42":"12","43":"8","44":"20.6","45":"29.4","46":"11","47":"8","48":"20.0","49":"29.0","50":"13","51":"10","52":"24.3","53":"33.7","54":"14","55":"9","56":"22.1","57":"34.7","58":"-0.4","59":"4.3","60":"4.7","61":"-0.6","62":"3.7","63":"4.3","64":"4","65":"3","66":"3","67":"4","68":"4","69":"4","70":"3","71":"3","72":"3","73":"FALSE","74":"No new bike lane","_rn_":"2"},{"1":"4620222.00","2":"2466","3":"2466023","4":"TRUE","5":"Montreal","6":"3587","7":"0.082313210","8":"0.014476934","9":"0.09282443","10":"0.0052905841","11":"0.09663123","12":"-0.004537943","13":"FALSE","14":"TRUE","15":"Not gentrified","16":"TRUE","17":"TRUE","18":"Gentrified","19":"FALSE","20":"TRUE","21":"Not gentrified","22":"57.91610","23":"35.1","24":"57.56359","25":"39.5","26":"50.00000","27":"41.79","28":"4155.251","29":"41.55251","30":"1059.5655","31":"0.0000","32":"0.0000","33":"11","34":"0","35":"0","36":"25.49944","37":"0.00000","38":"0.00000","39":"1059.5654725","40":"25.499435195","41":"19.9","42":"5","43":"2","44":"11.7","45":"24.9","46":"5","47":"2","48":"11.4","49":"24.0","50":"6","51":"3","52":"14.2","53":"29.6","54":"5","55":"3","56":"13.6","57":"26.9","58":"-0.9","59":"4.7","60":"5.6","61":"-0.3","62":"2.5","63":"2.8","64":"5","65":"5","66":"5","67":"5","68":"5","69":"5","70":"5","71":"5","72":"5","73":"TRUE","74":"New bike lanes","_rn_":"3"},{"1":"4620117.00","2":"2466","3":"2466023","4":"TRUE","5":"Montreal","6":"4359","7":"0.034245133","8":"0.006085192","9":"0.06315153","10":"0.0009442053","11":"0.03645207","12":"0.010056370","13":"TRUE","14":"TRUE","15":"Gentrified","16":"FALSE","17":"TRUE","18":"Not gentrified","19":"TRUE","20":"TRUE","21":"Gentrified","22":"84.76071","23":"27.5","24":"80.62201","25":"40.6","26":"73.28520","27":"41.64","28":"3360.624","29":"33.60624","30":"0.0000","31":"0.0000","32":"0.0000","33":"0","34":"0","35":"0","36":"0.00000","37":"0.00000","38":"0.00000","39":"0.0000000","40":"0.000000000","41":"27.1","42":"6","43":"4","44":"14.7","45":"20.9","46":"6","47":"4","48":"15.2","49":"22.7","50":"8","51":"5","52":"17.8","53":"27.8","54":"7","55":"4","56":"16.1","57":"26.8","58":"1.8","59":"6.9","60":"5.1","61":"0.5","62":"3.1","63":"2.6","64":"5","65":"5","66":"5","67":"5","68":"5","69":"5","70":"5","71":"5","72":"5","73":"FALSE","74":"No bike lane","_rn_":"4"},{"1":"4620124.00","2":"2466","3":"2466023","4":"TRUE","5":"Montreal","6":"5729","7":"0.020820044","8":"0.047056282","9":"0.02972110","10":"0.0401421555","11":"0.02970024","12":"0.039865255","13":"FALSE","14":"TRUE","15":"Not gentrified","16":"TRUE","17":"TRUE","18":"Gentrified","19":"TRUE","20":"TRUE","21":"Gentrified","22":"55.86690","23":"36.6","24":"51.55172","25":"47.0","26":"41.18151","27":"47.58","28":"5169.698","29":"51.69698","30":"781.5758","31":"0.0000","32":"0.0000","33":"8","34":"0","35":"0","36":"15.11840","37":"0.00000","38":"0.00000","39":"781.5758193","40":"15.118404503","41":"37.7","42":"12","43":"9","44":"23.4","45":"32.3","46":"13","47":"10","48":"25.9","49":"34.2","50":"15","51":"11","52":"29.4","53":"38.8","54":"14","55":"11","56":"28.3","57":"37.6","58":"1.9","59":"6.5","60":"4.6","61":"2.5","62":"6.0","63":"3.5","64":"5","65":"4","66":"4","67":"5","68":"5","69":"5","70":"5","71":"5","72":"5","73":"TRUE","74":"New bike lanes","_rn_":"5"},{"1":"4620306.00","2":"2466","3":"2466023","4":"TRUE","5":"Montreal","6":"2847","7":"0.030925210","8":"0.054219900","9":"0.03587117","10":"0.0427824009","11":"0.04348091","12":"0.040864073","13":"TRUE","14":"TRUE","15":"Gentrified","16":"TRUE","17":"TRUE","18":"Gentrified","19":"TRUE","20":"TRUE","21":"Gentrified","22":"16.21129","23":"24.4","24":"19.69981","25":"29.3","26":"14.71049","27":"32.79","28":"3734.591","29":"37.34591","30":"1086.4298","31":"537.5893","32":"537.5893","33":"11","34":"5","35":"5","36":"29.09100","37":"14.39486","38":"14.39486","39":"548.8405550","40":"14.696136132","41":"22.3","42":"7","43":"2","44":"9.6","45":"33.0","46":"8","47":"3","48":"11.7","49":"36.3","50":"9","51":"3","52":"13.7","53":"39.6","54":"7","55":"3","56":"14.0","57":"30.1","58":"3.3","59":"6.6","60":"3.3","61":"2.1","62":"4.1","63":"2.0","64":"5","65":"5","66":"5","67":"5","68":"5","69":"4","70":"3","71":"3","72":"3","73":"FALSE","74":"No new bike lane","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>write.csv(bei_df, &quot;data/_results/bei_equity.csv&quot;, na=&quot;&quot;, row.names = FALSE)

# keep only interact CT 
# UPDATE 2022-07-07 ##########
# and recompute quintiles for the new AOI
bei_df_aoi &lt;- filter(bei_df, interact_aoi) %&gt;%
  mutate(wSCOREMAT.2006.Q = ntile(wSCOREMAT.2006, 5),
         wSCOREMAT.2011.Q = ntile(wSCOREMAT.2011, 5),
         wSCOREMAT.2016.Q = ntile(wSCOREMAT.2016, 5),
         low_income_2006.Q = ntile(low_income_2006, 5),
         low_income_2011.Q = ntile(low_income_2011, 5),
         low_income_2016.Q = ntile(low_income_2016, 5),
         vis_minority_2006.Q = ntile(vis_minority_2006, 5),
         vis_minority_2011.Q = ntile(vis_minority_2011, 5),
         vis_minority_2016.Q = ntile(vis_minority_2016, 5),
         # Need to reorder factor in order to get the proper dummy variables in models below
         gentrif_status_2016 = forcats::fct_relevel(gentrif_status_2016, &quot;Not gentrified&quot;, &quot;Gentrified&quot;, &quot;Non eligible&quot;))</code></pre>
<p>Included variables:</p>
<ul>
<li>Census Tracts variables
<ul>
<li><code>CT_UID</code>: 2016 Census Tract ID</li>
<li><code>CD_UID</code>: 2016 Census Division</li>
<li><code>CSD_UID</code>: 2016 Census Subdivision</li>
<li><code>interact_aoi</code>: Does CT belong to INTERACT study area?</li>
<li><code>zone</code>: Montreal / Laval / Longueuil, etc. / Other</li>
<li><code>Population</code>: 2016 Population within CT</li>
<li><code>ct_area_m2ct</code>: Area of CT, in square meters</li>
</ul></li>
<li>Gentrification metrics
<ul>
<li><code>gentrified_2016_2011</code>: Is the CT gentrified in 2016?</li>
<li><code>gentrifiable_2011</code>: Is the CT candidate to gentrification in 2011?</li>
<li><code>gentrif_status_2016</code>: 3-state gentrification status in 2016 (Gentrified/Not gentrified/Non eligible)</li>
<li><code>gentrified_2011_2006</code>: Is the CT gentrified in 2011</li>
<li><code>gentrifiable_2006</code>: Is the CT candidate to gentrification in 2006</li>
<li><code>gentrif_status_2011</code>: 3-state gentrification status in 2011 (Gentrified/Not gentrified/Non eligible)</li>
<li><code>gentrified_2006_2001</code>: Is the CT gentrified in 2006</li>
<li><code>gentrifiable_2001</code>: Is the CT candidate to gentrification in 2001</li>
<li><code>gentrif_status_2006</code>: 3-state gentrification status in 2006 (Gentrified/Not gentrified/Non eligible)</li>
</ul></li>
<li>Pampalon‚Äôs metrics
<ul>
<li><code>wSCORESOC.2016</code>: Social deprivation index in 2016 (population weighted)</li>
<li><code>wSCOREMAT.2016</code>: Material deprivation index in 2016 (population weighted)</li>
<li><code>wSCOREMAT.2016.Q</code>: Quintile of material deprivation index in 2016 (population weighted)</li>
<li><code>wSCORESOC.2011</code>: Social deprivation index in 2011 (population weighted)</li>
<li><code>wSCOREMAT.2011</code>: Material deprivation index in 2011 (population weighted)</li>
<li><code>wSCOREMAT.2011.Q</code>: Quintile of aterial deprivation index in 2011 (population weighted)</li>
<li><code>wSCORESOC.2006</code>: Social deprivation index in 2006 (population weighted)</li>
<li><code>wSCOREMAT.2006</code>: Material deprivation index in 2006 (population weighted)</li>
<li><code>wSCOREMAT.2006.Q</code>: Quintile of material deprivation index in 2006 (population weighted)</li>
</ul></li>
<li>Social profile
<ul>
<li><code>vis_minority_2016</code>: % of visible minority in CT 2016</li>
<li><code>vis_minority_2016.Q</code>: Quintile of % of visible minority in CT 2016</li>
<li><code>low_income_2016</code>: prevalence of low income in CT 2016</li>
<li><code>low_income_2016.Q</code>: Quintile of prevalence of low income in CT 2016</li>
<li><code>vis_minority_2011</code>: % of visible minority in CT 2011</li>
<li><code>vis_minority_2011.Q</code>: Quintile of % of visible minority in CT 2011</li>
<li><code>low_income_2011</code>: prevalence of low income in CT 2011</li>
<li><code>low_income_2011.Q</code>: Quintile of prevalence of low income in CT 2011</li>
<li><code>vis_minority_2006</code>: % of visible minority in CT 2006</li>
<li><code>vis_minority_2006.Q</code>: Quintile of % of visible minority in CT 2006</li>
<li><code>low_income_2006</code>: prevalence of low income in CT 2006</li>
<li><code>low_income_2006.Q</code>: Qintile of prevalence of low income in CT 2006</li>
</ul></li>
<li>Bike lane density
<ul>
<li><code>Bike_lane_total.{2016|2011}ct</code>: total length of bike lanes, in 2016 or 2011, within CT</li>
<li><code>Bike_lane_total.hm.{2016|2011}ct</code>: total length of bike lanes, in hectometers (as integers), in 2016 or 2011, within CT</li>
<li><code>Bike_lane.by.street.{2016|2011}ct</code>: % of bike lanes compared to streets, in 2016 or 2011, within CT</li>
<li><code>Bike_lane_diff.2011.2016ct</code>: change in total length of bike lanes between 2011 and 2016, within CT</li>
<li><code>Bike_lane_diff.by.street.2011.2016ct</code>: change in total length of bike lanes between 2011 and 2011, normalized by street length, within CT</li>
<li><code>Bike_lane_diff.by.area.2011.2016ct</code>: change in total length of bike lanes between 2011 and 2011, normalized by area, within CT</li>
</ul></li>
<li>Green spaces
<ul>
<li><code>area_esp_vert_{2011|2015|2019}ct</code>: area of green space in 2011, 2015 or 2019 within CT (in hectares)</li>
<li><code>area_esp_vert_high_{2011|2015|2019}ct</code>: same as above, except for trees (high canopy)</li>
<li><code>pct_esp_vert_{2011|2015|2019}ct</code>: % of green space in 2011, 2015 or 2019 within CT</li>
<li><code>pct_esp_vert_high_{2011|2015|2019}ct</code>: same as above, except for trees (high canopy)</li>
<li><code>pct_esp_vert_diff{2011|2015}.{2015|2019}ct</code>: change in % of green space between 2011 and 2015, 2011 and 2019 as well as 2011 and 2019, within CT</li>
</ul></li>
</ul>
</div>
</div>
<div id="preliminary-analyses" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Preliminary analyses</h1>
<p>INTERACT study area ~ Montr√©al, Laval, Longueuil, Brossard, St-Lambert</p>
<div id="ses-variable-distribution" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> SES variable distribution</h2>
<pre class="r"><code>.bei_df_long &lt;- bei_df_aoi %&gt;% 
  select(CT_UID, CD_UID, starts_with(&quot;wSCORE&quot;)) %&gt;%
  select(!ends_with(&#39;.Q&#39;)) %&gt;%
  pivot_longer(!c(CT_UID, CD_UID))

ggplot(.bei_df_long, aes(value)) +
  geom_histogram() + 
  facet_wrap(~name) #, scales = &quot;free&quot;)</code></pre>
<pre><code>## Warning: Removed 80 rows containing non-finite values (`stat_bin()`).</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/outcome-distribution-aoi-1.png" /><!-- --></p>
<pre class="r"><code>.bei_df_long &lt;- bei_df_aoi %&gt;%
  select(CT_UID, CD_UID, starts_with(&quot;vis_minority&quot;), starts_with(&quot;low_income&quot;)) %&gt;%
  select(!ends_with(&#39;.Q&#39;)) %&gt;%
  pivot_longer(!c(CT_UID, CD_UID))

ggplot(.bei_df_long, aes(value)) +
  geom_histogram() + 
  facet_wrap(~name) #, scales = &quot;free&quot;)</code></pre>
<pre><code>## Warning: Removed 79 rows containing non-finite values (`stat_bin()`).</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/outcome-distribution-aoi-2.png" /><!-- --></p>
<pre class="r"><code>.bei_df_long &lt;- bei_df_aoi %&gt;%
  select(CT_UID, CD_UID, starts_with(&quot;gentrif_status&quot;)) %&gt;%
  select(!ends_with(&#39;.Q&#39;)) %&gt;%
  pivot_longer(!c(CT_UID, CD_UID))

ggplot(.bei_df_long, aes(value)) +
  geom_bar() + 
  facet_wrap(~name) #, scales = &quot;free&quot;, ncol = 3)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/outcome-distribution-aoi-3.png" /><!-- --></p>
</div>
<div id="bei-variable-distributions" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> BEI variable distributions</h2>
<div id="absolute-values" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Absolute values</h3>
<pre class="r"><code>.bei_df_long &lt;- bei_df_aoi %&gt;% 
  filter(interact_aoi) %&gt;%
  select(CT_UID, CD_UID, matches(&quot;^Bike_lane_total.*ct$&quot;), matches(&quot;^area_esp_vert.*ct$&quot;)) %&gt;%
  pivot_longer(!c(CT_UID, CD_UID))

ggplot(.bei_df_long, aes(value)) +
  geom_histogram() + 
  facet_wrap(~name, scales = &quot;free&quot;, ncol = 4)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/var-abs-distribution-ct-aoi-1.png" /><!-- --></p>
</div>
<div id="relative-values" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Relative values</h3>
<pre class="r"><code>.bei_df_long &lt;- bei_df_aoi %&gt;% 
  filter(interact_aoi) %&gt;%
  select(CT_UID, CD_UID, matches(&quot;^Bike_lane.by.*ct$&quot;), matches(&quot;^pct_esp_vert.*ct$&quot;)) %&gt;%
  pivot_longer(!c(CT_UID, CD_UID))

ggplot(.bei_df_long, aes(value)) +
  geom_histogram() + 
  facet_wrap(~name, scales = &quot;free&quot;, ncol = 3)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/var-rel-distribution-ct-aoi-1.png" /><!-- --></p>
</div>
</div>
</div>
<div id="association-between-ses-and-urban-conditions-at-baseline-2011" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Association between SES and Urban Conditions at baseline (2011)</h1>
<p>Looking at objective #1: <em>do urban interventions tend to be located in low SES neighborhoods?</em>. We look at <span class="math display">\[Urban Condition_{2011} = f(SES_{2011})\]</span> as well as <span class="math display">\[Urban Condition_{2011} = f(Gentrification_{2011 \to 2016})\]</span></p>
<p>Here <span class="math inline">\(UrbanCondition\)</span> means the state of the urban environment features, such as length of bike lanes, greenness coverage, etc. at one specific moment. This needs to be distinguished from <span class="math inline">\(UrbanIntervention\)</span>, which accounts for the <strong>changes</strong> in the <span class="math inline">\(UrbanConditions\)</span> between two years (see below).</p>
<p>We fit LMM models, with spatial random effect using <code>spaMM</code> package.</p>
<div id="uc-vs-pampalon-material" class="section level2 tabset" number="4.1">
<h2 class="tabset"><span class="header-section-number">4.1</span> UC vs Pampalon | material</h2>
<div id="bike-lane-length-hurdle" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Bike lane length (hurdle)</h3>
<p>Bike lane ratio to streets at the Census tract level. We use an offset, as explained in <a href="https://education.illinois.edu/docs/default-source/carolyn-anderson/edpsy589/lectures/4_glm/4glm_3_beamer_post.pdf">Anderson‚Äôs presentation</a>, to handle the denominator and model the Bike lane length in hectometers using a Poisson distribution.</p>
<p>Resorting to a hurdle model, to accommodate the zero-inflated distribution.</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Zero model
res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2011ct != 0) ~ wSCOREMAT.2011.Q + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2011ct != 0) ~ wSCOREMAT.2011.Q + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                  Estimate Cond. SE t-value   p-value
## (Intercept)       -2.4787  0.35883  -6.908 4.922e-12
## wSCOREMAT.2011.Q  -0.2162  0.09234  -2.342 1.920e-02
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377067 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.454  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -353.4342</code></pre>
<pre class="r"><code>ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.42512119            -0.02858366</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.zero, . ~ . -wSCOREMAT.2011.Q)
LRT(res.lmm.0, res.lmm.zero)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 5.122414  1 0.02361874</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout, title = &quot;DHARMa residual | Logit&quot;)
}

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2011ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                  Estimate Cond. SE t-value p-value
## (Intercept)      -2.08412  0.09774 -21.324   0.000
## wSCOREMAT.2011.Q -0.05171  0.02864  -1.805   0.071
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1331505 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.3978  
## # of obs: 454; # of groups: ct_no, 454 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1662.694</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##           -0.108588430            0.004809859</code></pre>
<pre class="r"><code>res.lmm.0&lt;- update(res.lmm.cnt, . ~ . -wSCOREMAT.2011.Q)
LRT(res.lmm.0, res.lmm.cnt)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 3.216597  1 0.07289504</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout, title = &quot;DHARMa residual | Count (truncated Poisson)&quot;)
}

# AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 4040.255</code></pre>
<p>Interpretation of the <code>wSCOREMAT.2011.Q</code> coefficient (significant in both sub-models): - we have <span class="math inline">\(e^{-0.216}\)</span> = 0.806 (95%CI: 0.654 ‚Äì 0.972), which means each increase of 1 quintile in the Material Score 2011 leads to a 19.4% decrease the chance of having a bicycle lane in the CT - we have <span class="math inline">\(e^{-0.052}\)</span> = 0.95 (95%CI: 0.897 ‚Äì 1.005), which means in CTs with bike lanes, each increase of 1 quintile in the Material Score 2011 leads to a 5% decrease the ratio of bike lanes to street in 2011.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.084</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.806</td>
<td align="right">0.019</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.zero$interval), 3)%&gt;%
  data.frame(wSCOREMAT.2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Zero model confidence interval&quot;)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.654</td>
<td align="right">0.972</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.124</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.950</td>
<td align="right">0.071</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.cnt$interval), 3)%&gt;%
  data.frame(wSCOREMAT.2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.897</td>
<td align="right">1.005</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 at the Census tract level, using a Poisson distribution</p>
<pre class="r"><code>f &lt;- area_esp_vert_2011ct ~ wSCOREMAT.2011.Q + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2011ct ~ wSCOREMAT.2011.Q + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2011ct ~ wSCOREMAT.2011.Q + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                  Estimate Cond. SE t-value  p-value
## (Intercept)      -0.61272  0.04130 -14.834 0.00e+00
## wSCOREMAT.2011.Q -0.09123  0.01113  -8.199 2.22e-16
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1383747 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.05602  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2329.779</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.11306613            -0.06933533</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - wSCOREMAT.2011.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 62.97397  1 2.109424e-15</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p>Interpretation of the <code>wSCOREMAT.2011.Q</code> coefficient (significant): we have <span class="math inline">\(e^{-0.091}\)</span> = 0.913 (95%CI: 0.893 ‚Äì 0.933), which means each increase of 1 quintile in the Material Score leads to a 8.7% decrease in the percentage of greenspace area within CT in 2011.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.542</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.913</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm$interval), 3)%&gt;%
  data.frame(wSCOREMAT.2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.893</td>
<td align="right">0.933</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 at the Census tract level, using a Poisson distribution</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2011ct ~ wSCOREMAT.2011.Q + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2011ct ~ wSCOREMAT.2011.Q + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2011ct ~ wSCOREMAT.2011.Q + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                  Estimate Cond. SE t-value  p-value
## (Intercept)       -1.2602  0.06071 -20.759 0.00e+00
## wSCOREMAT.2011.Q  -0.1354  0.01647  -8.221 2.22e-16
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377928 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1247  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2072.628</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##             -0.1677385             -0.1029865</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - wSCOREMAT.2011.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df     p_value
## p_v 63.63486  1 1.44329e-15</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p>Interpretation of the <code>vis_minority_2011.Q</code> coefficient (significant): we have <span class="math inline">\(e^{NA}\)</span> = NA (95%CI: 0.846 ‚Äì 0.902), which means each increase of 1 quintile in the Material Score leads to a 12.7% decrease in the percentage of tree canopy area within CT in 2011.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.284</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.873</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm$interval), 3)%&gt;%
  data.frame(wSCOREMAT.2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.846</td>
<td align="right">0.902</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="uc-vs-visible-minority" class="section level2 tabset" number="4.2">
<h2 class="tabset"><span class="header-section-number">4.2</span> UC vs Visible minority</h2>
<div id="bike-lane-length-hurdle-1" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Bike lane length (hurdle)</h3>
<p>Bike lane ratio to streets (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Zero model
res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2011ct != 0) ~ vis_minority_2011.Q + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2011ct != 0) ~ vis_minority_2011.Q + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                     Estimate Cond. SE t-value   p-value
## (Intercept)          -2.5602  0.33189  -7.714 1.221e-14
## vis_minority_2011.Q  -0.2175  0.08943  -2.432 1.500e-02
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377069 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.329  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -353.3975</code></pre>
<pre class="r"><code>ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.41031829               -0.03522793</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.zero, . ~ . - vis_minority_2011.Q)
LRT(res.lmm.0, res.lmm.zero)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 5.445155  1 0.01962268</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout, title = &quot;DHARMa residual | Logit&quot;)
}

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2011ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                     Estimate Cond. SE t-value p-value
## (Intercept)         -2.04064  0.09769  -20.89 0.00000
## vis_minority_2011.Q -0.07028  0.02928   -2.40 0.01639
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1299164 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.3915  
## # of obs: 454; # of groups: ct_no, 454 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1656.682</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.12810022               -0.01259185</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.cnt, . ~ . - vis_minority_2011.Q)
LRT(res.lmm.0, res.lmm.cnt)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 5.684915  1 0.01711137</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout, title = &quot;DHARMa residual | Count (truncated Poisson)&quot;)
}

# AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 4028.159</code></pre>
<p>Interpretation of the <code>vis_minority_2011.Q</code> coefficient: - model <em>zero-hurdle</em> (non significant): we have <span class="math inline">\(e^{-0.218}\)</span> = 0.804 (95%CI: 0.663 ‚Äì 0.965), which means each increase of 1 quintile in the proportion of visible minority 2011 leads to a NA% decrease the chance of having a bicycle lane in the CT - model <em>count</em>: we have <span class="math inline">\(e^{-0.07}\)</span> = 0.932 (95%CI: 0.88 ‚Äì 0.987), which means in CTs with bike lanes, each increase of 1 quintile in the Material Score 2011 leads to a 6.8% decrease the ratio of bike lanes to street in 2011.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.077</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.804</td>
<td align="right">0.015</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.zero$interval), 3)%&gt;%
  data.frame(vis_minority_2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Zero model confidence interval&quot;)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.663</td>
<td align="right">0.965</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.130</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.932</td>
<td align="right">0.016</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.cnt$interval), 3)%&gt;%
  data.frame(vis_minority_2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.88</td>
<td align="right">0.987</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-1" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2011ct ~ vis_minority_2011.Q + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2011ct ~ vis_minority_2011.Q + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2011ct ~ vis_minority_2011.Q + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                     Estimate Cond. SE t-value   p-value
## (Intercept)         -0.69854  0.04195 -16.651 0.000e+00
## vis_minority_2011.Q -0.06588  0.01171  -5.625 1.852e-08
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1385778 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.0603  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2340.555</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.08884590               -0.04281246</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p>Interpretation of the <code>vis_minority_2011.Q</code> coefficient (significant): we have <span class="math inline">\(e^{-0.066}\)</span> = 0.936 (95%CI: 0.915 ‚Äì 0.958), which means each increase of 1 quintile in the proportion of visible minority leads to a 6.4% decrease in the percentage of greenspace area within CT in 2011.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.497</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.936</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm$interval), 3)%&gt;%
  data.frame(vis_minority_2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.915</td>
<td align="right">0.958</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-1" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2011ct ~ vis_minority_2011.Q + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2011ct ~ vis_minority_2011.Q + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2011ct ~ vis_minority_2011.Q + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                     Estimate Cond. SE t-value p-value
## (Intercept)          -1.3415  0.06110 -21.956 0.0e+00
## vis_minority_2011.Q  -0.1149  0.01716  -6.692 2.2e-11
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1380946 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1314  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2079.034</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.14857780               -0.08112137</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p>Interpretation of the <code>vis_minority_2011.Q</code> coefficient (significant): we have <span class="math inline">\(e^{-0.115}\)</span> = 0.891 (95%CI: 0.862 ‚Äì 0.922), which means each increase of 1 quintile in the proportion of visible minority leads to a 10.9% decrease in the percentage of tree canopy area within CT in 2011.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.261</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.891</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm$interval), 3)%&gt;%
  data.frame(vis_minority_2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.862</td>
<td align="right">0.922</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="uc-vs-gentrified-ct" class="section level2 tabset" number="4.3">
<h2 class="tabset"><span class="header-section-number">4.3</span> UC vs gentrified CT</h2>
<p>Gentrified CT between 2011 and 2016. <em>NB</em> we now use a 3-state gentrification status</p>
<div id="bike-lane-length-hurdle-2" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Bike lane length (hurdle)</h3>
<p>Bike lane ratio to streets (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Zero model
res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2011ct != 0) ~ gentrif_status_2016 + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2011ct != 0) ~ gentrif_status_2016 + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE  t-value p-value
## (Intercept)                     -3.27822   0.2379 -13.7826  0.0000
## gentrif_status_2016Gentrified    0.04012   0.2711   0.1480  0.8824
## gentrif_status_2016Non eligible  0.23039   0.2985   0.7719  0.4402
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377728 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.489  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -355.8288</code></pre>
<pre class="r"><code>varfixef.zero &lt;- names(res.lmm.zero[[&#39;fixef&#39;]])
ci.1.lmm.zero &lt;- confint(res.lmm.zero, varfixef.zero[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                          -0.5469893                           0.6154186</code></pre>
<pre class="r"><code>ci.2.lmm.zero &lt;- confint(res.lmm.zero, varfixef.zero[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                            -0.3799708                             0.8719727</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.zero, . ~ . - gentrif_status_2016)
LRT(res.lmm.0, res.lmm.zero)</code></pre>
<pre><code>##       chi2_LR df   p_value
## p_v 0.5825823  2 0.7472981</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout, title = &quot;DHARMa residual | Logit&quot;)
}

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2011ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE  t-value p-value
## (Intercept)                     -2.27162  0.07135 -31.8377  0.0000
## gentrif_status_2016Gentrified    0.10399  0.09157   1.1356  0.2561
## gentrif_status_2016Non eligible -0.02444  0.08755  -0.2792  0.7801
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1228566 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.4003  
## # of obs: 454; # of groups: ct_no, 454 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1658.584</code></pre>
<pre class="r"><code>varfixef.cnt &lt;- names(res.lmm.cnt[[&#39;fixef&#39;]])
ci.1.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                          -0.0795367                           0.2891037</code></pre>
<pre class="r"><code>ci.2.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                            -0.1986635                             0.1513616</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.cnt, . ~ . - gentrif_status_2016)
LRT(res.lmm.0, res.lmm.cnt)</code></pre>
<pre><code>##      chi2_LR df   p_value
## p_v 1.879925  2 0.3906426</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout, title = &quot;DHARMa residual | Count (truncated Poisson)&quot;)
}

# AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 4038.826</code></pre>
<p>Interpretation of the <code>gentrif_status_2016</code> coefficient: none significant</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.038</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.041</td>
<td align="right">0.882</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.259</td>
<td align="right">0.440</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.zero$interval, ci.2.lmm.zero$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef.zero[2:3])
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Zero model confidence interval&quot;)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.579</td>
<td align="right">1.850</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.684</td>
<td align="right">2.392</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.103</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.110</td>
<td align="right">0.256</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.976</td>
<td align="right">0.780</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.cnt$interval, ci.2.lmm.cnt$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef.cnt[2:3]) 
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.924</td>
<td align="right">1.335</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.820</td>
<td align="right">1.163</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-2" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2011ct ~ gentrif_status_2016 + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2011ct ~ gentrif_status_2016 + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2011ct ~ gentrif_status_2016 + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE t-value p-value
## (Intercept)                     -1.01664  0.03199 -31.779  0.0000
## gentrif_status_2016Gentrified   -0.05599  0.03596  -1.557  0.1194
## gentrif_status_2016Non eligible  0.29838  0.03307   9.023  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1385187 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.05025  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                        logLik
## logL       (p_v(h)): -2301.48</code></pre>
<pre class="r"><code>varfixef &lt;- names(res.lmm[[&#39;fixef&#39;]])
ci.1.lmm &lt;- confint(res.lmm, varfixef[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                          -0.1265914                           0.0145680</code></pre>
<pre class="r"><code>ci.2.lmm &lt;- confint(res.lmm, varfixef[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                             0.2333298                             0.3633082</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - gentrif_status_2016)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df p_value
## p_v 108.5734  2       0</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p>Interpretation of the <code>gentrif_status_2016</code>: No significant difference between <em>Gentrified</em> vs.¬†<em>Not gentrified</em>. Only meaningful difference between <em>non eligible</em> and <em>not gentrified</em>.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.362</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.946</td>
<td align="right">0.119</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.348</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm$interval, ci.2.lmm$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef[2:3]) 
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.881</td>
<td align="right">1.015</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.263</td>
<td align="right">1.438</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-2" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2011ct ~ gentrif_status_2016 + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2011ct ~ gentrif_status_2016 + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2011ct ~ gentrif_status_2016 + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE  t-value   p-value
## (Intercept)                     -1.79434  0.05002 -35.8742 0.000e+00
## gentrif_status_2016Gentrified   -0.03222  0.05478  -0.5882 5.564e-01
## gentrif_status_2016Non eligible  0.26910  0.05205   5.1705 2.335e-07
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1379023 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1333  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2082.717</code></pre>
<pre class="r"><code>varfixef &lt;- names(res.lmm[[&#39;fixef&#39;]])
ci.1.lmm &lt;- confint(res.lmm, varfixef[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                         -0.13999699                          0.07537829</code></pre>
<pre class="r"><code>ci.2.lmm &lt;- confint(res.lmm, varfixef[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                             0.1666311                             0.3713818</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - gentrif_status_2016)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 35.71865  2 1.753051e-08</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p>Interpretation of the <code>gentrif_status_2016</code> coefficient: not significant between <em>Gentrified</em> and <em>Not gentrified</em>.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.166</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.968</td>
<td align="right">0.556</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.309</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm$interval, ci.2.lmm$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef[2:3]) 
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.869</td>
<td align="right">1.078</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.181</td>
<td align="right">1.450</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="association-between-ses-and-uc-in-2011-ses-as-categories" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Association between SES and UC in 2011 | SES as categories</h1>
<p><strong>UPDATE 2022-08-18</strong>: adding the same models, with discrete SES variables</p>
<div id="uc-vs-pampalon-material-1" class="section level2 tabset" number="5.1">
<h2 class="tabset"><span class="header-section-number">5.1</span> UC vs Pampalon | material</h2>
<div id="bike-lane-length-hurdle-3" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Bike lane length (hurdle)</h3>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Zero model
res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2011ct != 0) ~ factor(wSCOREMAT.2011.Q) + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2011ct != 0) ~ factor(wSCOREMAT.2011.Q) + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                           Estimate Cond. SE t-value  p-value
## (Intercept)               -2.86160   0.3378 -8.4714 0.000000
## factor(wSCOREMAT.2011.Q)2 -0.19935   0.3898 -0.5115 0.609026
## factor(wSCOREMAT.2011.Q)3 -0.08525   0.4004 -0.2129 0.831389
## factor(wSCOREMAT.2011.Q)4 -0.10580   0.4089 -0.2588 0.795827
## factor(wSCOREMAT.2011.Q)5 -1.04477   0.4016 -2.6014 0.009286
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1375796 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.444  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -351.0364</code></pre>
<pre class="r"><code>ci.lmm.zero.2 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2 upper factor(wSCOREMAT.2011.Q)2 
##                      -1.0157625                       0.6000846</code></pre>
<pre class="r"><code>ci.lmm.zero.3 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3 upper factor(wSCOREMAT.2011.Q)3 
##                      -0.9257822                       0.7339588</code></pre>
<pre class="r"><code>ci.lmm.zero.4 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4 upper factor(wSCOREMAT.2011.Q)4 
##                      -0.9634992                       0.7242757</code></pre>
<pre class="r"><code>ci.lmm.zero.5 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5 upper factor(wSCOREMAT.2011.Q)5 
##                      -1.9748666                      -0.2258412</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.zero, . ~ . -factor(wSCOREMAT.2011.Q))
LRT(res.lmm.0, res.lmm.zero)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 9.917987  4 0.04183207</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout, title = &quot;DHARMa residual | Logit&quot;)
}

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2011ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                           Estimate Cond. SE t-value p-value
## (Intercept)                -2.0747  0.08799 -23.580 0.00000
## factor(wSCOREMAT.2011.Q)2  -0.1772  0.10715  -1.654 0.09812
## factor(wSCOREMAT.2011.Q)3  -0.2408  0.11081  -2.173 0.02975
## factor(wSCOREMAT.2011.Q)4  -0.1564  0.11275  -1.387 0.16547
## factor(wSCOREMAT.2011.Q)5  -0.2706  0.12719  -2.127 0.03339
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1305916 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.3955  
## # of obs: 454; # of groups: ct_no, 454 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1661.156</code></pre>
<pre class="r"><code>ci.lmm.cnt.2 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2 upper factor(wSCOREMAT.2011.Q)2 
##                     -0.38889453                      0.03422423</code></pre>
<pre class="r"><code>ci.lmm.cnt.3 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3 upper factor(wSCOREMAT.2011.Q)3 
##                      -0.4593470                      -0.0224232</code></pre>
<pre class="r"><code>ci.lmm.cnt.4 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4 upper factor(wSCOREMAT.2011.Q)4 
##                     -0.37885112                      0.06556367</code></pre>
<pre class="r"><code>ci.lmm.cnt.5 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5 upper factor(wSCOREMAT.2011.Q)5 
##                     -0.52247315                     -0.01967952</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.cnt, . ~ . -factor(wSCOREMAT.2011.Q))
LRT(res.lmm.0, res.lmm.cnt)</code></pre>
<pre><code>##     chi2_LR df   p_value
## p_v 6.29161  4 0.1784034</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout, title = &quot;DHARMa residual | Count (truncated Poisson)&quot;)
}

# AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 4038.385</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.057</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.819</td>
<td align="right">0.609</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.918</td>
<td align="right">0.831</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.900</td>
<td align="right">0.796</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.352</td>
<td align="right">0.009</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q.2 = round(exp(ci.lmm.zero.2$interval), 3),
           wSCOREMAT.2011.Q.3 = round(exp(ci.lmm.zero.3$interval), 3),
           wSCOREMAT.2011.Q.4 = round(exp(ci.lmm.zero.4$interval), 3),
           wSCOREMAT.2011.Q.5 = round(exp(ci.lmm.zero.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Zero model confidence interval&quot;)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2</td>
<td align="right">0.362</td>
<td align="right">1.822</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3</td>
<td align="right">0.396</td>
<td align="right">2.083</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4</td>
<td align="right">0.382</td>
<td align="right">2.063</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5</td>
<td align="right">0.139</td>
<td align="right">0.798</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.126</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.838</td>
<td align="right">0.098</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.786</td>
<td align="right">0.030</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.855</td>
<td align="right">0.165</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.763</td>
<td align="right">0.033</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q.2 = round(exp(ci.lmm.cnt.2$interval), 3),
           wSCOREMAT.2011.Q.3 = round(exp(ci.lmm.cnt.3$interval), 3),
           wSCOREMAT.2011.Q.4 = round(exp(ci.lmm.cnt.4$interval), 3),
           wSCOREMAT.2011.Q.5 = round(exp(ci.lmm.cnt.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2</td>
<td align="right">0.678</td>
<td align="right">1.035</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3</td>
<td align="right">0.632</td>
<td align="right">0.978</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4</td>
<td align="right">0.685</td>
<td align="right">1.068</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5</td>
<td align="right">0.593</td>
<td align="right">0.981</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-3" class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 at the Census tract level, using a Poisson distribution</p>
<pre class="r"><code>f &lt;- area_esp_vert_2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                           Estimate Cond. SE t-value   p-value
## (Intercept)                -0.7271  0.03808 -19.094 0.000e+00
## factor(wSCOREMAT.2011.Q)2  -0.0818  0.04099  -1.996 4.597e-02
## factor(wSCOREMAT.2011.Q)3  -0.1164  0.04348  -2.677 7.429e-03
## factor(wSCOREMAT.2011.Q)4  -0.2162  0.04439  -4.870 1.115e-06
## factor(wSCOREMAT.2011.Q)5  -0.4003  0.04904  -8.163 3.331e-16
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1383734 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.05495  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2326.028</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2 upper factor(wSCOREMAT.2011.Q)2 
##                    -0.162362879                    -0.001325418</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3 upper factor(wSCOREMAT.2011.Q)3 
##                     -0.20181408                     -0.03099336</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4 upper factor(wSCOREMAT.2011.Q)4 
##                      -0.3033058                      -0.1288687</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5 upper factor(wSCOREMAT.2011.Q)5 
##                      -0.4965327                      -0.3038120</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(wSCOREMAT.2011.Q))
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 70.47529  4 1.798561e-14</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.483</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.921</td>
<td align="right">0.046</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.890</td>
<td align="right">0.007</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.806</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.670</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           wSCOREMAT.2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           wSCOREMAT.2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           wSCOREMAT.2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2</td>
<td align="right">0.850</td>
<td align="right">0.999</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3</td>
<td align="right">0.817</td>
<td align="right">0.969</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4</td>
<td align="right">0.738</td>
<td align="right">0.879</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5</td>
<td align="right">0.609</td>
<td align="right">0.738</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-3" class="section level3" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 at the Census tract level, using a Poisson distribution</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                           Estimate Cond. SE t-value   p-value
## (Intercept)                -1.4069  0.05576 -25.232 0.000e+00
## factor(wSCOREMAT.2011.Q)2  -0.1587  0.06030  -2.632 8.483e-03
## factor(wSCOREMAT.2011.Q)3  -0.2026  0.06399  -3.166 1.546e-03
## factor(wSCOREMAT.2011.Q)4  -0.3655  0.06578  -5.557 2.749e-08
## factor(wSCOREMAT.2011.Q)5  -0.5875  0.07296  -8.052 7.772e-16
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377966 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1237  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                        logLik
## logL       (p_v(h)): -2070.45</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2 upper factor(wSCOREMAT.2011.Q)2 
##                     -0.27723591                     -0.04018457</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3 upper factor(wSCOREMAT.2011.Q)3 
##                     -0.32826040                     -0.07662331</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4 upper factor(wSCOREMAT.2011.Q)4 
##                      -0.4947162                      -0.2361205</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5 upper factor(wSCOREMAT.2011.Q)5 
##                      -0.7308436                      -0.4439361</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(wSCOREMAT.2011.Q))
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##     chi2_LR df      p_value
## p_v 67.9895  4 6.028511e-14</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.245</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.853</td>
<td align="right">0.008</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.817</td>
<td align="right">0.002</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.694</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.556</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           wSCOREMAT.2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           wSCOREMAT.2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           wSCOREMAT.2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2</td>
<td align="right">0.758</td>
<td align="right">0.961</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3</td>
<td align="right">0.720</td>
<td align="right">0.926</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4</td>
<td align="right">0.610</td>
<td align="right">0.790</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5</td>
<td align="right">0.482</td>
<td align="right">0.642</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="uc-vs-visible-minority-1" class="section level2 tabset" number="5.2">
<h2 class="tabset"><span class="header-section-number">5.2</span> UC vs Visible minority</h2>
<div id="bike-lane-length-hurdle-4" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Bike lane length (hurdle)</h3>
<p>Bike lane ratio to streets (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ factor(vis_minority_2011.Q) + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Zero model
res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2011ct != 0) ~ factor(vis_minority_2011.Q) + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2011ct != 0) ~ factor(vis_minority_2011.Q) + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                              Estimate Cond. SE  t-value p-value
## (Intercept)                  -3.03664   0.3081 -9.85597 0.00000
## factor(vis_minority_2011.Q)2  0.26683   0.3816  0.69920 0.48443
## factor(vis_minority_2011.Q)3 -0.15925   0.3707 -0.42963 0.66747
## factor(vis_minority_2011.Q)4  0.00702   0.3897  0.01802 0.98563
## factor(vis_minority_2011.Q)5 -0.92787   0.3854 -2.40736 0.01607
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1375854 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.396  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -350.7932</code></pre>
<pre class="r"><code>ci.lmm.zero.2 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2 upper factor(vis_minority_2011.Q)2 
##                         -0.5079544                          1.0755847</code></pre>
<pre class="r"><code>ci.lmm.zero.3 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3 upper factor(vis_minority_2011.Q)3 
##                         -0.9249753                          0.6277925</code></pre>
<pre class="r"><code>ci.lmm.zero.4 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4 upper factor(vis_minority_2011.Q)4 
##                         -0.7915025                          0.8253032</code></pre>
<pre class="r"><code>ci.lmm.zero.5 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5 upper factor(vis_minority_2011.Q)5 
##                         -1.7740295                         -0.1386125</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.zero, . ~ . - factor(vis_minority_2011.Q))
LRT(res.lmm.0, res.lmm.zero)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 10.65385  4 0.03074246</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout, title = &quot;DHARMa residual | Logit&quot;)
}

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2011ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2011ct ~ factor(vis_minority_2011.Q) + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ factor(vis_minority_2011.Q) + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                              Estimate Cond. SE  t-value p-value
## (Intercept)                  -2.14979  0.08621 -24.9360 0.00000
## factor(vis_minority_2011.Q)2  0.05333  0.10220   0.5218 0.60182
## factor(vis_minority_2011.Q)3 -0.14583  0.10939  -1.3330 0.18252
## factor(vis_minority_2011.Q)4 -0.21031  0.11285  -1.8636 0.06237
## factor(vis_minority_2011.Q)5 -0.20807  0.12911  -1.6116 0.10705
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1290189 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.3898  
## # of obs: 454; # of groups: ct_no, 454 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1655.408</code></pre>
<pre class="r"><code>ci.lmm.cnt.2 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2 upper factor(vis_minority_2011.Q)2 
##                         -0.1479935                          0.2550843</code></pre>
<pre class="r"><code>ci.lmm.cnt.3 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3 upper factor(vis_minority_2011.Q)3 
##                        -0.36167475                         0.06966377</code></pre>
<pre class="r"><code>ci.lmm.cnt.4 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4 upper factor(vis_minority_2011.Q)4 
##                        -0.43274544                         0.01199704</code></pre>
<pre class="r"><code>ci.lmm.cnt.5 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5 upper factor(vis_minority_2011.Q)5 
##                        -0.46334509                         0.04625033</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.cnt, . ~ . - factor(vis_minority_2011.Q))
LRT(res.lmm.0, res.lmm.cnt)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 8.232463  4 0.08342449</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout, title = &quot;DHARMa residual | Count (truncated Poisson)&quot;)
}

# AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 4026.402</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.048</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">1.306</td>
<td align="right">0.484</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">0.853</td>
<td align="right">0.667</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">1.007</td>
<td align="right">0.986</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.395</td>
<td align="right">0.016</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q.2 = round(exp(ci.lmm.zero.2$interval), 3),
           vis_minority_2011.Q.3 = round(exp(ci.lmm.zero.3$interval), 3),
           vis_minority_2011.Q.4 = round(exp(ci.lmm.zero.4$interval), 3),
           vis_minority_2011.Q.5 = round(exp(ci.lmm.zero.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Zero model confidence interval&quot;)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2</td>
<td align="right">0.602</td>
<td align="right">2.932</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3</td>
<td align="right">0.397</td>
<td align="right">1.873</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4</td>
<td align="right">0.453</td>
<td align="right">2.283</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5</td>
<td align="right">0.170</td>
<td align="right">0.871</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.117</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">1.055</td>
<td align="right">0.602</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">0.864</td>
<td align="right">0.183</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.810</td>
<td align="right">0.062</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.812</td>
<td align="right">0.107</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q.2 = round(exp(ci.lmm.cnt.2$interval), 3),
           vis_minority_2011.Q.3 = round(exp(ci.lmm.cnt.3$interval), 3),
           vis_minority_2011.Q.4 = round(exp(ci.lmm.cnt.4$interval), 3),
           vis_minority_2011.Q.5 = round(exp(ci.lmm.cnt.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2</td>
<td align="right">0.862</td>
<td align="right">1.291</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3</td>
<td align="right">0.697</td>
<td align="right">1.072</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4</td>
<td align="right">0.649</td>
<td align="right">1.012</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5</td>
<td align="right">0.629</td>
<td align="right">1.047</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-4" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2011ct ~ factor(vis_minority_2011.Q) + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2011ct ~ factor(vis_minority_2011.Q) + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2011ct ~ factor(vis_minority_2011.Q) + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                              Estimate Cond. SE  t-value   p-value
## (Intercept)                  -0.78564  0.03743 -20.9874 0.000e+00
## factor(vis_minority_2011.Q)2 -0.03719  0.04171  -0.8918 3.725e-01
## factor(vis_minority_2011.Q)3 -0.09027  0.04358  -2.0715 3.831e-02
## factor(vis_minority_2011.Q)4 -0.13494  0.04551  -2.9655 3.022e-03
## factor(vis_minority_2011.Q)5 -0.28976  0.05020  -5.7723 7.818e-09
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1385796 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.05981  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2337.961</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2 upper factor(vis_minority_2011.Q)2 
##                        -0.11903739                         0.04480626</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3 upper factor(vis_minority_2011.Q)3 
##                       -0.175736261                       -0.004356101</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4 upper factor(vis_minority_2011.Q)4 
##                        -0.22418634                        -0.04529683</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5 upper factor(vis_minority_2011.Q)5 
##                         -0.3882358                         -0.1909309</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.456</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">0.963</td>
<td align="right">0.372</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">0.914</td>
<td align="right">0.038</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.874</td>
<td align="right">0.003</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.748</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           vis_minority_2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           vis_minority_2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           vis_minority_2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2</td>
<td align="right">0.888</td>
<td align="right">1.046</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3</td>
<td align="right">0.839</td>
<td align="right">0.996</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4</td>
<td align="right">0.799</td>
<td align="right">0.956</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5</td>
<td align="right">0.678</td>
<td align="right">0.826</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-4" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2011ct ~ factor(vis_minority_2011.Q) + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2011ct ~ factor(vis_minority_2011.Q) + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2011ct ~ factor(vis_minority_2011.Q) + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                              Estimate Cond. SE t-value   p-value
## (Intercept)                  -1.47245  0.05458 -26.978 0.000e+00
## factor(vis_minority_2011.Q)2 -0.09472  0.06100  -1.553 1.205e-01
## factor(vis_minority_2011.Q)3 -0.18374  0.06367  -2.886 3.905e-03
## factor(vis_minority_2011.Q)4 -0.31786  0.06699  -4.745 2.090e-06
## factor(vis_minority_2011.Q)5 -0.46969  0.07388  -6.358 2.046e-10
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1381152 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1315  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                        logLik
## logL       (p_v(h)): -2078.57</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2 upper factor(vis_minority_2011.Q)2 
##                        -0.21453089                         0.02528571</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3 upper factor(vis_minority_2011.Q)3 
##                        -0.30875587                        -0.05832109</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4 upper factor(vis_minority_2011.Q)4 
##                         -0.4493834                         -0.1859589</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5 upper factor(vis_minority_2011.Q)5 
##                         -0.6148673                         -0.3245555</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.229</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">0.910</td>
<td align="right">0.120</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">0.832</td>
<td align="right">0.004</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.728</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.625</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           vis_minority_2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           vis_minority_2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           vis_minority_2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2</td>
<td align="right">0.807</td>
<td align="right">1.026</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3</td>
<td align="right">0.734</td>
<td align="right">0.943</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4</td>
<td align="right">0.638</td>
<td align="right">0.830</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5</td>
<td align="right">0.541</td>
<td align="right">0.723</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="uc-vs-gentrified-ct-1" class="section level2 tabset" number="5.3">
<h2 class="tabset"><span class="header-section-number">5.3</span> UC vs gentrified CT</h2>
<p>No new models here, as <code>gentrified</code> variable is already used as a pure categorical variable.</p>
</div>
</div>
<div id="association-between-ses-and-urban-interventions-2011-to-2016" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Association between SES and Urban Interventions (2011 to 2016)</h1>
<p>Looking at objective #1 | <em>do urban interventions tend to be located in low SES neighborhoods?</em>. We look at <span class="math display">\[Urban Intervention_{2011 \to 2016} = f(SES_{2011})\]</span> as well as <span class="math display">\[Urban Intervention_{2011 \to 2016} = f(Gentrification_{2011 \to 2016})\]</span></p>
<p>Here <span class="math inline">\(Urban Intervention\)</span> means the changes in the urban environment features, such as variation of bike lane length, greenness coverage, etc.</p>
<p>Apparently, change in rates are rather modeled as a pre-post model, as suggested in <a href="https://www.researchgate.net/post/Is-there-a-difference-between-ANOVA-analysis-of-change-scores-and-repeated-measures-ANOVA">Jones‚Äôs answer</a>. Hence, we model change in interventions between 2011 and 2016 as <span class="math display">\[UC_{2016} = \beta_{0} + \beta_{1} * UC_{2011} + \beta_{2} * SES\]</span></p>
<p>Mostly redundant with multi-level approach below.</p>
<div id="ui-vs-pampalon-material" class="section level2 tabset" number="6.1">
<h2 class="tabset"><span class="header-section-number">6.1</span> UI vs Pampalon | material</h2>
<div id="bike-lane-length-change-hurdle" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Bike lane length change (hurdle)</h3>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial()) #, verbose=c(TRACE=TRUE), init=list(lambda=NaN))
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                             Estimate Cond. SE t-value   p-value
## (Intercept)                                 -5.07906   0.8708 -5.8330 5.445e-09
## wSCOREMAT.2011.Q                             0.04148   0.2112  0.1964 8.443e-01
## Bike_lane.by.street.2011ct                   3.93406   2.5445  1.5461 1.221e-01
## wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct -0.39869   0.5962 -0.6687 5.037e-01
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377281 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  5.685  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                        logLik
## logL       (p_v(h)): -149.363</code></pre>
<pre class="r"><code># ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;wSCOREMAT.2011.Q&#39;) # Not converging
# ci.lmm.zero.i &lt;- confint(res.lmm.zero, &#39;wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct&#39;)

# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                                  lower      upper
## (Intercept)                                 -6.7856968 -3.3724170
## wSCOREMAT.2011.Q                            -0.3723756  0.4553285
## Bike_lane.by.street.2011ct                  -1.0529751  8.9210966
## wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct -1.5672386  0.7698642</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout)
}

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                               Estimate Cond. SE  t-value
## (Intercept)                                 -2.7398550 0.087590 -31.2806
## wSCOREMAT.2011.Q                             0.0085593 0.024482   0.3496
## Bike_lane.by.street.2011ct                   0.0558818 0.004671  11.9646
## wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct -0.0004828 0.001463  -0.3300
##                                             p-value
## (Intercept)                                  0.0000
## wSCOREMAT.2011.Q                             0.7266
## Bike_lane.by.street.2011ct                   0.0000
## wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct  0.7414
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1502797 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1159  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1816.873</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.03957633             0.05672565</code></pre>
<pre class="r"><code>ci.lmm.cnt.i &lt;- confint(res.lmm.cnt, &#39;wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct 
##                                      -0.003370789 
## upper wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct 
##                                       0.002387528</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout)
}

# Plotting interaction
qtl &lt;- c(&quot;#8dd3c7&quot;, &quot;#bebada&quot;, &quot;#fb8072&quot;, &quot;#80b1d3&quot;, &quot;#fdb462&quot;) # Define colors for quintiles

.t &lt;- clean_bei.cnt$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm.cnt))

g_mat_bk.hrdl &lt;- ggplot(.t, aes(y=100*predict/street_length.hm, x=Bike_lane.by.street.2011ct, colour=factor(wSCOREMAT.2011.Q), fill=factor(wSCOREMAT.2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1, linetype=&quot;dashed&quot;) +
  scale_color_manual(values = qtl) +
  scale_fill_manual(values = qtl) +
  labs(colour=&#39;wSCOREMAT.2011.Q&#39;, fill=&#39;wSCOREMAT.2011.Q&#39;)
g_mat_bk.hrdl</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-1.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3944.473</code></pre>
<p>Interpretation of the <code>wSCOREMAT.2011.Q</code> coefficient | Zero model (not significant): we have <span class="math inline">\(e^{0.041}\)</span> = 1.042 Interpretation of the <code>wSCOREMAT.2011.Q</code> coefficient | Count model (not significant): we have <span class="math inline">\(e^{0.009}\)</span> = 1.009</p>
<p>Coefficient interpretation (marginal + interaction) as relative risk.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.006</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">1.042</td>
<td align="right">0.844</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">51.114</td>
<td align="right">0.122</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct</td>
<td align="right">0.671</td>
<td align="right">0.504</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero[c(2,4),] %&gt;% 
  data.frame() %&gt;% 
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.689</td>
<td align="right">1.577</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct</td>
<td align="right">0.209</td>
<td align="right">2.159</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.065</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">1.009</td>
<td align="right">0.727</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.057</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct</td>
<td align="right">1.000</td>
<td align="right">0.741</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm.cnt$interval), 3),
           `wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.961</td>
<td align="right">1.058</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.Bike_lane.by.street.2011ct</td>
<td align="right">0.997</td>
<td align="right">1.002</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Greenness change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ wSCOREMAT.2011.Q*pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                       Estimate  Cond. SE t-value   p-value
## (Intercept)                          -1.498050 0.0442870 -33.826 0.0000000
## wSCOREMAT.2011.Q                     -0.049155 0.0134091  -3.666 0.0002466
## pct_esp_vert_2011ct                   0.016238 0.0007741  20.976 0.0000000
## wSCOREMAT.2011.Q:pct_esp_vert_2011ct  0.001032 0.0002748   3.756 0.0001725
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1349627 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002036  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1892.331</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;wSCOREMAT.2011.Q&quot;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.07558043            -0.02278883</code></pre>
<pre class="r"><code>ci.lmm.i &lt;- confint(res.lmm, &quot;wSCOREMAT.2011.Q:pct_esp_vert_2011ct&quot;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q:pct_esp_vert_2011ct 
##                               0.0004936528 
## upper wSCOREMAT.2011.Q:pct_esp_vert_2011ct 
##                               0.0015736807</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}

# Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))

g_mat_gr &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_2011ct, colour=factor(wSCOREMAT.2011.Q), fill=factor(wSCOREMAT.2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl) +
  scale_fill_manual(values = qtl) +
  labs(colour=&#39;wSCOREMAT.2011.Q&#39;, fill=&#39;wSCOREMAT.2011.Q&#39;)
g_mat_gr</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-32-1.png" /><!-- --></p>
<p>Interpretation of the <code>wSCOREMAT.2011.Q</code> coefficient (significant): we have <span class="math inline">\(e^{-0.049}\)</span> = 0.952 (95%CI: 0.927 ‚Äì 0.977)</p>
<p>Coefficient interpretation (marginal + interaction) as relative risk.</p>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(wSCOREMAT.2011.Q=c(1,3,5))
i_e[&quot;UC2011.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;pct_esp_vert_2011ct&#39;] + i_e[&quot;wSCOREMAT.2011.Q&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;wSCOREMAT.2011.Q:pct_esp_vert_2011ct&#39;]
i_e[&quot;UC2011.relative.risk&quot;] &lt;- exp(i_e[&quot;UC2011.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["wSCOREMAT.2011.Q"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["UC2011.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["UC2011.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0.01727039","3":"1.017420"},{"1":"3","2":"0.01933485","3":"1.019523"},{"1":"5","2":"0.02139931","3":"1.021630"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(pct_esp_vert_2011ct = quantile(clean_bei$df$pct_esp_vert_2011ct)[2:4])
i_e[&quot;SES.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;wSCOREMAT.2011.Q&#39;] + i_e[&quot;pct_esp_vert_2011ct&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;wSCOREMAT.2011.Q:pct_esp_vert_2011ct&#39;]
i_e[&quot;SES.relative.risk&quot;] &lt;- exp(i_e[&quot;SES.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["pct_esp_vert_2011ct"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["SES.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SES.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"24.6","2":"-0.023762394","3":"0.9765177","_rn_":"25%"},{"1":"35.5","2":"-0.012511079","3":"0.9875669","_rn_":"50%"},{"1":"46.5","2":"-0.001156542","3":"0.9988441","_rn_":"75%"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.224</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.952</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.016</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q:pct_esp_vert_2011ct</td>
<td align="right">1.001</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm$interval), 3),
           `wSCOREMAT.2011.Q:pct_esp_vert_2011ct` = round(exp(ci.lmm.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.927</td>
<td align="right">0.977</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.pct_esp_vert_2011ct</td>
<td align="right">1.000</td>
<td align="right">1.002</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change" class="section level3" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Canopy (trees) change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                            Estimate  Cond. SE t-value   p-value
## (Intercept)                               -2.072388 0.0536182 -38.651 0.000e+00
## wSCOREMAT.2011.Q                          -0.122252 0.0167460  -7.300 2.870e-13
## pct_esp_vert_high_2011ct                   0.028081 0.0017552  15.999 0.000e+00
## wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct  0.005601 0.0007134   7.851 4.108e-15
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##    1.rho 
## 0.137914 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.01036  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1729.505</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;wSCOREMAT.2011.Q&quot;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.15514775            -0.08944108</code></pre>
<pre class="r"><code>ci.lmm.i &lt;- confint(res.lmm, &quot;wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct&quot;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct 
##                                     0.004203652 
## upper wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct 
##                                     0.007013851</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}

# Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))

g_mat_tc &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_high_2011ct, colour=factor(wSCOREMAT.2011.Q), fill=factor(wSCOREMAT.2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl) +
  scale_fill_manual(values = qtl) +
  labs(colour=&#39;wSCOREMAT.2011.Q&#39;, fill=&#39;wSCOREMAT.2011.Q&#39;)
g_mat_tc</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-35-1.png" /><!-- --></p>
<p>Interpretation of the <code>wSCOREMAT.2011.Q</code> coefficient (significant): we have <span class="math inline">\(e^{-0.122}\)</span> = 0.885 (95%CI: 0.856 ‚Äì 0.914)</p>
<p>Coefficient interpretation (marginal + interaction) as relative risk.</p>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(wSCOREMAT.2011.Q=c(1,3,5))
i_e[&quot;UC2011.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;pct_esp_vert_high_2011ct&#39;] + i_e[&quot;wSCOREMAT.2011.Q&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct&#39;]
i_e[&quot;UC2011.relative.risk&quot;] &lt;- exp(i_e[&quot;UC2011.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["wSCOREMAT.2011.Q"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["UC2011.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["UC2011.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0.03368179","3":"1.034255"},{"1":"3","2":"0.04488426","3":"1.045907"},{"1":"5","2":"0.05608673","3":"1.057689"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(pct_esp_vert_high_2011ct = quantile(clean_bei$df$pct_esp_vert_high_2011ct)[2:4])
i_e[&quot;SES.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;wSCOREMAT.2011.Q&#39;] + i_e[&quot;pct_esp_vert_high_2011ct&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct&#39;]
i_e[&quot;SES.relative.risk&quot;] &lt;- exp(i_e[&quot;SES.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["pct_esp_vert_high_2011ct"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["SES.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SES.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"11.8","2":"-0.056157692","3":"0.9453900","_rn_":"25%"},{"1":"16.4","2":"-0.030392014","3":"0.9700652","_rn_":"50%"},{"1":"22.5","2":"0.003775515","3":"1.0037827","_rn_":"75%"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.126</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.885</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.028</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct</td>
<td align="right">1.006</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm$interval), 3),
           `wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.856</td>
<td align="right">0.914</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.pct_esp_vert_high_2011ct</td>
<td align="right">1.004</td>
<td align="right">1.007</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-visible-minority" class="section level2 tabset" number="6.2">
<h2 class="tabset"><span class="header-section-number">6.2</span> UI vs Visible minority</h2>
<div id="bike-lane-length-change-hurdle-1" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Bike lane length change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                                Estimate Cond. SE t-value
## (Intercept)                                     -3.1409   0.9077 -3.4604
## vis_minority_2011.Q                             -0.4987   0.2298 -2.1705
## Bike_lane.by.street.2011ct                       4.9662   4.2116  1.1792
## vis_minority_2011.Q:Bike_lane.by.street.2011ct  -0.5233   0.9486 -0.5517
##                                                  p-value
## (Intercept)                                    0.0005394
## vis_minority_2011.Q                            0.0299662
## Bike_lane.by.street.2011ct                     0.2383313
## vis_minority_2011.Q:Bike_lane.by.street.2011ct 0.5811799
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1378894 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  6.709  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -145.2196</code></pre>
<pre class="r"><code># ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;vis_minority_2011.Q&#39;)
# ci.lmm.zero.i &lt;- confint(res.lmm.zero, &#39;vis_minority_2011.Q:Bike_lane.by.street.2011ct&#39;)

# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                                     lower       upper
## (Intercept)                                    -4.9198346 -1.36188456
## vis_minority_2011.Q                            -0.9490133 -0.04838061
## Bike_lane.by.street.2011ct                     -3.2884041 13.22078203
## vis_minority_2011.Q:Bike_lane.by.street.2011ct -2.3826317  1.33597310</code></pre>
<pre class="r"><code># p-value not far from 0.05, use LRT to refine test
res.lmm.0 &lt;- update(res.lmm.zero, . ~ . - vis_minority_2011.Q)
LRT(res.lmm.0, res.lmm.zero)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 3.924655  1 0.04758296</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout)
}

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                  Estimate Cond. SE  t-value
## (Intercept)                                    -2.6809663 0.089317 -30.0163
## vis_minority_2011.Q                            -0.0102146 0.025256  -0.4044
## Bike_lane.by.street.2011ct                      0.0555919 0.004831  11.5069
## vis_minority_2011.Q:Bike_lane.by.street.2011ct -0.0003738 0.001539  -0.2429
##                                                p-value
## (Intercept)                                     0.0000
## vis_minority_2011.Q                             0.6859
## Bike_lane.by.street.2011ct                      0.0000
## vis_minority_2011.Q:Bike_lane.by.street.2011ct  0.8081
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1504829 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1157  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1813.753</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;vis_minority_2011.Q&#39;) # Not converging</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.05994320                0.03944469</code></pre>
<pre class="r"><code>ci.lmm.cnt.i &lt;- confint(res.lmm.cnt, &#39;vis_minority_2011.Q:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q:Bike_lane.by.street.2011ct 
##                                         -0.003412284 
## upper vis_minority_2011.Q:Bike_lane.by.street.2011ct 
##                                          0.002644448</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout)
}

# Plotting interaction
.t &lt;- clean_bei.cnt$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm.cnt))

g_vis_bk.hrdl &lt;- ggplot(.t, aes(y=100*predict/street_length.hm, x=Bike_lane.by.street.2011ct, colour=factor(vis_minority_2011.Q), fill=factor(vis_minority_2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1, linetype = &quot;dashed&quot;) +
  scale_color_manual(values = qtl) +
  scale_fill_manual(values = qtl) +
  labs(colour=&#39;vis_minority_2011.Q&#39;, fill=&#39;vis_minority_2011.Q&#39;)
g_vis_bk.hrdl</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-2-1.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3929.946</code></pre>
<p>Interpretation of the <code>vis_minority_2011.Q</code> coefficient | Zero model (not significant): we have <span class="math inline">\(e^{-0.499}\)</span> = 0.607 Interpretation of the <code>wSCOREMAT.2011.Q</code> coefficient | Count model (not significant): we have <span class="math inline">\(e^{-0.01}\)</span> = 0.99</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.043</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.607</td>
<td align="right">0.030</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">143.479</td>
<td align="right">0.238</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q:Bike_lane.by.street.2011ct</td>
<td align="right">0.593</td>
<td align="right">0.581</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero[c(2,4),] %&gt;% 
  data.frame() %&gt;% 
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.387</td>
<td align="right">0.953</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q:Bike_lane.by.street.2011ct</td>
<td align="right">0.092</td>
<td align="right">3.804</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.068</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.990</td>
<td align="right">0.686</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.057</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q:Bike_lane.by.street.2011ct</td>
<td align="right">1.000</td>
<td align="right">0.808</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm.cnt$interval), 3),
           `vis_minority_2011.Q:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.942</td>
<td align="right">1.040</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.Bike_lane.by.street.2011ct</td>
<td align="right">0.997</td>
<td align="right">1.003</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-1" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Greenness change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ vis_minority_2011.Q * pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ vis_minority_2011.Q * pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ vis_minority_2011.Q * pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                           Estimate  Cond. SE t-value   p-value
## (Intercept)                             -1.5111792 0.0436670 -34.607 0.0000000
## vis_minority_2011.Q                     -0.0445802 0.0131690  -3.385 0.0007112
## pct_esp_vert_2011ct                      0.0166256 0.0007384  22.516 0.0000000
## vis_minority_2011.Q:pct_esp_vert_2011ct  0.0008595 0.0002457   3.498 0.0004681
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1344121 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002115  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                        logLik
## logL       (p_v(h)): -1892.88</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;vis_minority_2011.Q&quot;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.07042887               -0.01869090</code></pre>
<pre class="r"><code>ci.lmm.i &lt;- confint(res.lmm, &quot;vis_minority_2011.Q:pct_esp_vert_2011ct&quot;)</code></pre>
<pre><code>## lower vis_minority_2011.Q:pct_esp_vert_2011ct 
##                                  0.0003778652 
## upper vis_minority_2011.Q:pct_esp_vert_2011ct 
##                                  0.0013461091</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}

# Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))

g_vis_gr &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_2011ct, colour=factor(vis_minority_2011.Q), fill=factor(vis_minority_2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl) +
  scale_fill_manual(values = qtl) +
  labs(colour=&#39;vis_minority_2011.Q&#39;, fill=&#39;vis_minority_2011.Q&#39;)
g_vis_gr</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-39-1.png" /><!-- --></p>
<p>Interpretation of the <code>vis_minority_2011.Q</code> coefficient (significant): we have <span class="math inline">\(e^{-0.045}\)</span> = 0.956 (95%CI: 0.932 ‚Äì 0.981)</p>
<p>Coefficient interpretation (marginal + interaction) as relative risk.</p>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(vis_minority_2011.Q=c(1,3,5))
i_e[&quot;UC2011.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;pct_esp_vert_2011ct&#39;] + i_e[&quot;vis_minority_2011.Q&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;vis_minority_2011.Q:pct_esp_vert_2011ct&#39;]
i_e[&quot;UC2011.relative.risk&quot;] &lt;- exp(i_e[&quot;UC2011.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["vis_minority_2011.Q"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["UC2011.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["UC2011.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0.01748505","3":"1.017639"},{"1":"3","2":"0.01920398","3":"1.019390"},{"1":"5","2":"0.02092292","3":"1.021143"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(pct_esp_vert_2011ct = quantile(clean_bei$df$pct_esp_vert_2011ct)[2:4])
i_e[&quot;SES.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;vis_minority_2011.Q&#39;] + i_e[&quot;pct_esp_vert_2011ct&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;vis_minority_2011.Q:pct_esp_vert_2011ct&#39;]
i_e[&quot;SES.relative.risk&quot;] &lt;- exp(i_e[&quot;SES.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["pct_esp_vert_2011ct"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["SES.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SES.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"24.6","2":"-0.023437323","3":"0.9768352","_rn_":"25%"},{"1":"35.4","2":"-0.014155070","3":"0.9859446","_rn_":"50%"},{"1":"46.5","2":"-0.004614976","3":"0.9953957","_rn_":"75%"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.221</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.956</td>
<td align="right">0.001</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.017</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q:pct_esp_vert_2011ct</td>
<td align="right">1.001</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm$interval), 3),
           `vis_minority_2011.Q:pct_esp_vert_2011ct` = round(exp(ci.lmm.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.932</td>
<td align="right">0.981</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.pct_esp_vert_2011ct</td>
<td align="right">1.000</td>
<td align="right">1.001</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-1" class="section level3" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Canopy (trees) change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ vis_minority_2011.Q * pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ vis_minority_2011.Q * pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ vis_minority_2011.Q * pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                               Estimate Cond. SE t-value
## (Intercept)                                  -2.166921 0.058041 -37.334
## vis_minority_2011.Q                          -0.076255 0.017516  -4.353
## pct_esp_vert_high_2011ct                      0.032033 0.001940  16.514
## vis_minority_2011.Q:pct_esp_vert_high_2011ct  0.003299 0.000672   4.909
##                                                p-value
## (Intercept)                                  0.000e+00
## vis_minority_2011.Q                          1.340e-05
## pct_esp_vert_high_2011ct                     0.000e+00
## vis_minority_2011.Q:pct_esp_vert_high_2011ct 9.151e-07
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1379703 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.01181  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1746.127</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;vis_minority_2011.Q&quot;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.11068404               -0.04187537</code></pre>
<pre class="r"><code>ci.lmm.i &lt;- confint(res.lmm, &quot;vis_minority_2011.Q:pct_esp_vert_high_2011ct&quot;)</code></pre>
<pre><code>## lower vis_minority_2011.Q:pct_esp_vert_high_2011ct 
##                                        0.001981273 
## upper vis_minority_2011.Q:pct_esp_vert_high_2011ct 
##                                        0.004626773</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}

# Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))

g_vis_tc &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_high_2011ct, colour=factor(vis_minority_2011.Q), fill=factor(vis_minority_2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl) +
  scale_fill_manual(values = qtl) +
  labs(colour=&#39;vis_minority_2011.Q&#39;, fill=&#39;vis_minority_2011.Q&#39;)
g_vis_tc</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-42-1.png" /><!-- --></p>
<p>Interpretation of the <code>vis_minority_2011.Q</code> coefficient (significant): we have <span class="math inline">\(e^{-0.076}\)</span> = 0.927 (95%CI: 0.895 ‚Äì 0.959)</p>
<p>Coefficient interpretation (marginal + interaction) as relative risk.</p>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(vis_minority_2011.Q=c(1,3,5))
i_e[&quot;UC2011.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;pct_esp_vert_high_2011ct&#39;] + i_e[&quot;vis_minority_2011.Q&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;vis_minority_2011.Q:pct_esp_vert_high_2011ct&#39;]
i_e[&quot;UC2011.relative.risk&quot;] &lt;- exp(i_e[&quot;UC2011.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["vis_minority_2011.Q"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["UC2011.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["UC2011.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0.03533207","3":"1.035964"},{"1":"3","2":"0.04192939","3":"1.042821"},{"1":"5","2":"0.04852670","3":"1.049723"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(pct_esp_vert_high_2011ct = quantile(clean_bei$df$pct_esp_vert_high_2011ct)[2:4])
i_e[&quot;SES.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;vis_minority_2011.Q&#39;] + i_e[&quot;pct_esp_vert_high_2011ct&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;vis_minority_2011.Q:pct_esp_vert_high_2011ct&#39;]
i_e[&quot;SES.relative.risk&quot;] &lt;- exp(i_e[&quot;SES.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["pct_esp_vert_high_2011ct"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["SES.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SES.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"11.8","2":"-0.037330951","3":"0.9633573","_rn_":"25%"},{"1":"16.3","2":"-0.022486983","3":"0.9777640","_rn_":"50%"},{"1":"22.5","2":"-0.002035294","3":"0.9979668","_rn_":"75%"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.115</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.927</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.033</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q:pct_esp_vert_high_2011ct</td>
<td align="right">1.003</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm$interval), 3),
           `vis_minority_2011.Q:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.895</td>
<td align="right">0.959</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.pct_esp_vert_high_2011ct</td>
<td align="right">1.002</td>
<td align="right">1.005</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-gentrified-ct" class="section level2 tabset" number="6.3">
<h2 class="tabset"><span class="header-section-number">6.3</span> UI vs gentrified CT</h2>
<p>Gentrified CT between 2011 and 2016</p>
<div id="bike-lane-length-change-hurdle-2" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Bike lane length change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                                             Estimate  Cond. SE
## (Intercept)                                                  -4.8802    0.5760
## gentrif_status_2016Gentrified                                 0.1663    0.6454
## gentrif_status_2016Non eligible                              -0.5922    0.7697
## Bike_lane.by.street.2011ct                                  529.6093 9809.9920
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct   -527.7732 9809.9924
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct -526.4356 9809.9923
##                                                             t-value p-value
## (Intercept)                                                -8.47323  0.0000
## gentrif_status_2016Gentrified                               0.25768  0.7967
## gentrif_status_2016Non eligible                            -0.76935  0.4417
## Bike_lane.by.street.2011ct                                  0.05399  0.9569
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct   -0.05380  0.9571
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct -0.05366  0.9572
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1379763 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  6.079  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -142.4839</code></pre>
<pre class="r"><code># NB: not converging
# varfixef.zero &lt;- names(res.lmm.zero[[&#39;fixef&#39;]])
# ci.1.lmm.zero &lt;- confint(res.lmm.zero, varfixef.zero[2])
# ci.2.lmm.zero &lt;- confint(res.lmm.zero, varfixef.zero[3])

# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                                                    lower
## (Intercept)                                                    -6.009078
## gentrif_status_2016Gentrified                                  -1.098685
## gentrif_status_2016Non eligible                                -2.100875
## Bike_lane.by.street.2011ct                                 -18697.621907
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct   -19755.005061
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct -19753.667318
##                                                                    upper
## (Intercept)                                                   -3.7513654
## gentrif_status_2016Gentrified                                  1.4313003
## gentrif_status_2016Non eligible                                0.9164636
## Bike_lane.by.street.2011ct                                 19756.8404143
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct   18699.4586692
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct 18700.7960624</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout)
}

# Plotting interaction || MEANINGLESS
# .t &lt;- clean_bei$df
# .t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm.zero))
# 
# ggplot(.t, aes(y=100*predict/street_length.hm, x=Bike_lane.by.street.2011ct, colour=factor(gentrified_2016_2011), fill=factor(gentrified_2016_2011))) + 
#   geom_smooth(method = &quot;lm&quot;, alpha=.1) +
#   labs(colour=&#39;gentrified_2016_2011&#39;, fill=&#39;gentrified_2016_2011&#39;)

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                             Estimate Cond. SE
## (Intercept)                                                -2.617664 0.060610
## gentrif_status_2016Gentrified                               0.075961 0.079845
## gentrif_status_2016Non eligible                            -0.309834 0.076760
## Bike_lane.by.street.2011ct                                  0.049273 0.003585
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct   -0.003656 0.005041
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct  0.017433 0.004864
##                                                             t-value   p-value
## (Intercept)                                                -43.1889 0.000e+00
## gentrif_status_2016Gentrified                                0.9514 3.414e-01
## gentrif_status_2016Non eligible                             -4.0364 5.428e-05
## Bike_lane.by.street.2011ct                                  13.7426 0.000e+00
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct    -0.7252 4.683e-01
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct   3.5839 3.384e-04
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##    1.rho 
## 0.150282 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1066  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1801.132</code></pre>
<pre class="r"><code>varfixef.cnt &lt;- names(res.lmm.cnt[[&#39;fixef&#39;]])
ci.1.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                         -0.08145417                          0.23278476</code></pre>
<pre class="r"><code>ci.2.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                            -0.4612937                            -0.1589466</code></pre>
<pre class="r"><code>ci.3.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[5]) # Interaction</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct 
##                                                   -0.013554748 
## upper gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct 
##                                                    0.006278552</code></pre>
<pre class="r"><code>ci.4.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[6]) # Interaction</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct 
##                                                      0.007897441 
## upper gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct 
##                                                      0.027059083</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout)
}

# Plotting interaction
.t &lt;- clean_bei.cnt$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm.cnt))

g_gen_bk.hrdl &lt;- ggplot(.t, aes(y=100*predict/street_length.hm, x=Bike_lane.by.street.2011ct, colour=gentrif_status_2016, fill=gentrif_status_2016)) + 
  # geom_point() +
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  labs(colour=&#39;gentrif_status_2016&#39;, fill=&#39;gentrif_status_2016&#39;)
g_gen_bk.hrdl</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-0-1.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3903.232</code></pre>
<p>Interpretation of the <code>gentrif_status_2016</code> coefficient | Zero model: <em>Not gentrified</em> vs <em>Gentrified</em> not significant Interpretation of the <code>gentrif_status_2016</code> coefficient | Count model: idem</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<colgroup>
<col width="72%" />
<col width="17%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">8.000000e-03</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.181000e+00</td>
<td align="right">0.797</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">5.530000e-01</td>
<td align="right">0.442</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.014791e+230</td>
<td align="right">0.957</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct</td>
<td align="right">0.000000e+00</td>
<td align="right">0.957</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct</td>
<td align="right">0.000000e+00</td>
<td align="right">0.957</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero[c(2,3,5,6),] %&gt;% 
  data.frame() %&gt;% 
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.333</td>
<td align="right">4.184</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.122</td>
<td align="right">2.500</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct</td>
<td align="right">0.000</td>
<td align="right">Inf</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct</td>
<td align="right">0.000</td>
<td align="right">Inf</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.073</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.079</td>
<td align="right">0.341</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.734</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.051</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct</td>
<td align="right">0.996</td>
<td align="right">0.468</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct</td>
<td align="right">1.018</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.cnt$interval, ci.2.lmm.cnt$interval, ci.3.lmm.cnt$interval, ci.4.lmm.cnt$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = c(varfixef.cnt[2:3], varfixef.cnt[5:6]))
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.922</td>
<td align="right">1.262</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.630</td>
<td align="right">0.853</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct</td>
<td align="right">0.987</td>
<td align="right">1.006</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct</td>
<td align="right">1.008</td>
<td align="right">1.027</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-2" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Greenness change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ gentrif_status_2016 * pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ gentrif_status_2016 * pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ gentrif_status_2016 * pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                       Estimate Cond. SE
## (Intercept)                                         -1.8685995 0.044404
## gentrif_status_2016Gentrified                        0.0254690 0.071685
## gentrif_status_2016Non eligible                      0.3345833 0.051061
## pct_esp_vert_2011ct                                  0.0250277 0.001115
## gentrif_status_2016Gentrified:pct_esp_vert_2011ct   -0.0002392 0.001907
## gentrif_status_2016Non eligible:pct_esp_vert_2011ct -0.0078103 0.001187
##                                                      t-value   p-value
## (Intercept)                                         -42.0815 0.000e+00
## gentrif_status_2016Gentrified                         0.3553 7.224e-01
## gentrif_status_2016Non eligible                       6.5526 5.653e-11
## pct_esp_vert_2011ct                                  22.4459 0.000e+00
## gentrif_status_2016Gentrified:pct_esp_vert_2011ct    -0.1254 9.002e-01
## gentrif_status_2016Non eligible:pct_esp_vert_2011ct  -6.5780 4.769e-11
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1354874 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.001737  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1870.149</code></pre>
<pre class="r"><code>varfixef &lt;- names(res.lmm[[&#39;fixef&#39;]])
ci.1.lmm &lt;- confint(res.lmm, varfixef[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                          -0.1151682                           0.1659180</code></pre>
<pre class="r"><code>ci.2.lmm &lt;- confint(res.lmm, varfixef[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                             0.2344347                             0.4349738</code></pre>
<pre class="r"><code>ci.3.lmm &lt;- confint(res.lmm, varfixef[5]) # Interaction</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified:pct_esp_vert_2011ct 
##                                            -0.003981102 
## upper gentrif_status_2016Gentrified:pct_esp_vert_2011ct 
##                                             0.003496054</code></pre>
<pre class="r"><code>ci.4.lmm &lt;- confint(res.lmm, varfixef[6]) # Interaction</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible:pct_esp_vert_2011ct 
##                                              -0.010141120 
## upper gentrif_status_2016Non eligible:pct_esp_vert_2011ct 
##                                              -0.005482627</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}

# Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))

g_gen_gr &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_2011ct, colour=factor(gentrif_status_2016), fill=factor(gentrif_status_2016))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  labs(colour=&#39;gentrif_status_2016&#39;, fill=&#39;gentrif_status_2016&#39;)
g_gen_gr</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-46-1.png" /><!-- --></p>
<p>Interpretation of the <code>gentrif_status_2016</code> coefficient: <em>Gentrified</em> vs <em>Not gentrified</em> not significant for main and interaction terms</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.154</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.026</td>
<td align="right">0.722</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.397</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.025</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified:pct_esp_vert_2011ct</td>
<td align="right">1.000</td>
<td align="right">0.900</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible:pct_esp_vert_2011ct</td>
<td align="right">0.992</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm$interval, ci.2.lmm$interval, ci.3.lmm$interval, ci.4.lmm$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = c(varfixef[2:3], varfixef[5:6]))
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.891</td>
<td align="right">1.180</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.264</td>
<td align="right">1.545</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified:pct_esp_vert_2011ct</td>
<td align="right">0.996</td>
<td align="right">1.004</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible:pct_esp_vert_2011ct</td>
<td align="right">0.990</td>
<td align="right">0.995</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-2" class="section level3" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> Canopy (trees) change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ gentrif_status_2016 * pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ gentrif_status_2016 * pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ gentrif_status_2016 * pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                           Estimate Cond. SE
## (Intercept)                                              -2.676737 0.055544
## gentrif_status_2016Gentrified                             0.098183 0.083628
## gentrif_status_2016Non eligible                           0.359658 0.060765
## pct_esp_vert_high_2011ct                                  0.057789 0.002788
## gentrif_status_2016Gentrified:pct_esp_vert_high_2011ct   -0.004519 0.004292
## gentrif_status_2016Non eligible:pct_esp_vert_high_2011ct -0.020183 0.002914
##                                                          t-value   p-value
## (Intercept)                                              -48.192 0.000e+00
## gentrif_status_2016Gentrified                              1.174 2.404e-01
## gentrif_status_2016Non eligible                            5.919 3.242e-09
## pct_esp_vert_high_2011ct                                  20.727 0.000e+00
## gentrif_status_2016Gentrified:pct_esp_vert_high_2011ct    -1.053 2.923e-01
## gentrif_status_2016Non eligible:pct_esp_vert_high_2011ct  -6.925 4.357e-12
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1381568 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.009658  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1728.153</code></pre>
<pre class="r"><code>varfixef &lt;- names(res.lmm[[&#39;fixef&#39;]])
ci.1.lmm &lt;- confint(res.lmm, varfixef[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                         -0.06627735                          0.26181849</code></pre>
<pre class="r"><code>ci.2.lmm &lt;- confint(res.lmm, varfixef[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                             0.2399986                             0.4790137</code></pre>
<pre class="r"><code>ci.3.lmm &lt;- confint(res.lmm, varfixef[5]) # Interaction</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified:pct_esp_vert_high_2011ct 
##                                                 -0.012930470 
## upper gentrif_status_2016Gentrified:pct_esp_vert_high_2011ct 
##                                                  0.003900121</code></pre>
<pre class="r"><code>ci.4.lmm &lt;- confint(res.lmm, varfixef[6]) # Interaction</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible:pct_esp_vert_high_2011ct 
##                                                    -0.02589034 
## upper gentrif_status_2016Non eligible:pct_esp_vert_high_2011ct 
##                                                    -0.01443352</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}

# Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))

g_gen_tc &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_high_2011ct, colour=factor(gentrif_status_2016), fill=factor(gentrif_status_2016))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  labs(colour=&#39;gentrif_status_2016&#39;, fill=&#39;gentrif_status_2016&#39;)
g_gen_tc</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-48-1.png" /><!-- --></p>
<p>Interpretation of the <code>gentrif_status_2016</code> coefficient: <em>Gentrified</em> vs <em>Not gentrified</em> not significant for main and interaction terms</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.069</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.103</td>
<td align="right">0.240</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.433</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.059</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified:pct_esp_vert_high_2011ct</td>
<td align="right">0.995</td>
<td align="right">0.292</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible:pct_esp_vert_high_2011ct</td>
<td align="right">0.980</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm$interval, ci.2.lmm$interval, ci.3.lmm$interval, ci.4.lmm$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = c(varfixef[2:3], varfixef[5:6]))
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.936</td>
<td align="right">1.299</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.271</td>
<td align="right">1.614</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified:pct_esp_vert_high_2011ct</td>
<td align="right">0.987</td>
<td align="right">1.004</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible:pct_esp_vert_high_2011ct</td>
<td align="right">0.974</td>
<td align="right">0.986</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="association-between-ses-and-ui-ses-as-categories" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Association between SES and UI | SES as categories</h1>
<p>Following Yan and Behzad‚Äôs request, the exact same models as above are run, this time using SES quintiles as categories instead of ordinal values.</p>
<div id="ui-vs-pampalon-material-1" class="section level2 tabset" number="7.1">
<h2 class="tabset"><span class="header-section-number">7.1</span> UI vs Pampalon | material</h2>
<div id="bike-lane-length-change-hurdle-3" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Bike lane length change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ factor(wSCOREMAT.2011.Q) * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ factor(wSCOREMAT.2011.Q) * 
##     Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                                        Estimate  Cond. SE
## (Intercept)                                            -14.2558 8.936e+00
## factor(wSCOREMAT.2011.Q)2                                1.4924 1.099e+01
## factor(wSCOREMAT.2011.Q)3                               19.5507 1.179e+01
## factor(wSCOREMAT.2011.Q)4                                0.7105 1.177e+01
## factor(wSCOREMAT.2011.Q)5                                0.4046 1.084e+01
## Bike_lane.by.street.2011ct                             583.6726 1.018e+04
## factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct  -567.9511 1.018e+04
## factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct 24708.7169 4.830e+05
## factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct   506.9648 1.186e+04
## factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct  -569.8480 1.018e+04
##                                                       t-value p-value
## (Intercept)                                          -1.59538  0.1106
## factor(wSCOREMAT.2011.Q)2                             0.13582  0.8920
## factor(wSCOREMAT.2011.Q)3                             1.65808  0.0973
## factor(wSCOREMAT.2011.Q)4                             0.06036  0.9519
## factor(wSCOREMAT.2011.Q)5                             0.03733  0.9702
## Bike_lane.by.street.2011ct                            0.05735  0.9543
## factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct -0.05580  0.9555
## factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct  0.05115  0.9592
## factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct  0.04274  0.9659
## factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct -0.05599  0.9553
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##       1.rho 
## -0.01462678 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  979.1  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -145.6161</code></pre>
<pre class="r"><code># Not converging...
# ci.lmm.zero.2 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)2&#39;)
# ci.lmm.zero.3 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)3&#39;)
# ci.lmm.zero.4 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)4&#39;)
# ci.lmm.zero.5 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)5&#39;)
# ci.lmm.zero.2.i &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct&#39;)
# ci.lmm.zero.3.i &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct&#39;)
# ci.lmm.zero.4.i &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct&#39;)
# ci.lmm.zero.5.i &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct&#39;)

# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                                              lower        upper
## (Intercept)                                          -3.176951e+01 3.257861e+00
## factor(wSCOREMAT.2011.Q)2                            -2.004476e+01 2.302961e+01
## factor(wSCOREMAT.2011.Q)3                            -3.559626e+00 4.266098e+01
## factor(wSCOREMAT.2011.Q)4                            -2.236240e+01 2.378345e+01
## factor(wSCOREMAT.2011.Q)5                            -2.083780e+01 2.164691e+01
## Bike_lane.by.street.2011ct                           -1.936377e+04 2.053112e+04
## factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct -2.051543e+04 1.937953e+04
## factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct -9.219986e+05 9.714160e+05
## factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct -2.274054e+04 2.375447e+04
## factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct -2.051731e+04 1.937761e+04</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout)
}

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ factor(wSCOREMAT.2011.Q) * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ factor(wSCOREMAT.2011.Q) * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                        Estimate Cond. SE
## (Intercept)                                          -2.6530976 0.079798
## factor(wSCOREMAT.2011.Q)2                            -0.0476477 0.097618
## factor(wSCOREMAT.2011.Q)3                            -0.2787911 0.103109
## factor(wSCOREMAT.2011.Q)4                            -0.1176220 0.103883
## factor(wSCOREMAT.2011.Q)5                             0.0906718 0.106665
## Bike_lane.by.street.2011ct                            0.0513281 0.004010
## factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct  0.0001476 0.005746
## factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct  0.0205741 0.006444
## factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct  0.0051395 0.006053
## factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct -0.0070841 0.006645
##                                                        t-value  p-value
## (Intercept)                                          -33.24764 0.000000
## factor(wSCOREMAT.2011.Q)2                             -0.48811 0.625475
## factor(wSCOREMAT.2011.Q)3                             -2.70385 0.006854
## factor(wSCOREMAT.2011.Q)4                             -1.13226 0.257526
## factor(wSCOREMAT.2011.Q)5                              0.85006 0.395290
## Bike_lane.by.street.2011ct                            12.80005 0.000000
## factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct   0.02569 0.979502
## factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct   3.19275 0.001409
## factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct   0.84907 0.395841
## factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct  -1.06606 0.286397
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1503833 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1098  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1807.782</code></pre>
<pre class="r"><code>ci.lmm.cnt.2 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2 upper factor(wSCOREMAT.2011.Q)2 
##                      -0.2395054                       0.1445945</code></pre>
<pre class="r"><code>ci.lmm.cnt.3 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3 upper factor(wSCOREMAT.2011.Q)3 
##                     -0.48169048                     -0.07601927</code></pre>
<pre class="r"><code>ci.lmm.cnt.4 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4 upper factor(wSCOREMAT.2011.Q)4 
##                      -0.3221966                       0.0864844</code></pre>
<pre class="r"><code>ci.lmm.cnt.5 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5 upper factor(wSCOREMAT.2011.Q)5 
##                      -0.1190408                       0.3005133</code></pre>
<pre class="r"><code>ci.lmm.cnt.2.i &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct 
##                                                -0.01118639 
## upper factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct 
##                                                 0.01143479</code></pre>
<pre class="r"><code>ci.lmm.cnt.3.i &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct 
##                                                0.007897454 
## upper factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct 
##                                                0.033255825</code></pre>
<pre class="r"><code>ci.lmm.cnt.4.i &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct 
##                                               -0.006763394 
## upper factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct 
##                                                0.017054815</code></pre>
<pre class="r"><code>ci.lmm.cnt.5.i &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct 
##                                               -0.020247628 
## upper factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct 
##                                                0.005898914</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout)
}

# Plotting interaction
.t &lt;- clean_bei.cnt$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm.cnt))
.t &lt;- filter(.t, wSCOREMAT.2011.Q %in% c(1, 3)) # Keeping only significant interaction terms

g_mat_bk.hrdl.categ &lt;- ggplot(.t, aes(y=100*predict/street_length.hm, x=Bike_lane.by.street.2011ct, colour=factor(wSCOREMAT.2011.Q), fill=factor(wSCOREMAT.2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl[c(1, 3)]) +
  scale_fill_manual(values = qtl[c(1, 3)]) +
  labs(colour=&#39;wSCOREMAT.2011.Q&#39;, fill=&#39;wSCOREMAT.2011.Q&#39;)
g_mat_bk.hrdl.categ</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-c-1.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3930.795</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.000000e+00</td>
<td align="right">0.111</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">4.448000e+00</td>
<td align="right">0.892</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">3.095638e+08</td>
<td align="right">0.097</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">2.035000e+00</td>
<td align="right">0.952</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">1.499000e+00</td>
<td align="right">0.970</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">3.060472e+253</td>
<td align="right">0.954</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct</td>
<td align="right">0.000000e+00</td>
<td align="right">0.955</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct</td>
<td align="right">Inf</td>
<td align="right">0.959</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct</td>
<td align="right">1.485942e+220</td>
<td align="right">0.966</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct</td>
<td align="right">0.000000e+00</td>
<td align="right">0.955</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.070</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.953</td>
<td align="right">0.625</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.757</td>
<td align="right">0.007</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.889</td>
<td align="right">0.258</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">1.095</td>
<td align="right">0.395</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.053</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct</td>
<td align="right">1.000</td>
<td align="right">0.980</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct</td>
<td align="right">1.021</td>
<td align="right">0.001</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct</td>
<td align="right">1.005</td>
<td align="right">0.396</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct</td>
<td align="right">0.993</td>
<td align="right">0.286</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q.2 = round(exp(ci.lmm.cnt.2$interval), 3),
           wSCOREMAT.2011.Q.3 = round(exp(ci.lmm.cnt.3$interval), 3),
           wSCOREMAT.2011.Q.4 = round(exp(ci.lmm.cnt.4$interval), 3),
           wSCOREMAT.2011.Q.5 = round(exp(ci.lmm.cnt.5$interval), 3),
           `wSCOREMAT.2011.Q.2:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.2.i$interval), 3),
           `wSCOREMAT.2011.Q.3:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.3.i$interval), 3),
           `wSCOREMAT.2011.Q.4:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.4.i$interval), 3),
           `wSCOREMAT.2011.Q.5:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.5.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2</td>
<td align="right">0.787</td>
<td align="right">1.156</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3</td>
<td align="right">0.618</td>
<td align="right">0.927</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4</td>
<td align="right">0.725</td>
<td align="right">1.090</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5</td>
<td align="right">0.888</td>
<td align="right">1.351</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2.Bike_lane.by.street.2011ct</td>
<td align="right">0.989</td>
<td align="right">1.012</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3.Bike_lane.by.street.2011ct</td>
<td align="right">1.008</td>
<td align="right">1.034</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4.Bike_lane.by.street.2011ct</td>
<td align="right">0.993</td>
<td align="right">1.017</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5.Bike_lane.by.street.2011ct</td>
<td align="right">0.980</td>
<td align="right">1.006</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-3" class="section level3" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Greenness change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ factor(wSCOREMAT.2011.Q)* pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ factor(wSCOREMAT.2011.Q) * pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                 Estimate  Cond. SE  t-value
## (Intercept)                                   -1.5735882 0.0426297 -36.9130
## factor(wSCOREMAT.2011.Q)2                     -0.0322855 0.0560597  -0.5759
## factor(wSCOREMAT.2011.Q)3                     -0.0088857 0.0576215  -0.1542
## factor(wSCOREMAT.2011.Q)4                     -0.0836336 0.0635746  -1.3155
## factor(wSCOREMAT.2011.Q)5                     -0.4068994 0.0790521  -5.1472
## pct_esp_vert_2011ct                            0.0177927 0.0006874  25.8849
## factor(wSCOREMAT.2011.Q)2:pct_esp_vert_2011ct  0.0006060 0.0009295   0.6520
## factor(wSCOREMAT.2011.Q)3:pct_esp_vert_2011ct  0.0002387 0.0009717   0.2457
## factor(wSCOREMAT.2011.Q)4:pct_esp_vert_2011ct  0.0019576 0.0012456   1.5716
## factor(wSCOREMAT.2011.Q)5:pct_esp_vert_2011ct  0.0111026 0.0021491   5.1662
##                                                 p-value
## (Intercept)                                   0.000e+00
## factor(wSCOREMAT.2011.Q)2                     5.647e-01
## factor(wSCOREMAT.2011.Q)3                     8.774e-01
## factor(wSCOREMAT.2011.Q)4                     1.883e-01
## factor(wSCOREMAT.2011.Q)5                     2.644e-07
## pct_esp_vert_2011ct                           0.000e+00
## factor(wSCOREMAT.2011.Q)2:pct_esp_vert_2011ct 5.144e-01
## factor(wSCOREMAT.2011.Q)3:pct_esp_vert_2011ct 8.059e-01
## factor(wSCOREMAT.2011.Q)4:pct_esp_vert_2011ct 1.160e-01
## factor(wSCOREMAT.2011.Q)5:pct_esp_vert_2011ct 2.389e-07
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1357452 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.001909  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1882.725</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2 upper factor(wSCOREMAT.2011.Q)2 
##                     -0.14232696                      0.07780193</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3 upper factor(wSCOREMAT.2011.Q)3 
##                      -0.1221221                       0.1043164</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4 upper factor(wSCOREMAT.2011.Q)4 
##                     -0.20886312                      0.04177754</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5 upper factor(wSCOREMAT.2011.Q)5 
##                      -0.5626444                      -0.2516544</code></pre>
<pre class="r"><code>ci.lmm.2.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)2:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2:pct_esp_vert_2011ct 
##                                        -0.001222176 
## upper factor(wSCOREMAT.2011.Q)2:pct_esp_vert_2011ct 
##                                         0.002430290</code></pre>
<pre class="r"><code>ci.lmm.3.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)3:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3:pct_esp_vert_2011ct 
##                                        -0.001672635 
## upper factor(wSCOREMAT.2011.Q)3:pct_esp_vert_2011ct 
##                                         0.002145888</code></pre>
<pre class="r"><code>ci.lmm.4.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)4:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4:pct_esp_vert_2011ct 
##                                        -0.000493686 
## upper factor(wSCOREMAT.2011.Q)4:pct_esp_vert_2011ct 
##                                         0.004403640</code></pre>
<pre class="r"><code>ci.lmm.5.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)5:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5:pct_esp_vert_2011ct 
##                                         0.006886857 
## upper factor(wSCOREMAT.2011.Q)5:pct_esp_vert_2011ct 
##                                         0.015320786</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}

# Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))
.t &lt;- filter(.t, wSCOREMAT.2011.Q %in% c(1, 4, 5)) # Keeping only significant interaction terms

g_mat_gr.categ &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_2011ct, colour=factor(wSCOREMAT.2011.Q), fill=factor(wSCOREMAT.2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl[c(1, 4, 5)]) +
  scale_fill_manual(values = qtl[c(1, 4, 5)]) +
  labs(colour=&#39;wSCOREMAT.2011.Q&#39;, fill=&#39;wSCOREMAT.2011.Q&#39;)
g_mat_gr.categ</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-51-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.207</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.968</td>
<td align="right">0.565</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.991</td>
<td align="right">0.877</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.920</td>
<td align="right">0.188</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.666</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.018</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)2:pct_esp_vert_2011ct</td>
<td align="right">1.001</td>
<td align="right">0.514</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)3:pct_esp_vert_2011ct</td>
<td align="right">1.000</td>
<td align="right">0.806</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)4:pct_esp_vert_2011ct</td>
<td align="right">1.002</td>
<td align="right">0.116</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)5:pct_esp_vert_2011ct</td>
<td align="right">1.011</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code># LRT of main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(wSCOREMAT.2011.Q))</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre class="r"><code>LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##     chi2_LR df      p_value
## p_v 31.4152  4 2.518781e-06</code></pre>
<pre class="r"><code># CI
data.frame(wSCOREMAT.2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           wSCOREMAT.2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           wSCOREMAT.2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           wSCOREMAT.2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           `wSCOREMAT.2011.Q.2:pct_esp_vert_2011ct` = round(exp(ci.lmm.2.i$interval), 3),
           `wSCOREMAT.2011.Q.3:pct_esp_vert_2011ct` = round(exp(ci.lmm.3.i$interval), 3),
           `wSCOREMAT.2011.Q.4:pct_esp_vert_2011ct` = round(exp(ci.lmm.4.i$interval), 3),
           `wSCOREMAT.2011.Q.5:pct_esp_vert_2011ct` = round(exp(ci.lmm.5.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2</td>
<td align="right">0.867</td>
<td align="right">1.081</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3</td>
<td align="right">0.885</td>
<td align="right">1.110</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4</td>
<td align="right">0.812</td>
<td align="right">1.043</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5</td>
<td align="right">0.570</td>
<td align="right">0.778</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2.pct_esp_vert_2011ct</td>
<td align="right">0.999</td>
<td align="right">1.002</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3.pct_esp_vert_2011ct</td>
<td align="right">0.998</td>
<td align="right">1.002</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4.pct_esp_vert_2011ct</td>
<td align="right">1.000</td>
<td align="right">1.004</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5.pct_esp_vert_2011ct</td>
<td align="right">1.007</td>
<td align="right">1.015</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-3" class="section level3" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> Canopy (trees) change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ factor(wSCOREMAT.2011.Q) * pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ factor(wSCOREMAT.2011.Q) * pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                     Estimate Cond. SE t-value
## (Intercept)                                        -2.178719 0.048382 -45.031
## factor(wSCOREMAT.2011.Q)2                          -0.175408 0.065599  -2.674
## factor(wSCOREMAT.2011.Q)3                          -0.208579 0.068404  -3.049
## factor(wSCOREMAT.2011.Q)4                          -0.346803 0.073627  -4.710
## factor(wSCOREMAT.2011.Q)5                          -0.770440 0.091522  -8.418
## pct_esp_vert_high_2011ct                            0.033510 0.001367  24.509
## factor(wSCOREMAT.2011.Q)2:pct_esp_vert_high_2011ct  0.007049 0.002179   3.236
## factor(wSCOREMAT.2011.Q)3:pct_esp_vert_high_2011ct  0.007039 0.002433   2.893
## factor(wSCOREMAT.2011.Q)4:pct_esp_vert_high_2011ct  0.015786 0.003052   5.172
## factor(wSCOREMAT.2011.Q)5:pct_esp_vert_high_2011ct  0.043246 0.005403   8.004
##                                                      p-value
## (Intercept)                                        0.000e+00
## factor(wSCOREMAT.2011.Q)2                          7.497e-03
## factor(wSCOREMAT.2011.Q)3                          2.294e-03
## factor(wSCOREMAT.2011.Q)4                          2.474e-06
## factor(wSCOREMAT.2011.Q)5                          0.000e+00
## pct_esp_vert_high_2011ct                           0.000e+00
## factor(wSCOREMAT.2011.Q)2:pct_esp_vert_high_2011ct 1.213e-03
## factor(wSCOREMAT.2011.Q)3:pct_esp_vert_high_2011ct 3.813e-03
## factor(wSCOREMAT.2011.Q)4:pct_esp_vert_high_2011ct 2.311e-07
## factor(wSCOREMAT.2011.Q)5:pct_esp_vert_high_2011ct 1.221e-15
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1380067 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.008885  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1717.103</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2 upper factor(wSCOREMAT.2011.Q)2 
##                     -0.30426403                     -0.04677546</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3 upper factor(wSCOREMAT.2011.Q)3 
##                     -0.34270903                     -0.07404558</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4 upper factor(wSCOREMAT.2011.Q)4 
##                      -0.4911884                      -0.2022148</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5 upper factor(wSCOREMAT.2011.Q)5 
##                      -0.9503425                      -0.5903152</code></pre>
<pre class="r"><code>ci.lmm.2.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)2:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2:pct_esp_vert_high_2011ct 
##                                              0.002780478 
## upper factor(wSCOREMAT.2011.Q)2:pct_esp_vert_high_2011ct 
##                                              0.011350195</code></pre>
<pre class="r"><code>ci.lmm.3.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)3:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3:pct_esp_vert_high_2011ct 
##                                              0.002265341 
## upper factor(wSCOREMAT.2011.Q)3:pct_esp_vert_high_2011ct 
##                                              0.011835143</code></pre>
<pre class="r"><code>ci.lmm.4.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)4:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4:pct_esp_vert_high_2011ct 
##                                               0.00978752 
## upper factor(wSCOREMAT.2011.Q)4:pct_esp_vert_high_2011ct 
##                                               0.02176672</code></pre>
<pre class="r"><code>ci.lmm.5.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)5:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5:pct_esp_vert_high_2011ct 
##                                               0.03257925 
## upper factor(wSCOREMAT.2011.Q)5:pct_esp_vert_high_2011ct 
##                                               0.05380575</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}

# Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))

g_mat_tc.categ &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_high_2011ct, colour=factor(wSCOREMAT.2011.Q), fill=factor(wSCOREMAT.2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl) +
  scale_fill_manual(values = qtl) +
  labs(colour=&#39;wSCOREMAT.2011.Q&#39;, fill=&#39;wSCOREMAT.2011.Q&#39;)
g_mat_tc.categ</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-53-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.113</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.839</td>
<td align="right">0.007</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.812</td>
<td align="right">0.002</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.707</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.463</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.034</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)2:pct_esp_vert_high_2011ct</td>
<td align="right">1.007</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)3:pct_esp_vert_high_2011ct</td>
<td align="right">1.007</td>
<td align="right">0.004</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)4:pct_esp_vert_high_2011ct</td>
<td align="right">1.016</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)5:pct_esp_vert_high_2011ct</td>
<td align="right">1.044</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code># LRT of main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(wSCOREMAT.2011.Q))</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre class="r"><code>LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 72.03801  4 8.437695e-15</code></pre>
<pre class="r"><code># CI
data.frame(wSCOREMAT.2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           wSCOREMAT.2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           wSCOREMAT.2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           wSCOREMAT.2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           `wSCOREMAT.2011.Q.2:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.2.i$interval), 3),
           `wSCOREMAT.2011.Q.3:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.3.i$interval), 3),
           `wSCOREMAT.2011.Q.4:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.4.i$interval), 3),
           `wSCOREMAT.2011.Q.5:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.5.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2</td>
<td align="right">0.738</td>
<td align="right">0.954</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3</td>
<td align="right">0.710</td>
<td align="right">0.929</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4</td>
<td align="right">0.612</td>
<td align="right">0.817</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5</td>
<td align="right">0.387</td>
<td align="right">0.554</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2.pct_esp_vert_high_2011ct</td>
<td align="right">1.003</td>
<td align="right">1.011</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3.pct_esp_vert_high_2011ct</td>
<td align="right">1.002</td>
<td align="right">1.012</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4.pct_esp_vert_high_2011ct</td>
<td align="right">1.010</td>
<td align="right">1.022</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5.pct_esp_vert_high_2011ct</td>
<td align="right">1.033</td>
<td align="right">1.055</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-visible-minority-1" class="section level2 tabset" number="7.2">
<h2 class="tabset"><span class="header-section-number">7.2</span> UI vs Visible minority</h2>
<div id="bike-lane-length-change-hurdle-4" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Bike lane length change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ factor(vis_minority_2011.Q) * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial(), 
                 init=list(lambda=NaN)) # Outer optimization not working, forcing inner iterative solving...
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ factor(vis_minority_2011.Q) * 
##     Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of lambda and corrPars by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                                         Estimate Cond. SE
## (Intercept)                                              -4.0562   0.4643
## factor(vis_minority_2011.Q)2                              0.6022   0.6828
## factor(vis_minority_2011.Q)3                              0.1773   0.6288
## factor(vis_minority_2011.Q)4                             -1.3589   0.6932
## factor(vis_minority_2011.Q)5                             -1.5259   0.5970
## Bike_lane.by.street.2011ct                               30.6198  81.1599
## factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct 198.9227 725.4538
## factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct -29.3527  81.1646
## factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct 259.0025 626.4576
## factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct -29.2074  81.1618
##                                                         t-value p-value
## (Intercept)                                             -8.7365 0.00000
## factor(vis_minority_2011.Q)2                             0.8819 0.37783
## factor(vis_minority_2011.Q)3                             0.2820 0.77797
## factor(vis_minority_2011.Q)4                            -1.9604 0.04995
## factor(vis_minority_2011.Q)5                            -2.5557 0.01060
## Bike_lane.by.street.2011ct                               0.3773 0.70597
## factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct  0.2742 0.78393
## factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct -0.3616 0.71762
## factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct  0.4134 0.67928
## factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct -0.3599 0.71895
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##      1.rho 
## 0.08038497 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  2.645  
##              --- Coefficients for log(lambda):
##  Group        Term Estimate Cond.SE
##  ct_no (Intercept)   0.9725  0.1839
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -150.4966
## lambda leverages numerically 1 were replaced by 1- 1e-16 (as controlled by option &#39;regul_lev_lambda&#39;)</code></pre>
<pre class="r"><code># Not converging...
# ci.lmm.zero.2 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)2&#39;)
# ci.lmm.zero.3 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)3&#39;)
# ci.lmm.zero.4 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)4&#39;)
# ci.lmm.zero.5 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)5&#39;)
# ci.lmm.zero.2.i &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct&#39;)
# ci.lmm.zero.3.i &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct&#39;)
# ci.lmm.zero.4.i &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct&#39;)
# ci.lmm.zero.5.i &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct&#39;)

# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                                                 lower
## (Intercept)                                                -4.9662174
## factor(vis_minority_2011.Q)2                               -0.7361522
## factor(vis_minority_2011.Q)3                               -1.0551810
## factor(vis_minority_2011.Q)4                               -2.7175925
## factor(vis_minority_2011.Q)5                               -2.6960217
## Bike_lane.by.street.2011ct                               -128.4506849
## factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct -1222.9406865
## factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct  -188.4323522
## factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct  -968.8319099
## factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct  -188.2815866
##                                                                 upper
## (Intercept)                                             -3.146243e+00
## factor(vis_minority_2011.Q)2                             1.940566e+00
## factor(vis_minority_2011.Q)3                             1.409797e+00
## factor(vis_minority_2011.Q)4                            -2.703756e-04
## factor(vis_minority_2011.Q)5                            -3.556815e-01
## Bike_lane.by.street.2011ct                               1.896903e+02
## factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct  1.620786e+03
## factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct  1.297270e+02
## factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct  1.486837e+03
## factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct  1.298667e+02</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout)
}

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ factor(vis_minority_2011.Q) * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ factor(vis_minority_2011.Q) * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                          Estimate Cond. SE
## (Intercept)                                             -2.649646 0.081505
## factor(vis_minority_2011.Q)2                            -0.078942 0.098767
## factor(vis_minority_2011.Q)3                            -0.056722 0.103763
## factor(vis_minority_2011.Q)4                            -0.224426 0.107144
## factor(vis_minority_2011.Q)5                             0.019550 0.110105
## Bike_lane.by.street.2011ct                               0.052566 0.004523
## factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct  0.003060 0.005958
## factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct  0.002600 0.006880
## factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct  0.012985 0.006902
## factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct -0.007357 0.007015
##                                                          t-value p-value
## (Intercept)                                             -32.5091 0.00000
## factor(vis_minority_2011.Q)2                             -0.7993 0.42413
## factor(vis_minority_2011.Q)3                             -0.5466 0.58462
## factor(vis_minority_2011.Q)4                             -2.0946 0.03620
## factor(vis_minority_2011.Q)5                              0.1776 0.85907
## Bike_lane.by.street.2011ct                               11.6222 0.00000
## factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct   0.5137 0.60750
## factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct   0.3779 0.70551
## factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct   1.8813 0.05993
## factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct  -1.0487 0.29430
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##    1.rho 
## 0.150484 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1137  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1809.391</code></pre>
<pre class="r"><code>ci.lmm.cnt.2 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2 upper factor(vis_minority_2011.Q)2 
##                         -0.2734080                          0.1152141</code></pre>
<pre class="r"><code>ci.lmm.cnt.3 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3 upper factor(vis_minority_2011.Q)3 
##                         -0.2610830                          0.1472212</code></pre>
<pre class="r"><code>ci.lmm.cnt.4 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4 upper factor(vis_minority_2011.Q)4 
##                        -0.43590616                        -0.01402546</code></pre>
<pre class="r"><code>ci.lmm.cnt.5 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5 upper factor(vis_minority_2011.Q)5 
##                         -0.1971876                          0.2360893</code></pre>
<pre class="r"><code>ci.lmm.cnt.2.i &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct 
##                                                  -0.008659156 
## upper factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct 
##                                                   0.014789833</code></pre>
<pre class="r"><code>ci.lmm.cnt.3.i &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct 
##                                                   -0.01092843 
## upper factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct 
##                                                    0.01614587</code></pre>
<pre class="r"><code>ci.lmm.cnt.4.i &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct 
##                                                 -0.0005690631 
## upper factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct 
##                                                  0.0266062523</code></pre>
<pre class="r"><code>ci.lmm.cnt.5.i &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct 
##                                                  -0.021248712 
## upper factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct 
##                                                   0.006356914</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout)
}

# Plotting interaction
.t &lt;- clean_bei.cnt$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm.cnt))
.t &lt;- filter(.t, vis_minority_2011.Q %in% c(1, 4)) # Keeping only significant interaction terms

g_vis_bk.hrdl.categ &lt;- ggplot(.t, aes(y=100*predict/street_length.hm, x=Bike_lane.by.street.2011ct, colour=factor(vis_minority_2011.Q), fill=factor(vis_minority_2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl[c(1, 4)]) +
  scale_fill_manual(values = qtl[c(1, 4)]) +
  labs(colour=&#39;vis_minority_2011.Q&#39;, fill=&#39;vis_minority_2011.Q&#39;)
g_vis_bk.hrdl.categ</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-2c-1.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3943.776</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<colgroup>
<col width="71%" />
<col width="17%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">1.700000e-02</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">1.826000e+00</td>
<td align="right">0.378</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">1.194000e+00</td>
<td align="right">0.778</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">2.570000e-01</td>
<td align="right">0.050</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">2.170000e-01</td>
<td align="right">0.011</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.986152e+13</td>
<td align="right">0.706</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct</td>
<td align="right">2.460494e+86</td>
<td align="right">0.784</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct</td>
<td align="right">0.000000e+00</td>
<td align="right">0.718</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct</td>
<td align="right">3.043382e+112</td>
<td align="right">0.679</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct</td>
<td align="right">0.000000e+00</td>
<td align="right">0.719</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.071</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">0.924</td>
<td align="right">0.424</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">0.945</td>
<td align="right">0.585</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.799</td>
<td align="right">0.036</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">1.020</td>
<td align="right">0.859</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.054</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct</td>
<td align="right">1.003</td>
<td align="right">0.607</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct</td>
<td align="right">1.003</td>
<td align="right">0.706</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct</td>
<td align="right">1.013</td>
<td align="right">0.060</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct</td>
<td align="right">0.993</td>
<td align="right">0.294</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q.2 = round(exp(ci.lmm.cnt.2$interval), 3),
           vis_minority_2011.Q.3 = round(exp(ci.lmm.cnt.3$interval), 3),
           vis_minority_2011.Q.4 = round(exp(ci.lmm.cnt.4$interval), 3),
           vis_minority_2011.Q.5 = round(exp(ci.lmm.cnt.5$interval), 3),
           `vis_minority_2011.Q.2:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.2.i$interval), 3),
           `vis_minority_2011.Q.3:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.3.i$interval), 3),
           `vis_minority_2011.Q.4:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.4.i$interval), 3),
           `vis_minority_2011.Q.5:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.5.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2</td>
<td align="right">0.761</td>
<td align="right">1.122</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3</td>
<td align="right">0.770</td>
<td align="right">1.159</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4</td>
<td align="right">0.647</td>
<td align="right">0.986</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5</td>
<td align="right">0.821</td>
<td align="right">1.266</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2.Bike_lane.by.street.2011ct</td>
<td align="right">0.991</td>
<td align="right">1.015</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3.Bike_lane.by.street.2011ct</td>
<td align="right">0.989</td>
<td align="right">1.016</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4.Bike_lane.by.street.2011ct</td>
<td align="right">0.999</td>
<td align="right">1.027</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5.Bike_lane.by.street.2011ct</td>
<td align="right">0.979</td>
<td align="right">1.006</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-4" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Greenness change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ vis_minority_2011.Q * pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ factor(vis_minority_2011.Q) * pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ factor(vis_minority_2011.Q) * pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                    Estimate  Cond. SE  t-value
## (Intercept)                                      -1.5641340 0.0422445 -37.0258
## factor(vis_minority_2011.Q)2                     -0.0548760 0.0559928  -0.9801
## factor(vis_minority_2011.Q)3                     -0.0572034 0.0641486  -0.8917
## factor(vis_minority_2011.Q)4                     -0.0810112 0.0558706  -1.4500
## factor(vis_minority_2011.Q)5                     -0.2437760 0.0632134  -3.8564
## pct_esp_vert_2011ct                               0.0176047 0.0006826  25.7925
## factor(vis_minority_2011.Q)2:pct_esp_vert_2011ct  0.0009851 0.0009238   1.0664
## factor(vis_minority_2011.Q)3:pct_esp_vert_2011ct  0.0014117 0.0012208   1.1564
## factor(vis_minority_2011.Q)4:pct_esp_vert_2011ct  0.0014061 0.0009762   1.4404
## factor(vis_minority_2011.Q)5:pct_esp_vert_2011ct  0.0051993 0.0012986   4.0038
##                                                    p-value
## (Intercept)                                      0.000e+00
## factor(vis_minority_2011.Q)2                     3.271e-01
## factor(vis_minority_2011.Q)3                     3.725e-01
## factor(vis_minority_2011.Q)4                     1.471e-01
## factor(vis_minority_2011.Q)5                     1.151e-04
## pct_esp_vert_2011ct                              0.000e+00
## factor(vis_minority_2011.Q)2:pct_esp_vert_2011ct 2.863e-01
## factor(vis_minority_2011.Q)3:pct_esp_vert_2011ct 2.475e-01
## factor(vis_minority_2011.Q)4:pct_esp_vert_2011ct 1.497e-01
## factor(vis_minority_2011.Q)5:pct_esp_vert_2011ct 6.233e-05
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1345657 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002057  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1889.365</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2 upper factor(vis_minority_2011.Q)2 
##                        -0.16461043                         0.05568929</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3 upper factor(vis_minority_2011.Q)3 
##                         -0.1831642                          0.0693866</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4 upper factor(vis_minority_2011.Q)4 
##                        -0.19064003                         0.02960391</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5 upper factor(vis_minority_2011.Q)5 
##                         -0.3677580                         -0.1195351</code></pre>
<pre class="r"><code>ci.lmm.2.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)2:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2:pct_esp_vert_2011ct 
##                                          -0.0008399776 
## upper factor(vis_minority_2011.Q)2:pct_esp_vert_2011ct 
##                                           0.0027952612</code></pre>
<pre class="r"><code>ci.lmm.3.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)3:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3:pct_esp_vert_2011ct 
##                                           -0.000991913 
## upper factor(vis_minority_2011.Q)3:pct_esp_vert_2011ct 
##                                            0.003807898</code></pre>
<pre class="r"><code>ci.lmm.4.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)4:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4:pct_esp_vert_2011ct 
##                                          -0.0005154984 
## upper factor(vis_minority_2011.Q)4:pct_esp_vert_2011ct 
##                                           0.0033230989</code></pre>
<pre class="r"><code>ci.lmm.5.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)5:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5:pct_esp_vert_2011ct 
##                                            0.002653799 
## upper factor(vis_minority_2011.Q)5:pct_esp_vert_2011ct 
##                                            0.007760336</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}

# Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))
.t &lt;- filter(.t, vis_minority_2011.Q %in% c(1, 2, 3, 4, 5)) # Keeping only significant interaction terms (all significant)

g_vis_gr.categ &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_2011ct, colour=factor(vis_minority_2011.Q), fill=factor(vis_minority_2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl[c(1, 2, 3, 4, 5)]) +
  scale_fill_manual(values = qtl[c(1, 2, 3, 4, 5)]) +
  labs(colour=&#39;vis_minority_2011.Q&#39;, fill=&#39;vis_minority_2011.Q&#39;)
g_vis_gr.categ</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-56-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.209</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">0.947</td>
<td align="right">0.327</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">0.944</td>
<td align="right">0.373</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.922</td>
<td align="right">0.147</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.784</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.018</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)2:pct_esp_vert_2011ct</td>
<td align="right">1.001</td>
<td align="right">0.286</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)3:pct_esp_vert_2011ct</td>
<td align="right">1.001</td>
<td align="right">0.248</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)4:pct_esp_vert_2011ct</td>
<td align="right">1.001</td>
<td align="right">0.150</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)5:pct_esp_vert_2011ct</td>
<td align="right">1.005</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code># LRT of main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(vis_minority_2011.Q))</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre class="r"><code>LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df     p_value
## p_v 16.07472  4 0.002920527</code></pre>
<pre class="r"><code># CI
data.frame(vis_minority_2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           vis_minority_2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           vis_minority_2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           vis_minority_2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           `vis_minority_2011.Q.2:pct_esp_vert_2011ct` = round(exp(ci.lmm.2.i$interval), 3),
           `vis_minority_2011.Q.3:pct_esp_vert_2011ct` = round(exp(ci.lmm.3.i$interval), 3),
           `vis_minority_2011.Q.4:pct_esp_vert_2011ct` = round(exp(ci.lmm.4.i$interval), 3),
           `vis_minority_2011.Q.5:pct_esp_vert_2011ct` = round(exp(ci.lmm.5.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2</td>
<td align="right">0.848</td>
<td align="right">1.057</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3</td>
<td align="right">0.833</td>
<td align="right">1.072</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4</td>
<td align="right">0.826</td>
<td align="right">1.030</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5</td>
<td align="right">0.692</td>
<td align="right">0.887</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2.pct_esp_vert_2011ct</td>
<td align="right">0.999</td>
<td align="right">1.003</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3.pct_esp_vert_2011ct</td>
<td align="right">0.999</td>
<td align="right">1.004</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4.pct_esp_vert_2011ct</td>
<td align="right">0.999</td>
<td align="right">1.003</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5.pct_esp_vert_2011ct</td>
<td align="right">1.003</td>
<td align="right">1.008</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-4" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Canopy (trees) change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ vis_minority_2011.Q * pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ factor(vis_minority_2011.Q) * pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ factor(vis_minority_2011.Q) * pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                        Estimate Cond. SE
## (Intercept)                                           -2.268054 0.053294
## factor(vis_minority_2011.Q)2                          -0.089607 0.068156
## factor(vis_minority_2011.Q)3                           0.037427 0.071195
## factor(vis_minority_2011.Q)4                          -0.264702 0.069932
## factor(vis_minority_2011.Q)5                          -0.345748 0.080989
## pct_esp_vert_high_2011ct                               0.036459 0.001653
## factor(vis_minority_2011.Q)2:pct_esp_vert_high_2011ct  0.002923 0.002281
## factor(vis_minority_2011.Q)3:pct_esp_vert_high_2011ct -0.001599 0.002657
## factor(vis_minority_2011.Q)4:pct_esp_vert_high_2011ct  0.010308 0.002581
## factor(vis_minority_2011.Q)5:pct_esp_vert_high_2011ct  0.016413 0.003426
##                                                        t-value   p-value
## (Intercept)                                           -42.5576 0.000e+00
## factor(vis_minority_2011.Q)2                           -1.3147 1.886e-01
## factor(vis_minority_2011.Q)3                            0.5257 5.991e-01
## factor(vis_minority_2011.Q)4                           -3.7851 1.536e-04
## factor(vis_minority_2011.Q)5                           -4.2691 1.963e-05
## pct_esp_vert_high_2011ct                               22.0546 0.000e+00
## factor(vis_minority_2011.Q)2:pct_esp_vert_high_2011ct   1.2815 2.000e-01
## factor(vis_minority_2011.Q)3:pct_esp_vert_high_2011ct  -0.6019 5.472e-01
## factor(vis_minority_2011.Q)4:pct_esp_vert_high_2011ct   3.9945 6.482e-05
## factor(vis_minority_2011.Q)5:pct_esp_vert_high_2011ct   4.7911 1.659e-06
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1380284 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.0105  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1737.259</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2 upper factor(vis_minority_2011.Q)2 
##                        -0.22331594                         0.04414993</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3 upper factor(vis_minority_2011.Q)3 
##                         -0.1024562                          0.1771123</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4 upper factor(vis_minority_2011.Q)4 
##                         -0.4018329                         -0.1268827</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5 upper factor(vis_minority_2011.Q)5 
##                         -0.5047667                         -0.1869938</code></pre>
<pre class="r"><code>ci.lmm.2.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)2:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2:pct_esp_vert_high_2011ct 
##                                                 -0.00155326 
## upper factor(vis_minority_2011.Q)2:pct_esp_vert_high_2011ct 
##                                                  0.00741236</code></pre>
<pre class="r"><code>ci.lmm.3.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)3:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3:pct_esp_vert_high_2011ct 
##                                                -0.006814108 
## upper factor(vis_minority_2011.Q)3:pct_esp_vert_high_2011ct 
##                                                 0.003635254</code></pre>
<pre class="r"><code>ci.lmm.4.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)4:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4:pct_esp_vert_high_2011ct 
##                                                 0.005238727 
## upper factor(vis_minority_2011.Q)4:pct_esp_vert_high_2011ct 
##                                                 0.015391462</code></pre>
<pre class="r"><code>ci.lmm.5.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)5:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5:pct_esp_vert_high_2011ct 
##                                                 0.009689296 
## upper factor(vis_minority_2011.Q)5:pct_esp_vert_high_2011ct 
##                                                 0.023137153</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}

# Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))
.t &lt;- filter(.t, vis_minority_2011.Q %in% c(1, 2, 5)) # Keeping only significant interaction terms

g_vis_tc.categ &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_high_2011ct, colour=factor(vis_minority_2011.Q), fill=factor(vis_minority_2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl[c(1, 4, 5)]) +
  scale_fill_manual(values = qtl[c(1, 4, 5)]) +
  labs(colour=&#39;vis_minority_2011.Q&#39;, fill=&#39;vis_minority_2011.Q&#39;)
g_vis_tc.categ</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-58-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.104</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">0.914</td>
<td align="right">0.189</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">1.038</td>
<td align="right">0.599</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.767</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.708</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.037</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)2:pct_esp_vert_high_2011ct</td>
<td align="right">1.003</td>
<td align="right">0.200</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)3:pct_esp_vert_high_2011ct</td>
<td align="right">0.998</td>
<td align="right">0.547</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)4:pct_esp_vert_high_2011ct</td>
<td align="right">1.010</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)5:pct_esp_vert_high_2011ct</td>
<td align="right">1.017</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code># LRT of main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(vis_minority_2011.Q))</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre class="r"><code>LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 35.80911  4 3.167508e-07</code></pre>
<pre class="r"><code># CI
data.frame(vis_minority_2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           vis_minority_2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           vis_minority_2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           vis_minority_2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           `vis_minority_2011.Q.2:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.2.i$interval), 3),
           `vis_minority_2011.Q.3:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.3.i$interval), 3),
           `vis_minority_2011.Q.4:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.4.i$interval), 3),
           `vis_minority_2011.Q.5:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.5.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2</td>
<td align="right">0.800</td>
<td align="right">1.045</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3</td>
<td align="right">0.903</td>
<td align="right">1.194</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4</td>
<td align="right">0.669</td>
<td align="right">0.881</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5</td>
<td align="right">0.604</td>
<td align="right">0.829</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2.pct_esp_vert_high_2011ct</td>
<td align="right">0.998</td>
<td align="right">1.007</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3.pct_esp_vert_high_2011ct</td>
<td align="right">0.993</td>
<td align="right">1.004</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4.pct_esp_vert_high_2011ct</td>
<td align="right">1.005</td>
<td align="right">1.016</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5.pct_esp_vert_high_2011ct</td>
<td align="right">1.010</td>
<td align="right">1.023</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-gentrified-ct-1" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> UI vs gentrified CT</h2>
<p>No new models here, as <code>gentrified</code> variable is already used as a pure categorical variable.</p>
</div>
</div>
<div id="association-between-ses-and-ui-main-effect-no-interaction" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Association between SES and UI | Main effect, no interaction</h1>
<p>As discussed with Yan and Behzad, we rerun the UI models, without the interaction term <span class="math inline">\(SES \times UC_{2011}\)</span></p>
<div id="ui-vs-pampalon-material-2" class="section level2 tabset" number="8.1">
<h2 class="tabset"><span class="header-section-number">8.1</span> UI vs Pampalon | material</h2>
<div id="bike-lane-length-change-hurdle-5" class="section level3" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> Bike lane length change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q + Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ wSCOREMAT.2011.Q + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                  data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ wSCOREMAT.2011.Q + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                             Estimate Cond. SE  t-value   p-value
## (Intercept)                -4.906768   0.8597 -5.70736 1.147e-08
## wSCOREMAT.2011.Q           -0.005992   0.2083 -0.02876 9.771e-01
## Bike_lane.by.street.2011ct  2.496146   0.6977  3.57773 3.466e-04
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377136 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  5.772  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -149.7328</code></pre>
<pre class="r"><code># ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;wSCOREMAT.2011.Q&#39;) # Not converging
# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                 lower      upper
## (Intercept)                -6.5918014 -3.2217345
## wSCOREMAT.2011.Q           -0.4143207  0.4023376
## Bike_lane.by.street.2011ct  1.1287003  3.8635916</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                             Estimate Cond. SE  t-value p-value
## (Intercept)                -2.722506 0.070049 -38.8658  0.0000
## wSCOREMAT.2011.Q            0.002719 0.016920   0.1607  0.8723
## Bike_lane.by.street.2011ct  0.054524 0.002209  24.6839  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1502777 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1159  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1816.928</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.03059490             0.03598532</code></pre>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3943.321</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.007</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.994</td>
<td align="right">0.977</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">12.136</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero %&gt;% 
  data.frame() %&gt;% 
  slice(2) %&gt;%
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.661</td>
<td align="right">1.495</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.066</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">1.003</td>
<td align="right">0.872</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.056</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm.cnt$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.97</td>
<td align="right">1.037</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-5" class="section level3" number="8.1.2">
<h3><span class="header-section-number">8.1.2</span> Greenness change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ wSCOREMAT.2011.Q + pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ wSCOREMAT.2011.Q + pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ wSCOREMAT.2011.Q + pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                      Estimate  Cond. SE  t-value p-value
## (Intercept)         -1.622719 0.0303317 -53.4992  0.0000
## wSCOREMAT.2011.Q    -0.002903 0.0053591  -0.5417  0.5881
## pct_esp_vert_2011ct  0.018799 0.0003916  48.0014  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##    1.rho 
## 0.134586 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002185  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1899.339</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;wSCOREMAT.2011.Q&quot;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##           -0.013557419            0.007725432</code></pre>
<pre class="r"><code># Wald-test p-value for wSCOREMAT.2011.Q close to threshold, using LRT to improve accuracy
res.lmm.0 &lt;- update(res.lmm, . ~ . -wSCOREMAT.2011.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##       chi2_LR df   p_value
## p_v 0.2863924  1 0.5925417</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.197</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.997</td>
<td align="right">0.588</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.019</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.987</td>
<td align="right">1.008</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-5" class="section level3" number="8.1.3">
<h3><span class="header-section-number">8.1.3</span> Canopy (trees) change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ wSCOREMAT.2011.Q + pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ wSCOREMAT.2011.Q + pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ wSCOREMAT.2011.Q + pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                          Estimate Cond. SE t-value p-value
## (Intercept)              -2.33139 0.044977 -51.835  0.0000
## wSCOREMAT.2011.Q         -0.01165 0.009365  -1.244  0.2136
## pct_esp_vert_high_2011ct  0.03993 0.001018  39.225  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1378725 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.01264  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1759.457</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;wSCOREMAT.2011.Q&quot;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##           -0.030003749            0.006781971</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.097</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.988</td>
<td align="right">0.214</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.041</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.97</td>
<td align="right">1.007</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-visible-minority-2" class="section level2 tabset" number="8.2">
<h2 class="tabset"><span class="header-section-number">8.2</span> UI vs Visible minority</h2>
<div id="bike-lane-length-change-hurdle-6" class="section level3" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Bike lane length change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q + Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ vis_minority_2011.Q + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ vis_minority_2011.Q + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                            Estimate Cond. SE t-value  p-value
## (Intercept)                 -2.9916   0.9255  -3.232 0.001227
## vis_minority_2011.Q         -0.5414   0.2350  -2.303 0.021253
## Bike_lane.by.street.2011ct   2.8973   0.8300   3.491 0.000482
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1378848 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  7.163  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -145.4916</code></pre>
<pre class="r"><code># ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;vis_minority_2011.Q&#39;) # Not converging
# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                lower       upper
## (Intercept)                -4.805563 -1.17767746
## vis_minority_2011.Q        -1.002032 -0.08073096
## Bike_lane.by.street.2011ct  1.270430  4.52407931</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                            Estimate Cond. SE  t-value p-value
## (Intercept)                -2.66800 0.071599 -37.2630  0.0000
## vis_minority_2011.Q        -0.01460 0.017654  -0.8272  0.4081
## Bike_lane.by.street.2011ct  0.05455 0.002242  24.3299  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1504809 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1157  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1813.783</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.04943779                0.02007654</code></pre>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3928.548</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.050</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.582</td>
<td align="right">0.021</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">18.124</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero %&gt;% 
  data.frame() %&gt;% 
  slice(2) %&gt;%
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.367</td>
<td align="right">0.922</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.069</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.986</td>
<td align="right">0.408</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.056</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm.cnt$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.952</td>
<td align="right">1.02</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-6" class="section level3" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Greenness change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ vis_minority_2011.Q + pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ vis_minority_2011.Q + pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ vis_minority_2011.Q + pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                      Estimate  Cond. SE  t-value p-value
## (Intercept)         -1.630217 0.0282564 -57.6936  0.0000
## vis_minority_2011.Q -0.001778 0.0050107  -0.3548  0.7227
## pct_esp_vert_2011ct  0.018876 0.0003778  49.9586  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1352612 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002193  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1898.979</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;vis_minority_2011.Q&quot;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##              -0.011608925               0.008189944</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.196</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.998</td>
<td align="right">0.723</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.019</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.988</td>
<td align="right">1.008</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-6" class="section level3" number="8.2.3">
<h3><span class="header-section-number">8.2.3</span> Canopy (trees) change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ vis_minority_2011.Q + pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ vis_minority_2011.Q + pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ vis_minority_2011.Q + pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                           Estimate  Cond. SE t-value p-value
## (Intercept)              -2.368415 0.0425083 -55.716  0.0000
## vis_minority_2011.Q      -0.002105 0.0090337  -0.233  0.8158
## pct_esp_vert_high_2011ct  0.040422 0.0009895  40.850  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1380839 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.01276  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1758.026</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;vis_minority_2011.Q&quot;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.01982851                0.01565770</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.094</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.998</td>
<td align="right">0.816</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.041</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.98</td>
<td align="right">1.016</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-gentrified-ct-2" class="section level2 tabset" number="8.3">
<h2 class="tabset"><span class="header-section-number">8.3</span> UI vs gentrified CT</h2>
<p>Gentrified CT between 2011 and 2016</p>
<div id="bike-lane-length-change-hurdle-7" class="section level3" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Bike lane length change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ gentrif_status_2016 + Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ gentrif_status_2016 + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ gentrif_status_2016 + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE t-value   p-value
## (Intercept)                      -4.4608   0.5702 -7.8232 5.107e-15
## gentrif_status_2016Gentrified    -0.3921   0.6452 -0.6077 5.434e-01
## gentrif_status_2016Non eligible  -0.9083   0.7571 -1.1998 2.302e-01
## Bike_lane.by.street.2011ct        2.8642   0.7980  3.5894 3.315e-04
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1380079 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  6.454  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -147.1315</code></pre>
<pre class="r"><code># NB: not converging
# varfixef.zero &lt;- names(res.lmm.zero[[&#39;fixef&#39;]])
# ci.1.lmm.zero &lt;- confint(res.lmm.zero, varfixef.zero[2])
# ci.2.lmm.zero &lt;- confint(res.lmm.zero, varfixef.zero[3])
# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                     lower      upper
## (Intercept)                     -5.578439 -3.3432538
## gentrif_status_2016Gentrified   -1.656693  0.8725414
## gentrif_status_2016Non eligible -2.392202  0.5755399
## Bike_lane.by.street.2011ct       1.300204  4.4281284</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ gentrif_status_2016 + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ gentrif_status_2016 + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE  t-value p-value
## (Intercept)                     -2.67951  0.05235 -51.1890 0.00000
## gentrif_status_2016Gentrified    0.02021  0.05293   0.3819 0.70253
## gentrif_status_2016Non eligible -0.09996  0.05202  -1.9214 0.05468
## Bike_lane.by.street.2011ct       0.05481  0.00221  24.8031 0.00000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1503184 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1135  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1811.428</code></pre>
<pre class="r"><code>varfixef.cnt &lt;- names(res.lmm.cnt[[&#39;fixef&#39;]])
ci.1.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                         -0.08412051                          0.12432222</code></pre>
<pre class="r"><code>ci.2.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                          -0.202529322                           0.002429001</code></pre>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3929.12</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.012</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.676</td>
<td align="right">0.543</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.403</td>
<td align="right">0.230</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">17.534</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero %&gt;% 
  data.frame() %&gt;% 
  slice(2) %&gt;%
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.191</td>
<td align="right">2.393</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.069</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.020</td>
<td align="right">0.703</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.905</td>
<td align="right">0.055</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.056</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.cnt$interval, ci.2.lmm.cnt$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef.cnt[2:3])
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.919</td>
<td align="right">1.132</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.817</td>
<td align="right">1.002</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-7" class="section level3" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Greenness change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ gentrif_status_2016 + pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ gentrif_status_2016 + pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ gentrif_status_2016 + pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                  Estimate  Cond. SE  t-value p-value
## (Intercept)                     -1.637763 0.0222381 -73.6466  0.0000
## gentrif_status_2016Gentrified    0.003574 0.0216208   0.1653  0.8687
## gentrif_status_2016Non eligible  0.010172 0.0180015   0.5651  0.5720
## pct_esp_vert_2011ct              0.018792 0.0004276  43.9433  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1354899 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002185  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1898.879</code></pre>
<pre class="r"><code>varfixef &lt;- names(res.lmm[[&#39;fixef&#39;]])
ci.1.lmm &lt;- confint(res.lmm, varfixef[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                         -0.03886172                          0.04589248</code></pre>
<pre class="r"><code>ci.2.lmm &lt;- confint(res.lmm, varfixef[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                           -0.02532631                            0.04554155</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.194</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.004</td>
<td align="right">0.869</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.010</td>
<td align="right">0.572</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.019</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm$interval, ci.2.lmm$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef[2:3])
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.962</td>
<td align="right">1.047</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.975</td>
<td align="right">1.047</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-7" class="section level3" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Canopy (trees) change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ gentrif_status_2016 + pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ gentrif_status_2016 + pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ gentrif_status_2016 + pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE  t-value p-value
## (Intercept)                     -2.37842 0.031676 -75.0859  0.0000
## gentrif_status_2016Gentrified    0.02462 0.033736   0.7298  0.4655
## gentrif_status_2016Non eligible -0.02071 0.028880  -0.7171  0.4733
## pct_esp_vert_high_2011ct         0.04091 0.000996  41.0757  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1380259 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.01266  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1757.065</code></pre>
<pre class="r"><code>varfixef &lt;- names(res.lmm[[&#39;fixef&#39;]])
ci.1.lmm &lt;- confint(res.lmm, varfixef[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                         -0.04175084                          0.09068032</code></pre>
<pre class="r"><code>ci.2.lmm &lt;- confint(res.lmm, varfixef[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                           -0.07739748                            0.03596469</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.093</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.025</td>
<td align="right">0.466</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.980</td>
<td align="right">0.473</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.042</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm$interval, ci.2.lmm$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef[2:3])
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.959</td>
<td align="right">1.095</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.926</td>
<td align="right">1.037</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="association-between-ses-and-ui-main-effect-no-interaction-ses-as-categories" class="section level1" number="9">
<h1><span class="header-section-number">9</span> Association between SES and UI | Main effect, no interaction, SES as categories</h1>
<p>As discussed with Yan and Behzad, we rerun the UI models, without the interaction term <span class="math inline">\(SES \times UC_{2011}\)</span>, SES as categories instead of continuous</p>
<div id="ui-vs-pampalon-material-3" class="section level2 tabset" number="9.1">
<h2 class="tabset"><span class="header-section-number">9.1</span> UI vs Pampalon | material</h2>
<div id="bike-lane-length-change-hurdle-8" class="section level3" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Bike lane length change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ factor(wSCOREMAT.2011.Q) + Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ factor(wSCOREMAT.2011.Q) + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ factor(wSCOREMAT.2011.Q) + 
##     Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                            Estimate Cond. SE  t-value p-value
## (Intercept)                 -13.864    7.092 -1.95486 0.05060
## factor(wSCOREMAT.2011.Q)2    15.674    8.247  1.90051 0.05737
## factor(wSCOREMAT.2011.Q)3    15.255    8.554  1.78344 0.07451
## factor(wSCOREMAT.2011.Q)4     2.084    8.276  0.25185 0.80116
## factor(wSCOREMAT.2011.Q)5    -0.276    7.896 -0.03496 0.97211
## Bike_lane.by.street.2011ct   14.526    6.180  2.35058 0.01874
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1300809 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  414.9  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -142.6438</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ factor(wSCOREMAT.2011.Q) + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ factor(wSCOREMAT.2011.Q) + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                            Estimate Cond. SE  t-value p-value
## (Intercept)                -2.69690 0.064286 -41.9520  0.0000
## factor(wSCOREMAT.2011.Q)2  -0.03216 0.062899  -0.5113  0.6091
## factor(wSCOREMAT.2011.Q)3  -0.04030 0.065192  -0.6182  0.5364
## factor(wSCOREMAT.2011.Q)4  -0.04942 0.067039  -0.7372  0.4610
## factor(wSCOREMAT.2011.Q)5   0.03424 0.074919   0.4570  0.6476
## Bike_lane.by.street.2011ct  0.05463 0.002214  24.6792  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##    1.rho 
## 0.150297 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1155  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1815.939</code></pre>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3933.165</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.000</td>
<td align="right">0.051</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">6412881.434</td>
<td align="right">0.057</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">4219203.181</td>
<td align="right">0.075</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">8.038</td>
<td align="right">0.801</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.759</td>
<td align="right">0.972</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">2035989.348</td>
<td align="right">0.019</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.067</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.968</td>
<td align="right">0.609</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.960</td>
<td align="right">0.536</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.952</td>
<td align="right">0.461</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">1.035</td>
<td align="right">0.648</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.056</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-8" class="section level3" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> Greenness change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ factor(wSCOREMAT.2011.Q) + pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ factor(wSCOREMAT.2011.Q) + pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ factor(wSCOREMAT.2011.Q) + pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                            Estimate  Cond. SE  t-value p-value
## (Intercept)               -1.626912 0.0267689 -60.7762  0.0000
## factor(wSCOREMAT.2011.Q)2  0.004070 0.0170448   0.2388  0.8113
## factor(wSCOREMAT.2011.Q)3  0.008822 0.0179864   0.4905  0.6238
## factor(wSCOREMAT.2011.Q)4  0.014715 0.0204090   0.7210  0.4709
## factor(wSCOREMAT.2011.Q)5 -0.036032 0.0249055  -1.4468  0.1480
## pct_esp_vert_2011ct        0.018693 0.0003924  47.6384  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1337871 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002114  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1897.025</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.197</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">1.004</td>
<td align="right">0.811</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">1.009</td>
<td align="right">0.624</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">1.015</td>
<td align="right">0.471</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.965</td>
<td align="right">0.148</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.019</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-8" class="section level3" number="9.1.3">
<h3><span class="header-section-number">9.1.3</span> Canopy (trees) change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ factor(wSCOREMAT.2011.Q) + pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ factor(wSCOREMAT.2011.Q) + pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ factor(wSCOREMAT.2011.Q) + pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                            Estimate Cond. SE  t-value p-value
## (Intercept)               -2.370144 0.040176 -58.9944 0.00000
## factor(wSCOREMAT.2011.Q)2  0.037919 0.030519   1.2425 0.21405
## factor(wSCOREMAT.2011.Q)3  0.009507 0.033036   0.2878 0.77352
## factor(wSCOREMAT.2011.Q)4  0.024478 0.035691   0.6858 0.49283
## factor(wSCOREMAT.2011.Q)5 -0.077360 0.042906  -1.8030 0.07138
## pct_esp_vert_high_2011ct   0.039904 0.001009  39.5516 0.00000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1378561 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.01214  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1755.557</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.093</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">1.039</td>
<td align="right">0.214</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">1.010</td>
<td align="right">0.774</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">1.025</td>
<td align="right">0.493</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.926</td>
<td align="right">0.071</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.041</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-visible-minority-3" class="section level2 tabset" number="9.2">
<h2 class="tabset"><span class="header-section-number">9.2</span> UI vs Visible minority</h2>
<div id="bike-lane-length-change-hurdle-9" class="section level3" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> Bike lane length change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ factor(vis_minority_2011.Q) + Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ factor(vis_minority_2011.Q) + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ factor(vis_minority_2011.Q) + 
##     Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                              Estimate Cond. SE t-value   p-value
## (Intercept)                   -5.0900    1.163 -4.3780 1.198e-05
## factor(vis_minority_2011.Q)2   1.8354    1.354  1.3557 1.752e-01
## factor(vis_minority_2011.Q)3   1.1104    1.263  0.8795 3.791e-01
## factor(vis_minority_2011.Q)4   0.1611    1.311  0.1230 9.021e-01
## factor(vis_minority_2011.Q)5  -1.7016    1.287 -1.3223 1.861e-01
## Bike_lane.by.street.2011ct     3.3247    1.039  3.2002 1.373e-03
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1378411 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  11.44  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -143.3384</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ factor(vis_minority_2011.Q) + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ factor(vis_minority_2011.Q) + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                              Estimate Cond. SE  t-value p-value
## (Intercept)                  -2.67529 0.063059 -42.4252  0.0000
## factor(vis_minority_2011.Q)2 -0.03757 0.060202  -0.6241  0.5325
## factor(vis_minority_2011.Q)3 -0.02383 0.064355  -0.3702  0.7112
## factor(vis_minority_2011.Q)4 -0.07706 0.068068  -1.1321  0.2576
## factor(vis_minority_2011.Q)5 -0.04812 0.076711  -0.6272  0.5305
## Bike_lane.by.street.2011ct    0.05465 0.002247  24.3249  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1504718 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1155  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1813.409</code></pre>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3929.494</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.006</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">6.268</td>
<td align="right">0.175</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">3.036</td>
<td align="right">0.379</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">1.175</td>
<td align="right">0.902</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.182</td>
<td align="right">0.186</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">27.789</td>
<td align="right">0.001</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.069</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">0.963</td>
<td align="right">0.533</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">0.976</td>
<td align="right">0.711</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.926</td>
<td align="right">0.258</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.953</td>
<td align="right">0.531</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.056</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-9" class="section level3" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> Greenness change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ factor(vis_minority_2011.Q) + pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ factor(vis_minority_2011.Q) + pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ factor(vis_minority_2011.Q) + pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                Estimate Cond. SE   t-value p-value
## (Intercept)                  -1.6409263 0.026010 -63.08879  0.0000
## factor(vis_minority_2011.Q)2  0.0038858 0.017299   0.22463  0.8223
## factor(vis_minority_2011.Q)3  0.0249982 0.019765   1.26478  0.2060
## factor(vis_minority_2011.Q)4  0.0004811 0.018957   0.02538  0.9798
## factor(vis_minority_2011.Q)5 -0.0124081 0.022800  -0.54422  0.5863
## pct_esp_vert_2011ct           0.0189164 0.000381  49.64342  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1353621 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002188  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1897.455</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.194</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">1.004</td>
<td align="right">0.822</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">1.025</td>
<td align="right">0.206</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">1.000</td>
<td align="right">0.980</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.988</td>
<td align="right">0.586</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.019</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-9" class="section level3" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> Canopy (trees) change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ factor(vis_minority_2011.Q) + pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ factor(vis_minority_2011.Q) + pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ factor(vis_minority_2011.Q) + pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                               Estimate  Cond. SE   t-value p-value
## (Intercept)                  -2.377969 0.0380198 -62.54556  0.0000
## factor(vis_minority_2011.Q)2 -0.001729 0.0309577  -0.05586  0.9555
## factor(vis_minority_2011.Q)3  0.038080 0.0337279   1.12903  0.2589
## factor(vis_minority_2011.Q)4 -0.019030 0.0346832  -0.54869  0.5832
## factor(vis_minority_2011.Q)5 -0.003218 0.0395372  -0.08138  0.9351
## pct_esp_vert_high_2011ct      0.040455 0.0009863  41.01615  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1380789 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.01257  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1756.459</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.093</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">0.998</td>
<td align="right">0.955</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">1.039</td>
<td align="right">0.259</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.981</td>
<td align="right">0.583</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.997</td>
<td align="right">0.935</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.041</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-gentrified-ct-3" class="section level2 tabset" number="9.3">
<h2 class="tabset"><span class="header-section-number">9.3</span> UI vs gentrified CT</h2>
<p>No new models here, as <code>gentrified</code> variable is already used as a pure categorical variable.</p>
</div>
</div>
<div id="tables-and-figures" class="section level1" number="10">
<h1><span class="header-section-number">10</span> Tables and figures</h1>
<div id="ses-map-and-inset-map" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> SES map and inset map</h2>
<pre class="r"><code># inset map
csd_data &lt;- get_census(dataset=&#39;CA16&#39;, regions=list(PR=&#39;24&#39;), level=&#39;CSD&#39;, geo_format = &quot;sf&quot;) %&gt;%
  mutate(interact_aoi = (CD_UID %in% c(2466, 2465, 2458)) &amp; !(GeoUID %in% c(2458033, 2458037)),
         interact_name = case_when(CD_UID == 2466 ~ &#39;Montr√©al&#39;,
                                   TRUE ~ str_remove(name, &quot; \\([[:upper:]-]+\\)&quot;)))
pr_data &lt;- get_census(dataset = &#39;CA16&#39;, regions=list(C=&#39;1&#39;), level = &#39;PR&#39;, geo_format = &quot;sf&quot;)

inset_lim &lt;- st_bbox(st_transform(filter(CT16, interact_aoi), st_crs(4326)))
# inset_map &lt;- ggplot() +
#   geom_sf(data = csd_data, aes(fill=factor(interact_aoi)), color = NA, show.legend = F) +
#   scale_fill_manual(values = c(&quot;TRUE&quot; = &quot;light blue&quot;, &quot;FALSE&quot; = &quot;gray&quot;), labels=NULL) +
#   coord_sf(xlim = c(-77, -69), ylim = c(45, 49), crs = st_crs(4326), default_crs = st_crs(4326), expand = FALSE) +
#   theme(axis.text=element_text(size=15), axis.title.x=element_blank(), axis.title.y=element_blank()) +
#   scale_x_continuous(breaks = seq(-76, -70, by = 2)) +
#   scale_y_continuous(breaks = seq(45.5, 49, by = 1)) 
# inset_map &lt;- inset_map + 
#   annotate(&quot;rect&quot;, xmin = inset_lim[&#39;xmin&#39;], ymin = inset_lim[&#39;ymin&#39;], xmax = inset_lim[&#39;xmax&#39;], ymax = inset_lim[&#39;ymax&#39;], fill = NA, color = &quot;black&quot;, size = 1) +
#   annotate(&quot;text&quot;, label = &quot;Quebec, Canada&quot;, x = (-77 - 69) / 2, y = (45 + 49)/2, size = 8)

exp_fact = 1.05
inset_map &lt;- ggplot() +
  geom_sf(data = pr_data, color = &quot;black&quot;, show.legend = F) +
  coord_sf(xlim = c(-55, -140), ylim = c(40, 75), crs = st_crs(4326), default_crs = st_crs(4326), expand = FALSE) +
  theme(axis.text=element_text(size=15), axis.title.x=element_blank(), axis.title.y=element_blank()) +
  scale_x_continuous(breaks = seq(-130, -60, by = 20)) +
  scale_y_continuous(breaks = seq(45, 70, by = 10)) 
inset_map &lt;- inset_map + 
  annotate(&quot;rect&quot;, 
           xmin = inset_lim[&#39;xmin&#39;] - exp_fact * (inset_lim[&#39;xmax&#39;] - inset_lim[&#39;xmin&#39;]), 
           ymin = inset_lim[&#39;ymin&#39;] - exp_fact * (inset_lim[&#39;ymax&#39;] - inset_lim[&#39;ymin&#39;]), 
           xmax = inset_lim[&#39;xmax&#39;] + exp_fact * (inset_lim[&#39;xmax&#39;] - inset_lim[&#39;xmin&#39;]), 
           ymax = inset_lim[&#39;ymax&#39;] + exp_fact * (inset_lim[&#39;ymax&#39;] - inset_lim[&#39;ymin&#39;]), 
           fill = NA, color = &quot;red&quot;, size = 2)

  
# SES map
.ses_data_sf &lt;- CT16 %&gt;%
  inner_join(bei_df_aoi, by = c(&quot;GeoUID&quot; = &quot;CT_UID&quot;))

.ses_data &lt;- bi_class(.ses_data_sf, x = vis_minority_2011, y = wSCOREMAT.2011, style = &quot;quantile&quot;, dim = 3)
ses_map &lt;- ggplot() + 
  geom_sf(data = .ses_data, mapping = aes(fill = bi_class), color = &quot;white&quot;, size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = &quot;Brown&quot;, dim = 3) +
  geom_sf_label(data = filter(csd_data, (GeoUID == &quot;2466023&quot;) | ((CD_UID %in% c(&quot;2465&quot;, &quot;2458&quot;)) &amp; !(GeoUID %in% c(2458033, 2458037)))),
                aes(label=interact_name), check_overlap = T, size = 8) + 
  scalebar(data = .ses_data, dist = 5, dist_unit = &quot;km&quot;, transform = F) +
  theme(panel.background = element_rect(fill = &quot;white&quot;),
        axis.ticks = element_blank(),
        axis.text = element_blank(),
        axis.title = element_blank(),
        panel.grid = element_blank())
ses_legend &lt;- bi_legend(pal = &quot;Brown&quot;,
                    dim = 3,
                    xlab = &quot;Visible Minority &quot;,
                    ylab = &quot;Material deprivation &quot;,
                    size = 14)
ggdraw() +
  draw_plot(ses_map, 0, 0, 1, 1) +
  draw_plot(ses_legend, 0.8, .75, 0.2, 0.2) +
  draw_plot(inset_map, 0.02, .7, 0.25, 0.25)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_img/SES_map.png" /></p>
</div>
<div id="maps-of-bec-and-bei" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> Maps of BEC and BEI</h2>
<div id="greenness-5" class="section level3" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Greenness</h3>
<pre class="r"><code># Green space
g_bec_bike &lt;- ggplot() +
   geom_sf(data=filter(bike_lane_changes, interact_aoi), mapping = aes(fill=as.numeric(Bike_lane.by.street.2011ct)), lwd = 0) +
  scale_fill_distiller(name = &quot;Bike lane to\nstreet length (%)&quot;, palette = &quot;YlGn&quot;, direction = 1) + 
   geom_sf(data=filter(CT16, interact_aoi), fill=NA, color=&quot;gray&quot;, size=.2, alpha=0.2) + 
  ggnewscale::new_scale_fill() +
  geom_sf(data=filter(bike_lane_changes, interact_aoi), mapping = aes(fill=factor(units::drop_units(Bike_lane.by.street.2011ct) == 0)), lwd = 0.1) +
  scale_fill_manual(name=&quot;No bike lane in CT&quot;, values = c(&quot;TRUE&quot; = &quot;white&quot;), labels=NULL, na.translate = FALSE) +
  labs(title = &quot;Normalized bike lane length in 2011&quot;)


g_bei_bike &lt;- ggplot() +
  geom_sf(data=filter(bike_lane_changes, interact_aoi), mapping = aes(fill=as.numeric(Bike_lane_diff.by.street.2011.2016ct)), lwd=0) +
   geom_sf(data=filter(CT16, interact_aoi), fill=NA, color=&quot;gray&quot;, size=.2, alpha=0.2) + 
  scale_fill_gradient2(name = &quot;Change in normalized\nbike lane (%)&quot;)+ 
  labs(title = &quot;Bike lane change between 2011 and 2016&quot;)

# Green space
g_bec_green &lt;- ggplot() +
   geom_sf(data=inner_join(filter(CT16, interact_aoi), esp_vert_ct, by=&quot;GeoUID&quot;), mapping = aes(fill=as.numeric(pct_esp_vert_2011)), lwd = 0) +
   geom_sf(data=filter(CT16, interact_aoi), fill=NA, color=&quot;gray&quot;, size=.2, alpha=0.2) + 
  scale_fill_distiller(name = &quot;Greenspace (%)&quot;, palette = &quot;BrBG&quot;, direction = 1)+ 
  labs(title = &quot;A) Proportion of greenspace in 2011&quot;)

g_bei_green &lt;- ggplot() +
   geom_sf(data=inner_join(filter(CT16, interact_aoi), esp_vert_ct, by=&quot;GeoUID&quot;), mapping = aes(fill=as.numeric(pct_esp_vert_diff_2011.2017)), lwd = 0) +
   geom_sf(data=filter(CT16, interact_aoi), fill=NA, color=&quot;gray&quot;, size=.2, alpha=0.2) + 
  scale_fill_gradient2(name = &quot;Greenspace\nchange (%)&quot;)+ 
  #scale_fill_steps2(name = &quot;Greenspace\nchange (%)&quot;, nice.breaks=T) + 
  labs(title = &quot;C) Greenspace change between 2011 and 2017&quot;)

# Green space
g_bec_tree &lt;- ggplot() +
   geom_sf(data=inner_join(filter(CT16, interact_aoi), esp_vert_ct, by=&quot;GeoUID&quot;), mapping = aes(fill=as.numeric(pct_esp_vert_high_2011)), lwd = 0) +
   geom_sf(data=filter(CT16, interact_aoi), fill=NA, color=&quot;gray&quot;, size=.2, alpha=0.2) + 
  scale_fill_distiller(name = &quot;Tree canopy (%)&quot;, palette = &quot;BrBG&quot;, direction = 1)+ 
  labs(title = &quot;B) Proportion of tree canopy in 2011&quot;)

g_bei_tree &lt;- ggplot() +
   geom_sf(data=inner_join(filter(CT16, interact_aoi), esp_vert_ct, by=&quot;GeoUID&quot;), mapping = aes(fill=as.numeric(pct_esp_vert_diff_high_2011.2017)), lwd = 0) +
   geom_sf(data=filter(CT16, interact_aoi), fill=NA, color=&quot;gray&quot;, size=.2, alpha=0.2) + 
  scale_fill_gradient2(name = &quot;Tree canopy\nchange (%)&quot;)+ 
  labs(title = &quot;D) Tree canopy change between 2011 and 2017&quot;)

# Create grid of maps
pcol1 &lt;- plot_grid(
  #g_bec_bike + theme_void(), 
  g_bec_green + theme_void(), 
  g_bec_tree + theme_void(),
  align = &quot;vh&quot;,
  #labels = c(&quot;A&quot;, &quot;B&quot;),
  #hjust = -1,
  ncol = 1
)

pcol2 &lt;- plot_grid(
 #g_bei_bike + theme_void(), 
  g_bei_green + theme_void(), 
  g_bei_tree + theme_void(),
  align = &quot;vh&quot;,
  #labels = c(&quot;C&quot;, &quot;D&quot;),
  #hjust = -1,
  ncol = 1
)

# output all graphs
plot_grid(pcol1, pcol2, nrow=1)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_img/BEC-BEI_maps.png" /></p>
</div>
<div id="bike-lanes" class="section level3" number="10.2.2">
<h3><span class="header-section-number">10.2.2</span> Bike lanes</h3>
<pre class="r"><code># Create grid of maps
plot_grid(
  g_bec_bike + theme_void(), 
  g_bei_bike + theme_void(),
  align = &quot;vh&quot;,
  labels = c(&quot;A&quot;, &quot;B&quot;),
  hjust = -30,
  ncol = 1
)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_img/BEC-BEI_maps.bikes.png" /></p>
</div>
</div>
<div id="ses-and-bei-outcomes" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> SES and BEI outcomes</h2>
<pre class="r"><code># Extract SES and BEI in 2011
.tab1_2011 &lt;- bei_df_aoi %&gt;%
  transmute(year = &quot;2011&quot;,
            zone = zone,
            CT_UID = CT_UID,
            Population = Population,
            `Material score` = wSCOREMAT.2011,
            `% visible minorities` = vis_minority_2011,
            `gentrified` = gentrified_2016_2011,
            `Bike lane` = Bike_lane_total.2011ct &gt; 0,
            `No bike lane` = Bike_lane_total.2011ct == 0,
            `Bike lane length (hm)` = Bike_lane_total.2011ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2011ct,
            `Green space area (ha)` = area_esp_vert_2011ct,
            `% green space within CT` = pct_esp_vert_2011ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2011ct,
            `% tree canopy within CT` = pct_esp_vert_high_2011ct)

# Extract SES and BEI in 2016
.tab1_2016 &lt;- bei_df_aoi %&gt;%
  transmute(year = &quot;2016&quot;,
            zone = zone,
            CT_UID = CT_UID,
            `Bike lane` = Bike_lane_total.2016ct &gt; 0,
            `No bike lane` = Bike_lane_total.2016ct == 0,
            `Bike lane length (hm)` = Bike_lane_total.2016ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2016ct,
            `Green space area (ha)` = area_esp_vert_2017ct,
            `% green space within CT` = pct_esp_vert_2017ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2017ct,
            `% tree canopy within CT` = pct_esp_vert_high_2017ct)

.tab1_med &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year) %&gt;%
  summarize(across(where(is.numeric), median, na.rm=TRUE), 
            `% gentrified` = 100 * sum(`gentrified`, na.rm = TRUE) / n(),
            `Bike lane presence` = sum(`Bike lane`),
            `Bike lane absence` = sum(`No bike lane`))</code></pre>
<pre><code>## Warning: There was 1 warning in `summarize()`.
## ‚Ñπ In argument: `across(where(is.numeric), median, na.rm = TRUE)`.
## ‚Ñπ In group 1: `year = &quot;2011&quot;`.
## Caused by warning:
## ! The `...` argument of `across()` is deprecated as of dplyr 1.1.0.
## Supply arguments directly to `.fns` through an anonymous function instead.
## 
##   # Previously
##   across(a:b, mean, na.rm = TRUE)
## 
##   # Now
##   across(a:b, \(x) mean(x, na.rm = TRUE))</code></pre>
<pre class="r"><code>.tab1_p25 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.25, na.rm=TRUE))
.tab1_p75 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.75, na.rm=TRUE))
tab1 &lt;- inner_join(.tab1_med, .tab1_p25, by=&quot;year&quot;, suffix = c(&quot;&quot;, &quot; p25&quot;)) %&gt;%
  inner_join(.tab1_p75, by=&quot;year&quot;, suffix = c(&quot;&quot;, &quot; p75&quot;)) %&gt;%
  transmute(year = year,
            Population = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                   TRUE ~ paste0(round(`Population`,1), &quot; (&quot;, round(`Population p25`,1), &quot; - &quot;, round(`Population p75`,1), &quot;)&quot;)),
            `Material score` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                         TRUE ~ paste0(round(`Material score`,3), &quot; (&quot;, round(`Material score p25`,3), &quot; - &quot;, round(`Material score p75`,3), &quot;)&quot;)),
            `% visible minorities` = case_when(is.na(`% visible minorities`) ~ &quot;&quot;, 
                                               TRUE ~ paste0(round(`% visible minorities`,1), &quot; (&quot;, round(`% visible minorities p25`,1), &quot; - &quot;, round(`% visible minorities p75`,1), &quot;)&quot;)),
            `% gentrified CTs` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                           TRUE ~ as.character(round(`% gentrified`, 1))),
            `Bike lane presence (N)` = as.character(`Bike lane presence`),
            `Bike lane absence (N)` = as.character(`Bike lane absence`),
            `Bike lane length (hm)` = paste0(round(`Bike lane length (hm)`,1), &quot; (&quot;, round(`Bike lane length (hm) p25`,1), &quot; - &quot;, round(`Bike lane length (hm) p75`,1), &quot;)&quot;),
            `% Bike lane to streets` = paste0(round(`% Bike lane to streets`,1), &quot; (&quot;, round(`% Bike lane to streets p25`,1), &quot; - &quot;, round(`% Bike lane to streets p75`,1), &quot;)&quot;),
            `Green space area (ha)` = paste0(round(`Green space area (ha)`,1), &quot; (&quot;, round(`Green space area (ha) p25`,1), &quot; - &quot;, round(`Green space area (ha) p75`,1), &quot;)&quot;),
            `% green space within CT` = paste0(round(`% green space within CT`,1), &quot; (&quot;, round(`% green space within CT p25`,1), &quot; - &quot;, round(`% green space within CT p75`,1), &quot;)&quot;),
            `Tree canopy area (ha)` = paste0(round(`Tree canopy area (ha)`,1), &quot; (&quot;, round(`Tree canopy area (ha) p25`,1), &quot; - &quot;, round(`Tree canopy area (ha) p75`,1), &quot;)&quot;),
            `% tree canopy within CT` = paste0(round(`% tree canopy within CT`,1), &quot; (&quot;, round(`% tree canopy within CT p25`,1), &quot; - &quot;, round(`% tree canopy within CT p75`,1), &quot;)&quot;)) %&gt;%
  tibble::column_to_rownames(&quot;year&quot;) %&gt;%
  t() %&gt;% 
  as.data.frame()

tab1 %&gt;% knitr::kable() %&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
2011
</th>
<th style="text-align:left;">
2016
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Population
</td>
<td style="text-align:left;">
3808 (2612 - 5157)
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Material score
</td>
<td style="text-align:left;">
0.007 (-0.018 - 0.032)
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% visible minorities
</td>
<td style="text-align:left;">
21.7 (14.5 - 34.5)
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% gentrified CTs
</td>
<td style="text-align:left;">
30
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane presence (N)
</td>
<td style="text-align:left;">
487
</td>
<td style="text-align:left;">
576
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane absence (N)
</td>
<td style="text-align:left;">
202
</td>
<td style="text-align:left;">
113
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane length (hm)
</td>
<td style="text-align:left;">
6.8 (0 - 18)
</td>
<td style="text-align:left;">
10.4 (2.9 - 21.4)
</td>
</tr>
<tr>
<td style="text-align:left;">
% Bike lane to streets
</td>
<td style="text-align:left;">
6.9 (0 - 14)
</td>
<td style="text-align:left;">
10.7 (3.4 - 17.9)
</td>
</tr>
<tr>
<td style="text-align:left;">
Green space area (ha)
</td>
<td style="text-align:left;">
22 (8 - 59)
</td>
<td style="text-align:left;">
25 (9 - 64)
</td>
</tr>
<tr>
<td style="text-align:left;">
% green space within CT
</td>
<td style="text-align:left;">
35.6 (24.4 - 46.7)
</td>
<td style="text-align:left;">
40.2 (29.4 - 50.4)
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree canopy area (ha)
</td>
<td style="text-align:left;">
10 (4 - 22)
</td>
<td style="text-align:left;">
12 (5 - 25)
</td>
</tr>
<tr>
<td style="text-align:left;">
% tree canopy within CT
</td>
<td style="text-align:left;">
16.4 (11.8 - 22.6)
</td>
<td style="text-align:left;">
20.2 (14.5 - 26.8)
</td>
</tr>
</tbody>
</table>
<div id="by-q1-q5" class="section level3" number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> By Q1 / Q5</h3>
<p>We look at Urban conditions in 2011 and 2016 within Q1 and Q5 of 2011 equity metrics</p>
<pre class="r"><code># Extract SES and BEI in 2011
.tab1_2011 &lt;- bei_df_aoi %&gt;%
  filter(wSCOREMAT.2011.Q %in% c(1, 5) ) %&gt;%
  transmute(year = &quot;2011&quot;,
            quintile = case_when(wSCOREMAT.2011.Q == 1 ~ &quot;Q1 Deprivation&quot;,
                                 wSCOREMAT.2011.Q == 5 ~ &quot;Q5 Deprivation&quot;),
            zone = zone,
            CT_UID = CT_UID,
            Population = Population,
            `Material score` = wSCOREMAT.2011,
            `% visible minorities` = vis_minority_2011,
            `gentrified` = gentrified_2016_2011,
            `Bike lane` = Bike_lane_total.2011ct &gt; 0,
            `Bike lane length (hm)` = Bike_lane_total.2011ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2011ct,
            `Green space area (ha)` = area_esp_vert_2011ct,
            `% green space within CT` = pct_esp_vert_2011ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2011ct,
            `% tree canopy within CT` = pct_esp_vert_high_2011ct)

# Extract SES and BEI in 2016
.tab1_2016 &lt;- bei_df_aoi %&gt;%
  filter(wSCOREMAT.2011.Q %in% c(1, 5) ) %&gt;%
  transmute(year = &quot;2016&quot;,
            quintile = case_when(wSCOREMAT.2011.Q == 1 ~ &quot;Q1 Deprivation&quot;,
                                 wSCOREMAT.2011.Q == 5 ~ &quot;Q5 Deprivation&quot;),
            zone = zone,
            CT_UID = CT_UID,
            `Bike lane` = Bike_lane_total.2016ct &gt; 0,
            `Bike lane length (hm)` = Bike_lane_total.2016ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2016ct,
            `Green space area (ha)` = area_esp_vert_2017ct,
            `% green space within CT` = pct_esp_vert_2017ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2017ct,
            `% tree canopy within CT` = pct_esp_vert_high_2017ct)

.tab1_med &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), median, na.rm=TRUE), 
            `% gentrified` = 100 * sum(`gentrified`, na.rm = TRUE) / n(),
            `Bike lane presence` = sum(`Bike lane`),
            `Bike lane absence` = n() - sum(`Bike lane`))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>.tab1_p25 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.25, na.rm=TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>.tab1_p75 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.75, na.rm=TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>tab1 &lt;- inner_join(.tab1_med, .tab1_p25, by=c(&quot;year&quot;, &quot;quintile&quot;), suffix = c(&quot;&quot;, &quot; p25&quot;)) %&gt;%
  inner_join(.tab1_p75, by=c(&quot;year&quot;, &quot;quintile&quot;), suffix = c(&quot;&quot;, &quot; p75&quot;)) %&gt;%
  transmute(year.quintile = paste(year, quintile),
            Population = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                   TRUE ~ paste0(round(`Population`,1), &quot; (&quot;, round(`Population p25`,1), &quot; - &quot;, round(`Population p75`,1), &quot;)&quot;)),
            `Material score` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                         TRUE ~ paste0(round(`Material score`,3), &quot; (&quot;, round(`Material score p25`,3), &quot; - &quot;, round(`Material score p75`,3), &quot;)&quot;)),
            `% visible minorities` = case_when(is.na(`% visible minorities`) ~ &quot;&quot;, 
                                               TRUE ~ paste0(round(`% visible minorities`,1), &quot; (&quot;, round(`% visible minorities p25`,1), &quot; - &quot;, round(`% visible minorities p75`,1), &quot;)&quot;)),
            `% gentrified CTs` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                           TRUE ~ as.character(round(`% gentrified`, 1))),
            `Bike lane presence (N)` = as.character(`Bike lane presence`),
            `Bike lane absence (N)` = as.character(`Bike lane absence`),
            `Bike lane length (hm)` = paste0(round(`Bike lane length (hm)`,1), &quot; (&quot;, round(`Bike lane length (hm) p25`,1), &quot; - &quot;, round(`Bike lane length (hm) p75`,1), &quot;)&quot;),
            `% Bike lane to streets` = paste0(round(`% Bike lane to streets`,1), &quot; (&quot;, round(`% Bike lane to streets p25`,1), &quot; - &quot;, round(`% Bike lane to streets p75`,1), &quot;)&quot;),
            `Green space area (ha)` = paste0(round(`Green space area (ha)`,1), &quot; (&quot;, round(`Green space area (ha) p25`,1), &quot; - &quot;, round(`Green space area (ha) p75`,1), &quot;)&quot;),
            `% green space within CT` = paste0(round(`% green space within CT`,1), &quot; (&quot;, round(`% green space within CT p25`,1), &quot; - &quot;, round(`% green space within CT p75`,1), &quot;)&quot;),
            `Tree canopy area (ha)` = paste0(round(`Tree canopy area (ha)`,1), &quot; (&quot;, round(`Tree canopy area (ha) p25`,1), &quot; - &quot;, round(`Tree canopy area (ha) p75`,1), &quot;)&quot;),
            `% tree canopy within CT` = paste0(round(`% tree canopy within CT`,1), &quot; (&quot;, round(`% tree canopy within CT p25`,1), &quot; - &quot;, round(`% tree canopy within CT p75`,1), &quot;)&quot;)) %&gt;%
  tibble::column_to_rownames(&quot;year.quintile&quot;) %&gt;%
  t() %&gt;% 
  as.data.frame()

tab1 %&gt;% knitr::kable() %&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
2011 Q1 Deprivation
</th>
<th style="text-align:left;">
2011 Q5 Deprivation
</th>
<th style="text-align:left;">
2016 Q1 Deprivation
</th>
<th style="text-align:left;">
2016 Q5 Deprivation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
year
</td>
<td style="text-align:left;">
2011
</td>
<td style="text-align:left;">
2011
</td>
<td style="text-align:left;">
2016
</td>
<td style="text-align:left;">
2016
</td>
</tr>
<tr>
<td style="text-align:left;">
Population
</td>
<td style="text-align:left;">
3092 (1999 - 4873.5)
</td>
<td style="text-align:left;">
3946 (2991.5 - 5229)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Material score
</td>
<td style="text-align:left;">
-0.044 (-0.061 - -0.034)
</td>
<td style="text-align:left;">
0.054 (0.045 - 0.071)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% visible minorities
</td>
<td style="text-align:left;">
15.7 (9.3 - 22.3)
</td>
<td style="text-align:left;">
37.5 (25.8 - 54.5)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% gentrified CTs
</td>
<td style="text-align:left;">
15.6
</td>
<td style="text-align:left;">
40.7
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane presence (N)
</td>
<td style="text-align:left;">
99
</td>
<td style="text-align:left;">
75
</td>
<td style="text-align:left;">
110
</td>
<td style="text-align:left;">
96
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane absence (N)
</td>
<td style="text-align:left;">
36
</td>
<td style="text-align:left;">
60
</td>
<td style="text-align:left;">
25
</td>
<td style="text-align:left;">
39
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane length (hm)
</td>
<td style="text-align:left;">
6.9 (0 - 22.2)
</td>
<td style="text-align:left;">
1.7 (0 - 9.1)
</td>
<td style="text-align:left;">
9.6 (2.4 - 24.6)
</td>
<td style="text-align:left;">
5.6 (0 - 12.5)
</td>
</tr>
<tr>
<td style="text-align:left;">
% Bike lane to streets
</td>
<td style="text-align:left;">
7.6 (0 - 16.5)
</td>
<td style="text-align:left;">
1.3 (0 - 9.8)
</td>
<td style="text-align:left;">
11.5 (3.2 - 21)
</td>
<td style="text-align:left;">
8 (0 - 15.3)
</td>
</tr>
<tr>
<td style="text-align:left;">
Green space area (ha)
</td>
<td style="text-align:left;">
20 (4.5 - 88.5)
</td>
<td style="text-align:left;">
15 (7 - 25)
</td>
<td style="text-align:left;">
25 (5.5 - 93.5)
</td>
<td style="text-align:left;">
17 (8 - 28.5)
</td>
</tr>
<tr>
<td style="text-align:left;">
% green space within CT
</td>
<td style="text-align:left;">
41.1 (24.4 - 53)
</td>
<td style="text-align:left;">
28.8 (20.8 - 35.2)
</td>
<td style="text-align:left;">
47.1 (29.8 - 57)
</td>
<td style="text-align:left;">
32.9 (25 - 40.8)
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree canopy area (ha)
</td>
<td style="text-align:left;">
12 (3 - 41)
</td>
<td style="text-align:left;">
7 (3.5 - 10)
</td>
<td style="text-align:left;">
15 (4 - 47)
</td>
<td style="text-align:left;">
8 (4.5 - 12)
</td>
</tr>
<tr>
<td style="text-align:left;">
% tree canopy within CT
</td>
<td style="text-align:left;">
22 (14.6 - 34.2)
</td>
<td style="text-align:left;">
12.5 (8.8 - 15.9)
</td>
<td style="text-align:left;">
27.9 (19 - 37.4)
</td>
<td style="text-align:left;">
15.8 (10.4 - 19.7)
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Extract SES and BEI in 2011
.tab1_2011 &lt;- bei_df_aoi %&gt;%
  filter(vis_minority_2011.Q %in% c(1, 5) ) %&gt;%
  transmute(year = &quot;2011&quot;,
            quintile = case_when(vis_minority_2011.Q == 1 ~ &quot;Q1 Vis. Minorities&quot;,
                                 vis_minority_2011.Q == 5 ~ &quot;Q5 Vis. Minorities&quot;),
            zone = zone,
            CT_UID = CT_UID,
            Population = Population,
            `Material score` = wSCOREMAT.2011,
            `% visible minorities` = vis_minority_2011,
            `gentrified` = gentrified_2016_2011,
            `Bike lane` = Bike_lane_total.2011ct &gt; 0,
            `Bike lane length (hm)` = Bike_lane_total.2011ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2011ct,
            `Green space area (ha)` = area_esp_vert_2011ct,
            `% green space within CT` = pct_esp_vert_2011ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2011ct,
            `% tree canopy within CT` = pct_esp_vert_high_2011ct)

# Extract SES and BEI in 2016
.tab1_2016 &lt;- bei_df_aoi %&gt;%
  filter(vis_minority_2011.Q %in% c(1, 5) ) %&gt;%
  transmute(year = &quot;2016&quot;,
            quintile = case_when(vis_minority_2011.Q == 1 ~ &quot;Q1 Vis. Minorities&quot;,
                                 vis_minority_2011.Q == 5 ~ &quot;Q5 Vis. Minorities&quot;),
            zone = zone,
            CT_UID = CT_UID,
            `Bike lane` = Bike_lane_total.2016ct &gt; 0,
            `Bike lane length (hm)` = Bike_lane_total.2016ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2016ct,
            `Green space area (ha)` = area_esp_vert_2017ct,
            `% green space within CT` = pct_esp_vert_2017ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2017ct,
            `% tree canopy within CT` = pct_esp_vert_high_2017ct)

.tab1_med &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), median, na.rm=TRUE), 
            `% gentrified` = 100 * sum(`gentrified`, na.rm = TRUE) / n(),
            `Bike lane presence` = sum(`Bike lane`),
            `Bike lane absence` = n() - sum(`Bike lane`))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>.tab1_p25 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.25, na.rm=TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>.tab1_p75 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.75, na.rm=TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>tab1 &lt;- inner_join(.tab1_med, .tab1_p25, by=c(&quot;year&quot;, &quot;quintile&quot;), suffix = c(&quot;&quot;, &quot; p25&quot;)) %&gt;%
  inner_join(.tab1_p75, by=c(&quot;year&quot;, &quot;quintile&quot;), suffix = c(&quot;&quot;, &quot; p75&quot;)) %&gt;%
  transmute(year.quintile = paste(year, quintile),
            Population = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                   TRUE ~ paste0(round(`Population`,1), &quot; (&quot;, round(`Population p25`,1), &quot; - &quot;, round(`Population p75`,1), &quot;)&quot;)),
            `Material score` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                         TRUE ~ paste0(round(`Material score`,3), &quot; (&quot;, round(`Material score p25`,3), &quot; - &quot;, round(`Material score p75`,3), &quot;)&quot;)),
            `% visible minorities` = case_when(is.na(`% visible minorities`) ~ &quot;&quot;, 
                                               TRUE ~ paste0(round(`% visible minorities`,1), &quot; (&quot;, round(`% visible minorities p25`,1), &quot; - &quot;, round(`% visible minorities p75`,1), &quot;)&quot;)),
            `% gentrified CTs` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                           TRUE ~ as.character(round(`% gentrified`, 1))),
            `Bike lane presence (N)` = as.character(`Bike lane presence`),
            `Bike lane absence (N)` = as.character(`Bike lane absence`),
            `Bike lane length (hm)` = paste0(round(`Bike lane length (hm)`,1), &quot; (&quot;, round(`Bike lane length (hm) p25`,1), &quot; - &quot;, round(`Bike lane length (hm) p75`,1), &quot;)&quot;),
            `% Bike lane to streets` = paste0(round(`% Bike lane to streets`,1), &quot; (&quot;, round(`% Bike lane to streets p25`,1), &quot; - &quot;, round(`% Bike lane to streets p75`,1), &quot;)&quot;),
            `Green space area (ha)` = paste0(round(`Green space area (ha)`,1), &quot; (&quot;, round(`Green space area (ha) p25`,1), &quot; - &quot;, round(`Green space area (ha) p75`,1), &quot;)&quot;),
            `% green space within CT` = paste0(round(`% green space within CT`,1), &quot; (&quot;, round(`% green space within CT p25`,1), &quot; - &quot;, round(`% green space within CT p75`,1), &quot;)&quot;),
            `Tree canopy area (ha)` = paste0(round(`Tree canopy area (ha)`,1), &quot; (&quot;, round(`Tree canopy area (ha) p25`,1), &quot; - &quot;, round(`Tree canopy area (ha) p75`,1), &quot;)&quot;),
            `% tree canopy within CT` = paste0(round(`% tree canopy within CT`,1), &quot; (&quot;, round(`% tree canopy within CT p25`,1), &quot; - &quot;, round(`% tree canopy within CT p75`,1), &quot;)&quot;)) %&gt;%
  tibble::column_to_rownames(&quot;year.quintile&quot;) %&gt;%
  t() %&gt;% 
  as.data.frame()

tab1 %&gt;% knitr::kable() %&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
2011 Q1 Vis. Minorities
</th>
<th style="text-align:left;">
2011 Q5 Vis. Minorities
</th>
<th style="text-align:left;">
2016 Q1 Vis. Minorities
</th>
<th style="text-align:left;">
2016 Q5 Vis. Minorities
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
year
</td>
<td style="text-align:left;">
2011
</td>
<td style="text-align:left;">
2011
</td>
<td style="text-align:left;">
2016
</td>
<td style="text-align:left;">
2016
</td>
</tr>
<tr>
<td style="text-align:left;">
Population
</td>
<td style="text-align:left;">
3016 (2123.5 - 4213)
</td>
<td style="text-align:left;">
4193 (3395.5 - 5644)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Material score
</td>
<td style="text-align:left;">
-0.018 (-0.042 - 0.013)
</td>
<td style="text-align:left;">
0.037 (0.013 - 0.063)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% visible minorities
</td>
<td style="text-align:left;">
9.1 (7.4 - 11.1)
</td>
<td style="text-align:left;">
48.8 (43 - 58.2)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% gentrified CTs
</td>
<td style="text-align:left;">
32.6
</td>
<td style="text-align:left;">
29.6
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane presence (N)
</td>
<td style="text-align:left;">
98
</td>
<td style="text-align:left;">
74
</td>
<td style="text-align:left;">
116
</td>
<td style="text-align:left;">
92
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane absence (N)
</td>
<td style="text-align:left;">
37
</td>
<td style="text-align:left;">
61
</td>
<td style="text-align:left;">
19
</td>
<td style="text-align:left;">
43
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane length (hm)
</td>
<td style="text-align:left;">
8.4 (0 - 21.6)
</td>
<td style="text-align:left;">
1.7 (0 - 9.7)
</td>
<td style="text-align:left;">
10.9 (4.3 - 27.8)
</td>
<td style="text-align:left;">
5.2 (0 - 14.5)
</td>
</tr>
<tr>
<td style="text-align:left;">
% Bike lane to streets
</td>
<td style="text-align:left;">
8.1 (0 - 14.5)
</td>
<td style="text-align:left;">
1.1 (0 - 8.3)
</td>
<td style="text-align:left;">
12.9 (6 - 20.5)
</td>
<td style="text-align:left;">
6.6 (0 - 14.3)
</td>
</tr>
<tr>
<td style="text-align:left;">
Green space area (ha)
</td>
<td style="text-align:left;">
20 (6 - 78)
</td>
<td style="text-align:left;">
16 (7.5 - 33.5)
</td>
<td style="text-align:left;">
21 (7 - 83.5)
</td>
<td style="text-align:left;">
19 (9.5 - 37.5)
</td>
</tr>
<tr>
<td style="text-align:left;">
% green space within CT
</td>
<td style="text-align:left;">
37.4 (25.2 - 53)
</td>
<td style="text-align:left;">
30.4 (23.1 - 38.2)
</td>
<td style="text-align:left;">
41.4 (31.9 - 56.9)
</td>
<td style="text-align:left;">
35.8 (26.9 - 44.6)
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree canopy area (ha)
</td>
<td style="text-align:left;">
12 (3 - 39.5)
</td>
<td style="text-align:left;">
7 (4 - 15.5)
</td>
<td style="text-align:left;">
12 (4 - 44.5)
</td>
<td style="text-align:left;">
10 (4 - 17.5)
</td>
</tr>
<tr>
<td style="text-align:left;">
% tree canopy within CT
</td>
<td style="text-align:left;">
18.3 (14.5 - 29.9)
</td>
<td style="text-align:left;">
14.5 (8.4 - 20.4)
</td>
<td style="text-align:left;">
23.3 (18 - 34.8)
</td>
<td style="text-align:left;">
17.4 (9.9 - 24)
</td>
</tr>
</tbody>
</table>
</div>
<div id="by-gentrification-status" class="section level3" number="10.3.2">
<h3><span class="header-section-number">10.3.2</span> By gentrification status</h3>
<pre class="r"><code># Extract SES and BEI in 2011
.tab1_2011 &lt;- bei_df_aoi %&gt;%
  filter(!is.na(gentrif_status_2016)) %&gt;%
  transmute(year = &quot;2011&quot;,
            quintile = gentrif_status_2016,
            zone = zone,
            CT_UID = CT_UID,
            Population = Population,
            `Material score` = wSCOREMAT.2011,
            `% visible minorities` = vis_minority_2011,
            `gentrified` = gentrified_2016_2011,
            `Bike lane` = Bike_lane_total.2011ct &gt; 0,
            `Bike lane length (hm)` = Bike_lane_total.2011ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2011ct,
            `Green space area (ha)` = area_esp_vert_2011ct,
            `% green space within CT` = pct_esp_vert_2011ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2011ct,
            `% tree canopy within CT` = pct_esp_vert_high_2011ct)

# Extract SES and BEI in 2016
.tab1_2016 &lt;- bei_df_aoi %&gt;%
  filter(!is.na(gentrif_status_2016)) %&gt;%
  transmute(year = &quot;2016&quot;,
            quintile = gentrif_status_2016,
            zone = zone,
            CT_UID = CT_UID,
            `Bike lane` = Bike_lane_total.2016ct &gt; 0,
            `Bike lane length (hm)` = Bike_lane_total.2016ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2016ct,
            `Green space area (ha)` = area_esp_vert_2017ct,
            `% green space within CT` = pct_esp_vert_2017ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2017ct,
            `% tree canopy within CT` = pct_esp_vert_high_2017ct)

.tab1_med &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), median, na.rm=TRUE), 
            `% gentrified` = 100 * sum(`gentrified`, na.rm = TRUE) / n(),
            `Bike lane presence` = sum(`Bike lane`),
            `Bike lane absence` = n() - sum(`Bike lane`))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>.tab1_p25 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.25, na.rm=TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>.tab1_p75 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.75, na.rm=TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>tab1 &lt;- inner_join(.tab1_med, .tab1_p25, by=c(&quot;year&quot;, &quot;quintile&quot;), suffix = c(&quot;&quot;, &quot; p25&quot;)) %&gt;%
  inner_join(.tab1_p75, by=c(&quot;year&quot;, &quot;quintile&quot;), suffix = c(&quot;&quot;, &quot; p75&quot;)) %&gt;%
  transmute(year.quintile = paste(year, quintile),
            Population = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                   TRUE ~ paste0(round(`Population`,1), &quot; (&quot;, round(`Population p25`,1), &quot; - &quot;, round(`Population p75`,1), &quot;)&quot;)),
            `Material score` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                         TRUE ~ paste0(round(`Material score`,3), &quot; (&quot;, round(`Material score p25`,3), &quot; - &quot;, round(`Material score p75`,3), &quot;)&quot;)),
            `% visible minorities` = case_when(is.na(`% visible minorities`) ~ &quot;&quot;, 
                                               TRUE ~ paste0(round(`% visible minorities`,1), &quot; (&quot;, round(`% visible minorities p25`,1), &quot; - &quot;, round(`% visible minorities p75`,1), &quot;)&quot;)),
            `% gentrified CTs` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                           TRUE ~ as.character(round(`% gentrified`, 1))),
            `Bike lane presence (N)` = as.character(`Bike lane presence`),
            `Bike lane absence (N)` = as.character(`Bike lane absence`),
            `Bike lane length (hm)` = paste0(round(`Bike lane length (hm)`,1), &quot; (&quot;, round(`Bike lane length (hm) p25`,1), &quot; - &quot;, round(`Bike lane length (hm) p75`,1), &quot;)&quot;),
            `% Bike lane to streets` = paste0(round(`% Bike lane to streets`,1), &quot; (&quot;, round(`% Bike lane to streets p25`,1), &quot; - &quot;, round(`% Bike lane to streets p75`,1), &quot;)&quot;),
            `Green space area (ha)` = paste0(round(`Green space area (ha)`,1), &quot; (&quot;, round(`Green space area (ha) p25`,1), &quot; - &quot;, round(`Green space area (ha) p75`,1), &quot;)&quot;),
            `% green space within CT` = paste0(round(`% green space within CT`,1), &quot; (&quot;, round(`% green space within CT p25`,1), &quot; - &quot;, round(`% green space within CT p75`,1), &quot;)&quot;),
            `Tree canopy area (ha)` = paste0(round(`Tree canopy area (ha)`,1), &quot; (&quot;, round(`Tree canopy area (ha) p25`,1), &quot; - &quot;, round(`Tree canopy area (ha) p75`,1), &quot;)&quot;),
            `% tree canopy within CT` = paste0(round(`% tree canopy within CT`,1), &quot; (&quot;, round(`% tree canopy within CT p25`,1), &quot; - &quot;, round(`% tree canopy within CT p75`,1), &quot;)&quot;)) %&gt;%
  tibble::column_to_rownames(&quot;year.quintile&quot;) %&gt;%
  t() %&gt;% 
  as.data.frame()

tab1 %&gt;% knitr::kable() %&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
2011 Not gentrified
</th>
<th style="text-align:left;">
2011 Gentrified
</th>
<th style="text-align:left;">
2011 Non eligible
</th>
<th style="text-align:left;">
2016 Not gentrified
</th>
<th style="text-align:left;">
2016 Gentrified
</th>
<th style="text-align:left;">
2016 Non eligible
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
year
</td>
<td style="text-align:left;">
2011
</td>
<td style="text-align:left;">
2011
</td>
<td style="text-align:left;">
2011
</td>
<td style="text-align:left;">
2016
</td>
<td style="text-align:left;">
2016
</td>
<td style="text-align:left;">
2016
</td>
</tr>
<tr>
<td style="text-align:left;">
Population
</td>
<td style="text-align:left;">
3833.5 (2732.5 - 5212.2)
</td>
<td style="text-align:left;">
3176 (2257.5 - 4510.5)
</td>
<td style="text-align:left;">
4276 (3232.2 - 5528.5)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Material score
</td>
<td style="text-align:left;">
0.024 (0.001 - 0.046)
</td>
<td style="text-align:left;">
0.018 (-0.004 - 0.039)
</td>
<td style="text-align:left;">
-0.016 (-0.042 - 0.007)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% visible minorities
</td>
<td style="text-align:left;">
28.2 (17.5 - 43.4)
</td>
<td style="text-align:left;">
21.1 (13.9 - 32.4)
</td>
<td style="text-align:left;">
19.9 (12.3 - 29.1)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% gentrified CTs
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane presence (N)
</td>
<td style="text-align:left;">
142
</td>
<td style="text-align:left;">
129
</td>
<td style="text-align:left;">
205
</td>
<td style="text-align:left;">
176
</td>
<td style="text-align:left;">
170
</td>
<td style="text-align:left;">
219
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane absence (N)
</td>
<td style="text-align:left;">
80
</td>
<td style="text-align:left;">
78
</td>
<td style="text-align:left;">
41
</td>
<td style="text-align:left;">
46
</td>
<td style="text-align:left;">
37
</td>
<td style="text-align:left;">
27
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane length (hm)
</td>
<td style="text-align:left;">
4.2 (0 - 13.2)
</td>
<td style="text-align:left;">
3.7 (0 - 11)
</td>
<td style="text-align:left;">
14.7 (3 - 31.5)
</td>
<td style="text-align:left;">
7.8 (2 - 16.2)
</td>
<td style="text-align:left;">
7.9 (2.4 - 15.3)
</td>
<td style="text-align:left;">
17.3 (6.8 - 35.3)
</td>
</tr>
<tr>
<td style="text-align:left;">
% Bike lane to streets
</td>
<td style="text-align:left;">
5.8 (0 - 12.1)
</td>
<td style="text-align:left;">
5.6 (0 - 14.5)
</td>
<td style="text-align:left;">
7.5 (1.7 - 13.6)
</td>
<td style="text-align:left;">
9.6 (3 - 17.2)
</td>
<td style="text-align:left;">
13.4 (3.9 - 20)
</td>
<td style="text-align:left;">
9.7 (3.8 - 16.1)
</td>
</tr>
<tr>
<td style="text-align:left;">
Green space area (ha)
</td>
<td style="text-align:left;">
17 (7.2 - 28)
</td>
<td style="text-align:left;">
9 (4 - 22)
</td>
<td style="text-align:left;">
66 (35.2 - 119.8)
</td>
<td style="text-align:left;">
19 (9 - 30.8)
</td>
<td style="text-align:left;">
10 (5 - 24.5)
</td>
<td style="text-align:left;">
69 (40 - 123.8)
</td>
</tr>
<tr>
<td style="text-align:left;">
% green space within CT
</td>
<td style="text-align:left;">
31.4 (22.7 - 38.7)
</td>
<td style="text-align:left;">
27.5 (20.7 - 35.2)
</td>
<td style="text-align:left;">
48.2 (40.3 - 57.9)
</td>
<td style="text-align:left;">
36.5 (27.1 - 43.3)
</td>
<td style="text-align:left;">
32.8 (25.6 - 40.5)
</td>
<td style="text-align:left;">
51.2 (44.2 - 60.3)
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree canopy area (ha)
</td>
<td style="text-align:left;">
8 (4 - 12)
</td>
<td style="text-align:left;">
5 (3 - 10)
</td>
<td style="text-align:left;">
24 (14 - 52.8)
</td>
<td style="text-align:left;">
9 (5 - 15)
</td>
<td style="text-align:left;">
6 (4 - 12)
</td>
<td style="text-align:left;">
28 (16 - 58.8)
</td>
</tr>
<tr>
<td style="text-align:left;">
% tree canopy within CT
</td>
<td style="text-align:left;">
15.2 (11.6 - 19.7)
</td>
<td style="text-align:left;">
15.2 (11.4 - 19.5)
</td>
<td style="text-align:left;">
20.6 (12.9 - 30.5)
</td>
<td style="text-align:left;">
19.1 (13.6 - 23.6)
</td>
<td style="text-align:left;">
19.4 (15 - 23.8)
</td>
<td style="text-align:left;">
24.3 (15.2 - 34.8)
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="interactions-in-ui-associations" class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> Interactions in UI associations</h2>
<div id="continuous-ses-variables" class="section level3" number="10.4.1">
<h3><span class="header-section-number">10.4.1</span> Continuous SES variables</h3>
<p><em>NB</em> Update 2023-01-17: we graph gentrification separately now</p>
<pre class="r"><code>base_size_all = 20
# extract the legend from one of the plots
legend.row1 &lt;- get_legend(
  # create some space to the left of the legend
  g_mat_gr + labs(colour=&#39;Material score\n(Quintiles)&#39;, fill=&#39;Material score\n(Quintiles)&#39;) + theme(legend.box.margin = margin(0, 0, 0, 12)) + theme_classic(base_size = base_size_all)
)

prow1.1 &lt;- plot_grid(
  g_mat_bk.hrdl + xlab(&quot;% Bike lane to streets 2011&quot;) + ylab(&quot;% Bike lane to streets 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_mat_gr + xlab(&quot;% green space within CT 2011&quot;) + ylab(&quot;% green space within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_mat_tc + xlab(&quot;% tree canopy within CT 2011&quot;) + ylab(&quot;% tree canopy within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  align = &quot;vh&quot;,
  labels = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;),
  hjust = -1,
  nrow = 1
)

prow1 &lt;- plot_grid(prow1.1, legend.row1, rel_widths = c(3, .4))

# extract the legend from one of the plots
legend.row2 &lt;- get_legend(
  # create some space to the left of the legend
  g_vis_gr + labs(colour=&#39;Visible minorities\n(Quintiles)&#39;, fill=&#39;Visible minorities\n(Quintiles)&#39;) + theme(legend.box.margin = margin(0, 0, 0, 12)) + theme_classic(base_size = base_size_all)
)

prow2.1 &lt;- plot_grid(
  g_vis_bk.hrdl + xlab(&quot;% Bike lane to streets 2011&quot;) + ylab(&quot;% Bike lane to streets 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_vis_gr + xlab(&quot;% green space within CT 2011&quot;) + ylab(&quot;% green space within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_vis_tc + xlab(&quot;% tree canopy within CT 2011&quot;) + ylab(&quot;% tree canopy within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  align = &quot;vh&quot;,
  labels = c(&quot;D&quot;, &quot;E&quot;, &quot;F&quot;),
  hjust = -1,
  nrow = 1
)

prow2 &lt;- plot_grid(prow2.1, legend.row2, rel_widths = c(3, .4))

# output all graphs
plot_grid(prow1, prow2, ncol=1)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_img/cont_interactions.png" /></p>
<pre class="r"><code>base_size_all = 20

# extract the legend from one of the plots
legend.row3 &lt;- get_legend(
  # create some space to the left of the legend
  g_gen_gr + labs(colour=&#39;Gentrified&#39;, fill=&#39;Gentrified&#39;) + theme(legend.box.margin = margin(0, 0, 0, 12)) + theme_classic(base_size = base_size_all)
)

prow3.1 &lt;- plot_grid(
  g_gen_bk.hrdl + xlab(&quot;% Bike lane to streets 2011&quot;) + ylab(&quot;% Bike lane to streets 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_gen_gr + xlab(&quot;% green space within CT 2011&quot;) + ylab(&quot;% green space within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_gen_tc + xlab(&quot;% tree canopy within CT 2011&quot;) + ylab(&quot;% tree canopy within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  align = &quot;vh&quot;,
  labels = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;),
  hjust = -1,
  nrow = 1
)

plot_grid(prow3.1, legend.row3, rel_widths = c(3, .4))</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_img/cont_interactions_bike.png" /></p>
</div>
<div id="categorical-ses-variables" class="section level3" number="10.4.2">
<h3><span class="header-section-number">10.4.2</span> Categorical SES variables</h3>
<pre class="r"><code>base_size_all = 20
# extract the legend from one of the plots
legend.row1 &lt;- get_legend(
  # create some space to the left of the legend
  g_mat_tc.categ + labs(colour=&#39;Material score\n(Quintiles) as\ncategorical variables&#39;, fill=&#39;Material score\n(Quintiles) as\ncategorical variables&#39;) + theme(legend.box.margin = margin(0, 0, 0, 12))+ theme_classic(base_size = base_size_all)
)

prow1.1 &lt;- plot_grid(
  g_mat_bk.hrdl.categ + xlab(&quot;% Bike lane to streets 2011&quot;) + ylab(&quot;% Bike lane to streets 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_mat_gr.categ + xlab(&quot;% green space within CT 2011&quot;) + ylab(&quot;% green space within CT 2016&quot;)  + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_mat_tc.categ + xlab(&quot;% tree canopy within CT 2011&quot;) + ylab(&quot;% tree canopy within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  align = &quot;vh&quot;,
  labels = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;),
  hjust = -1,
  nrow = 1
)

prow1 &lt;- plot_grid(prow1.1, legend.row1, rel_widths = c(3, .4))

# extract the legend from one of the plots
legend.row2 &lt;- get_legend(
  # create some space to the left of the legend
  g_vis_gr.categ + labs(colour=&#39;Visible minorities\n(Quintiles) as\ncategorical variables&#39;, fill=&#39;Visible minorities\n(Quintiles) as\ncategorical variables&#39;) + theme(legend.box.margin = margin(0, 0, 0, 12))+ theme_classic(base_size = base_size_all)
)

prow2.1 &lt;- plot_grid(
  g_vis_bk.hrdl.categ + xlab(&quot;% Bike lane to streets 2011&quot;) + ylab(&quot;% Bike lane to streets 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_vis_gr.categ + xlab(&quot;% green space within CT 2011&quot;) + ylab(&quot;% green space within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_vis_tc.categ + xlab(&quot;% tree canopy within CT 2011&quot;) + ylab(&quot;% tree canopy within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  align = &quot;vh&quot;,
  labels = c(&quot;D&quot;, &quot;E&quot;, &quot;F&quot;),
  hjust = -1,
  nrow = 1
)

prow2 &lt;- plot_grid(prow2.1, legend.row2, rel_widths = c(3, .4))

# output all graphs
plot_grid(prow1, prow2, ncol=1)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_img/disc_interactions.png" /></p>
</div>
</div>
</div>
<div id="annexes" class="section level1" number="11">
<h1><span class="header-section-number">11</span> Annexes</h1>
<pre><code>## R version 4.1.3 (2022-03-10)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur/Monterey 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_CA.UTF-8/en_CA.UTF-8/en_CA.UTF-8/C/en_CA.UTF-8/en_CA.UTF-8
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] cancensus_0.5.5  stringr_1.5.0    DHARMa_0.4.5     stargazer_5.2.3 
##  [5] spaMM_4.1.20     cachem_1.0.6     memoise_2.0.1    spatialreg_1.2-5
##  [9] spdep_1.2-5      spData_2.0.1     sp_1.5-0         lme4_1.1-31     
## [13] Matrix_1.4-0     cowplot_1.1.1    biscale_1.0.0    openxlsx_4.2.5  
## [17] RPostgres_1.4.5  DBI_1.1.3        ggsn_0.5.0       ggmap_3.0.1     
## [21] ggplot2_3.4.1    stars_0.5-5      abind_1.4-5      sf_1.0-9        
## [25] tidyr_1.3.0      dplyr_1.1.0     
## 
## loaded via a namespace (and not attached):
##   [1] minqa_1.2.4         colorspace_2.0-3    deldir_1.0-6       
##   [4] ellipsis_0.3.2      class_7.3-20        rstudioapi_0.14    
##   [7] proxy_0.4-27        farver_2.1.1        bit64_4.0.5        
##  [10] RSpectra_0.16-1     fansi_1.0.3         lubridate_1.9.0    
##  [13] xml2_1.3.3          codetools_0.2-18    splines_4.1.3      
##  [16] knitr_1.41          jsonlite_1.8.0      nloptr_2.0.3       
##  [19] png_0.1-7           readr_2.1.3         compiler_4.1.3     
##  [22] httr_1.4.4          fastmap_1.1.0       cli_3.6.0          
##  [25] s2_1.1.0            htmltools_0.5.3     tools_4.1.3        
##  [28] coda_0.19-4         gtable_0.3.0        glue_1.6.2         
##  [31] wk_0.6.0            gmodels_2.18.1.1    Rcpp_1.0.9         
##  [34] slam_0.1-50         jquerylib_0.1.4     raster_3.5-21      
##  [37] vctrs_0.5.2         svglite_2.1.0       gdata_2.18.0.1     
##  [40] nlme_3.1-155        lwgeom_0.2-11       xfun_0.36          
##  [43] rvest_1.0.3         timechange_0.2.0    lifecycle_1.0.3    
##  [46] gtools_3.9.3        terra_1.5-21        ROI_1.0-0          
##  [49] LearnBayes_2.15.1   MASS_7.3-55         scales_1.2.1       
##  [52] vroom_1.6.0         hms_1.1.2           parallel_4.1.3     
##  [55] expm_0.999-6        RColorBrewer_1.1-3  yaml_2.3.5         
##  [58] pbapply_1.5-0       sass_0.4.2          stringi_1.7.8      
##  [61] highr_0.9           maptools_1.1-4      e1071_1.7-11       
##  [64] boot_1.3-28         zip_2.2.0           systemfonts_1.0.4  
##  [67] RgoogleMaps_1.4.5.3 rlang_1.0.6         pkgconfig_2.0.3    
##  [70] bitops_1.0-7        evaluate_0.16       lattice_0.20-45    
##  [73] purrr_1.0.1         labeling_0.4.2      bit_4.0.4          
##  [76] tidyselect_1.2.0    geojsonsf_2.0.3     plyr_1.8.7         
##  [79] magrittr_2.0.3      R6_2.5.1            generics_0.1.3     
##  [82] pillar_1.8.1        foreign_0.8-82      withr_2.5.0        
##  [85] units_0.8-0         tibble_3.1.8        crayon_1.5.1       
##  [88] KernSmooth_2.23-20  utf8_1.2.2          tzdb_0.3.0         
##  [91] rmarkdown_2.20      jpeg_0.1-9          blob_1.2.3         
##  [94] forcats_1.0.0       webshot_0.5.3       digest_0.6.29      
##  [97] classInt_0.4-7      numDeriv_2016.8-1.1 munsell_0.5.0      
## [100] viridisLite_0.4.1   kableExtra_1.3.4    registry_0.5-1     
## [103] bslib_0.4.0</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="B. Thierry, Spherelab" />


<title>BEI and equity paper analyses | FINAL | AOI ok | Hurdle models</title>

<script src="BEI_equity_paper.final.aoiOK_files/header-attrs-2.25/header-attrs.js"></script>
<script src="BEI_equity_paper.final.aoiOK_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="BEI_equity_paper.final.aoiOK_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="BEI_equity_paper.final.aoiOK_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="BEI_equity_paper.final.aoiOK_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="BEI_equity_paper.final.aoiOK_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="BEI_equity_paper.final.aoiOK_files/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="BEI_equity_paper.final.aoiOK_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="BEI_equity_paper.final.aoiOK_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="BEI_equity_paper.final.aoiOK_files/navigation-1.1/tabsets.js"></script>
<script src="BEI_equity_paper.final.aoiOK_files/navigation-1.1/codefolding.js"></script>
<link href="BEI_equity_paper.final.aoiOK_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="BEI_equity_paper.final.aoiOK_files/highlightjs-9.12.0/highlight.js"></script>
<link href="BEI_equity_paper.final.aoiOK_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="BEI_equity_paper.final.aoiOK_files/pagedtable-1.1/js/pagedtable.js"></script>
<script src="BEI_equity_paper.final.aoiOK_files/kePrint-0.0.1/kePrint.js"></script>
<link href="BEI_equity_paper.final.aoiOK_files/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">BEI and equity paper analyses | FINAL | AOI
ok | Hurdle models</h1>
<h4 class="author">B. Thierry, Spherelab</h4>
<h4 class="date">04 January, 2024</h4>

</div>


<pre class="r"><code># Clean up dataframe to keep only meaningful vars and drop NA, ready for LM
tidy_df &lt;- function(src_df, ct, f, drop_islands=TRUE) {
  clean_bei_df &lt;- src_df %&gt;%
    select(CT_UID, all_of(all.vars(f))) %&gt;%
    drop_na() %&gt;%
    units::drop_units()
  
  # Join geom from CT dataframe
  df &lt;- ct %&gt;%
    transmute(CT_UID = GeoUID) %&gt;%
    inner_join(clean_bei_df, by=&quot;CT_UID&quot;)
  
  # Build neighborhood (with islands) and extract island IDs
  ct_nb &lt;- poly2nb(df)
  
  if (drop_islands) {
    islands &lt;- lapply(ct_nb, min) %&gt;% lapply(function(e) e == 0) %&gt;% unlist %&gt;% which()

    # Cleanup subset DF to drop islands and NA
    df &lt;- df %&gt;%
      filter(!row_number() %in% islands) %&gt;%
      mutate(ct_no = row_number()) # Add CT number, matching row number
  
    # Recompute neighborhood
    ct_nb &lt;- poly2nb(df)
    
    # Clean up final dataframe (no island, no NA&#39;s, pure dataframe)
    clean_df &lt;- df %&gt;%
      as.data.frame() %&gt;%
      select(CT_UID, ct_no, all_of(all.vars(f)))
  }

  nbw = nb2listw(ct_nb, zero.policy = !drop_islands)
  nbmatx = nb2mat(ct_nb, style = &quot;B&quot;, zero.policy = !drop_islands)
  
  list(df=clean_df, nbmatx=nbmatx, nbw=nbw, island_dropped=drop_islands)
}</code></pre>
<p>This document builds on <code>BEI_equity_paper.Rmd</code> doc, which
started as an analysis for the equity paper and moved to an exploration
of the best modeling framework (simple OLS, spatial auto-regressive
linear regression, spatial random effect model and INLA) to assess the
relation between interventions and equity metrics. The conclusions of
this exploration led to the following decisions:</p>
<ol style="list-style-type: decimal">
<li>go with quintiles instead of absolute numbers (easier to
interpret)</li>
<li>use [zero inflated] Poisson distribution where fit (<em>ie</em> Bike
lane ratio)</li>
<li>use <code>spaMM</code> package to model association;
<code>INLA</code> could be the focus of another methodological paper
which would compare both approaches</li>
<li>use non-buffered dependent variable, as spatial dependency is
already taken care of through the spatial random effect</li>
</ol>
<p>This document contains the analyses to be included in the BEI and
equity paper.</p>
<div id="proposal" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Proposal</h1>
<div id="original-grant-proposal-for-census-tract-level-analyses"
class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Original grant
proposal for Census tract level analyses</h2>
<div id="objective-1-socio-spatial-inequalities-in-urban-interventions"
class="section level3" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Objective 1:
Socio-spatial inequalities in urban interventions:</h3>
<ul>
<li>To test if urban interventions tend to be located in low SES
neighborhoods (H1a); we will run the following model: <span
class="math display">\[Log(ùîº(UI_{ùëñ} \mid X_{ùëñ})) = \alpha + \beta_{1} *
SES_{ùëñ}\]</span> a Poisson regression model with <span
class="math inline">\(UI\)</span> = the number of Urban Interventions
between 2016 and 2021, <span class="math inline">\(SES\)</span> = the
socio-economic status of the census track at 2016.</li>
<li>To test the reduction in socio-economic inequalities in urban
conditions (e.g.¬†length and type of bicycle lanes, NDVI) between 2006
and 2020 (H1b), we will run the following model: <span
class="math display">\[ùîº(UC_{ij} \mid X_{ij}) = \beta_{0j} + \beta_{1j}
‚àó SES + \beta_{2j} ‚àó Time + \beta_{3j} ‚àó SES ‚àó Time +
\epsilon_{ij}\]</span> a multilevel linear model with <span
class="math inline">\(UC\)</span> = the Urban condition, <span
class="math inline">\(SES\)</span> = the socio-economic status of the
census track.</li>
</ul>
</div>
<div
id="objective-2-examining-causal-pathways-and-directionality-of-interventiongentrification-relation"
class="section level3" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Objective 2:
Examining causal pathways and directionality of
intervention/gentrification relation:</h3>
<ul>
<li>To test if urban interventions occur before gentrification or if
gentrification occurs before the implementation of new urban
interventions, we will run two models : (1) <span
class="math display">\[Logit(ùîº(G_{i} \mid X_{i})) = \alpha + \beta_{1} ‚àó
UI_{i} + + \beta_{2} ‚àó PG_{i} + \beta ‚àó X_{control_{i}}\]</span> a
logistic regression model among low SES census tracts (2006) with <span
class="math inline">\(G\)</span> = Gentrification between 2006 and 2016,
<span class="math inline">\(UI\)</span> = the number of Urban
Interventions between 2001 and 2006, and <span
class="math inline">\(PG\)</span> = SES status 2006; and (2) <span
class="math display">\[Logit(ùîº(UI_{i} \mid X_{i})) = \alpha + \beta_{1}
‚àó G_{i} + \beta_{2} ‚àó UC_{i} + \beta ‚àó X_{control_{i}}\]</span> a
Poisson regression model, with <span class="math inline">\(UI\)</span> =
the number of Urban Interventions between 2016 and 2023, <span
class="math inline">\(G\)</span> = Gentrification between 2006 and 2016,
and <span class="math inline">\(UC\)</span> = Urban Conditions in
2016.</li>
</ul>
</div>
</div>
<div id="paper-objective" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Paper objective</h2>
<p>We focus on obj #1: are urban interventions tend to be located in low
SES neighborhoods. Here, the urban interventions considered are bike
lanes and canopy/tree coverage and low SES ~ high Pampalon deprivation
index. In a second step, we will look at the variations of UI and SES
and their association.</p>
<p>Data extraction and pre-analyses for the paper looking at BEI and
equity. BEI comprise bike lanes and canopy changes while equity is
measured through Pampalon deprivation index. (Partially adapted from
original work on BEI bike lanes ‚Äì see <code>bike_lane_stats.R</code> and
<code>ReadMe.md</code>.)</p>
<p>Paper is available <a
href="https://docs.google.com/document/d/1m7axqojha0YGud4rWQ1zsWaxufim7lvk5DDQ-h5VSfE/edit">here</a>.</p>
<p><strong>General processing steps:</strong></p>
<ul>
<li>Get CT 2016 boundaries (from Cancensus API)</li>
<li>Get BEI interventions (canopy / bike lanes) for the selected years
(2011 / 2015 / 2016 / 2019)</li>
<li>Compute changes between years
<ul>
<li>for the original CT boundaries</li>
<li>for buffered CTs (250 / 500 / 750m)</li>
</ul></li>
</ul>
<p>In a second phase, these BEI changes will be linked to Pampalon index
for 2016 (and 2011 ?)</p>
</div>
<div id="revision-history" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Revision history</h2>
<p><strong>UPDATE 2021-12-02</strong> Following discussion with <span
class="citation">@Yan</span>, add normalized bike line changes:</p>
<ul>
<li>by CT/buffer area</li>
<li>by street length within CT/buffer</li>
</ul>
<p><strong>UPDATE 2021-12-08</strong> Following discussion with <span
class="citation">@Yan</span></p>
<ul>
<li>Keep only normalized variation of bike lane length</li>
<li>Reverse relation: BEI metric = f(Equity metric (Pampalon /
gentrification))</li>
<li>Display association at baseline, then add delta over time</li>
<li>Canopy : distinguish between high and low canopy</li>
</ul>
<p><strong>UPDATE 2022-01-14</strong> Following discussion with <span
class="citation">@Ruben</span> and <span
class="citation">@Yan</span></p>
<ul>
<li>Test model with UC 2011 when modeling UI</li>
<li>Models with <em>random slope</em> probably not pertinent (see model
6, section 7.1.6)</li>
<li>Try to define <code>Year</code> variable as continuous instead of
category in LME</li>
<li>Check if range of <code>wSCOREMAT</code> matches theoretical range
of x-axis in graph (-.2 &gt;&gt; .2), might ponder the magnitude of the
observed trend</li>
<li>Test three-way interaction instead of 2 times two-way interactions
(interactions might be complicated to interpret‚Ä¶)</li>
<li>For gentrification and multilevel model, use GEE (logit)</li>
</ul>
<p><strong>UPDATE 2022-02-10</strong> Following gentrification
meeting</p>
<ul>
<li>Add correlation matrix of SES variables (Caislin)</li>
<li>Drop <code>wSCORESOC</code>, which does not capture equity dimension
(Meghan) [replaced by visible minority]</li>
<li>Paper focus should be on gentrification</li>
</ul>
<p><strong>UPDATE 2022-02-15</strong></p>
<ul>
<li>Add spatial autocorrelation test (Moran‚Äôs I)</li>
<li>Add Lagrange Multipliers to test best spatial model</li>
<li>Add comparison of OLS/SAR/SEM models</li>
</ul>
<p><strong>UPDATE 2022-06-28</strong></p>
<ul>
<li>Add categorical SES variables (instead of ordinal coding) to better
explain the Q5 vs other effect (see Behzad and Yan‚Äôs comments); this is
particularly true for bike lanes changes, as no significant effect found
yet graph shows clearly a Q5 vs.¬†other effect</li>
<li>Build maps of SES (?) and BEI / BEC (might be better in ArcGIS)</li>
</ul>
<p><strong>UPDATE 2022-07-07</strong></p>
<ul>
<li>Fix quintile computation (which was previously based on the whole
CMA and now uses the actual AOI)</li>
<li>Dropped a few useless chunks (mostly bike lane, no hurdle
model)</li>
</ul>
<p><strong>UPDATE 2023-01-16</strong></p>
<ul>
<li>Decided to split the paper in two (gentrif + greenness) after
reviews from the paper submission</li>
<li>As per reviewer‚Äôs suggestion, gentrification now distinguishes
between 3 states: gentrified / not-gontrified/non-eligible to
gentrification</li>
</ul>
<p><strong>UPDATE 2023-02-20</strong></p>
<ul>
<li>Fix study area to exclude Boucherville</li>
</ul>
<p><strong>UPDATE 2023-03-16</strong></p>
<ul>
<li>Discard true hurdle model approach by processing separately the
change in bike lanes (no change vs.¬†having a bike lane in 2026 when no
bike lanes existed in 2011) and the amount of change when there is a
bike lane in 2016. || <em>NB</em>: this does not improve the model
convergence</li>
<li>Added manual CI computation when not converging with
<code>confint</code> function</li>
</ul>
<p><strong>UPDATE 2023-05-19</strong></p>
<p>Second review of paper by Landscape and Urban Planning</p>
<ul>
<li>Added a confusion matrix / correlation + test to justify that SES
variables are kept separate in order to avoid colinearity issues</li>
<li>Added UC 2016 models (to replicate UC 2011 models at baseline, as
justed by one review and agreed by Yan and Behzad)</li>
<li>Computed global % of green space and tree canopy for the whole study
area (on top of the stats for the % at the CT level)</li>
</ul>
</div>
<div id="a-few-references" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> A few
references‚Ä¶</h2>
<ul>
<li>General resources on GLMM
<ul>
<li><a
href="http://bbolker.github.io/mixedmodels-misc/glmmFAQ.html">GLMM
FAQ</a></li>
</ul></li>
<li>Count and rate models:
<ul>
<li><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3513584/">A
tutorial on count regression and zero-altered count models for
longitudinal substance use data</a></li>
<li><a
href="https://psycnet.apa.org/fulltext/1996-93539-001.html">Regression
Analyses of Counts and Rates: Poisson, Overdispersed Poisson, and
Negative Binomial Models</a></li>
<li><a
href="https://www.tandfonline.com/doi/full/10.1080/00223890802634175?journalCode=hjpa20">The
Analysis of Count Data: A Gentle Introduction to Poisson Regression and
Its Alternatives</a></li>
</ul></li>
<li>Spatial models:
<ul>
<li><a href="https://rspatial.org/raster/analysis/7-spregression.html"
class="uri">https://rspatial.org/raster/analysis/7-spregression.html</a></li>
<li><a href="https://rpubs.com/quarcs-lab/tutorial-spatial-regression"
class="uri">https://rpubs.com/quarcs-lab/tutorial-spatial-regression</a></li>
<li><a
href="https://www.r-bloggers.com/2019/09/spatial-regression-in-r-part-1-spamm-vs-glmmtmb/"
class="uri">https://www.r-bloggers.com/2019/09/spatial-regression-in-r-part-1-spamm-vs-glmmtmb/</a></li>
<li><a href="https://crd230.github.io/lab8.html"
class="uri">https://crd230.github.io/lab8.html</a></li>
<li><a
href="http://labs.bio.unc.edu/Buckley/documents/AnselinIntroSpatRegres.pdf"
class="uri">http://labs.bio.unc.edu/Buckley/documents/AnselinIntroSpatRegres.pdf</a></li>
</ul></li>
<li>Interactions:
<ul>
<li><a
href="https://stats.oarc.ucla.edu/r/seminars/interactions-r/#s4d">Decomposing,
Probing, and Plotting Interactions in R</a></li>
<li><a
href="https://cran.r-project.org/web/packages/emmeans/vignettes/sophisticated.html">Sophisticated
models in emmeans</a></li>
<li><a
href="https://tysonbarrett.com/Rstats/chapter-6-multilevel-modeling.html">R
for Researchers: An Introduction</a></li>
<li><a
href="https://academic.oup.com/ije/article/41/2/514/692957">Recommendations
for presenting analyses of effect modification and interaction</a></li>
<li><a
href="https://stats.stackexchange.com/questions/94888/p-value-for-interaction-term-in-mixed-effects-models-using-lme4">Testing
interact terms</a></li>
</ul></li>
</ul>
</div>
</div>
<div id="built-environment-intervention-extraction"
class="section level1" number="2">
<h1><span class="header-section-number">2</span> Built Environment
Intervention Extraction</h1>
<div id="get-aoi-limits" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Get AOI limits</h2>
<pre class="r"><code># CT boundaries for Montreal
CT16 &lt;- get_census(dataset=&#39;CA16&#39;, regions=list(CMA=&#39;24462&#39;), level=&#39;CT&#39;, geo_format = &quot;sf&quot;) %&gt;%
  filter(Type == &quot;CT&quot;) %&gt;%
  mutate(interact_aoi = (CD_UID %in% c(2466, 2465, 2458)) &amp; !(CSD_UID %in% c(2458033, 2458037))) %&gt;% # Flag Montr√©al island, Laval and the South shore (Longueuil, St-Lambert, Brossard) and drop Boucherville and St-Bruno
  st_transform(32188)</code></pre>
<pre><code>## Reading geo data from local cache.</code></pre>
<pre class="r"><code>CT11 &lt;- get_census(dataset=&#39;CA11&#39;, regions=list(CMA=&#39;24462&#39;), level=&#39;CT&#39;, geo_format = &quot;sf&quot;) %&gt;%
  filter(Type == &quot;CT&quot;) %&gt;%
  st_transform(32188)</code></pre>
<pre><code>## Reading geo data from local cache.</code></pre>
<pre class="r"><code># Compute N CTs per broad area (Laval / Montreal / South shore)
CT16 %&gt;% as.data.frame() %&gt;%
  filter(interact_aoi) %&gt;%
  group_by(CD_UID) %&gt;%
  summarise(n = n())</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["CD_UID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"2458","2":"75"},{"1":"2465","2":"81"},{"1":"2466","2":"533"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="bike-lane-changes" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Bike lane
changes</h2>
<p>We use data categorized by Philippe Apparicio‚Äôs team who manually
identified bike lanes for each census year since 1991. For this study,
we limit ourselves to 2016, 2011 and 2006 census years.</p>
<p>On top of the original CT boundaries, three levels of buffer have
been applied to the CT ‚Äì 250m, 500m &amp; 750m. Then the same series of
processing steps (see above) have been applied to the buffers.</p>
<pre class="r"><code># Bike lanes, from Ph. Apparicio
# Cleaunp done with GDAL:
# ogr2ogr -f GPKG ReseauCyclableFinal.gpkg  ReseauCyclableFinal.gdb Reseau -nlt MULTILINESTRING
reseau &lt;- st_read(dsn=&quot;data/ReseauCyclableFinal.gpkg&quot;, layer = &quot;Reseau&quot;) # Already in NAD83 / MTM zone 8</code></pre>
<pre><code>## Reading layer `Reseau&#39; from data source 
##   `I:\Benoit\WORKSPACE\GENTRI_BEI_equity\data\ReseauCyclableFinal.gpkg&#39; 
##   using driver `GPKG&#39;
## Simple feature collection with 82166 features and 72 fields (with 1 geometry empty)
## Geometry type: MULTILINESTRING
## Dimension:     XY, XYZ
## Bounding box:  xmin: 266985.5 ymin: 5029251 xmax: 320986.1 ymax: 5062652
## z_range:       zmin: 0 zmax: 0
## Projected CRS: NAD83 / MTM zone 8</code></pre>
<pre class="r"><code>bike_lane &lt;- reseau %&gt;%
  filter(An2016 == 1 | An2011 == 1) %&gt;%
  select(IdRte, ClsRte, Zone, starts_with(&quot;An&quot;), starts_with(&quot;Typo_&quot;))</code></pre>
<pre class="r"><code>compute_bikelane_by_area &lt;- function(sf_areas, year_fld, typo_fld) {
  # Compute length of bike lanes within each area.
  # --
  # Parameters:
  #   - sf_areas: sf class object defining the areas of interest, must have a GeoUID field
  #   - year_fld: field name specifying the year of interest, e.g. An2016
  #   - typo_fld: field name specifying the typology for the year of interest, e.g. Typo_2016
  
  year_fld &lt;- enquo(year_fld)
  typo_fld &lt;- enquo(typo_fld)
  
  # Compute intersection of bike lanes with areas
  bk &lt;- bike_lane %&gt;%
    filter(!!year_fld == 1) %&gt;%
    st_intersection(sf_areas) %&gt;%
    mutate(bike_lane_length = st_length(.)) %&gt;%
    as.data.frame() %&gt;%
    group_by(GeoUID, !!typo_fld) %&gt;%
    summarise(bike_lane_length = sum(bike_lane_length)) %&gt;%
    ungroup() %&gt;%
    pivot_wider(names_from = !!typo_fld, names_prefix = &quot;Bike_class&quot;, names_sort = TRUE,
                values_from = bike_lane_length, values_fill = units::set_units(0, m)) %&gt;%
    mutate(Bike_lane_total = units::set_units(rowSums(select(., starts_with(&quot;Bike_class&quot;))), m))
  
  # Merge back into original sf_areas
  bk &lt;- sf_areas %&gt;%
    left_join(bk)
  
  # Replace NA by 0, which occur in Bike_class length
  bk[is.na(bk)] &lt;- 0
  
  return(bk)
}

compute_streetlength_by_area &lt;- function(sf_areas) {
  # Compute length of streets within each area.
  # --
  # Parameters:
  #   - sf_areas: sf class object defining the areas of interest, must have a GeoUID field

  # Compute intersection of streets with areas
  bk &lt;- reseau  %&gt;%
    st_cast(&quot;MULTILINESTRING&quot;) %&gt;% # Get rid of a few MULTICURVE geometries
    st_intersection(sf_areas) %&gt;%
    mutate(street_length = st_length(.)) %&gt;%
    as.data.frame() %&gt;%
    group_by(GeoUID) %&gt;%
    summarise(street_length = sum(street_length)) %&gt;%
    ungroup()
  
  # Merge back into original sf_areas
  bk &lt;- sf_areas %&gt;%
    mutate(shape_area_km2 = units::set_units(st_area(.), &#39;km^2&#39;)) %&gt;%
    left_join(bk)
  
  # Replace NA by 0
  bk[is.na(bk)] &lt;- 0
  
  return(bk)
}


# Compute year 2016 and year 2011 bike lanes within 2016 CTs
# NB: contrary to the original work, we keep the same area of reference, i.e. 2016
bike_lane_by_CT16 &lt;- compute_bikelane_by_area(CT16, An2016, Typo_2016)
bike_lane_by_CT11 &lt;- compute_bikelane_by_area(CT16, An2011, Typo_2011)
bike_lane_by_CT06 &lt;- compute_bikelane_by_area(CT16, An2006, Typo_2006)

# Compute total street length within CT/buffer
street_length_by_CT16 &lt;- compute_streetlength_by_area(CT16)

# Reorganize data to have all data in one dataframe
bike_lane_changes &lt;- CT16 %&gt;%
  left_join(select(as.data.frame(street_length_by_CT16), GeoUID, street_length, shape_area_km2), by=&quot;GeoUID&quot;) %&gt;%
  left_join(select(as.data.frame(bike_lane_by_CT16), GeoUID, starts_with(&quot;Bike_&quot;)), by=&quot;GeoUID&quot;) %&gt;%
  left_join(select(as.data.frame(bike_lane_by_CT11), GeoUID, starts_with(&quot;Bike_&quot;)), by=&quot;GeoUID&quot;, suffix=c(&quot;.2016ct&quot;, &quot;.2011ct&quot;)) %&gt;%
  left_join(select(as.data.frame(bike_lane_by_CT06), GeoUID, starts_with(&quot;Bike_&quot;)), by=&quot;GeoUID&quot;)

# Compute ratio of bike lane vs street length
bike_lane_changes &lt;- bike_lane_changes %&gt;%
  transmute(GeoUID = GeoUID,
            interact_aoi = interact_aoi,
            street_length = street_length,
            street_length.hm = street_length / 100, # in hectometers, can be kept as float (not a dependent variable following a Poisson distribution)
            Bike_lane_total.2016ct = Bike_lane_total.2016ct,
            Bike_lane_total.2011ct = Bike_lane_total.2011ct,
            Bike_lane_total.2006ct = Bike_lane_total,
            Bike_lane_total.hm.2016ct = as.integer(round(Bike_lane_total.2016ct/100)),
            Bike_lane_total.hm.2011ct = as.integer(round(Bike_lane_total.2011ct/100)),
            Bike_lane_total.hm.2006ct = as.integer(round(Bike_lane_total/100)),
            Bike_lane.by.street.2016ct = 100 * Bike_lane_total.2016ct / street_length, # In percents
            Bike_lane.by.street.2011ct = 100 * Bike_lane_total.2011ct / street_length,
            Bike_lane.by.street.2006ct = 100 * Bike_lane_total / street_length)

# Compute change between 2011 and 2016 (only for total bike lane length)
bike_lane_changes &lt;- bike_lane_changes %&gt;%
  mutate(Bike_lane_diff.2011.2016ct = Bike_lane_total.2016ct - Bike_lane_total.2011ct)

# Normalize bike lane change by (i) street length and (ii) area
bike_lane_changes &lt;- bike_lane_changes %&gt;%
  mutate(Bike_lane_diff.by.street.2011.2016ct = 100 * Bike_lane_diff.2011.2016ct / street_length)

# Save results
st_write(bike_lane_changes, dsn = &quot;data/bike_length_changes.gpkg&quot;, delete_layer = TRUE)</code></pre>
<pre><code>## Deleting layer `bike_length_changes&#39; using driver `GPKG&#39;
## Writing layer `bike_length_changes&#39; to data source 
##   `data/bike_length_changes.gpkg&#39; using driver `GPKG&#39;
## Writing 970 features with 15 fields and geometry type Multi Polygon.</code></pre>
<pre class="r"><code># Clean up
rm(buf_CT16)
rm(bike_lane_by_CT11, bike_lane_by_CT16, bike_lane_by_CT06)
rm(street_length_by_CT16)</code></pre>
<div id="illustration-of-bike-lane-metrics"
class="section level3 tabset" number="2.2.1">
<h3 class="tabset"><span class="header-section-number">2.2.1</span>
Illustration of bike lane metrics</h3>
<p>Check output for one specific dataset (Census tracts 2016, no
buffer)</p>
<div id="raw-length" class="section level4" number="2.2.1.1">
<h4><span class="header-section-number">2.2.1.1</span> Raw length</h4>
<p>Bike lane length in 2016 within CTs, measured in meters</p>
<pre class="r"><code>ggplot() +
   geom_sf(data=filter(bike_lane_changes, interact_aoi), mapping = aes(fill=as.numeric(Bike_lane_total.2016ct)), lwd=0) +
  scale_fill_continuous(name = &quot;Total length (m)&quot;)+ 
  labs(title = &quot;Length of bike lanes within 2016 CTs&quot;)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/carte-controle-1.png" /><!-- --></p>
</div>
<div id="absolute-length-change" class="section level4"
number="2.2.1.2">
<h4><span class="header-section-number">2.2.1.2</span> Absolute length
change</h4>
<p>Absolute bike lane length change between 2011 and 2016, in meters</p>
<pre class="r"><code>ggplot() +
   geom_sf(data=filter(bike_lane_changes, interact_aoi), mapping = aes(fill=as.numeric(Bike_lane_diff.2011.2016ct)), lwd=0) +
  scale_fill_gradient2(name = &quot;Length (m)&quot;)+ 
  labs(title = &quot;Changes in bike lane between 2011 and 2016&quot;)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/carte-controle-1-1.png" /><!-- --></p>
</div>
<div id="normalized-length-change-by-street" class="section level4"
number="2.2.1.3">
<h4><span class="header-section-number">2.2.1.3</span> Normalized length
change (by street)</h4>
<p>Relative bike lane length change between 2011 and 2016, normalized by
street length within CT in 2016, expressed in %</p>
<p><span class="math display">\[Variation = \frac{Bike
Lane_{2016}}{Street Length_{2016}} - \frac{Bike Lane_{2011}}{Street
Length_{2016}}\]</span></p>
<pre class="r"><code>ggplot() +
   geom_sf(data=filter(bike_lane_changes, interact_aoi), mapping = aes(fill=as.numeric(Bike_lane_diff.by.street.2011.2016ct)), lwd=0) +
  scale_fill_gradient2(name = &quot;Variation (%)&quot;)+ 
  labs(title = &quot;Changes in bike lane between 2011 and 2016, normalized by street&quot;)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/carte-controle-2-1.png" /><!-- --></p>
</div>
</div>
<div id="basic-stats-on-each-layer" class="section level3"
number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Basic stats on each
layer</h3>
<p>At the Census Tract level.</p>
<pre class="r"><code># CT level
ggplot(bike_lane_changes) +
  geom_histogram(aes(as.numeric(Bike_lane_diff.2011.2016ct)), binwidth = 250) + 
  xlab(&quot;Difference of bike lane length between 2016 and 2011 | CT level&quot;)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/bike-lane-stats-ct-1.png" /><!-- --></p>
<pre class="r"><code>summary(bike_lane_changes$Bike_lane_diff.2011.2016ct)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## -1377.7     0.0     0.0   262.1   189.7 14463.8</code></pre>
<pre class="r"><code>ggplot(bike_lane_changes) +
  geom_histogram(aes(as.numeric(Bike_lane_diff.by.street.2011.2016ct))) + 
  xlab(&quot;Difference of bike lane length between 2016 and 2011, normalized by street&quot;)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/bike-lane-stats-ct-2.png" /><!-- --></p>
<pre class="r"><code>summary(bike_lane_changes$Bike_lane_diff.by.street.2011.2016ct)</code></pre>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA&#39;s 
## -100.000    0.000    0.000    3.665    4.496  100.000      252</code></pre>
</div>
</div>
<div id="canopy-changes" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Canopy changes</h2>
<p>Canopy changes is based on <a
href="http://observatoire.cmm.qc.ca/fileadmin/user_upload/geomatique/IndiceCanopee/2015/CMM_indiceCanopee_2015_methodologie.pdf">data
produced by CMM</a>, using multispectral aerial imagery and lidar. In
order to sync the observations with the census years, we focus on 2011
and 2019 with one extra observation point in 2015.</p>
<p>The processing steps are similar to the ones for the bike lanes:</p>
<ul>
<li>Import the raster for each of the 3 years</li>
<li>Compute proportion of canopy within each CT for the 3 years</li>
</ul>
<pre class="r"><code># Codes du raster &quot;espace vert&quot;
# 0. No data (hors CMM)
# 1. NDVI &lt; 0,3 et MNH &lt; 3,0m = Min√©ral bas (route, stationnement, etc.)
# 2. NDVI &lt; 0,3 et MNH ‚â• 3,0m = Min√©ral haut (constructions)
# 3. NDVI ‚â• 0,3 et MNH &lt; 3,0m = V√©g√©tal bas (culture, gazon, etc.)
# 4. NDVI ‚â• 0,3 et MNH ‚â• 3,0m = V√©g√©tal haut (canop√©e)
# 5. Aquatique

# Load rasters into pg database for further processing
system(&#39;psql -d gentrif_bei -c &quot;CREATE EXTENSION IF NOT EXISTS postgis&quot;&#39;)
system(&#39;psql -d gentrif_bei -c &quot;CREATE EXTENSION IF NOT EXISTS postgis_raster&quot;&#39;)

if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2019&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/2019/*.tif -F -t 1000x1000 canopee2019 | psql -d gentrif_bei&quot;, intern = TRUE)
} else { message(&quot;PG Raster &#39;canopee2019&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2019&#39; already imported</code></pre>
<pre class="r"><code>if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2017&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/2017/*.tif -F -t 1000x1000 canopee2017 | psql -d gentrif_bei&quot;, intern = TRUE)
} else { message(&quot;PG Raster &#39;canopee2017&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2017&#39; already imported</code></pre>
<pre class="r"><code>if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2015&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/2015/*.tif -F -t 1000x1000 canopee2015 | psql -d gentrif_bei&quot;, intern = TRUE)
} else { message(&quot;PG Raster &#39;canopee2015&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2015&#39; already imported</code></pre>
<pre class="r"><code>if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2011&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/2011/*.tif -F -t 1000x1000 canopee2011 | psql -d gentrif_bei&quot;, intern = TRUE)
} else { message(&quot;PG Raster &#39;canopee2011&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2011&#39; already imported</code></pre>
<pre class="r"><code># Resample to 10m as the original rasters have a 1m resolution, which is too high to allow for a swift processing
if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2019_10m&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;gdal_translate -of GTiff PG:\&quot;host=localhost dbname=gentrif_bei table=canopee2019 mode=2\&quot; -r mode -tr 10 10 data/canopy/canopee2019_10m.tif&quot;)
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/canopee2019_10m.tif -F -t 100x100 canopee2019_10m | psql -d gentrif_bei&quot;)
} else { message(&quot;PG Raster &#39;canopee2019_10m&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2019_10m&#39; already imported</code></pre>
<pre class="r"><code>if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2017_10m&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;gdal_translate -of GTiff PG:\&quot;host=localhost dbname=gentrif_bei table=canopee2017 mode=2\&quot; -r mode -tr 10 10 data/canopy/canopee2017_10m.tif&quot;)
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/canopee2017_10m.tif -F -t 100x100 canopee2017_10m | psql -d gentrif_bei&quot;)
} else { message(&quot;PG Raster &#39;canopee2017_10m&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2017_10m&#39; already imported</code></pre>
<pre class="r"><code>if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2015_10m&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;gdal_translate -of GTiff PG:\&quot;host=localhost dbname=gentrif_bei table=canopee2015 mode=2\&quot; -r mode -tr 10 10 data/canopy/canopee2015_10m.tif&quot;)
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/canopee2015_10m.tif -F -t 100x100 canopee2015_10m | psql -d gentrif_bei&quot;)
} else { message(&quot;PG Raster &#39;canopee2015_10m&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2015_10m&#39; already imported</code></pre>
<pre class="r"><code>if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;canopee2011_10m&#39;) IS NOT NULL;&quot;)) == 0) {
  system(&quot;gdal_translate -of GTiff PG:\&quot;host=localhost dbname=gentrif_bei table=canopee2011 mode=2\&quot; -r mode -tr 10 10 data/canopy/canopee2011_10m.tif&quot;)
  system(&quot;raster2pgsql -s 32188 -I -C -M data/canopy/canopee2011_10m.tif -F -t 100x100 canopee2011_10m | psql -d gentrif_bei&quot;)
} else { message(&quot;PG Raster &#39;canopee2011_10m&#39; already imported&quot;) }</code></pre>
<pre><code>## PG Raster &#39;canopee2011_10m&#39; already imported</code></pre>
<pre class="r"><code># Push CT16 to pg
if (nrow(dbGetQuery(con_bei, &quot;SELECT 1 test WHERE to_regclass(&#39;ct16&#39;) IS NOT NULL;&quot;)) == 0) {
  CT16 %&gt;%
    st_transform(crs = 32188) %&gt;%
    st_write(con_bei, &quot;ct16&quot;,
             layer_options = c(&quot;OVERWRITE=yes&quot;, &quot;LAUNDER=true&quot;, &quot;SPATIAL_INDEX=gist&quot;, &quot;GEOMETRY_NAME=geom&quot;))
  system(&quot;psql -d gentrif_bei -c &#39;CREATE INDEX ON  ct16 USING gist (geometry)&#39;&quot;)
} else { message(&quot;PG Layer CT16 already imported&quot;) }</code></pre>
<pre><code>## PG Layer CT16 already imported</code></pre>
<pre class="sql"><code>WITH cnt19 AS (
    SELECT &quot;GeoUID&quot;, &quot;Population&quot;
        ,(pvc).value, SUM((pvc).count) As total
    FROM (SELECT &quot;GeoUID&quot;, &quot;Population&quot;
            ,ST_ValueCount(ST_Clip(rast, geometry)) As pvc
        FROM canopee2019_10m
        JOIN ct16 ON ST_Intersects(geometry, rast)
    ) As foo
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;, (pvc).value
),
canopee19 AS (
    SELECT &quot;GeoUID&quot;
        ,round(.1*.1 * sum(total) FILTER (WHERE value in (3, 4))) AS area_esp_vert_2019 -- area expressed in hectares
        ,round(100. * sum(total) FILTER (WHERE value in (3, 4)) / sum(total), 1) AS pct_esp_vert_2019
        ,round(.1*.1 * sum(total) FILTER (WHERE value = 4)) AS area_esp_vert_high_2019
        ,round(100. * sum(total) FILTER (WHERE value = 4) / sum(total), 1) AS pct_esp_vert_high_2019
    FROM cnt19
    WHERE value &gt; 0 -- discard no data, including postgis raster no data
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;
),
cnt17 AS (
    SELECT &quot;GeoUID&quot;, &quot;Population&quot;
        ,(pvc).value, SUM((pvc).count) As total
    FROM (SELECT &quot;GeoUID&quot;, &quot;Population&quot;
            ,ST_ValueCount(ST_Clip(rast, geometry)) As pvc
        FROM canopee2017_10m
        JOIN ct16 ON ST_Intersects(geometry, rast)
    ) As foo
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;, (pvc).value
),
canopee17 AS (
    SELECT &quot;GeoUID&quot;
        ,round(.1*.1 * sum(total) FILTER (WHERE value in (3, 4))) AS area_esp_vert_2017
        ,round(100. * sum(total) FILTER (WHERE value in (3, 4)) / sum(total), 1) AS pct_esp_vert_2017
        ,round(.1*.1 * sum(total) FILTER (WHERE value = 4)) AS area_esp_vert_high_2017
        ,round(100. * sum(total) FILTER (WHERE value = 4) / sum(total), 1) AS pct_esp_vert_high_2017
    FROM cnt17
    WHERE value &gt; 0 -- discard no data, including postgis raster no data
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;
),
cnt15 AS (
    SELECT &quot;GeoUID&quot;, &quot;Population&quot;
        ,(pvc).value, SUM((pvc).count) As total
    FROM (SELECT &quot;GeoUID&quot;, &quot;Population&quot;
            ,ST_ValueCount(ST_Clip(rast, geometry)) As pvc
        FROM canopee2015_10m
        JOIN ct16 ON ST_Intersects(geometry, rast)
    ) As foo
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;, (pvc).value
),
canopee15 AS (
    SELECT &quot;GeoUID&quot;
        ,round(.1*.1 * sum(total) FILTER (WHERE value in (3, 4))) AS area_esp_vert_2015
        ,round(100. * sum(total) FILTER (WHERE value in (3, 4)) / sum(total), 1) AS pct_esp_vert_2015
        ,round(.1*.1 * sum(total) FILTER (WHERE value = 4)) AS area_esp_vert_high_2015
        ,round(100. * sum(total) FILTER (WHERE value = 4) / sum(total), 1) AS pct_esp_vert_high_2015
    FROM cnt15
    WHERE value &gt; 0 -- discard no data, including postgis raster no data
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;
),
cnt11 AS (
    SELECT &quot;GeoUID&quot;, &quot;Population&quot;
        ,(pvc).value, SUM((pvc).count) As total
    FROM (SELECT &quot;GeoUID&quot;, &quot;Population&quot;
            ,ST_ValueCount(ST_Clip(rast, geometry)) As pvc
        FROM canopee2011_10m
        JOIN ct16 ON ST_Intersects(geometry, rast)
    ) As foo
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;, (pvc).value
),
canopee11 AS (
    SELECT &quot;GeoUID&quot;
        ,round(.1*.1 * sum(total) FILTER (WHERE value in (3, 4))) AS area_esp_vert_2011
        ,round(100. * sum(total) FILTER (WHERE value in (3, 4)) / sum(total), 1) AS pct_esp_vert_2011
        ,round(.1*.1 * sum(total) FILTER (WHERE value = 4)) AS area_esp_vert_high_2011
        ,round(100. * sum(total) FILTER (WHERE value = 4) / sum(total), 1) AS pct_esp_vert_high_2011
    FROM cnt11
    WHERE value &gt; 0 -- discard no data, including postgis raster no data
    GROUP BY &quot;GeoUID&quot;, &quot;Population&quot;
)
SELECT &quot;GeoUID&quot;
    ,round((st_area(geometry) / 10000)::numeric, 1) ct_area_h -- CT area in hectares
    ,COALESCE(area_esp_vert_2011, 0) area_esp_vert_2011
    ,coalesce(area_esp_vert_high_2011, 0) area_esp_vert_high_2011
    ,coalesce(pct_esp_vert_high_2011, 0) pct_esp_vert_high_2011
    ,coalesce(pct_esp_vert_2011, 0) pct_esp_vert_2011
    ,COALESCE(area_esp_vert_2015, 0) area_esp_vert_2015
    ,coalesce(area_esp_vert_high_2015, 0) area_esp_vert_high_2015
    ,coalesce(pct_esp_vert_high_2015, 0) pct_esp_vert_high_2015
    ,coalesce(pct_esp_vert_2015, 0) pct_esp_vert_2015
    ,COALESCE(area_esp_vert_2017, 0) area_esp_vert_2017
    ,coalesce(area_esp_vert_high_2017, 0) area_esp_vert_high_2017
    ,coalesce(pct_esp_vert_high_2017, 0) pct_esp_vert_high_2017
    ,coalesce(pct_esp_vert_2017, 0) pct_esp_vert_2017
    ,COALESCE(area_esp_vert_2019, 0) area_esp_vert_2019
    ,coalesce(area_esp_vert_high_2019, 0) area_esp_vert_high_2019
    ,coalesce(pct_esp_vert_high_2019, 0) pct_esp_vert_high_2019
    ,coalesce(pct_esp_vert_2019, 0) pct_esp_vert_2019
FROM ct16
FULL JOIN canopee19 USING (&quot;GeoUID&quot;)
FULL JOIN canopee17 USING (&quot;GeoUID&quot;)
FULL JOIN canopee15 USING (&quot;GeoUID&quot;)
FULL JOIN canopee11 USING (&quot;GeoUID&quot;);</code></pre>
<img
src="BEI_equity_paper.final.aoiOK_files/figure-html/get-esp-vert-ct-display-1.png" /><!-- --><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/get-esp-vert-ct-display-2.png" /><!-- --><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/get-esp-vert-ct-display-3.png" /><!-- --><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/get-esp-vert-ct-display-4.png" /><!-- --><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/get-esp-vert-ct-display-5.png" /><!-- -->
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["GeoUID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["ct_area_h"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2011"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2011"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2011"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2011"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2015"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2015"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2015"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2015"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2017"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2017"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2017"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2017"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2019"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2019"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2019"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2019"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_2011.2015"],"name":[19],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_2011.2017"],"name":[20],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_2015.2017"],"name":[21],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_high_2011.2015"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_high_2011.2017"],"name":[23],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_high_2015.2017"],"name":[24],"type":["dbl"],"align":["right"]}],"data":[{"1":"4620001.00","2":"46.2","3":"21","4":"7","5":"14.6","6":"46.0","7":"22","8":"8","9":"17.4","10":"47.6","11":"22","12":"8","13":"18.2","14":"48.4","15":"23","16":"9","17":"19.7","18":"49.9","19":"1.6","20":"2.4","21":"0.8","22":"2.8","23":"3.6","24":"0.8","_rn_":"1"},{"1":"4620002.00","2":"38.9","3":"13","4":"7","5":"18.7","6":"34.7","7":"14","8":"8","9":"21.0","10":"35.3","11":"15","12":"8","13":"21.0","14":"37.6","15":"15","16":"8","17":"21.6","18":"38.5","19":"0.6","20":"2.9","21":"2.3","22":"2.3","23":"2.3","24":"0.0","_rn_":"2"},{"1":"4620003.00","2":"74.0","3":"27","4":"13","5":"17.9","6":"37.0","7":"28","8":"15","9":"20.8","10":"37.5","11":"30","12":"16","13":"21.7","14":"41.0","15":"30","16":"16","17":"21.1","18":"41.2","19":"0.5","20":"4.0","21":"3.5","22":"2.9","23":"3.8","24":"0.9","_rn_":"3"},{"1":"4620004.00","2":"44.8","3":"14","4":"9","5":"19.5","6":"31.7","7":"14","8":"9","9":"19.7","10":"31.5","11":"16","12":"10","13":"21.9","14":"35.9","15":"16","16":"10","17":"21.4","18":"36.0","19":"-0.2","20":"4.2","21":"4.4","22":"0.2","23":"2.4","24":"2.2","_rn_":"4"},{"1":"4620005.00","2":"56.4","3":"28","4":"12","5":"20.7","6":"49.0","7":"27","8":"11","9":"20.1","10":"47.3","11":"29","12":"13","13":"23.5","14":"51.2","15":"29","16":"14","17":"24.0","18":"52.0","19":"-1.7","20":"2.2","21":"3.9","22":"-0.6","23":"2.8","24":"3.4","_rn_":"5"},{"1":"4620006.00","2":"64.8","3":"26","4":"12","5":"19.1","6":"40.5","7":"25","8":"11","9":"17.7","10":"38.8","11":"27","12":"14","13":"21.0","14":"41.0","15":"27","16":"14","17":"21.1","18":"41.2","19":"-1.7","20":"0.5","21":"2.2","22":"-1.4","23":"1.9","24":"3.3","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="pampalon-index" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Pampalon index</h2>
<p>Get it <a
href="https://www.inspq.qc.ca/en/deprivation/material-and-social-deprivation-index">here</a></p>
<pre class="r"><code>pampalon &lt;- read.xlsx(&quot;data/Canada2016Pampalon/A-MSDIData_Can2016_eng/1. EquivalenceTableCanada2016_ENG.xlsx&quot;, sheet = 2) %&gt;%
  mutate(DA = as.character(DA)) %&gt;%
  select(DA, SCOREMAT, SCORESOC)

# 2016 DA boundaries for Montreal
DA16 &lt;- get_census(dataset=&#39;CA16&#39;, regions=list(CMA=&#39;24462&#39;), level=&#39;DA&#39;, geo_format = &quot;sf&quot;) %&gt;%
  filter(Type == &quot;DA&quot;) %&gt;%
  st_transform(st_crs(bike_lane))</code></pre>
<pre><code>## Reading geo data from local cache.</code></pre>
<pre class="r"><code>pampalon &lt;- DA16 %&gt;%
  inner_join(pampalon, by = c(&quot;GeoUID&quot; = &quot;DA&quot;)) %&gt;%
  as.data.frame()

# Get Pampalon 2006
pampalon06 &lt;- read.xlsx(&quot;data/Canada2006Pampalon/A-MSDIData_Can2006_eng/1. CorrespondenceTable_Can2006_eng.xlsx&quot;, sheet = 2) %&gt;%
  mutate(DA = as.character(DA)) %&gt;%
  select(DA, DAPOP2006, SCOREMAT, SCORESOC)

# Get LUT DA2006 &lt;-&gt; DA2011 from StatCan
lut_da.1 &lt;- read.csv(&quot;data/2011_92-156_DA_AD_txt/2011_92-156_DA_AD.txt&quot;, colClasses = &quot;character&quot;, 
                     header = FALSE, col.names = c(&quot;DAUID2011.ADIDU2011&quot;, &quot;DAUID2006.ADIDU2006&quot;, &quot;DBUID2011&quot;, &quot;DA_rel_flag&quot;)) %&gt;%
  select(!c(DBUID2011, DA_rel_flag)) %&gt;%
  unique()

# Link Pampalon 2011 to LUT and compute weighted mean of scores of Pampalon 2011
# NB: population numbers will diverge from  reality when more than one DA is merged into one DA of next census
pampalon06.11 &lt;- pampalon06 %&gt;%
  inner_join(lut_da.1, by = c(&quot;DA&quot; = &quot;DAUID2006.ADIDU2006&quot;)) %&gt;%
  group_by(DAUID2011.ADIDU2011) %&gt;%
  summarise(pop2006 = sum(DAPOP2006),
            SCOREMAT.06 = weighted.mean(SCOREMAT, DAPOP2006, na.rm = TRUE),
            SCORESOC.06 = weighted.mean(SCORESOC, DAPOP2006, na.rm = TRUE))

# Get Pampalon 2011
pampalon11 &lt;- read.xlsx(&quot;data/Canada2011Pampalon/A-MSDIData_Can2011_eng/1. CorrespondenceTable_Can2011_eng.xlsx&quot;, sheet = 2) %&gt;%
  mutate(DA = as.character(DA)) %&gt;%
  select(DA, DAPOP2011, SCOREMAT, SCORESOC)

# Get LUT DA2011 &lt;-&gt; DA2016 from StatCan
lut_da &lt;- read.csv(&quot;data/2016_92-156_DA_AD_csv/2016_92-156_DA_AD.csv&quot;, colClasses = &quot;character&quot;) %&gt;%
  select(!c(DBUID2016.IDIDU2016, DA_rel_flag.AD_ind_rel)) %&gt;%
  unique()

# Link Pampalon 2011 to LUT, then to Pampalon 06 and finally compute weighted mean of scores of Pampalon 2011
pampalon11.16 &lt;- pampalon11 %&gt;%
  inner_join(lut_da, by = c(&quot;DA&quot; = &quot;DAUID2011.ADIDU2011&quot;)) %&gt;%
  left_join(pampalon06.11, by =c(&quot;DA&quot; = &quot;DAUID2011.ADIDU2011&quot;)) %&gt;%
  group_by(DAUID2016.ADIDU2016) %&gt;%
  summarise(pop2011 = sum(DAPOP2011),
            SCOREMAT = weighted.mean(SCOREMAT, DAPOP2011, na.rm = TRUE),
            SCORESOC = weighted.mean(SCORESOC, DAPOP2011, na.rm = TRUE),
            SCOREMAT.06 = weighted.mean(SCOREMAT.06, pop2006, na.rm = TRUE),
            SCORESOC.06 = weighted.mean(SCORESOC.06, pop2006, na.rm = TRUE),
            pop2006 = sum(pop2006))

# Then link Pampalon 2011 to 2016
pampalon &lt;- pampalon %&gt;%
  left_join(pampalon11.16, by = c(&quot;GeoUID&quot; = &quot;DAUID2016.ADIDU2016&quot;), suffix = c(&quot;.16&quot;, &quot;.11&quot;))

# Aggregate at the CT level
pampalon_CT &lt;- pampalon %&gt;%
  group_by(CT_UID) %&gt;%
  summarise(wSCOREMAT.2016 = weighted.mean(SCOREMAT.16, Population, na.rm = TRUE),
            wSCORESOC.2016 = weighted.mean(SCORESOC.16, Population, na.rm = TRUE),
            wSCOREMAT.2011 = weighted.mean(SCOREMAT.11, pop2011, na.rm = TRUE),
            wSCORESOC.2011 = weighted.mean(SCORESOC.11, pop2011, na.rm = TRUE),
            wSCOREMAT.2006 = weighted.mean(SCOREMAT.06, pop2006, na.rm = TRUE),
            wSCORESOC.2006 = weighted.mean(SCORESOC.06, pop2006, na.rm = TRUE))

# Clean up
rm(lut_da, lut_da.1, pampalon11.16, pampalon06.11, pampalon11, pampalon06)

# Display map
.pampalon_CT_geom &lt;- CT16 %&gt;%
  left_join(pampalon_CT, by = c(&quot;GeoUID&quot; = &quot;CT_UID&quot;)) %&gt;%
  filter(interact_aoi)

.pampalon_data &lt;- bi_class(.pampalon_CT_geom, x = wSCOREMAT.2016, y = wSCORESOC.2016, style = &quot;quantile&quot;, dim = 3)</code></pre>
<pre><code>## Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): var
## has missing values, omitted in finding classes

## Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): var
## has missing values, omitted in finding classes</code></pre>
<pre class="r"><code>.map &lt;- ggplot() + 
  geom_sf(data = .pampalon_data, mapping = aes(fill = bi_class), color = &quot;white&quot;, size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = &quot;DkBlue&quot;, dim = 3) +
  labs(title = &quot;Pampalon: material and social deprivation index&quot;) + 
  theme(panel.background = element_rect(fill = &quot;white&quot;),
        #axis.ticks = element_blank(),
        #axis.text = element_blank(),
        panel.grid = element_line(color = &quot;darkgray&quot;, size = 0.2))</code></pre>
<pre><code>## Warning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.
## ‚Ñπ Please use the `linewidth` argument instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<pre class="r"><code>.legend &lt;- bi_legend(pal = &quot;DkBlue&quot;,
                    dim = 3,
                    xlab = &quot;Material &quot;,
                    ylab = &quot;Social &quot;,
                    size = 8)
ggdraw() +
  draw_plot(.map, 0, 0, 1, 1) +
  draw_plot(.legend, 0.1, .7, 0.2, 0.2)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/read-pampalon-1.png" /><!-- --></p>
</div>
<div id="gentrification" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Gentrification</h2>
<p>Using Ding metric computed on 5 year span.</p>
<pre class="r"><code># Load gentrified CTs, 5 year span (from repo gentrification_metrics)

# UPDATE: add 2021 gentrification status, reprojected at the CT16 level
.g21 &lt;- st_read(&quot;data/gentrified_5years_cltd.gpkg&quot;, &quot;gentrified_ding_21&quot;, quiet=TRUE) %&gt;%
  filter(cma_uid_21 == &quot;24462&quot;) %&gt;%
  st_transform(st_crs(bike_lane))
.g21 &lt;- CT16 %&gt;%
  st_join(.g21, largest = TRUE) %&gt;%
  transmute(ct_uid_16 = GeoUID,
            ct_uid_21 = ct_uid_21, 
            cma_uid_21 = cma_uid_21, 
            cd_uid_21 = cd_uid_21,
            ccs_uid_21 = ccs_uid_21, 
            csd_uid_21 = csd_uid_21,
            population_21 = population_21,
            gentrified_2021_2016 = gentrified_2021_2016, 
            gentrifiable_2016 = gentrifiable_2016, 
            gentrified_2021_2016_category = gentrified_2021_2016_category)</code></pre>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout
## all geometries</code></pre>
<pre class="r"><code>ding &lt;- list()
ding[[&quot;2021&quot;]] &lt;- .g21
ding[[&quot;2016&quot;]] &lt;- st_read(&quot;data/gentrified_5years.gpkg&quot;, &quot;gentrified_ding_16&quot;, quiet=TRUE) %&gt;%
  filter(cma_uid_16 == &quot;24462&quot;) %&gt;%
  st_transform(st_crs(bike_lane))
ding[[&quot;2011&quot;]] &lt;- st_read(&quot;data/gentrified_5years.gpkg&quot;, &quot;gentrified_ding_11&quot;, quiet=TRUE) %&gt;%
  filter(cma_uid_11 == &quot;24462&quot;) %&gt;%
  st_transform(st_crs(bike_lane))
ding[[&quot;2006&quot;]] &lt;- st_read(&quot;data/gentrified_5years.gpkg&quot;, &quot;gentrified_ding_06&quot;, quiet=TRUE) %&gt;%
  filter(cma_uid_06 == &quot;24462&quot;) %&gt;%
  st_transform(st_crs(bike_lane))

.ding_map &lt;- ding[[&quot;2016&quot;]] %&gt;%
  mutate(gentrification_status = factor(case_when(!gentrifiable_2011 ~ &quot;Non eligible&quot;, 
                                           gentrifiable_2011 &amp; !gentrified_2016_2011 ~ &quot;Not gentrified&quot;,
                                           gentrified_2016_2011 ~ &quot;Gentrified&quot;), levels = c(&quot;Non eligible&quot;, &quot;Not gentrified&quot;, &quot;Gentrified&quot;))) %&gt;%
  left_join(select(as.data.frame(CT16), GeoUID, interact_aoi), by = c(&quot;ct_uid_16&quot; = &quot;GeoUID&quot;)) %&gt;%
  filter(interact_aoi)

ggplot(data = .ding_map) + 
  geom_sf(aes(fill = gentrification_status)) +
  scale_fill_manual(values = c(&quot;lightgray&quot;, &quot;yellow&quot;, &quot;red&quot;), name = &quot;Gentrification status in 2016&quot;) +
  #labs(title = &quot;Census tract gentrification status in 2016&quot;) +
  theme_void(base_size = 20)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/ding-load-1.png" /><!-- --></p>
</div>
<div id="equity-metrics-low-income-population-and-visible-minority"
class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Equity metrics |
low-income population and visible minority</h2>
<p>Introduced here as a proposition, nothing acted (2022-02-04)</p>
<pre class="r"><code># Visible Minority
# - v_CA16_3954: Total - Visible minority for the population in private households - 25% sample data (Total)
# - v_CA16_3957: Total visible minority population (Total)

# Low income (LIM-AT)
# - v_CA16_2540: Prevalence of low income based on the Low-income measure, after tax (LIM-AT) (%) (Total)
equity_ct16 &lt;- get_census(dataset=&#39;CA16&#39;, regions=list(CMA=&#39;24462&#39;), level=&#39;CT&#39;, geo_format = &quot;sf&quot;,
                          vectors = c(&quot;v_CA16_3954&quot;, &quot;v_CA16_3957&quot;, &quot;v_CA16_2540&quot;)) %&gt;%
  filter(Type == &quot;CT&quot;) %&gt;%
  transmute(CT_UID = GeoUID,
            vis_minority_2016 = `v_CA16_3957: Total visible minority population` / `v_CA16_3954: Total - Visible minority for the population in private households - 25% sample data` * 100,
            low_income_2016 = `v_CA16_2540: Prevalence of low income based on the Low-income measure, after tax (LIM-AT) (%)`)</code></pre>
<pre><code>## Reading vectors data from local cache.</code></pre>
<pre><code>## Reading geo data from local cache.</code></pre>
<pre class="r"><code># Visible Minority
# - v_CA11N_457: CA 2011 NHS, Total population in private households by visible minority (Total)
# - v_CA11N_460: CA 2011 NHS, Total population in private households by visible minority, Total visible minority population (Total)

# Low income (LIM-AT)
# - v_CA11N_2606: CA 2011 NHS, Prevalence of low income in 2010 based on after-tax low-income measure % (Total)
equity_ct11 &lt;- get_census(dataset=&#39;CA11&#39;, regions=list(CMA=&#39;24462&#39;), level=&#39;CT&#39;, geo_format = &quot;sf&quot;,
                          vectors = c(&quot;v_CA11N_457&quot;, &quot;v_CA11N_460&quot;, &quot;v_CA11N_2606&quot;)) %&gt;%
  filter(Type == &quot;CT&quot;) %&gt;%
  transmute(CT_UID = GeoUID,
            vis_minority_2011 = `v_CA11N_460: Total visible minority population` / `v_CA11N_457: Total population in private households by visible minority` * 100,
            low_income_2011 = `v_CA11N_2606: Prevalence of low income in 2010 based on after-tax low-income measure %`)</code></pre>
<pre><code>## Reading vectors data from local cache.
## Reading geo data from local cache.</code></pre>
<pre class="r"><code># Visible Minority
# - v_CA06_1302: Total population by visible minority groups
# - v_CA06_1303: Total population by visible minority groups, Total visible minority population

# Low income (LIM-AT)
# - v_TX2006_551: After-tax low income status of tax filers and dependents (census family low income measure, CFLIM-AT) for couple and lone parent families by family composition, 2006 | All family units | Persons in Low Income | % - Total
equity_ct06 &lt;- get_census(dataset=&#39;CA06&#39;, regions=list(CMA=&#39;24462&#39;), level=&#39;CT&#39;, geo_format = &quot;sf&quot;,
                          vectors = c(&quot;v_CA06_1302&quot;, &quot;v_CA06_1303&quot;, &quot;v_TX2006_551&quot;)) %&gt;%
  filter(Type == &quot;CT&quot;) %&gt;%
  transmute(CT_UID = GeoUID,
            vis_minority_2006 = `v_CA06_1303: Total visible minority population` / `v_CA06_1302: Total population by visible minority groups - 20% sample data` * 100,
            low_income_2006 = `v_TX2006_551: % - Total`)</code></pre>
<pre><code>## Reading vectors data from local cache.
## Reading geo data from local cache.</code></pre>
<pre class="r"><code>equity_ct &lt;- st_join(equity_ct16, equity_ct11, left=TRUE, largest=TRUE, suffix=c(&quot;&quot;, &quot;_2011&quot;)) %&gt;% # join on largest overlap, to overcome mismatch in CT UID
  st_join(equity_ct06, left=TRUE, largest=TRUE, suffix=c(&quot;&quot;, &quot;_2006&quot;)) %&gt;%
  data.frame()</code></pre>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout
## all geometries

## Warning: attribute variables are assumed to be spatially constant throughout
## all geometries</code></pre>
<pre class="r"><code># cleanup
rm(equity_ct11, equity_ct16, equity_ct06)

# Display map
.equity_CT_geom &lt;- CT16 %&gt;%
  left_join(equity_ct, by = c(&quot;GeoUID&quot; = &quot;CT_UID&quot;)) %&gt;%
  filter(interact_aoi)

.equity_data &lt;- bi_class(.equity_CT_geom, x = vis_minority_2016, y = low_income_2016, style = &quot;quantile&quot;, dim = 3)</code></pre>
<pre><code>## Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): var
## has missing values, omitted in finding classes</code></pre>
<pre><code>## Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): var
## has missing values, omitted in finding classes</code></pre>
<pre class="r"><code>.map &lt;- ggplot() + 
  geom_sf(data = .equity_data, mapping = aes(fill = bi_class), color = &quot;white&quot;, size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = &quot;Brown&quot;, dim = 3) +
  labs(title = &quot;Equity metrics: % of visible minority and % of low-income household&quot;) + 
  theme(panel.background = element_rect(fill = &quot;white&quot;),
        #axis.ticks = element_blank(),
        #axis.text = element_blank(),
        panel.grid = element_line(color = &quot;darkgray&quot;, size = 0.2))
.legend &lt;- bi_legend(pal = &quot;Brown&quot;,
                    dim = 3,
                    xlab = &quot;Vis. Minority &quot;,
                    ylab = &quot;Low-Income &quot;,
                    size = 8)
ggdraw() +
  draw_plot(.map, 0, 0, 1, 1) +
  draw_plot(.legend, 0.1, .7, 0.2, 0.2)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/equity-metrics-1.png" /><!-- --></p>
</div>
<div id="build-complete-dataset" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Build complete
dataset</h2>
<p>All variables + outcome linked at the CT level + quintiles of SES
variables</p>
<pre class="r"><code>.bike_lane_changes &lt;- bike_lane_changes %&gt;%
  as.data.frame() %&gt;%
  select(GeoUID, starts_with(&quot;street_length&quot;), ends_with(&quot;ct&quot;, ignore.case = FALSE)) %&gt;%
  select(GeoUID, starts_with(&quot;street_length&quot;), starts_with(&quot;Bike_lane&quot;)) # Drop individual category lane length

bei_df &lt;- CT16 %&gt;%
  as.data.frame() %&gt;%
  transmute(CT_UID = GeoUID,
            CD_UID = CD_UID,
            CSD_UID = CSD_UID,
            interact_aoi = interact_aoi,
            zone = case_when(CD_UID == &quot;2466&quot; ~ &quot;Montreal&quot;,
                             CD_UID == &quot;2458&quot; ~ &quot;Longueuil&quot;,
                             CD_UID == &quot;2465&quot; ~ &quot;Laval&quot;,
                             TRUE ~ &quot;Other&quot;),
            Population = Population) %&gt;%
  left_join(pampalon_CT, by=&quot;CT_UID&quot;) %&gt;%
  left_join(select(as.data.frame(ding$`2021`), ct_uid_16, starts_with(&quot;gentrif&quot;)), by=c(&quot;CT_UID&quot; = &quot;ct_uid_16&quot;)) %&gt;%
  mutate(gentrif_status_2021 = factor(case_when(!gentrifiable_2016 ~ &quot;Non eligible&quot;, 
                                           gentrifiable_2016 &amp; !gentrified_2021_2016 ~ &quot;Not gentrified&quot;,
                                           gentrified_2021_2016 ~ &quot;Gentrified&quot;), levels = c(&quot;Non eligible&quot;, &quot;Not gentrified&quot;, &quot;Gentrified&quot;))) %&gt;%
  left_join(select(as.data.frame(ding$`2016`), ct_uid_16, starts_with(&quot;gentrif&quot;)), by=c(&quot;CT_UID&quot; = &quot;ct_uid_16&quot;)) %&gt;%
  mutate(gentrif_status_2016 = factor(case_when(!gentrifiable_2011 ~ &quot;Non eligible&quot;, 
                                           gentrifiable_2011 &amp; !gentrified_2016_2011 ~ &quot;Not gentrified&quot;,
                                           gentrified_2016_2011 ~ &quot;Gentrified&quot;), levels = c(&quot;Non eligible&quot;, &quot;Not gentrified&quot;, &quot;Gentrified&quot;))) %&gt;%
  left_join(select(as.data.frame(ding$`2011`), ct_uid_11, starts_with(&quot;gentrif&quot;)), by=c(&quot;CT_UID&quot; = &quot;ct_uid_11&quot;)) %&gt;%
  mutate(gentrif_status_2011 = factor(case_when(!gentrifiable_2006 ~ &quot;Non eligible&quot;, 
                                           gentrifiable_2006 &amp; !gentrified_2011_2006 ~ &quot;Not gentrified&quot;,
                                           gentrified_2011_2006 ~ &quot;Gentrified&quot;), levels = c(&quot;Non eligible&quot;, &quot;Not gentrified&quot;, &quot;Gentrified&quot;))) %&gt;%
  left_join(select(as.data.frame(ding$`2006`), ct_uid_06, starts_with(&quot;gentrif&quot;)), by=c(&quot;CT_UID&quot; = &quot;ct_uid_06&quot;)) %&gt;%
  mutate(gentrif_status_2006 = factor(case_when(!gentrifiable_2001 ~ &quot;Non eligible&quot;, 
                                           gentrifiable_2001 &amp; !gentrified_2006_2001 ~ &quot;Not gentrified&quot;,
                                           gentrified_2006_2001 ~ &quot;Gentrified&quot;), levels = c(&quot;Non eligible&quot;, &quot;Not gentrified&quot;, &quot;Gentrified&quot;))) %&gt;%
  left_join(select(as.data.frame(equity_ct), !c(&quot;geometry&quot;, &quot;CT_UID_2011&quot;, &quot;CT_UID_2006&quot;)), by=&quot;CT_UID&quot;) %&gt;%
  left_join(.bike_lane_changes, by=c(&quot;CT_UID&quot; = &quot;GeoUID&quot;)) %&gt;%
  left_join(as.data.frame(rename_with(esp_vert_ct, ~ paste0(., &quot;ct&quot;))), by=c(&quot;CT_UID&quot; = &quot;GeoUIDct&quot;)) %&gt;%
  # Compute quintile of SES variables
  mutate(wSCOREMAT.2006.Q = ntile(wSCOREMAT.2006, 5),
         wSCOREMAT.2011.Q = ntile(wSCOREMAT.2011, 5),
         wSCOREMAT.2016.Q = ntile(wSCOREMAT.2016, 5),
         low_income_2006.Q = ntile(low_income_2006, 5),
         low_income_2011.Q = ntile(low_income_2011, 5),
         low_income_2016.Q = ntile(low_income_2016, 5),
         vis_minority_2006.Q = ntile(vis_minority_2006, 5),
         vis_minority_2011.Q = ntile(vis_minority_2011, 5),
         vis_minority_2016.Q = ntile(vis_minority_2016, 5)) %&gt;%
  units::drop_units() %&gt;%
  # UPDATE 2023-03-16: adding change dependent variables
  mutate(change.2011.2016.2states = case_when((Bike_lane_total.2011ct &gt; 0) &amp; (Bike_lane_total.2016ct &gt; 0) ~ FALSE,
                                              (Bike_lane_total.2011ct == 0) &amp; (Bike_lane_total.2016ct == 0) ~ FALSE,
                                              TRUE ~ TRUE),
         change.2011.2016.3states = case_when((Bike_lane_total.2011ct == 0) &amp; (Bike_lane_total.2016ct == 0) ~ &#39;No bike lane&#39;,
                                              (Bike_lane_total.2011ct == 0) &amp; (Bike_lane_total.2016ct &gt; 0) ~ &#39;New bike lanes&#39;,
                                              (Bike_lane_total.2011ct &gt; 0) &amp; (Bike_lane_total.2016ct &gt; 0) ~ &#39;No new bike lane&#39;))
  
  
head(bei_df)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["CT_UID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["CD_UID"],"name":[2],"type":["chr"],"align":["left"]},{"label":["CSD_UID"],"name":[3],"type":["chr"],"align":["left"]},{"label":["interact_aoi"],"name":[4],"type":["lgl"],"align":["right"]},{"label":["zone"],"name":[5],"type":["chr"],"align":["left"]},{"label":["Population"],"name":[6],"type":["int"],"align":["right"]},{"label":["wSCOREMAT.2016"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["wSCORESOC.2016"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["wSCOREMAT.2011"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["wSCORESOC.2011"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["wSCOREMAT.2006"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["wSCORESOC.2006"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["gentrified_2021_2016"],"name":[13],"type":["lgl"],"align":["right"]},{"label":["gentrifiable_2016"],"name":[14],"type":["lgl"],"align":["right"]},{"label":["gentrified_2021_2016_category"],"name":[15],"type":["chr"],"align":["left"]},{"label":["gentrif_status_2021"],"name":[16],"type":["fct"],"align":["left"]},{"label":["gentrified_2016_2011"],"name":[17],"type":["lgl"],"align":["right"]},{"label":["gentrifiable_2011"],"name":[18],"type":["lgl"],"align":["right"]},{"label":["gentrified_2016_2011_category"],"name":[19],"type":["chr"],"align":["left"]},{"label":["gentrif_status_2016"],"name":[20],"type":["fct"],"align":["left"]},{"label":["gentrified_2011_2006"],"name":[21],"type":["lgl"],"align":["right"]},{"label":["gentrifiable_2006"],"name":[22],"type":["lgl"],"align":["right"]},{"label":["gentrified_2011_2006_category"],"name":[23],"type":["chr"],"align":["left"]},{"label":["gentrif_status_2011"],"name":[24],"type":["fct"],"align":["left"]},{"label":["gentrified_2006_2001"],"name":[25],"type":["lgl"],"align":["right"]},{"label":["gentrifiable_2001"],"name":[26],"type":["lgl"],"align":["right"]},{"label":["gentrified_2006_2001_category"],"name":[27],"type":["chr"],"align":["left"]},{"label":["gentrif_status_2006"],"name":[28],"type":["fct"],"align":["left"]},{"label":["vis_minority_2016"],"name":[29],"type":["dbl"],"align":["right"]},{"label":["low_income_2016"],"name":[30],"type":["dbl"],"align":["right"]},{"label":["vis_minority_2011"],"name":[31],"type":["dbl"],"align":["right"]},{"label":["low_income_2011"],"name":[32],"type":["dbl"],"align":["right"]},{"label":["vis_minority_2006"],"name":[33],"type":["dbl"],"align":["right"]},{"label":["low_income_2006"],"name":[34],"type":["dbl"],"align":["right"]},{"label":["street_length"],"name":[35],"type":["dbl"],"align":["right"]},{"label":["street_length.hm"],"name":[36],"type":["dbl"],"align":["right"]},{"label":["Bike_lane_total.2016ct"],"name":[37],"type":["dbl"],"align":["right"]},{"label":["Bike_lane_total.2011ct"],"name":[38],"type":["dbl"],"align":["right"]},{"label":["Bike_lane_total.2006ct"],"name":[39],"type":["dbl"],"align":["right"]},{"label":["Bike_lane_total.hm.2016ct"],"name":[40],"type":["int"],"align":["right"]},{"label":["Bike_lane_total.hm.2011ct"],"name":[41],"type":["int"],"align":["right"]},{"label":["Bike_lane_total.hm.2006ct"],"name":[42],"type":["int"],"align":["right"]},{"label":["Bike_lane.by.street.2016ct"],"name":[43],"type":["dbl"],"align":["right"]},{"label":["Bike_lane.by.street.2011ct"],"name":[44],"type":["dbl"],"align":["right"]},{"label":["Bike_lane.by.street.2006ct"],"name":[45],"type":["dbl"],"align":["right"]},{"label":["Bike_lane_diff.2011.2016ct"],"name":[46],"type":["dbl"],"align":["right"]},{"label":["Bike_lane_diff.by.street.2011.2016ct"],"name":[47],"type":["dbl"],"align":["right"]},{"label":["ct_area_hct"],"name":[48],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2011ct"],"name":[49],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2011ct"],"name":[50],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2011ct"],"name":[51],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2011ct"],"name":[52],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2015ct"],"name":[53],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2015ct"],"name":[54],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2015ct"],"name":[55],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2015ct"],"name":[56],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2017ct"],"name":[57],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2017ct"],"name":[58],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2017ct"],"name":[59],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2017ct"],"name":[60],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_2019ct"],"name":[61],"type":["dbl"],"align":["right"]},{"label":["area_esp_vert_high_2019ct"],"name":[62],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_high_2019ct"],"name":[63],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_2019ct"],"name":[64],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_2011.2015ct"],"name":[65],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_2011.2017ct"],"name":[66],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_2015.2017ct"],"name":[67],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_high_2011.2015ct"],"name":[68],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_high_2011.2017ct"],"name":[69],"type":["dbl"],"align":["right"]},{"label":["pct_esp_vert_diff_high_2015.2017ct"],"name":[70],"type":["dbl"],"align":["right"]},{"label":["wSCOREMAT.2006.Q"],"name":[71],"type":["int"],"align":["right"]},{"label":["wSCOREMAT.2011.Q"],"name":[72],"type":["int"],"align":["right"]},{"label":["wSCOREMAT.2016.Q"],"name":[73],"type":["int"],"align":["right"]},{"label":["low_income_2006.Q"],"name":[74],"type":["int"],"align":["right"]},{"label":["low_income_2011.Q"],"name":[75],"type":["int"],"align":["right"]},{"label":["low_income_2016.Q"],"name":[76],"type":["int"],"align":["right"]},{"label":["vis_minority_2006.Q"],"name":[77],"type":["int"],"align":["right"]},{"label":["vis_minority_2011.Q"],"name":[78],"type":["int"],"align":["right"]},{"label":["vis_minority_2016.Q"],"name":[79],"type":["int"],"align":["right"]},{"label":["change.2011.2016.2states"],"name":[80],"type":["lgl"],"align":["right"]},{"label":["change.2011.2016.3states"],"name":[81],"type":["chr"],"align":["left"]}],"data":[{"1":"4620001.00","2":"2466","3":"2466023","4":"TRUE","5":"Montreal","6":"2638","7":"0.01358583","8":"0.04174371","9":"0.01886948","10":"0.04685112","11":"0.037951946","12":"0.04236989","13":"FALSE","14":"TRUE","15":"NA","16":"Not gentrified","17":"TRUE","18":"TRUE","19":"moderate","20":"Gentrified","21":"FALSE","22":"TRUE","23":"NA","24":"Not gentrified","25":"TRUE","26":"TRUE","27":"moderate","28":"Gentrified","29":"15.39889","30":"18.9","31":"8.949416","32":"16.7","33":"3.636364","34":"19.19","35":"8321.962","36":"83.21962","37":"2982.1097","38":"2813.5098","39":"1065.5528","40":"30","41":"28","42":"11","43":"35.834215","44":"33.808252","45":"12.804106","46":"168.5999","47":"2.025963","48":"46.2","49":"21","50":"7","51":"14.6","52":"46.0","53":"22","54":"8","55":"17.4","56":"47.6","57":"22","58":"8","59":"18.2","60":"48.4","61":"23","62":"9","63":"19.7","64":"49.9","65":"1.6","66":"2.4","67":"0.8","68":"2.8","69":"3.6","70":"0.8","71":"5","72":"4","73":"4","74":"3","75":"3","76":"4","77":"2","78":"2","79":"3","80":"FALSE","81":"No new bike lane","_rn_":"1"},{"1":"4620002.00","2":"2466","3":"2466023","4":"TRUE","5":"Montreal","6":"3516","7":"0.02646157","8":"0.05040989","9":"0.04140888","10":"0.04934777","11":"0.016746388","12":"0.04654262","13":"FALSE","14":"TRUE","15":"NA","16":"Not gentrified","17":"FALSE","18":"TRUE","19":"NA","20":"Not gentrified","21":"FALSE","22":"TRUE","23":"NA","24":"Not gentrified","25":"TRUE","26":"TRUE","27":"moderate","28":"Gentrified","29":"16.76647","30":"20.4","31":"11.184211","32":"19.9","33":"10.320285","34":"20.47","35":"8083.669","36":"80.83669","37":"751.5037","38":"751.5037","39":"0.0000","40":"8","41":"8","42":"0","43":"9.296567","44":"9.296567","45":"0.000000","46":"0.0000","47":"0.000000","48":"38.9","49":"13","50":"7","51":"18.7","52":"34.7","53":"14","54":"8","55":"21.0","56":"35.3","57":"15","58":"8","59":"21.0","60":"37.6","61":"15","62":"8","63":"21.6","64":"38.5","65":"0.6","66":"2.9","67":"2.3","68":"2.3","69":"2.3","70":"0.0","71":"4","72":"5","73":"4","74":"3","75":"3","76":"4","77":"3","78":"2","79":"3","80":"FALSE","81":"No new bike lane","_rn_":"2"},{"1":"4620003.00","2":"2466","3":"2466023","4":"TRUE","5":"Montreal","6":"6373","7":"0.03758600","8":"0.02933949","9":"0.01828800","10":"0.03527105","11":"0.015321870","12":"0.03041342","13":"FALSE","14":"TRUE","15":"NA","16":"Not gentrified","17":"FALSE","18":"TRUE","19":"NA","20":"Not gentrified","21":"TRUE","22":"TRUE","23":"moderate","24":"Gentrified","25":"FALSE","26":"TRUE","27":"NA","28":"Not gentrified","29":"22.08000","30":"18.3","31":"14.760746","32":"18.7","33":"8.589441","34":"19.26","35":"13480.896","36":"134.80896","37":"1657.1076","38":"1482.8098","39":"0.0000","40":"17","41":"15","42":"0","43":"12.292266","44":"10.999341","45":"0.000000","46":"174.2978","47":"1.292925","48":"74.0","49":"27","50":"13","51":"17.9","52":"37.0","53":"28","54":"15","55":"20.8","56":"37.5","57":"30","58":"16","59":"21.7","60":"41.0","61":"30","62":"16","63":"21.1","64":"41.2","65":"0.5","66":"4.0","67":"3.5","68":"2.9","69":"3.8","70":"0.9","71":"4","72":"4","73":"5","74":"3","75":"3","76":"3","77":"2","78":"3","79":"3","80":"FALSE","81":"No new bike lane","_rn_":"3"},{"1":"4620004.00","2":"2466","3":"2466023","4":"TRUE","5":"Montreal","6":"3176","7":"0.01515110","8":"0.04272896","9":"0.02707231","10":"0.04568434","11":"0.003881755","12":"0.05101261","13":"TRUE","14":"TRUE","15":"moderate","16":"Gentrified","17":"TRUE","18":"TRUE","19":"moderate","20":"Gentrified","21":"TRUE","22":"TRUE","23":"intense","24":"Gentrified","25":"FALSE","26":"TRUE","27":"NA","28":"Not gentrified","29":"15.44586","30":"18.9","31":"12.755906","32":"18.9","33":"7.974482","34":"20.13","35":"7538.252","36":"75.38252","37":"0.0000","38":"0.0000","39":"0.0000","40":"0","41":"0","42":"0","43":"0.000000","44":"0.000000","45":"0.000000","46":"0.0000","47":"0.000000","48":"44.8","49":"14","50":"9","51":"19.5","52":"31.7","53":"14","54":"9","55":"19.7","56":"31.5","57":"16","58":"10","59":"21.9","60":"35.9","61":"16","62":"10","63":"21.4","64":"36.0","65":"-0.2","66":"4.2","67":"4.4","68":"0.2","69":"2.4","70":"2.2","71":"3","72":"4","73":"4","74":"3","75":"3","76":"4","77":"2","78":"3","79":"3","80":"FALSE","81":"No bike lane","_rn_":"4"},{"1":"4620005.00","2":"2466","3":"2466023","4":"TRUE","5":"Montreal","6":"3060","7":"0.02033165","8":"0.04394519","9":"0.02010919","10":"0.04580424","11":"0.015391242","12":"0.03043359","13":"TRUE","14":"TRUE","15":"moderate","16":"Gentrified","17":"FALSE","18":"TRUE","19":"NA","20":"Not gentrified","21":"TRUE","22":"TRUE","23":"moderate","24":"Gentrified","25":"FALSE","26":"TRUE","27":"NA","28":"Not gentrified","29":"13.67381","30":"19.7","31":"9.017713","32":"21.1","33":"9.531502","34":"19.08","35":"8821.545","36":"88.21545","37":"2143.7787","38":"1870.2315","39":"842.6210","40":"21","41":"19","42":"8","43":"24.301623","44":"21.200725","45":"9.551852","46":"273.5472","47":"3.100898","48":"56.4","49":"28","50":"12","51":"20.7","52":"49.0","53":"27","54":"11","55":"20.1","56":"47.3","57":"29","58":"13","59":"23.5","60":"51.2","61":"29","62":"14","63":"24.0","64":"52.0","65":"-1.7","66":"2.2","67":"3.9","68":"-0.6","69":"2.8","70":"3.4","71":"4","72":"4","73":"4","74":"3","75":"4","76":"4","77":"3","78":"2","79":"2","80":"FALSE","81":"No new bike lane","_rn_":"5"},{"1":"4620006.00","2":"2466","3":"2466023","4":"TRUE","5":"Montreal","6":"4467","7":"0.04766933","8":"0.02804641","9":"0.04268265","10":"0.03517419","11":"0.033230795","12":"0.04111945","13":"FALSE","14":"TRUE","15":"NA","16":"Not gentrified","17":"FALSE","18":"TRUE","19":"NA","20":"Not gentrified","21":"TRUE","22":"TRUE","23":"moderate","24":"Gentrified","25":"FALSE","26":"TRUE","27":"NA","28":"Not gentrified","29":"25.93458","30":"26.9","31":"18.955732","32":"28.6","33":"12.195122","34":"28.22","35":"8264.078","36":"82.64078","37":"1786.5756","38":"904.4780","39":"700.9652","40":"18","41":"9","42":"7","43":"21.618573","44":"10.944694","45":"8.482074","46":"882.0976","47":"10.673878","48":"64.8","49":"26","50":"12","51":"19.1","52":"40.5","53":"25","54":"11","55":"17.7","56":"38.8","57":"27","58":"14","59":"21.0","60":"41.0","61":"27","62":"14","63":"21.1","64":"41.2","65":"-1.7","66":"0.5","67":"2.2","68":"-1.4","69":"1.9","70":"3.3","71":"5","72":"5","73":"5","74":"4","75":"4","76":"5","77":"3","78":"3","79":"4","80":"FALSE","81":"No new bike lane","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>write.csv(bei_df, &quot;data/_results/bei_equity.csv&quot;, na=&quot;&quot;, row.names = FALSE)

# keep only interact CT 
# UPDATE 2022-07-07 ##########
# and recompute quintiles for the new AOI
bei_df_aoi &lt;- filter(bei_df, interact_aoi) %&gt;%
  mutate(wSCOREMAT.2006.Q = ntile(wSCOREMAT.2006, 5),
         wSCOREMAT.2011.Q = ntile(wSCOREMAT.2011, 5),
         wSCOREMAT.2016.Q = ntile(wSCOREMAT.2016, 5),
         low_income_2006.Q = ntile(low_income_2006, 5),
         low_income_2011.Q = ntile(low_income_2011, 5),
         low_income_2016.Q = ntile(low_income_2016, 5),
         vis_minority_2006.Q = ntile(vis_minority_2006, 5),
         vis_minority_2011.Q = ntile(vis_minority_2011, 5),
         vis_minority_2016.Q = ntile(vis_minority_2016, 5),
         # Need to reorder factor in order to get the proper dummy variables in models below
         gentrif_status_2016 = forcats::fct_relevel(gentrif_status_2016, &quot;Not gentrified&quot;, &quot;Gentrified&quot;, &quot;Non eligible&quot;),
         gentrif_status_2021 = forcats::fct_relevel(gentrif_status_2021, &quot;Not gentrified&quot;, &quot;Gentrified&quot;, &quot;Non eligible&quot;))</code></pre>
<p>Included variables:</p>
<ul>
<li>Census Tracts variables
<ul>
<li><code>CT_UID</code>: 2016 Census Tract ID</li>
<li><code>CD_UID</code>: 2016 Census Division</li>
<li><code>CSD_UID</code>: 2016 Census Subdivision</li>
<li><code>interact_aoi</code>: Does CT belong to INTERACT study
area?</li>
<li><code>zone</code>: Montreal / Laval / Longueuil, etc. / Other</li>
<li><code>Population</code>: 2016 Population within CT</li>
<li><code>ct_area_m2ct</code>: Area of CT, in square meters</li>
</ul></li>
<li>Gentrification metrics
<ul>
<li><code>gentrified_2016_2011</code>: Is the CT gentrified in
2016?</li>
<li><code>gentrifiable_2011</code>: Is the CT candidate to
gentrification in 2011?</li>
<li><code>gentrif_status_2016</code>: 3-state gentrification status in
2016 (Gentrified/Not gentrified/Non eligible)</li>
<li><code>gentrified_2011_2006</code>: Is the CT gentrified in 2011</li>
<li><code>gentrifiable_2006</code>: Is the CT candidate to
gentrification in 2006</li>
<li><code>gentrif_status_2011</code>: 3-state gentrification status in
2011 (Gentrified/Not gentrified/Non eligible)</li>
<li><code>gentrified_2006_2001</code>: Is the CT gentrified in 2006</li>
<li><code>gentrifiable_2001</code>: Is the CT candidate to
gentrification in 2001</li>
<li><code>gentrif_status_2006</code>: 3-state gentrification status in
2006 (Gentrified/Not gentrified/Non eligible)</li>
</ul></li>
<li>Pampalon‚Äôs metrics
<ul>
<li><code>wSCORESOC.2016</code>: Social deprivation index in 2016
(population weighted)</li>
<li><code>wSCOREMAT.2016</code>: Material deprivation index in 2016
(population weighted)</li>
<li><code>wSCOREMAT.2016.Q</code>: Quintile of material deprivation
index in 2016 (population weighted)</li>
<li><code>wSCORESOC.2011</code>: Social deprivation index in 2011
(population weighted)</li>
<li><code>wSCOREMAT.2011</code>: Material deprivation index in 2011
(population weighted)</li>
<li><code>wSCOREMAT.2011.Q</code>: Quintile of aterial deprivation index
in 2011 (population weighted)</li>
<li><code>wSCORESOC.2006</code>: Social deprivation index in 2006
(population weighted)</li>
<li><code>wSCOREMAT.2006</code>: Material deprivation index in 2006
(population weighted)</li>
<li><code>wSCOREMAT.2006.Q</code>: Quintile of material deprivation
index in 2006 (population weighted)</li>
</ul></li>
<li>Social profile
<ul>
<li><code>vis_minority_2016</code>: % of visible minority in CT
2016</li>
<li><code>vis_minority_2016.Q</code>: Quintile of % of visible minority
in CT 2016</li>
<li><code>low_income_2016</code>: prevalence of low income in CT
2016</li>
<li><code>low_income_2016.Q</code>: Quintile of prevalence of low income
in CT 2016</li>
<li><code>vis_minority_2011</code>: % of visible minority in CT
2011</li>
<li><code>vis_minority_2011.Q</code>: Quintile of % of visible minority
in CT 2011</li>
<li><code>low_income_2011</code>: prevalence of low income in CT
2011</li>
<li><code>low_income_2011.Q</code>: Quintile of prevalence of low income
in CT 2011</li>
<li><code>vis_minority_2006</code>: % of visible minority in CT
2006</li>
<li><code>vis_minority_2006.Q</code>: Quintile of % of visible minority
in CT 2006</li>
<li><code>low_income_2006</code>: prevalence of low income in CT
2006</li>
<li><code>low_income_2006.Q</code>: Qintile of prevalence of low income
in CT 2006</li>
</ul></li>
<li>Bike lane density
<ul>
<li><code>Bike_lane_total.{2016|2011}ct</code>: total length of bike
lanes, in 2016 or 2011, within CT</li>
<li><code>Bike_lane_total.hm.{2016|2011}ct</code>: total length of bike
lanes, in hectometers (as integers), in 2016 or 2011, within CT</li>
<li><code>Bike_lane.by.street.{2016|2011}ct</code>: % of bike lanes
compared to streets, in 2016 or 2011, within CT</li>
<li><code>Bike_lane_diff.2011.2016ct</code>: change in total length of
bike lanes between 2011 and 2016, within CT</li>
<li><code>Bike_lane_diff.by.street.2011.2016ct</code>: change in total
length of bike lanes between 2011 and 2011, normalized by street length,
within CT</li>
<li><code>Bike_lane_diff.by.area.2011.2016ct</code>: change in total
length of bike lanes between 2011 and 2011, normalized by area, within
CT</li>
</ul></li>
<li>Green spaces
<ul>
<li><code>area_esp_vert_{2011|2015|2019}ct</code>: area of green space
in 2011, 2015 or 2019 within CT (in hectares)</li>
<li><code>area_esp_vert_high_{2011|2015|2019}ct</code>: same as above,
except for trees (high canopy)</li>
<li><code>pct_esp_vert_{2011|2015|2019}ct</code>: % of green space in
2011, 2015 or 2019 within CT</li>
<li><code>pct_esp_vert_high_{2011|2015|2019}ct</code>: same as above,
except for trees (high canopy)</li>
<li><code>pct_esp_vert_diff{2011|2015}.{2015|2019}ct</code>: change in %
of green space between 2011 and 2015, 2011 and 2019 as well as 2011 and
2019, within CT</li>
</ul></li>
</ul>
</div>
</div>
<div id="preliminary-analyses" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Preliminary
analyses</h1>
<p>INTERACT study area ~ Montr√©al, Laval, Longueuil, Brossard,
St-Lambert</p>
<div id="ses-variable-distribution" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> SES variable
distribution</h2>
<pre class="r"><code>.bei_df_long &lt;- bei_df_aoi %&gt;% 
  select(CT_UID, CD_UID, starts_with(&quot;wSCORE&quot;)) %&gt;%
  select(!ends_with(&#39;.Q&#39;)) %&gt;%
  pivot_longer(!c(CT_UID, CD_UID))

ggplot(.bei_df_long, aes(value)) +
  geom_histogram() + 
  facet_wrap(~name) #, scales = &quot;free&quot;)</code></pre>
<pre><code>## Warning: Removed 80 rows containing non-finite values (`stat_bin()`).</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/outcome-distribution-aoi-1.png" /><!-- --></p>
<pre class="r"><code>.bei_df_long &lt;- bei_df_aoi %&gt;%
  select(CT_UID, CD_UID, starts_with(&quot;vis_minority&quot;), starts_with(&quot;low_income&quot;)) %&gt;%
  select(!ends_with(&#39;.Q&#39;)) %&gt;%
  pivot_longer(!c(CT_UID, CD_UID))

ggplot(.bei_df_long, aes(value)) +
  geom_histogram() + 
  facet_wrap(~name) #, scales = &quot;free&quot;)</code></pre>
<pre><code>## Warning: Removed 79 rows containing non-finite values (`stat_bin()`).</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/outcome-distribution-aoi-2.png" /><!-- --></p>
<pre class="r"><code>.bei_df_long &lt;- bei_df_aoi %&gt;%
  select(CT_UID, CD_UID, starts_with(&quot;gentrif_status&quot;)) %&gt;%
  select(!ends_with(&#39;.Q&#39;)) %&gt;%
  pivot_longer(!c(CT_UID, CD_UID))

ggplot(.bei_df_long, aes(value)) +
  geom_bar() + 
  facet_wrap(~name) #, scales = &quot;free&quot;, ncol = 3)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/outcome-distribution-aoi-3.png" /><!-- --></p>
<div id="confusion-matrix-correlations" class="section level3"
number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Confusion matrix /
correlations</h3>
<p>Following the 2nd revision by Urban Landscape, one computes the
confusion matrix between tiertiles of material deprivation, % of Visible
Minorities and gentrification status at baseline:</p>
<pre class="r"><code>cfx &lt;- bei_df_aoi %&gt;%
  data.frame() %&gt;%
  mutate(wSCOREMAT.2011.Tier = ntile(wSCOREMAT.2011, 3),
         vis_minority_2011.Tier = ntile(vis_minority_2011, 3)) %&gt;%
  select(CT_UID, ends_with(&quot;.Tier&quot;), gentrified_2016_2011, wSCOREMAT.2011, vis_minority_2011)

# Correlation between contiunous SES metrcis
cor.test(cfx$wSCOREMAT.2011, cfx$vis_minority_2011,  method = &quot;pearson&quot;, use = &quot;complete.obs&quot;)</code></pre>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  cfx$wSCOREMAT.2011 and cfx$vis_minority_2011
## t = 14.638, df = 670, p-value &lt; 2.2e-16
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.4327316 0.5475013
## sample estimates:
##       cor 
## 0.4922529</code></pre>
<pre class="r"><code># Confusion Mtx Tiertiles SES
# See http://rcompanion.org/handbook/H_10.html
# 3 classes -&gt; small (0.07 - &lt; 0.20) | medium (0.20 - 0.35) | large (&gt; 0.35)
cramerV(table(cfx$wSCOREMAT.2011.Tier, cfx$vis_minority_2011.Tier))</code></pre>
<pre><code>## Cramer V 
##   0.2557</code></pre>
<pre class="r"><code>cramerV(table(cfx$wSCOREMAT.2011.Tier, cfx$gentrified_2016_2011))</code></pre>
<pre><code>## Cramer V 
##   0.1814</code></pre>
<pre class="r"><code>cramerV(table(cfx$vis_minority_2011.Tier, cfx$gentrified_2016_2011))</code></pre>
<pre><code>## Cramer V 
##  0.06296</code></pre>
<p>Only the SES metrics seem moderately correlated.</p>
</div>
</div>
<div id="bei-variable-distributions" class="section level2"
number="3.2">
<h2><span class="header-section-number">3.2</span> BEI variable
distributions</h2>
<div id="absolute-values" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Absolute
values</h3>
<pre class="r"><code>.bei_df_long &lt;- bei_df_aoi %&gt;% 
  filter(interact_aoi) %&gt;%
  select(CT_UID, CD_UID, matches(&quot;^Bike_lane_total.*ct$&quot;), matches(&quot;^area_esp_vert.*ct$&quot;)) %&gt;%
  pivot_longer(!c(CT_UID, CD_UID))

ggplot(.bei_df_long, aes(value)) +
  geom_histogram() + 
  facet_wrap(~name, scales = &quot;free&quot;, ncol = 4)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/var-abs-distribution-ct-aoi-1.png" /><!-- --></p>
</div>
<div id="relative-values" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Relative
values</h3>
<pre class="r"><code>.bei_df_long &lt;- bei_df_aoi %&gt;% 
  filter(interact_aoi) %&gt;%
  select(CT_UID, CD_UID, matches(&quot;^Bike_lane.by.*ct$&quot;), matches(&quot;^pct_esp_vert.*ct$&quot;)) %&gt;%
  pivot_longer(!c(CT_UID, CD_UID))

ggplot(.bei_df_long, aes(value)) +
  geom_histogram() + 
  facet_wrap(~name, scales = &quot;free&quot;, ncol = 3)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/var-rel-distribution-ct-aoi-1.png" /><!-- --></p>
</div>
</div>
</div>
<div id="association-between-ses-and-urban-conditions-at-baseline-2011"
class="section level1" number="4">
<h1><span class="header-section-number">4</span> Association between SES
and Urban Conditions at baseline (2011)</h1>
<p>Looking at objective #1: <em>do urban interventions tend to be
located in low SES neighborhoods?</em>. We look at <span
class="math display">\[Urban Condition_{2011} = f(SES_{2011})\]</span>
as well as <span class="math display">\[Urban Condition_{2011} =
f(Gentrification_{2011 \to 2016})\]</span></p>
<p>Here <span class="math inline">\(UrbanCondition\)</span> means the
state of the urban environment features, such as length of bike lanes,
greenness coverage, etc. at one specific moment. This needs to be
distinguished from <span
class="math inline">\(UrbanIntervention\)</span>, which accounts for the
<strong>changes</strong> in the <span
class="math inline">\(UrbanConditions\)</span> between two years (see
below).</p>
<p>We fit LMM models, with spatial random effect using
<code>spaMM</code> package.</p>
<div id="uc-vs-pampalon-material" class="section level2 tabset"
number="4.1">
<h2 class="tabset"><span class="header-section-number">4.1</span> UC vs
Pampalon | material</h2>
<div id="bike-lane-length-hurdle" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Bike lane length
(hurdle)</h3>
<p>Bike lane ratio to streets at the Census tract level. We use an
offset, as explained in <a
href="https://education.illinois.edu/docs/default-source/carolyn-anderson/edpsy589/lectures/4_glm/4glm_3_beamer_post.pdf">Anderson‚Äôs
presentation</a>, to handle the denominator and model the Bike lane
length in hectometers using a Poisson distribution.</p>
<p>Resorting to a hurdle model, to accommodate the zero-inflated
distribution.</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Zero model
res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2011ct != 0) ~ wSCOREMAT.2011.Q + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2011ct != 0) ~ wSCOREMAT.2011.Q + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                  Estimate Cond. SE t-value   p-value
## (Intercept)       -2.4787  0.35883  -6.908 4.922e-12
## wSCOREMAT.2011.Q  -0.2162  0.09234  -2.342 1.920e-02
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377067 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.454  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -353.4342</code></pre>
<pre class="r"><code>ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.42512119            -0.02858366</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.zero, . ~ . -wSCOREMAT.2011.Q)
LRT(res.lmm.0, res.lmm.zero)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 5.122414  1 0.02361874</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout, title = &quot;DHARMa residual | Logit&quot;)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-3-1.png" /><!-- --></p>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2011ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                  Estimate Cond. SE t-value p-value
## (Intercept)      -2.08412  0.09774 -21.324   0.000
## wSCOREMAT.2011.Q -0.05171  0.02864  -1.805   0.071
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1331505 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.3978  
## # of obs: 454; # of groups: ct_no, 454 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1662.694</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##           -0.108588430            0.004809859</code></pre>
<pre class="r"><code>res.lmm.0&lt;- update(res.lmm.cnt, . ~ . -wSCOREMAT.2011.Q)
LRT(res.lmm.0, res.lmm.cnt)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 3.216597  1 0.07289504</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout, title = &quot;DHARMa residual | Count (truncated Poisson)&quot;)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-3-2.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 4040.255</code></pre>
<p>Interpretation of the <code>wSCOREMAT.2011.Q</code> coefficient
(significant in both sub-models): - we have <span
class="math inline">\(e^{-0.216}\)</span> = 0.806 (95%CI: 0.654 ‚Äì
0.972), which means each increase of 1 quintile in the Material Score
2011 leads to a 19.4% decrease the chance of having a bicycle lane in
the CT - we have <span class="math inline">\(e^{-0.052}\)</span> = 0.95
(95%CI: 0.897 ‚Äì 1.005), which means in CTs with bike lanes, each
increase of 1 quintile in the Material Score 2011 leads to a 5% decrease
the ratio of bike lanes to street in 2011.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.084</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.806</td>
<td align="right">0.019</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.zero$interval), 3)%&gt;%
  data.frame(wSCOREMAT.2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Zero model confidence interval&quot;)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.654</td>
<td align="right">0.972</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.124</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.950</td>
<td align="right">0.071</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.cnt$interval), 3)%&gt;%
  data.frame(wSCOREMAT.2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.897</td>
<td align="right">1.005</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 at the Census tract level, using a Poisson
distribution</p>
<pre class="r"><code>f &lt;- area_esp_vert_2011ct ~ wSCOREMAT.2011.Q + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2011ct ~ wSCOREMAT.2011.Q + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2011ct ~ wSCOREMAT.2011.Q + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                  Estimate Cond. SE t-value  p-value
## (Intercept)      -0.61272  0.04130 -14.834 0.00e+00
## wSCOREMAT.2011.Q -0.09123  0.01113  -8.199 2.22e-16
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1383748 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.05602  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2329.779</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.11306613            -0.06933533</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - wSCOREMAT.2011.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 62.97397  1 2.109424e-15</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-5-1.png" /><!-- --></p>
<p>Interpretation of the <code>wSCOREMAT.2011.Q</code> coefficient
(significant): we have <span class="math inline">\(e^{-0.091}\)</span> =
0.913 (95%CI: 0.893 ‚Äì 0.933), which means each increase of 1 quintile in
the Material Score leads to a 8.7% decrease in the percentage of
greenspace area within CT in 2011.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.542</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.913</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm$interval), 3)%&gt;%
  data.frame(wSCOREMAT.2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.893</td>
<td align="right">0.933</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 at the Census tract level, using a Poisson
distribution</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2011ct ~ wSCOREMAT.2011.Q + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2011ct ~ wSCOREMAT.2011.Q + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2011ct ~ wSCOREMAT.2011.Q + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                  Estimate Cond. SE t-value  p-value
## (Intercept)       -1.2602  0.06071 -20.759 0.00e+00
## wSCOREMAT.2011.Q  -0.1354  0.01647  -8.221 2.22e-16
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377929 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1247  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2072.628</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##             -0.1677385             -0.1029865</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - wSCOREMAT.2011.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df     p_value
## p_v 63.63486  1 1.44329e-15</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-7-1.png" /><!-- --></p>
<p>Interpretation of the <code>vis_minority_2011.Q</code> coefficient
(significant): we have <span class="math inline">\(e^{NA}\)</span> = NA
(95%CI: 0.846 ‚Äì 0.902), which means each increase of 1 quintile in the
Material Score leads to a 12.7% decrease in the percentage of tree
canopy area within CT in 2011.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.284</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.873</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm$interval), 3)%&gt;%
  data.frame(wSCOREMAT.2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.846</td>
<td align="right">0.902</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="uc-vs-visible-minority" class="section level2 tabset"
number="4.2">
<h2 class="tabset"><span class="header-section-number">4.2</span> UC vs
Visible minority</h2>
<div id="bike-lane-length-hurdle-1" class="section level3"
number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Bike lane length
(hurdle)</h3>
<p>Bike lane ratio to streets (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Zero model
res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2011ct != 0) ~ vis_minority_2011.Q + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2011ct != 0) ~ vis_minority_2011.Q + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                     Estimate Cond. SE t-value   p-value
## (Intercept)          -2.5602  0.33189  -7.714 1.221e-14
## vis_minority_2011.Q  -0.2175  0.08943  -2.432 1.500e-02
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377069 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.329  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -353.3975</code></pre>
<pre class="r"><code>ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.41031830               -0.03522793</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.zero, . ~ . - vis_minority_2011.Q)
LRT(res.lmm.0, res.lmm.zero)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 5.445155  1 0.01962268</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout, title = &quot;DHARMa residual | Logit&quot;)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-9-1.png" /><!-- --></p>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2011ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                     Estimate Cond. SE t-value p-value
## (Intercept)         -2.04064  0.09769  -20.89 0.00000
## vis_minority_2011.Q -0.07028  0.02928   -2.40 0.01639
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1299156 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.3915  
## # of obs: 454; # of groups: ct_no, 454 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1656.682</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.12810022               -0.01259185</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.cnt, . ~ . - vis_minority_2011.Q)
LRT(res.lmm.0, res.lmm.cnt)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 5.684915  1 0.01711137</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout, title = &quot;DHARMa residual | Count (truncated Poisson)&quot;)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-9-2.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 4028.159</code></pre>
<p>Interpretation of the <code>vis_minority_2011.Q</code> coefficient: -
model <em>zero-hurdle</em> (non significant): we have <span
class="math inline">\(e^{-0.218}\)</span> = 0.804 (95%CI: 0.663 ‚Äì
0.965), which means each increase of 1 quintile in the proportion of
visible minority 2011 leads to a NA% decrease the chance of having a
bicycle lane in the CT - model <em>count</em>: we have <span
class="math inline">\(e^{-0.07}\)</span> = 0.932 (95%CI: 0.88 ‚Äì 0.987),
which means in CTs with bike lanes, each increase of 1 quintile in the
Material Score 2011 leads to a 6.8% decrease the ratio of bike lanes to
street in 2011.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.077</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.804</td>
<td align="right">0.015</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.zero$interval), 3)%&gt;%
  data.frame(vis_minority_2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Zero model confidence interval&quot;)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.663</td>
<td align="right">0.965</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.130</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.932</td>
<td align="right">0.016</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.cnt$interval), 3)%&gt;%
  data.frame(vis_minority_2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.88</td>
<td align="right">0.987</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-1" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2011ct ~ vis_minority_2011.Q + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2011ct ~ vis_minority_2011.Q + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2011ct ~ vis_minority_2011.Q + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                     Estimate Cond. SE t-value   p-value
## (Intercept)         -0.69854  0.04195 -16.651 0.000e+00
## vis_minority_2011.Q -0.06588  0.01171  -5.625 1.852e-08
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1385778 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.0603  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2340.555</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.08884590               -0.04281246</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - vis_minority_2011.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 30.42281  1 3.474195e-08</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-11-1.png" /><!-- --></p>
<p>Interpretation of the <code>vis_minority_2011.Q</code> coefficient
(significant): we have <span class="math inline">\(e^{-0.066}\)</span> =
0.936 (95%CI: 0.915 ‚Äì 0.958), which means each increase of 1 quintile in
the proportion of visible minority leads to a 6.4% decrease in the
percentage of greenspace area within CT in 2011.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.497</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.936</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm$interval), 3)%&gt;%
  data.frame(vis_minority_2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.915</td>
<td align="right">0.958</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-1" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2011ct ~ vis_minority_2011.Q + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2011ct ~ vis_minority_2011.Q + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2011ct ~ vis_minority_2011.Q + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                     Estimate Cond. SE t-value p-value
## (Intercept)          -1.3415  0.06110 -21.956 0.0e+00
## vis_minority_2011.Q  -0.1149  0.01716  -6.692 2.2e-11
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1380946 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1314  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2079.034</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.14857780               -0.08112137</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - vis_minority_2011.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 43.08352  1 5.245226e-11</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-13-1.png" /><!-- --></p>
<p>Interpretation of the <code>vis_minority_2011.Q</code> coefficient
(significant): we have <span class="math inline">\(e^{-0.115}\)</span> =
0.891 (95%CI: 0.862 ‚Äì 0.922), which means each increase of 1 quintile in
the proportion of visible minority leads to a 10.9% decrease in the
percentage of tree canopy area within CT in 2011.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.261</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.891</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm$interval), 3)%&gt;%
  data.frame(vis_minority_2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.862</td>
<td align="right">0.922</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="uc-vs-gentrified-ct" class="section level2 tabset"
number="4.3">
<h2 class="tabset"><span class="header-section-number">4.3</span> UC vs
gentrified CT</h2>
<p>Gentrified CT between 2011 and 2016. <em>NB</em> we now use a 3-state
gentrification status</p>
<div id="bike-lane-length-hurdle-2" class="section level3"
number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Bike lane length
(hurdle)</h3>
<p>Bike lane ratio to streets (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Zero model
res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2011ct != 0) ~ gentrif_status_2016 + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2011ct != 0) ~ gentrif_status_2016 + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE  t-value p-value
## (Intercept)                     -3.27822   0.2379 -13.7826  0.0000
## gentrif_status_2016Gentrified    0.04012   0.2711   0.1480  0.8824
## gentrif_status_2016Non eligible  0.23039   0.2985   0.7719  0.4402
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377728 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.489  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -355.8288</code></pre>
<pre class="r"><code>varfixef.zero &lt;- names(res.lmm.zero[[&#39;fixef&#39;]])
ci.1.lmm.zero &lt;- confint(res.lmm.zero, varfixef.zero[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                          -0.5469893                           0.6154186</code></pre>
<pre class="r"><code>ci.2.lmm.zero &lt;- confint(res.lmm.zero, varfixef.zero[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                            -0.3799708                             0.8719727</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.zero, . ~ . - gentrif_status_2016)
LRT(res.lmm.0, res.lmm.zero)</code></pre>
<pre><code>##       chi2_LR df   p_value
## p_v 0.5825823  2 0.7472981</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout, title = &quot;DHARMa residual | Logit&quot;)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-15-1.png" /><!-- --></p>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2011ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE  t-value p-value
## (Intercept)                     -2.27162  0.07135 -31.8377  0.0000
## gentrif_status_2016Gentrified    0.10399  0.09157   1.1356  0.2561
## gentrif_status_2016Non eligible -0.02444  0.08755  -0.2792  0.7801
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1228566 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.4003  
## # of obs: 454; # of groups: ct_no, 454 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1658.584</code></pre>
<pre class="r"><code>varfixef.cnt &lt;- names(res.lmm.cnt[[&#39;fixef&#39;]])
ci.1.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                          -0.0795367                           0.2891037</code></pre>
<pre class="r"><code>ci.2.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                            -0.1986635                             0.1513616</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.cnt, . ~ . - gentrif_status_2016)
LRT(res.lmm.0, res.lmm.cnt)</code></pre>
<pre><code>##      chi2_LR df   p_value
## p_v 1.879925  2 0.3906426</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout, title = &quot;DHARMa residual | Count (truncated Poisson)&quot;)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-15-2.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 4038.826</code></pre>
<p>Interpretation of the <code>gentrif_status_2016</code> coefficient:
none significant</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.038</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.041</td>
<td align="right">0.882</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.259</td>
<td align="right">0.440</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.zero$interval, ci.2.lmm.zero$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef.zero[2:3])
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Zero model confidence interval&quot;)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.579</td>
<td align="right">1.850</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.684</td>
<td align="right">2.392</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.103</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.110</td>
<td align="right">0.256</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.976</td>
<td align="right">0.780</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.cnt$interval, ci.2.lmm.cnt$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef.cnt[2:3]) 
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.924</td>
<td align="right">1.335</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.820</td>
<td align="right">1.163</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-2" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2011ct ~ gentrif_status_2016 + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2011ct ~ gentrif_status_2016 + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2011ct ~ gentrif_status_2016 + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE t-value p-value
## (Intercept)                     -1.01664  0.03199 -31.780  0.0000
## gentrif_status_2016Gentrified   -0.05599  0.03596  -1.557  0.1194
## gentrif_status_2016Non eligible  0.29838  0.03307   9.023  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1385187 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.05024  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                        logLik
## logL       (p_v(h)): -2301.48</code></pre>
<pre class="r"><code>varfixef &lt;- names(res.lmm[[&#39;fixef&#39;]])
ci.1.lmm &lt;- confint(res.lmm, varfixef[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                          -0.1265914                           0.0145680</code></pre>
<pre class="r"><code>ci.2.lmm &lt;- confint(res.lmm, varfixef[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                             0.2333299                             0.3633088</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - gentrif_status_2016)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df p_value
## p_v 108.5734  2       0</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-17-1.png" /><!-- --></p>
<p>Interpretation of the <code>gentrif_status_2016</code>: No
significant difference between <em>Gentrified</em> vs.¬†<em>Not
gentrified</em>. Only meaningful difference between <em>non
eligible</em> and <em>not gentrified</em>.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.362</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.946</td>
<td align="right">0.119</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.348</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm$interval, ci.2.lmm$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef[2:3]) 
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.881</td>
<td align="right">1.015</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.263</td>
<td align="right">1.438</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-2" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2011ct ~ gentrif_status_2016 + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2011ct ~ gentrif_status_2016 + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2011ct ~ gentrif_status_2016 + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE  t-value   p-value
## (Intercept)                     -1.79434  0.05002 -35.8742 0.000e+00
## gentrif_status_2016Gentrified   -0.03222  0.05478  -0.5882 5.564e-01
## gentrif_status_2016Non eligible  0.26910  0.05205   5.1705 2.335e-07
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1379023 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1333  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2082.717</code></pre>
<pre class="r"><code>varfixef &lt;- names(res.lmm[[&#39;fixef&#39;]])
ci.1.lmm &lt;- confint(res.lmm, varfixef[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                         -0.13999699                          0.07537829</code></pre>
<pre class="r"><code>ci.2.lmm &lt;- confint(res.lmm, varfixef[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                             0.1666311                             0.3713836</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - gentrif_status_2016)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 35.71865  2 1.753051e-08</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-19-1.png" /><!-- --></p>
<p>Interpretation of the <code>gentrif_status_2016</code> coefficient:
not significant between <em>Gentrified</em> and <em>Not
gentrified</em>.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.166</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.968</td>
<td align="right">0.556</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.309</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm$interval, ci.2.lmm$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef[2:3]) 
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.869</td>
<td align="right">1.078</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.181</td>
<td align="right">1.450</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div
id="association-between-ses-and-urban-conditions-at-end-of-period-2016"
class="section level1" number="5">
<h1><span class="header-section-number">5</span> Association between SES
and Urban Conditions at end of period (2016)</h1>
<p><strong>ADDED FOLLOWING REVIEWERS‚Äô COMMENTS</strong></p>
<div id="uc-vs-pampalon-material-1" class="section level2 tabset"
number="5.1">
<h2 class="tabset"><span class="header-section-number">5.1</span> UC vs
Pampalon | material</h2>
<div id="greenness-3" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 at the Census tract level, using a Poisson
distribution</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ wSCOREMAT.2016.Q + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ wSCOREMAT.2016.Q + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ wSCOREMAT.2016.Q + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                  Estimate Cond. SE t-value   p-value
## (Intercept)       -0.5341  0.03781 -14.124 0.000e+00
## wSCOREMAT.2016.Q  -0.0836  0.01023  -8.169 3.331e-16
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1383151 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.04465  
## # of obs: 674; # of groups: ct_no, 674 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2346.008</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &#39;wSCOREMAT.2016.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2016.Q upper wSCOREMAT.2016.Q 
##            -0.10367374            -0.06342881</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - wSCOREMAT.2016.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 61.90814  1 3.552714e-15</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-21-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.586</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2016.Q</td>
<td align="right">0.920</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm$interval), 3)%&gt;%
  data.frame(wSCOREMAT.2016.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2016.Q</td>
<td align="right">0.902</td>
<td align="right">0.939</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-3" class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 at the Census tract level, using a Poisson
distribution</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ wSCOREMAT.2016.Q + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ wSCOREMAT.2016.Q + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ wSCOREMAT.2016.Q + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                  Estimate Cond. SE t-value p-value
## (Intercept)        -1.090  0.05676 -19.211       0
## wSCOREMAT.2016.Q   -0.138  0.01544  -8.936       0
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##   1.rho 
## 0.13774 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1074  
## # of obs: 674; # of groups: ct_no, 674 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2134.507</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &#39;wSCOREMAT.2016.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2016.Q upper wSCOREMAT.2016.Q 
##             -0.1682889             -0.1075699</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - wSCOREMAT.2016.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df p_value
## p_v 74.13586  1       0</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-23-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.336</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2016.Q</td>
<td align="right">0.871</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm$interval), 3)%&gt;%
  data.frame(wSCOREMAT.2016.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2016.Q</td>
<td align="right">0.845</td>
<td align="right">0.898</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="uc-vs-visible-minority-1" class="section level2 tabset"
number="5.2">
<h2 class="tabset"><span class="header-section-number">5.2</span> UC vs
Visible minority</h2>
<div id="greenness-4" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ vis_minority_2016.Q + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ vis_minority_2016.Q + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ vis_minority_2016.Q + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                     Estimate Cond. SE t-value   p-value
## (Intercept)         -0.61554  0.03839 -16.035 0.000e+00
## vis_minority_2016.Q -0.05968  0.01082  -5.515 3.496e-08
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1382566 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.04851  
## # of obs: 675; # of groups: ct_no, 675 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2361.003</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &#39;vis_minority_2016.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2016.Q upper vis_minority_2016.Q 
##               -0.08090358               -0.03837079</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - vis_minority_2016.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 29.30047  1 6.198066e-08</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-25-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.540</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2016.Q</td>
<td align="right">0.942</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm$interval), 3)%&gt;%
  data.frame(vis_minority_2016.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2016.Q</td>
<td align="right">0.922</td>
<td align="right">0.962</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-4" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ vis_minority_2016.Q + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ vis_minority_2016.Q + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ vis_minority_2016.Q + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                     Estimate Cond. SE t-value  p-value
## (Intercept)          -1.1963  0.05762 -20.762 0.00e+00
## vis_minority_2016.Q  -0.1084  0.01631  -6.645 3.03e-11
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377588 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1165  
## # of obs: 675; # of groups: ct_no, 675 
##  ------------- Likelihood values  -------------
##                        logLik
## logL       (p_v(h)): -2151.28</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &#39;vis_minority_2016.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2016.Q upper vis_minority_2016.Q 
##               -0.14037329               -0.07629247</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - vis_minority_2016.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 42.43582  1 7.304002e-11</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-27-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.302</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2016.Q</td>
<td align="right">0.897</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm$interval), 3)%&gt;%
  data.frame(vis_minority_2016.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2016.Q</td>
<td align="right">0.869</td>
<td align="right">0.927</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="uc-vs-gentrified-ct-1" class="section level2 tabset"
number="5.3">
<h2 class="tabset"><span class="header-section-number">5.3</span> UC vs
gentrified CT</h2>
<p>Gentrified CT between 2016 and 2021. <em>NB</em> we use a 3-state
gentrification status</p>
<div id="greenness-5" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2017 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ gentrif_status_2021 + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ gentrif_status_2021 + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ gentrif_status_2021 + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE  t-value p-value
## (Intercept)                     -0.91613  0.02999 -30.5470  0.0000
## gentrif_status_2021Gentrified   -0.01085  0.03305  -0.3283  0.7427
## gentrif_status_2021Non eligible  0.28058  0.03121   8.9902  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1381706 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.04045  
## # of obs: 675; # of groups: ct_no, 675 
##  ------------- Likelihood values  -------------
##                        logLik
## logL       (p_v(h)): -2325.15</code></pre>
<pre class="r"><code>varfixef &lt;- names(res.lmm[[&#39;fixef&#39;]])
ci.1.lmm &lt;- confint(res.lmm, varfixef[2])</code></pre>
<pre><code>## lower gentrif_status_2021Gentrified upper gentrif_status_2021Gentrified 
##                         -0.07569281                          0.05404515</code></pre>
<pre class="r"><code>ci.2.lmm &lt;- confint(res.lmm, varfixef[3])</code></pre>
<pre><code>## lower gentrif_status_2021Non eligible upper gentrif_status_2021Non eligible 
##                             0.2191477                             0.3418391</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - gentrif_status_2021)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df p_value
## p_v 101.0071  2       0</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-29-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.400</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2021Gentrified</td>
<td align="right">0.989</td>
<td align="right">0.743</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2021Non eligible</td>
<td align="right">1.324</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm$interval, ci.2.lmm$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef[2:3]) 
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2021Gentrified</td>
<td align="right">0.927</td>
<td align="right">1.056</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2021Non eligible</td>
<td align="right">1.245</td>
<td align="right">1.408</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-5" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2017 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ gentrif_status_2021 + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ gentrif_status_2021 + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ gentrif_status_2021 + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE  t-value   p-value
## (Intercept)                     -1.66290  0.04812 -34.5557 0.000e+00
## gentrif_status_2021Gentrified    0.05082  0.05139   0.9889 3.227e-01
## gentrif_status_2021Non eligible  0.30110  0.05006   6.0153 1.796e-09
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377059 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1171  
## # of obs: 675; # of groups: ct_no, 675 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2152.525</code></pre>
<pre class="r"><code>varfixef &lt;- names(res.lmm[[&#39;fixef&#39;]])
ci.1.lmm &lt;- confint(res.lmm, varfixef[2])</code></pre>
<pre><code>## lower gentrif_status_2021Gentrified upper gentrif_status_2021Gentrified 
##                          -0.0501185                           0.1518662</code></pre>
<pre class="r"><code>ci.2.lmm &lt;- confint(res.lmm, varfixef[3])</code></pre>
<pre><code>## lower gentrif_status_2021Non eligible upper gentrif_status_2021Non eligible 
##                             0.2026970                             0.3994606</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - gentrif_status_2021)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 39.94413  2 2.119541e-09</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-31-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.190</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2021Gentrified</td>
<td align="right">1.052</td>
<td align="right">0.323</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2021Non eligible</td>
<td align="right">1.351</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm$interval, ci.2.lmm$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef[2:3]) 
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2021Gentrified</td>
<td align="right">0.951</td>
<td align="right">1.164</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2021Non eligible</td>
<td align="right">1.225</td>
<td align="right">1.491</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="association-between-ses-and-uc-in-2011-ses-as-categories"
class="section level1" number="6">
<h1><span class="header-section-number">6</span> Association between SES
and UC in 2011 | SES as categories</h1>
<p><strong>UPDATE 2022-08-18</strong>: adding the same models, with
discrete SES variables</p>
<div id="uc-vs-pampalon-material-2" class="section level2 tabset"
number="6.1">
<h2 class="tabset"><span class="header-section-number">6.1</span> UC vs
Pampalon | material</h2>
<div id="bike-lane-length-hurdle-3" class="section level3"
number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Bike lane length
(hurdle)</h3>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Zero model
res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2011ct != 0) ~ factor(wSCOREMAT.2011.Q) + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2011ct != 0) ~ factor(wSCOREMAT.2011.Q) + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                           Estimate Cond. SE t-value  p-value
## (Intercept)               -2.86160   0.3378 -8.4714 0.000000
## factor(wSCOREMAT.2011.Q)2 -0.19935   0.3898 -0.5115 0.609026
## factor(wSCOREMAT.2011.Q)3 -0.08525   0.4004 -0.2129 0.831388
## factor(wSCOREMAT.2011.Q)4 -0.10580   0.4089 -0.2588 0.795827
## factor(wSCOREMAT.2011.Q)5 -1.04477   0.4016 -2.6014 0.009286
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1375796 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.444  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -351.0364</code></pre>
<pre class="r"><code>ci.lmm.zero.2 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2 upper factor(wSCOREMAT.2011.Q)2 
##                      -1.0157625                       0.6000846</code></pre>
<pre class="r"><code>ci.lmm.zero.3 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3 upper factor(wSCOREMAT.2011.Q)3 
##                      -0.9257822                       0.7339588</code></pre>
<pre class="r"><code>ci.lmm.zero.4 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4 upper factor(wSCOREMAT.2011.Q)4 
##                      -0.9634992                       0.7242757</code></pre>
<pre class="r"><code>ci.lmm.zero.5 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5 upper factor(wSCOREMAT.2011.Q)5 
##                      -1.9748669                      -0.2258412</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.zero, . ~ . -factor(wSCOREMAT.2011.Q))
LRT(res.lmm.0, res.lmm.zero)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 9.917987  4 0.04183207</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout, title = &quot;DHARMa residual | Logit&quot;)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-33-1.png" /><!-- --></p>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2011ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                           Estimate Cond. SE t-value p-value
## (Intercept)                -2.0747  0.08799 -23.580 0.00000
## factor(wSCOREMAT.2011.Q)2  -0.1772  0.10715  -1.654 0.09812
## factor(wSCOREMAT.2011.Q)3  -0.2408  0.11081  -2.173 0.02975
## factor(wSCOREMAT.2011.Q)4  -0.1564  0.11275  -1.387 0.16547
## factor(wSCOREMAT.2011.Q)5  -0.2706  0.12719  -2.127 0.03339
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1305916 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.3955  
## # of obs: 454; # of groups: ct_no, 454 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1661.156</code></pre>
<pre class="r"><code>ci.lmm.cnt.2 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2 upper factor(wSCOREMAT.2011.Q)2 
##                     -0.38889453                      0.03422423</code></pre>
<pre class="r"><code>ci.lmm.cnt.3 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3 upper factor(wSCOREMAT.2011.Q)3 
##                      -0.4593470                      -0.0224232</code></pre>
<pre class="r"><code>ci.lmm.cnt.4 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4 upper factor(wSCOREMAT.2011.Q)4 
##                     -0.37885112                      0.06556367</code></pre>
<pre class="r"><code>ci.lmm.cnt.5 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5 upper factor(wSCOREMAT.2011.Q)5 
##                     -0.52247315                     -0.01967952</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.cnt, . ~ . -factor(wSCOREMAT.2011.Q))
LRT(res.lmm.0, res.lmm.cnt)</code></pre>
<pre><code>##     chi2_LR df   p_value
## p_v 6.29161  4 0.1784034</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout, title = &quot;DHARMa residual | Count (truncated Poisson)&quot;)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-33-2.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 4038.385</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.057</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.819</td>
<td align="right">0.609</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.918</td>
<td align="right">0.831</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.900</td>
<td align="right">0.796</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.352</td>
<td align="right">0.009</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q.2 = round(exp(ci.lmm.zero.2$interval), 3),
           wSCOREMAT.2011.Q.3 = round(exp(ci.lmm.zero.3$interval), 3),
           wSCOREMAT.2011.Q.4 = round(exp(ci.lmm.zero.4$interval), 3),
           wSCOREMAT.2011.Q.5 = round(exp(ci.lmm.zero.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Zero model confidence interval&quot;)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2</td>
<td align="right">0.362</td>
<td align="right">1.822</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3</td>
<td align="right">0.396</td>
<td align="right">2.083</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4</td>
<td align="right">0.382</td>
<td align="right">2.063</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5</td>
<td align="right">0.139</td>
<td align="right">0.798</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.126</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.838</td>
<td align="right">0.098</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.786</td>
<td align="right">0.030</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.855</td>
<td align="right">0.165</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.763</td>
<td align="right">0.033</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q.2 = round(exp(ci.lmm.cnt.2$interval), 3),
           wSCOREMAT.2011.Q.3 = round(exp(ci.lmm.cnt.3$interval), 3),
           wSCOREMAT.2011.Q.4 = round(exp(ci.lmm.cnt.4$interval), 3),
           wSCOREMAT.2011.Q.5 = round(exp(ci.lmm.cnt.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2</td>
<td align="right">0.678</td>
<td align="right">1.035</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3</td>
<td align="right">0.632</td>
<td align="right">0.978</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4</td>
<td align="right">0.685</td>
<td align="right">1.068</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5</td>
<td align="right">0.593</td>
<td align="right">0.981</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-6" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 at the Census tract level, using a Poisson
distribution</p>
<pre class="r"><code>f &lt;- area_esp_vert_2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                           Estimate Cond. SE t-value   p-value
## (Intercept)                -0.7271  0.03808 -19.094 0.000e+00
## factor(wSCOREMAT.2011.Q)2  -0.0818  0.04099  -1.996 4.597e-02
## factor(wSCOREMAT.2011.Q)3  -0.1164  0.04348  -2.677 7.429e-03
## factor(wSCOREMAT.2011.Q)4  -0.2162  0.04439  -4.870 1.115e-06
## factor(wSCOREMAT.2011.Q)5  -0.4003  0.04904  -8.163 3.331e-16
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1383734 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.05495  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2326.028</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2 upper factor(wSCOREMAT.2011.Q)2 
##                    -0.162362879                    -0.001325418</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3 upper factor(wSCOREMAT.2011.Q)3 
##                     -0.20181408                     -0.03099336</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4 upper factor(wSCOREMAT.2011.Q)4 
##                      -0.3033058                      -0.1288687</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5 upper factor(wSCOREMAT.2011.Q)5 
##                      -0.4965327                      -0.3038120</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(wSCOREMAT.2011.Q))
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 70.47529  4 1.798561e-14</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-35-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.483</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.921</td>
<td align="right">0.046</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.890</td>
<td align="right">0.007</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.806</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.670</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           wSCOREMAT.2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           wSCOREMAT.2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           wSCOREMAT.2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2</td>
<td align="right">0.850</td>
<td align="right">0.999</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3</td>
<td align="right">0.817</td>
<td align="right">0.969</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4</td>
<td align="right">0.738</td>
<td align="right">0.879</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5</td>
<td align="right">0.609</td>
<td align="right">0.738</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-6" class="section level3" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 at the Census tract level, using a Poisson
distribution</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2011ct ~ factor(wSCOREMAT.2011.Q) + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                           Estimate Cond. SE t-value   p-value
## (Intercept)                -1.4069  0.05576 -25.232 0.000e+00
## factor(wSCOREMAT.2011.Q)2  -0.1587  0.06030  -2.632 8.483e-03
## factor(wSCOREMAT.2011.Q)3  -0.2026  0.06399  -3.166 1.546e-03
## factor(wSCOREMAT.2011.Q)4  -0.3655  0.06578  -5.557 2.749e-08
## factor(wSCOREMAT.2011.Q)5  -0.5875  0.07296  -8.052 7.772e-16
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377966 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1237  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                        logLik
## logL       (p_v(h)): -2070.45</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2 upper factor(wSCOREMAT.2011.Q)2 
##                     -0.27723591                     -0.04018457</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3 upper factor(wSCOREMAT.2011.Q)3 
##                     -0.32826040                     -0.07662331</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4 upper factor(wSCOREMAT.2011.Q)4 
##                      -0.4947162                      -0.2361205</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5 upper factor(wSCOREMAT.2011.Q)5 
##                      -0.7308436                      -0.4439361</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(wSCOREMAT.2011.Q))
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##     chi2_LR df      p_value
## p_v 67.9895  4 6.028511e-14</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-37-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.245</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.853</td>
<td align="right">0.008</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.817</td>
<td align="right">0.002</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.694</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.556</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           wSCOREMAT.2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           wSCOREMAT.2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           wSCOREMAT.2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2</td>
<td align="right">0.758</td>
<td align="right">0.961</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3</td>
<td align="right">0.720</td>
<td align="right">0.926</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4</td>
<td align="right">0.610</td>
<td align="right">0.790</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5</td>
<td align="right">0.482</td>
<td align="right">0.642</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="uc-vs-visible-minority-2" class="section level2 tabset"
number="6.2">
<h2 class="tabset"><span class="header-section-number">6.2</span> UC vs
Visible minority</h2>
<div id="bike-lane-length-hurdle-4" class="section level3"
number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Bike lane length
(hurdle)</h3>
<p>Bike lane ratio to streets (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ factor(vis_minority_2011.Q) + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Zero model
res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2011ct != 0) ~ factor(vis_minority_2011.Q) + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2011ct != 0) ~ factor(vis_minority_2011.Q) + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                              Estimate Cond. SE  t-value p-value
## (Intercept)                  -3.03664   0.3081 -9.85597 0.00000
## factor(vis_minority_2011.Q)2  0.26683   0.3816  0.69920 0.48443
## factor(vis_minority_2011.Q)3 -0.15925   0.3707 -0.42963 0.66747
## factor(vis_minority_2011.Q)4  0.00702   0.3897  0.01802 0.98563
## factor(vis_minority_2011.Q)5 -0.92787   0.3854 -2.40736 0.01607
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1375854 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.396  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -350.7932</code></pre>
<pre class="r"><code>ci.lmm.zero.2 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2 upper factor(vis_minority_2011.Q)2 
##                         -0.5079544                          1.0755847</code></pre>
<pre class="r"><code>ci.lmm.zero.3 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3 upper factor(vis_minority_2011.Q)3 
##                         -0.9249753                          0.6277925</code></pre>
<pre class="r"><code>ci.lmm.zero.4 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4 upper factor(vis_minority_2011.Q)4 
##                         -0.7915025                          0.8253032</code></pre>
<pre class="r"><code>ci.lmm.zero.5 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5 upper factor(vis_minority_2011.Q)5 
##                         -1.7740296                         -0.1386125</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.zero, . ~ . - factor(vis_minority_2011.Q))
LRT(res.lmm.0, res.lmm.zero)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 10.65385  4 0.03074246</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout, title = &quot;DHARMa residual | Logit&quot;)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-39-1.png" /><!-- --></p>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2011ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2011ct ~ factor(vis_minority_2011.Q) + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ factor(vis_minority_2011.Q) + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                              Estimate Cond. SE  t-value p-value
## (Intercept)                  -2.14979  0.08621 -24.9360 0.00000
## factor(vis_minority_2011.Q)2  0.05333  0.10220   0.5218 0.60182
## factor(vis_minority_2011.Q)3 -0.14583  0.10939  -1.3331 0.18252
## factor(vis_minority_2011.Q)4 -0.21031  0.11285  -1.8636 0.06237
## factor(vis_minority_2011.Q)5 -0.20807  0.12911  -1.6116 0.10704
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1290198 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.3898  
## # of obs: 454; # of groups: ct_no, 454 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1655.408</code></pre>
<pre class="r"><code>ci.lmm.cnt.2 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2 upper factor(vis_minority_2011.Q)2 
##                         -0.1479935                          0.2550843</code></pre>
<pre class="r"><code>ci.lmm.cnt.3 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3 upper factor(vis_minority_2011.Q)3 
##                        -0.36167475                         0.06966377</code></pre>
<pre class="r"><code>ci.lmm.cnt.4 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4 upper factor(vis_minority_2011.Q)4 
##                        -0.43274544                         0.01199704</code></pre>
<pre class="r"><code>ci.lmm.cnt.5 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5 upper factor(vis_minority_2011.Q)5 
##                        -0.46334509                         0.04625033</code></pre>
<pre class="r"><code>res.lmm.0 &lt;- update(res.lmm.cnt, . ~ . - factor(vis_minority_2011.Q))
LRT(res.lmm.0, res.lmm.cnt)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 8.232463  4 0.08342449</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout, title = &quot;DHARMa residual | Count (truncated Poisson)&quot;)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-39-2.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 4026.402</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.048</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">1.306</td>
<td align="right">0.484</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">0.853</td>
<td align="right">0.667</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">1.007</td>
<td align="right">0.986</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.395</td>
<td align="right">0.016</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q.2 = round(exp(ci.lmm.zero.2$interval), 3),
           vis_minority_2011.Q.3 = round(exp(ci.lmm.zero.3$interval), 3),
           vis_minority_2011.Q.4 = round(exp(ci.lmm.zero.4$interval), 3),
           vis_minority_2011.Q.5 = round(exp(ci.lmm.zero.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Zero model confidence interval&quot;)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2</td>
<td align="right">0.602</td>
<td align="right">2.932</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3</td>
<td align="right">0.397</td>
<td align="right">1.873</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4</td>
<td align="right">0.453</td>
<td align="right">2.283</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5</td>
<td align="right">0.170</td>
<td align="right">0.871</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.117</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">1.055</td>
<td align="right">0.602</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">0.864</td>
<td align="right">0.183</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.810</td>
<td align="right">0.062</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.812</td>
<td align="right">0.107</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q.2 = round(exp(ci.lmm.cnt.2$interval), 3),
           vis_minority_2011.Q.3 = round(exp(ci.lmm.cnt.3$interval), 3),
           vis_minority_2011.Q.4 = round(exp(ci.lmm.cnt.4$interval), 3),
           vis_minority_2011.Q.5 = round(exp(ci.lmm.cnt.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2</td>
<td align="right">0.862</td>
<td align="right">1.291</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3</td>
<td align="right">0.697</td>
<td align="right">1.072</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4</td>
<td align="right">0.649</td>
<td align="right">1.012</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5</td>
<td align="right">0.629</td>
<td align="right">1.047</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-7" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2011ct ~ factor(vis_minority_2011.Q) + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2011ct ~ factor(vis_minority_2011.Q) + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2011ct ~ factor(vis_minority_2011.Q) + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                              Estimate Cond. SE  t-value   p-value
## (Intercept)                  -0.78564  0.03743 -20.9874 0.000e+00
## factor(vis_minority_2011.Q)2 -0.03719  0.04171  -0.8918 3.725e-01
## factor(vis_minority_2011.Q)3 -0.09027  0.04358  -2.0715 3.831e-02
## factor(vis_minority_2011.Q)4 -0.13494  0.04551  -2.9655 3.022e-03
## factor(vis_minority_2011.Q)5 -0.28976  0.05020  -5.7723 7.818e-09
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1385795 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.05981  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2337.961</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2 upper factor(vis_minority_2011.Q)2 
##                        -0.11903740                         0.04480626</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3 upper factor(vis_minority_2011.Q)3 
##                       -0.175736289                       -0.004356101</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4 upper factor(vis_minority_2011.Q)4 
##                        -0.22418634                        -0.04529683</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5 upper factor(vis_minority_2011.Q)5 
##                         -0.3882358                         -0.1909309</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(vis_minority_2011.Q))
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 35.61216  4 3.477087e-07</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-41-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.456</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">0.963</td>
<td align="right">0.372</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">0.914</td>
<td align="right">0.038</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.874</td>
<td align="right">0.003</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.748</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           vis_minority_2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           vis_minority_2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           vis_minority_2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2</td>
<td align="right">0.888</td>
<td align="right">1.046</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3</td>
<td align="right">0.839</td>
<td align="right">0.996</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4</td>
<td align="right">0.799</td>
<td align="right">0.956</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5</td>
<td align="right">0.678</td>
<td align="right">0.826</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-7" class="section level3" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2011ct ~ factor(vis_minority_2011.Q) + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2011ct ~ factor(vis_minority_2011.Q) + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2011ct ~ factor(vis_minority_2011.Q) + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                              Estimate Cond. SE t-value   p-value
## (Intercept)                  -1.47245  0.05458 -26.978 0.000e+00
## factor(vis_minority_2011.Q)2 -0.09472  0.06100  -1.553 1.205e-01
## factor(vis_minority_2011.Q)3 -0.18374  0.06367  -2.886 3.905e-03
## factor(vis_minority_2011.Q)4 -0.31786  0.06699  -4.745 2.089e-06
## factor(vis_minority_2011.Q)5 -0.46969  0.07388  -6.358 2.046e-10
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1381152 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1315  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                        logLik
## logL       (p_v(h)): -2078.57</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2 upper factor(vis_minority_2011.Q)2 
##                        -0.21453089                         0.02528571</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3 upper factor(vis_minority_2011.Q)3 
##                        -0.30875587                        -0.05832109</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4 upper factor(vis_minority_2011.Q)4 
##                         -0.4493834                         -0.1859589</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5 upper factor(vis_minority_2011.Q)5 
##                         -0.6148673                         -0.3245555</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(vis_minority_2011.Q))
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 44.01138  4 6.380946e-09</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-43-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.229</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">0.910</td>
<td align="right">0.120</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">0.832</td>
<td align="right">0.004</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.728</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.625</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           vis_minority_2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           vis_minority_2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           vis_minority_2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2</td>
<td align="right">0.807</td>
<td align="right">1.026</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3</td>
<td align="right">0.734</td>
<td align="right">0.943</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4</td>
<td align="right">0.638</td>
<td align="right">0.830</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5</td>
<td align="right">0.541</td>
<td align="right">0.723</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="uc-vs-gentrified-ct-2" class="section level2 tabset"
number="6.3">
<h2 class="tabset"><span class="header-section-number">6.3</span> UC vs
gentrified CT</h2>
<p>No new models here, as <code>gentrified</code> variable is already
used as a pure categorical variable.</p>
</div>
</div>
<div id="association-between-ses-and-uc-in-2016-ses-as-categories"
class="section level1" number="7">
<h1><span class="header-section-number">7</span> Association between SES
and UC in 2016 | SES as categories</h1>
<p><strong>UPDATE 2023-05-19</strong>: as decided with Yan and Behzad,
we add the <em>end of period</em> model, this time SES as categories
instead of continuous</p>
<div id="uc-vs-pampalon-material-3" class="section level2 tabset"
number="7.1">
<h2 class="tabset"><span class="header-section-number">7.1</span> UC vs
Pampalon | material</h2>
<div id="greenness-8" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 at the Census tract level, using a Poisson
distribution</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ factor(wSCOREMAT.2016.Q) + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ factor(wSCOREMAT.2016.Q) + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ factor(wSCOREMAT.2016.Q) + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                           Estimate Cond. SE t-value   p-value
## (Intercept)               -0.64324  0.03553 -18.106 0.000e+00
## factor(wSCOREMAT.2016.Q)2 -0.05898  0.03885  -1.518 1.290e-01
## factor(wSCOREMAT.2016.Q)3 -0.13289  0.03993  -3.328 8.748e-04
## factor(wSCOREMAT.2016.Q)4 -0.18067  0.04117  -4.388 1.142e-05
## factor(wSCOREMAT.2016.Q)5 -0.36555  0.04517  -8.093 5.551e-16
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1383093 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.0439  
## # of obs: 674; # of groups: ct_no, 674 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2342.181</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2016.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2016.Q)2 upper factor(wSCOREMAT.2016.Q)2 
##                     -0.13536058                      0.01724839</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2016.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2016.Q)3 upper factor(wSCOREMAT.2016.Q)3 
##                     -0.21125975                     -0.05438351</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2016.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2016.Q)4 upper factor(wSCOREMAT.2016.Q)4 
##                     -0.26142437                     -0.09957775</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2016.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2016.Q)5 upper factor(wSCOREMAT.2016.Q)5 
##                      -0.4541506                      -0.2765883</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(wSCOREMAT.2016.Q))
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 69.56323  4 2.808864e-14</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-45-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.526</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2016.Q)2</td>
<td align="right">0.943</td>
<td align="right">0.129</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2016.Q)3</td>
<td align="right">0.876</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2016.Q)4</td>
<td align="right">0.835</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2016.Q)5</td>
<td align="right">0.694</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2016.Q.2 = round(exp(ci.lmm.2$interval), 3),
           wSCOREMAT.2016.Q.3 = round(exp(ci.lmm.3$interval), 3),
           wSCOREMAT.2016.Q.4 = round(exp(ci.lmm.4$interval), 3),
           wSCOREMAT.2016.Q.5 = round(exp(ci.lmm.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2016.Q.2</td>
<td align="right">0.873</td>
<td align="right">1.017</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2016.Q.3</td>
<td align="right">0.810</td>
<td align="right">0.947</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2016.Q.4</td>
<td align="right">0.770</td>
<td align="right">0.905</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2016.Q.5</td>
<td align="right">0.635</td>
<td align="right">0.758</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-8" class="section level3" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2017 at the Census tract level, using a Poisson
distribution</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ factor(wSCOREMAT.2016.Q) + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ factor(wSCOREMAT.2016.Q) + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ factor(wSCOREMAT.2016.Q) + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                           Estimate Cond. SE t-value   p-value
## (Intercept)                -1.2221  0.05276 -23.164 0.000e+00
## factor(wSCOREMAT.2016.Q)2  -0.1857  0.05745  -3.232 1.231e-03
## factor(wSCOREMAT.2016.Q)3  -0.2687  0.05941  -4.522 6.131e-06
## factor(wSCOREMAT.2016.Q)4  -0.3731  0.06180  -6.036 1.579e-09
## factor(wSCOREMAT.2016.Q)5  -0.6089  0.06814  -8.937 0.000e+00
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##    1.rho 
## 0.137718 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1065  
## # of obs: 674; # of groups: ct_no, 674 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2132.441</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2016.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2016.Q)2 upper factor(wSCOREMAT.2016.Q)2 
##                     -0.29850669                     -0.07271386</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2016.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2016.Q)3 upper factor(wSCOREMAT.2016.Q)3 
##                      -0.3853105                      -0.1517505</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2016.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2016.Q)4 upper factor(wSCOREMAT.2016.Q)4 
##                      -0.4943666                      -0.2513389</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2016.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2016.Q)5 upper factor(wSCOREMAT.2016.Q)5 
##                      -0.7427128                      -0.4747855</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(wSCOREMAT.2016.Q))
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 78.26746  4 4.440892e-16</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-47-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.295</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2016.Q)2</td>
<td align="right">0.831</td>
<td align="right">0.001</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2016.Q)3</td>
<td align="right">0.764</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2016.Q)4</td>
<td align="right">0.689</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2016.Q)5</td>
<td align="right">0.544</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2016.Q.2 = round(exp(ci.lmm.2$interval), 3),
           wSCOREMAT.2016.Q.3 = round(exp(ci.lmm.3$interval), 3),
           wSCOREMAT.2016.Q.4 = round(exp(ci.lmm.4$interval), 3),
           wSCOREMAT.2016.Q.5 = round(exp(ci.lmm.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2016.Q.2</td>
<td align="right">0.742</td>
<td align="right">0.930</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2016.Q.3</td>
<td align="right">0.680</td>
<td align="right">0.859</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2016.Q.4</td>
<td align="right">0.610</td>
<td align="right">0.778</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2016.Q.5</td>
<td align="right">0.476</td>
<td align="right">0.622</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="uc-vs-visible-minority-3" class="section level2 tabset"
number="7.2">
<h2 class="tabset"><span class="header-section-number">7.2</span> UC vs
Visible minority</h2>
<div id="greenness-9" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Greenness</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2017 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ factor(vis_minority_2016.Q) + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ factor(vis_minority_2016.Q) + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ factor(vis_minority_2016.Q) + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                              Estimate Cond. SE t-value   p-value
## (Intercept)                  -0.68748  0.03429 -20.048 0.000e+00
## factor(vis_minority_2016.Q)2 -0.06255  0.03878  -1.613 1.068e-01
## factor(vis_minority_2016.Q)3 -0.07031  0.03989  -1.763 7.794e-02
## factor(vis_minority_2016.Q)4 -0.12792  0.04171  -3.067 2.163e-03
## factor(vis_minority_2016.Q)5 -0.27533  0.04671  -5.894 3.772e-09
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1382568 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.04808  
## # of obs: 675; # of groups: ct_no, 675 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2357.493</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(vis_minority_2016.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2016.Q)2 upper factor(vis_minority_2016.Q)2 
##                        -0.13861263                         0.01374789</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(vis_minority_2016.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2016.Q)3 upper factor(vis_minority_2016.Q)3 
##                       -0.148530792                        0.008231516</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(vis_minority_2016.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2016.Q)4 upper factor(vis_minority_2016.Q)4 
##                        -0.20969916                        -0.04563736</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(vis_minority_2016.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2016.Q)5 upper factor(vis_minority_2016.Q)5 
##                         -0.3669616                         -0.1834218</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-49-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.503</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2016.Q)2</td>
<td align="right">0.939</td>
<td align="right">0.107</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2016.Q)3</td>
<td align="right">0.932</td>
<td align="right">0.078</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2016.Q)4</td>
<td align="right">0.880</td>
<td align="right">0.002</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2016.Q)5</td>
<td align="right">0.759</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2016.Q.2 = round(exp(ci.lmm.2$interval), 3),
           vis_minority_2016.Q.3 = round(exp(ci.lmm.3$interval), 3),
           vis_minority_2016.Q.4 = round(exp(ci.lmm.4$interval), 3),
           vis_minority_2016.Q.5 = round(exp(ci.lmm.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2016.Q.2</td>
<td align="right">0.871</td>
<td align="right">1.014</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2016.Q.3</td>
<td align="right">0.862</td>
<td align="right">1.008</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2016.Q.4</td>
<td align="right">0.811</td>
<td align="right">0.955</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2016.Q.5</td>
<td align="right">0.693</td>
<td align="right">0.832</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-9" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Canopy (trees)</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ factor(vis_minority_2016.Q) + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ factor(vis_minority_2016.Q) + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx, 
                 family = Poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ factor(vis_minority_2016.Q) + offset(log(ct_area_hct)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                              Estimate Cond. SE t-value   p-value
## (Intercept)                   -1.3045  0.05128 -25.439 0.000e+00
## factor(vis_minority_2016.Q)2  -0.1370  0.05761  -2.377 1.743e-02
## factor(vis_minority_2016.Q)3  -0.1819  0.05979  -3.042 2.354e-03
## factor(vis_minority_2016.Q)4  -0.2964  0.06297  -4.706 2.521e-06
## factor(vis_minority_2016.Q)5  -0.4678  0.07048  -6.638 3.188e-11
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377784 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1163  
## # of obs: 675; # of groups: ct_no, 675 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2150.128</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(vis_minority_2016.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2016.Q)2 upper factor(vis_minority_2016.Q)2 
##                        -0.25008783                        -0.02367488</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(vis_minority_2016.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2016.Q)3 upper factor(vis_minority_2016.Q)3 
##                         -0.2992617                         -0.0641431</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(vis_minority_2016.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2016.Q)4 upper factor(vis_minority_2016.Q)4 
##                         -0.4199470                         -0.1723185</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(vis_minority_2016.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2016.Q)5 upper factor(vis_minority_2016.Q)5 
##                         -0.6062511                         -0.3293438</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-51-1.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.271</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2016.Q)2</td>
<td align="right">0.872</td>
<td align="right">0.017</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2016.Q)3</td>
<td align="right">0.834</td>
<td align="right">0.002</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2016.Q)4</td>
<td align="right">0.744</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2016.Q)5</td>
<td align="right">0.626</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2016.Q.2 = round(exp(ci.lmm.2$interval), 3),
           vis_minority_2016.Q.3 = round(exp(ci.lmm.3$interval), 3),
           vis_minority_2016.Q.4 = round(exp(ci.lmm.4$interval), 3),
           vis_minority_2016.Q.5 = round(exp(ci.lmm.5$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2016.Q.2</td>
<td align="right">0.779</td>
<td align="right">0.977</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2016.Q.3</td>
<td align="right">0.741</td>
<td align="right">0.938</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2016.Q.4</td>
<td align="right">0.657</td>
<td align="right">0.842</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2016.Q.5</td>
<td align="right">0.545</td>
<td align="right">0.719</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="uc-vs-gentrified-ct-3" class="section level2 tabset"
number="7.3">
<h2 class="tabset"><span class="header-section-number">7.3</span> UC vs
gentrified CT</h2>
<p>No new models here, as <code>gentrified</code> variable is already
used as a pure categorical variable.</p>
</div>
</div>
<div id="association-between-ses-and-urban-interventions-2011-to-2016"
class="section level1" number="8">
<h1><span class="header-section-number">8</span> Association between SES
and Urban Interventions (2011 to 2016)</h1>
<p>Looking at objective #1 | <em>do urban interventions tend to be
located in low SES neighborhoods?</em>. We look at <span
class="math display">\[Urban Intervention_{2011 \to 2016} =
f(SES_{2011})\]</span> as well as <span class="math display">\[Urban
Intervention_{2011 \to 2016} = f(Gentrification_{2011 \to
2016})\]</span></p>
<p>Here <span class="math inline">\(Urban Intervention\)</span> means
the changes in the urban environment features, such as variation of bike
lane length, greenness coverage, etc.</p>
<p>Apparently, change in rates are rather modeled as a pre-post model,
as suggested in <a
href="https://www.researchgate.net/post/Is-there-a-difference-between-ANOVA-analysis-of-change-scores-and-repeated-measures-ANOVA">Jones‚Äôs
answer</a>. Hence, we model change in interventions between 2011 and
2016 as <span class="math display">\[UC_{2016} = \beta_{0} + \beta_{1} *
UC_{2011} + \beta_{2} * SES\]</span></p>
<p>Mostly redundant with multi-level approach below.</p>
<div id="ui-vs-pampalon-material" class="section level2 tabset"
number="8.1">
<h2 class="tabset"><span class="header-section-number">8.1</span> UI vs
Pampalon | material</h2>
<div id="bike-lane-length-change-hurdle" class="section level3"
number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> Bike lane length
change (hurdle)</h3>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial()) #, verbose=c(TRACE=TRUE), init=list(lambda=NaN))
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                             Estimate Cond. SE t-value   p-value
## (Intercept)                                 -5.07923   0.8709 -5.8323 5.468e-09
## wSCOREMAT.2011.Q                             0.04149   0.2112  0.1965 8.442e-01
## Bike_lane.by.street.2011ct                   3.93457   2.5448  1.5461 1.221e-01
## wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct -0.39874   0.5963 -0.6687 5.037e-01
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377279 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  5.688  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                        logLik
## logL       (p_v(h)): -149.363</code></pre>
<pre class="r"><code># ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;wSCOREMAT.2011.Q&#39;) # Not converging
# ci.lmm.zero.i &lt;- confint(res.lmm.zero, &#39;wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct&#39;)

# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                                  lower      upper
## (Intercept)                                 -6.7861243 -3.3723299
## wSCOREMAT.2011.Q                            -0.3724189  0.4554084
## Bike_lane.by.street.2011ct                  -1.0532032  8.9223524
## wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct -1.5674635  0.7699881</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-1.png" /><!-- --></p>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                               Estimate Cond. SE  t-value
## (Intercept)                                 -2.7398548 0.087589 -31.2807
## wSCOREMAT.2011.Q                             0.0085593 0.024482   0.3496
## Bike_lane.by.street.2011ct                   0.0558818 0.004671  11.9646
## wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct -0.0004828 0.001463  -0.3300
##                                             p-value
## (Intercept)                                  0.0000
## wSCOREMAT.2011.Q                             0.7266
## Bike_lane.by.street.2011ct                   0.0000
## wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct  0.7414
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1502797 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1159  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1816.873</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.03957633             0.05672565</code></pre>
<pre class="r"><code>ci.lmm.cnt.i &lt;- confint(res.lmm.cnt, &#39;wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct 
##                                      -0.003370789 
## upper wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct 
##                                       0.002387528</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-2.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
qtl &lt;- c(&quot;#8dd3c7&quot;, &quot;#bebada&quot;, &quot;#fb8072&quot;, &quot;#80b1d3&quot;, &quot;#fdb462&quot;) # Define colors for quintiles

.t &lt;- clean_bei.cnt$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm.cnt))

g_mat_bk.hrdl &lt;- ggplot(.t, aes(y=100*predict/street_length.hm, x=Bike_lane.by.street.2011ct, colour=factor(wSCOREMAT.2011.Q), fill=factor(wSCOREMAT.2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1, linetype=&quot;dashed&quot;) +
  scale_color_manual(values = qtl) +
  scale_fill_manual(values = qtl) +
  labs(colour=&#39;wSCOREMAT.2011.Q&#39;, fill=&#39;wSCOREMAT.2011.Q&#39;)
g_mat_bk.hrdl</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-3.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3944.473</code></pre>
<p>Interpretation of the <code>wSCOREMAT.2011.Q</code> coefficient |
Zero model (not significant): we have <span
class="math inline">\(e^{0.041}\)</span> = 1.042 Interpretation of the
<code>wSCOREMAT.2011.Q</code> coefficient | Count model (not
significant): we have <span class="math inline">\(e^{0.009}\)</span> =
1.009</p>
<p>Coefficient interpretation (marginal + interaction) as relative
risk.</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.006</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">1.042</td>
<td align="right">0.844</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">51.140</td>
<td align="right">0.122</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct</td>
<td align="right">0.671</td>
<td align="right">0.504</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero[c(2,4),] %&gt;% 
  data.frame() %&gt;% 
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.689</td>
<td align="right">1.577</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct</td>
<td align="right">0.209</td>
<td align="right">2.160</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.065</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">1.009</td>
<td align="right">0.727</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.057</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct</td>
<td align="right">1.000</td>
<td align="right">0.741</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm.cnt$interval), 3),
           `wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.961</td>
<td align="right">1.058</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.Bike_lane.by.street.2011ct</td>
<td align="right">0.997</td>
<td align="right">1.002</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change" class="section level3" number="8.1.2">
<h3><span class="header-section-number">8.1.2</span> Greenness
change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                       Estimate  Cond. SE t-value   p-value
## (Intercept)                          -1.498050 0.0442870 -33.826 0.0000000
## wSCOREMAT.2011.Q                     -0.049155 0.0134091  -3.666 0.0002466
## pct_esp_vert_2011ct                   0.016238 0.0007741  20.976 0.0000000
## wSCOREMAT.2011.Q:pct_esp_vert_2011ct  0.001032 0.0002748   3.756 0.0001725
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1349626 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002036  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1892.331</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;wSCOREMAT.2011.Q&quot;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.07558043            -0.02278883</code></pre>
<pre class="r"><code>ci.lmm.i &lt;- confint(res.lmm, &quot;wSCOREMAT.2011.Q:pct_esp_vert_2011ct&quot;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q:pct_esp_vert_2011ct 
##                               0.0004936528 
## upper wSCOREMAT.2011.Q:pct_esp_vert_2011ct 
##                               0.0015736807</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - wSCOREMAT.2011.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df    p_value
## p_v 13.29694  1 0.00026584</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-54-1.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))

g_mat_gr &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_2011ct, colour=factor(wSCOREMAT.2011.Q), fill=factor(wSCOREMAT.2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl) +
  scale_fill_manual(values = qtl) +
  labs(colour=&#39;wSCOREMAT.2011.Q&#39;, fill=&#39;wSCOREMAT.2011.Q&#39;)
g_mat_gr</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-54-2.png" /><!-- --></p>
<p>Interpretation of the <code>wSCOREMAT.2011.Q</code> coefficient
(significant): we have <span class="math inline">\(e^{-0.049}\)</span> =
0.952 (95%CI: 0.927 ‚Äì 0.977)</p>
<p>Coefficient interpretation (marginal + interaction) as relative
risk.</p>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(wSCOREMAT.2011.Q=c(1,3,5))
i_e[&quot;UC2011.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;pct_esp_vert_2011ct&#39;] + i_e[&quot;wSCOREMAT.2011.Q&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;wSCOREMAT.2011.Q:pct_esp_vert_2011ct&#39;]
i_e[&quot;UC2011.relative.risk&quot;] &lt;- exp(i_e[&quot;UC2011.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["wSCOREMAT.2011.Q"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["UC2011.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["UC2011.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0.01727039","3":"1.017420"},{"1":"3","2":"0.01933485","3":"1.019523"},{"1":"5","2":"0.02139931","3":"1.021630"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(pct_esp_vert_2011ct = quantile(clean_bei$df$pct_esp_vert_2011ct)[2:4])
i_e[&quot;SES.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;wSCOREMAT.2011.Q&#39;] + i_e[&quot;pct_esp_vert_2011ct&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;wSCOREMAT.2011.Q:pct_esp_vert_2011ct&#39;]
i_e[&quot;SES.relative.risk&quot;] &lt;- exp(i_e[&quot;SES.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["pct_esp_vert_2011ct"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["SES.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SES.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"24.6","2":"-0.023762380","3":"0.9765177","_rn_":"25%"},{"1":"35.5","2":"-0.012511066","3":"0.9875669","_rn_":"50%"},{"1":"46.5","2":"-0.001156529","3":"0.9988441","_rn_":"75%"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.224</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.952</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.016</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q:pct_esp_vert_2011ct</td>
<td align="right">1.001</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm$interval), 3),
           `wSCOREMAT.2011.Q:pct_esp_vert_2011ct` = round(exp(ci.lmm.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.927</td>
<td align="right">0.977</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.pct_esp_vert_2011ct</td>
<td align="right">1.000</td>
<td align="right">1.002</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change" class="section level3" number="8.1.3">
<h3><span class="header-section-number">8.1.3</span> Canopy (trees)
change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                            Estimate  Cond. SE t-value   p-value
## (Intercept)                               -2.072388 0.0536182 -38.651 0.000e+00
## wSCOREMAT.2011.Q                          -0.122252 0.0167460  -7.300 2.870e-13
## pct_esp_vert_high_2011ct                   0.028081 0.0017552  15.999 0.000e+00
## wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct  0.005601 0.0007134   7.851 4.108e-15
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##    1.rho 
## 0.137914 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.01036  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1729.505</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;wSCOREMAT.2011.Q&quot;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.15514775            -0.08944108</code></pre>
<pre class="r"><code>ci.lmm.i &lt;- confint(res.lmm, &quot;wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct&quot;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct 
##                                     0.004203652 
## upper wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct 
##                                     0.007013851</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - wSCOREMAT.2011.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 51.89085  1 5.867529e-13</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-57-1.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))

g_mat_tc &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_high_2011ct, colour=factor(wSCOREMAT.2011.Q), fill=factor(wSCOREMAT.2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl) +
  scale_fill_manual(values = qtl) +
  labs(colour=&#39;wSCOREMAT.2011.Q&#39;, fill=&#39;wSCOREMAT.2011.Q&#39;)
g_mat_tc</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-57-2.png" /><!-- --></p>
<p>Interpretation of the <code>wSCOREMAT.2011.Q</code> coefficient
(significant): we have <span class="math inline">\(e^{-0.122}\)</span> =
0.885 (95%CI: 0.856 ‚Äì 0.914)</p>
<p>Coefficient interpretation (marginal + interaction) as relative
risk.</p>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(wSCOREMAT.2011.Q=c(1,3,5))
i_e[&quot;UC2011.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;pct_esp_vert_high_2011ct&#39;] + i_e[&quot;wSCOREMAT.2011.Q&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct&#39;]
i_e[&quot;UC2011.relative.risk&quot;] &lt;- exp(i_e[&quot;UC2011.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["wSCOREMAT.2011.Q"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["UC2011.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["UC2011.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0.03368179","3":"1.034255"},{"1":"3","2":"0.04488426","3":"1.045907"},{"1":"5","2":"0.05608673","3":"1.057689"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(pct_esp_vert_high_2011ct = quantile(clean_bei$df$pct_esp_vert_high_2011ct)[2:4])
i_e[&quot;SES.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;wSCOREMAT.2011.Q&#39;] + i_e[&quot;pct_esp_vert_high_2011ct&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct&#39;]
i_e[&quot;SES.relative.risk&quot;] &lt;- exp(i_e[&quot;SES.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["pct_esp_vert_high_2011ct"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["SES.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SES.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"11.8","2":"-0.056157685","3":"0.9453901","_rn_":"25%"},{"1":"16.4","2":"-0.030392004","3":"0.9700652","_rn_":"50%"},{"1":"22.5","2":"0.003775528","3":"1.0037827","_rn_":"75%"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.126</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.885</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.028</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct</td>
<td align="right">1.006</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm$interval), 3),
           `wSCOREMAT.2011.Q:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.856</td>
<td align="right">0.914</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.pct_esp_vert_high_2011ct</td>
<td align="right">1.004</td>
<td align="right">1.007</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-visible-minority" class="section level2 tabset"
number="8.2">
<h2 class="tabset"><span class="header-section-number">8.2</span> UI vs
Visible minority</h2>
<div id="bike-lane-length-change-hurdle-1" class="section level3"
number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Bike lane length
change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                                Estimate Cond. SE t-value
## (Intercept)                                     -3.1413   0.9074 -3.4619
## vis_minority_2011.Q                             -0.4985   0.2297 -2.1705
## Bike_lane.by.street.2011ct                       4.9651   4.2103  1.1793
## vis_minority_2011.Q:Bike_lane.by.street.2011ct  -0.5232   0.9483 -0.5517
##                                                  p-value
## (Intercept)                                    0.0005363
## vis_minority_2011.Q                            0.0299723
## Bike_lane.by.street.2011ct                     0.2382902
## vis_minority_2011.Q:Bike_lane.by.street.2011ct 0.5811218
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1378894 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  6.704  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -145.2196</code></pre>
<pre class="r"><code># ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;vis_minority_2011.Q&#39;)
# ci.lmm.zero.i &lt;- confint(res.lmm.zero, &#39;vis_minority_2011.Q:Bike_lane.by.street.2011ct&#39;)

# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                                    lower       upper
## (Intercept)                                    -4.919709 -1.36284888
## vis_minority_2011.Q                            -0.948703 -0.04834734
## Bike_lane.by.street.2011ct                     -3.286929 13.21703541
## vis_minority_2011.Q:Bike_lane.by.street.2011ct -2.381950  1.33546531</code></pre>
<pre class="r"><code># p-value not far from 0.05, use LRT to refine test
res.lmm.0 &lt;- update(res.lmm.zero, . ~ . - vis_minority_2011.Q)
LRT(res.lmm.0, res.lmm.zero)</code></pre>
<pre><code>##      chi2_LR df  p_value
## p_v 3.924653  1 0.047583</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-2-1.png" /><!-- --></p>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                  Estimate Cond. SE  t-value
## (Intercept)                                    -2.6809663 0.089317 -30.0163
## vis_minority_2011.Q                            -0.0102146 0.025256  -0.4044
## Bike_lane.by.street.2011ct                      0.0555919 0.004831  11.5069
## vis_minority_2011.Q:Bike_lane.by.street.2011ct -0.0003738 0.001539  -0.2429
##                                                p-value
## (Intercept)                                     0.0000
## vis_minority_2011.Q                             0.6859
## Bike_lane.by.street.2011ct                      0.0000
## vis_minority_2011.Q:Bike_lane.by.street.2011ct  0.8081
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1504829 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1157  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1813.753</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;vis_minority_2011.Q&#39;) # Not converging</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.05994319                0.03944469</code></pre>
<pre class="r"><code>ci.lmm.cnt.i &lt;- confint(res.lmm.cnt, &#39;vis_minority_2011.Q:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q:Bike_lane.by.street.2011ct 
##                                         -0.003412284 
## upper vis_minority_2011.Q:Bike_lane.by.street.2011ct 
##                                          0.002644448</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-2-2.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
.t &lt;- clean_bei.cnt$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm.cnt))

g_vis_bk.hrdl &lt;- ggplot(.t, aes(y=100*predict/street_length.hm, x=Bike_lane.by.street.2011ct, colour=factor(vis_minority_2011.Q), fill=factor(vis_minority_2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1, linetype = &quot;dashed&quot;) +
  scale_color_manual(values = qtl) +
  scale_fill_manual(values = qtl) +
  labs(colour=&#39;vis_minority_2011.Q&#39;, fill=&#39;vis_minority_2011.Q&#39;)
g_vis_bk.hrdl</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-2-3.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3929.946</code></pre>
<p>Interpretation of the <code>vis_minority_2011.Q</code> coefficient |
Zero model (not significant): we have <span
class="math inline">\(e^{-0.499}\)</span> = 0.607 Interpretation of the
<code>wSCOREMAT.2011.Q</code> coefficient | Count model (not
significant): we have <span class="math inline">\(e^{-0.01}\)</span> =
0.99</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.043</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.607</td>
<td align="right">0.030</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">143.316</td>
<td align="right">0.238</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q:Bike_lane.by.street.2011ct</td>
<td align="right">0.593</td>
<td align="right">0.581</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero[c(2,4),] %&gt;% 
  data.frame() %&gt;% 
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.387</td>
<td align="right">0.953</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q:Bike_lane.by.street.2011ct</td>
<td align="right">0.092</td>
<td align="right">3.802</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.068</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.990</td>
<td align="right">0.686</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.057</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q:Bike_lane.by.street.2011ct</td>
<td align="right">1.000</td>
<td align="right">0.808</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm.cnt$interval), 3),
           `vis_minority_2011.Q:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.942</td>
<td align="right">1.040</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.Bike_lane.by.street.2011ct</td>
<td align="right">0.997</td>
<td align="right">1.003</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-1" class="section level3" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Greenness
change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ vis_minority_2011.Q * pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ vis_minority_2011.Q * pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ vis_minority_2011.Q * pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                           Estimate  Cond. SE t-value   p-value
## (Intercept)                             -1.5111792 0.0436670 -34.607 0.0000000
## vis_minority_2011.Q                     -0.0445802 0.0131690  -3.385 0.0007112
## pct_esp_vert_2011ct                      0.0166256 0.0007384  22.516 0.0000000
## vis_minority_2011.Q:pct_esp_vert_2011ct  0.0008595 0.0002457   3.498 0.0004681
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1344122 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002115  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                        logLik
## logL       (p_v(h)): -1892.88</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;vis_minority_2011.Q&quot;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.07042887               -0.01869090</code></pre>
<pre class="r"><code>ci.lmm.i &lt;- confint(res.lmm, &quot;vis_minority_2011.Q:pct_esp_vert_2011ct&quot;)</code></pre>
<pre><code>## lower vis_minority_2011.Q:pct_esp_vert_2011ct 
##                                  0.0003778652 
## upper vis_minority_2011.Q:pct_esp_vert_2011ct 
##                                  0.0013461091</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - vis_minority_2011.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df     p_value
## p_v 11.32218  1 0.000765866</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-61-1.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))

g_vis_gr &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_2011ct, colour=factor(vis_minority_2011.Q), fill=factor(vis_minority_2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl) +
  scale_fill_manual(values = qtl) +
  labs(colour=&#39;vis_minority_2011.Q&#39;, fill=&#39;vis_minority_2011.Q&#39;)
g_vis_gr</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-61-2.png" /><!-- --></p>
<p>Interpretation of the <code>vis_minority_2011.Q</code> coefficient
(significant): we have <span class="math inline">\(e^{-0.045}\)</span> =
0.956 (95%CI: 0.932 ‚Äì 0.981)</p>
<p>Coefficient interpretation (marginal + interaction) as relative
risk.</p>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(vis_minority_2011.Q=c(1,3,5))
i_e[&quot;UC2011.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;pct_esp_vert_2011ct&#39;] + i_e[&quot;vis_minority_2011.Q&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;vis_minority_2011.Q:pct_esp_vert_2011ct&#39;]
i_e[&quot;UC2011.relative.risk&quot;] &lt;- exp(i_e[&quot;UC2011.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["vis_minority_2011.Q"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["UC2011.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["UC2011.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0.01748505","3":"1.017639"},{"1":"3","2":"0.01920398","3":"1.019390"},{"1":"5","2":"0.02092292","3":"1.021143"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(pct_esp_vert_2011ct = quantile(clean_bei$df$pct_esp_vert_2011ct)[2:4])
i_e[&quot;SES.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;vis_minority_2011.Q&#39;] + i_e[&quot;pct_esp_vert_2011ct&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;vis_minority_2011.Q:pct_esp_vert_2011ct&#39;]
i_e[&quot;SES.relative.risk&quot;] &lt;- exp(i_e[&quot;SES.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["pct_esp_vert_2011ct"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["SES.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SES.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"24.6","2":"-0.023437320","3":"0.9768352","_rn_":"25%"},{"1":"35.4","2":"-0.014155068","3":"0.9859446","_rn_":"50%"},{"1":"46.5","2":"-0.004614976","3":"0.9953957","_rn_":"75%"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.221</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.956</td>
<td align="right">0.001</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.017</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q:pct_esp_vert_2011ct</td>
<td align="right">1.001</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm$interval), 3),
           `vis_minority_2011.Q:pct_esp_vert_2011ct` = round(exp(ci.lmm.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.932</td>
<td align="right">0.981</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.pct_esp_vert_2011ct</td>
<td align="right">1.000</td>
<td align="right">1.001</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-1" class="section level3" number="8.2.3">
<h3><span class="header-section-number">8.2.3</span> Canopy (trees)
change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ vis_minority_2011.Q * pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ vis_minority_2011.Q * pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ vis_minority_2011.Q * pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                               Estimate Cond. SE t-value
## (Intercept)                                  -2.166921 0.058041 -37.334
## vis_minority_2011.Q                          -0.076255 0.017516  -4.353
## pct_esp_vert_high_2011ct                      0.032033 0.001940  16.514
## vis_minority_2011.Q:pct_esp_vert_high_2011ct  0.003299 0.000672   4.909
##                                                p-value
## (Intercept)                                  0.000e+00
## vis_minority_2011.Q                          1.340e-05
## pct_esp_vert_high_2011ct                     0.000e+00
## vis_minority_2011.Q:pct_esp_vert_high_2011ct 9.151e-07
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1379703 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.01181  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1746.127</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;vis_minority_2011.Q&quot;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.11068404               -0.04187537</code></pre>
<pre class="r"><code>ci.lmm.i &lt;- confint(res.lmm, &quot;vis_minority_2011.Q:pct_esp_vert_high_2011ct&quot;)</code></pre>
<pre><code>## lower vis_minority_2011.Q:pct_esp_vert_high_2011ct 
##                                        0.001981273 
## upper vis_minority_2011.Q:pct_esp_vert_high_2011ct 
##                                        0.004626773</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - vis_minority_2011.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 18.71619  1 1.516891e-05</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-64-1.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))

g_vis_tc &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_high_2011ct, colour=factor(vis_minority_2011.Q), fill=factor(vis_minority_2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl) +
  scale_fill_manual(values = qtl) +
  labs(colour=&#39;vis_minority_2011.Q&#39;, fill=&#39;vis_minority_2011.Q&#39;)
g_vis_tc</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-64-2.png" /><!-- --></p>
<p>Interpretation of the <code>vis_minority_2011.Q</code> coefficient
(significant): we have <span class="math inline">\(e^{-0.076}\)</span> =
0.927 (95%CI: 0.895 ‚Äì 0.959)</p>
<p>Coefficient interpretation (marginal + interaction) as relative
risk.</p>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(vis_minority_2011.Q=c(1,3,5))
i_e[&quot;UC2011.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;pct_esp_vert_high_2011ct&#39;] + i_e[&quot;vis_minority_2011.Q&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;vis_minority_2011.Q:pct_esp_vert_high_2011ct&#39;]
i_e[&quot;UC2011.relative.risk&quot;] &lt;- exp(i_e[&quot;UC2011.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["vis_minority_2011.Q"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["UC2011.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["UC2011.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0.03533207","3":"1.035964"},{"1":"3","2":"0.04192939","3":"1.042821"},{"1":"5","2":"0.04852671","3":"1.049723"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code># Compute combined effects (marginal + interaction) for each quintile of SES:
i_e &lt;- data.frame(pct_esp_vert_high_2011ct = quantile(clean_bei$df$pct_esp_vert_high_2011ct)[2:4])
i_e[&quot;SES.effect&quot;] &lt;- res.lmm[[&quot;fixef&quot;]][&#39;vis_minority_2011.Q&#39;] + i_e[&quot;pct_esp_vert_high_2011ct&quot;] * res.lmm[[&quot;fixef&quot;]][&#39;vis_minority_2011.Q:pct_esp_vert_high_2011ct&#39;]
i_e[&quot;SES.relative.risk&quot;] &lt;- exp(i_e[&quot;SES.effect&quot;])
i_e</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["pct_esp_vert_high_2011ct"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["SES.effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SES.relative.risk"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"11.8","2":"-0.037330942","3":"0.9633573","_rn_":"25%"},{"1":"16.3","2":"-0.022486974","3":"0.9777640","_rn_":"50%"},{"1":"22.5","2":"-0.002035286","3":"0.9979668","_rn_":"75%"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.115</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.927</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.033</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q:pct_esp_vert_high_2011ct</td>
<td align="right">1.003</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm$interval), 3),
           `vis_minority_2011.Q:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.895</td>
<td align="right">0.959</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.pct_esp_vert_high_2011ct</td>
<td align="right">1.002</td>
<td align="right">1.005</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-gentrified-ct" class="section level2 tabset"
number="8.3">
<h2 class="tabset"><span class="header-section-number">8.3</span> UI vs
gentrified CT</h2>
<p>Gentrified CT between 2011 and 2016</p>
<div id="bike-lane-length-change-hurdle-2" class="section level3"
number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Bike lane length
change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                                             Estimate  Cond. SE
## (Intercept)                                                  -4.8802    0.5760
## gentrif_status_2016Gentrified                                 0.1663    0.6454
## gentrif_status_2016Non eligible                              -0.5922    0.7698
## Bike_lane.by.street.2011ct                                  529.6616 9815.2715
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct   -527.8256 9815.2719
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct -526.4878 9815.2718
##                                                             t-value p-value
## (Intercept)                                                -8.47316  0.0000
## gentrif_status_2016Gentrified                               0.25768  0.7967
## gentrif_status_2016Non eligible                            -0.76935  0.4417
## Bike_lane.by.street.2011ct                                  0.05396  0.9570
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct   -0.05378  0.9571
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct -0.05364  0.9572
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1379763 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  6.079  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -142.4839</code></pre>
<pre class="r"><code># NB: not converging
# varfixef.zero &lt;- names(res.lmm.zero[[&#39;fixef&#39;]])
# ci.1.lmm.zero &lt;- confint(res.lmm.zero, varfixef.zero[2])
# ci.2.lmm.zero &lt;- confint(res.lmm.zero, varfixef.zero[3])

# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                                                    lower
## (Intercept)                                                    -6.009097
## gentrif_status_2016Gentrified                                  -1.098692
## gentrif_status_2016Non eligible                                -2.100891
## Bike_lane.by.street.2011ct                                 -18707.917213
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct   -19765.405092
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct -19764.067187
##                                                                    upper
## (Intercept)                                                   -3.7513629
## gentrif_status_2016Gentrified                                  1.4313160
## gentrif_status_2016Non eligible                                0.9164769
## Bike_lane.by.street.2011ct                                 19767.2404085
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct   18709.7539388
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct 18711.0914938</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-0-1.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction || MEANINGLESS
# .t &lt;- clean_bei$df
# .t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm.zero))
# 
# ggplot(.t, aes(y=100*predict/street_length.hm, x=Bike_lane.by.street.2011ct, colour=factor(gentrified_2016_2011), fill=factor(gentrified_2016_2011))) + 
#   geom_smooth(method = &quot;lm&quot;, alpha=.1) +
#   labs(colour=&#39;gentrified_2016_2011&#39;, fill=&#39;gentrified_2016_2011&#39;)

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                             Estimate Cond. SE
## (Intercept)                                                -2.617665 0.060610
## gentrif_status_2016Gentrified                               0.075961 0.079845
## gentrif_status_2016Non eligible                            -0.309834 0.076760
## Bike_lane.by.street.2011ct                                  0.049273 0.003585
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct   -0.003656 0.005041
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct  0.017433 0.004864
##                                                             t-value   p-value
## (Intercept)                                                -43.1888 0.000e+00
## gentrif_status_2016Gentrified                                0.9514 3.414e-01
## gentrif_status_2016Non eligible                             -4.0364 5.428e-05
## Bike_lane.by.street.2011ct                                  13.7426 0.000e+00
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct    -0.7252 4.683e-01
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct   3.5839 3.384e-04
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1502821 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1066  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1801.132</code></pre>
<pre class="r"><code>varfixef.cnt &lt;- names(res.lmm.cnt[[&#39;fixef&#39;]])
ci.1.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                         -0.08145417                          0.23278476</code></pre>
<pre class="r"><code>ci.2.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                            -0.4612937                            -0.1589467</code></pre>
<pre class="r"><code>ci.3.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[5]) # Interaction</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct 
##                                                   -0.013554748 
## upper gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct 
##                                                    0.006278553</code></pre>
<pre class="r"><code>ci.4.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[6]) # Interaction</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct 
##                                                      0.007897442 
## upper gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct 
##                                                      0.027059083</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-0-2.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
.t &lt;- clean_bei.cnt$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm.cnt))

g_gen_bk.hrdl &lt;- ggplot(.t, aes(y=100*predict/street_length.hm, x=Bike_lane.by.street.2011ct, colour=gentrif_status_2016, fill=gentrif_status_2016)) + 
  # geom_point() +
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  labs(colour=&#39;gentrif_status_2016&#39;, fill=&#39;gentrif_status_2016&#39;)
g_gen_bk.hrdl</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-0-3.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3903.232</code></pre>
<p>Interpretation of the <code>gentrif_status_2016</code> coefficient |
Zero model: <em>Not gentrified</em> vs <em>Gentrified</em> not
significant Interpretation of the <code>gentrif_status_2016</code>
coefficient | Count model: idem</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<colgroup>
<col width="72%" />
<col width="17%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">8.000000e-03</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.181000e+00</td>
<td align="right">0.797</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">5.530000e-01</td>
<td align="right">0.442</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.069324e+230</td>
<td align="right">0.957</td>
</tr>
<tr class="odd">
<td
align="left">gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct</td>
<td align="right">0.000000e+00</td>
<td align="right">0.957</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non
eligible:Bike_lane.by.street.2011ct</td>
<td align="right">0.000000e+00</td>
<td align="right">0.957</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero[c(2,3,5,6),] %&gt;% 
  data.frame() %&gt;% 
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<colgroup>
<col width="83%" />
<col width="8%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.333</td>
<td align="right">4.184</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.122</td>
<td align="right">2.500</td>
</tr>
<tr class="odd">
<td
align="left">gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct</td>
<td align="right">0.000</td>
<td align="right">Inf</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non
eligible:Bike_lane.by.street.2011ct</td>
<td align="right">0.000</td>
<td align="right">Inf</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<colgroup>
<col width="80%" />
<col width="8%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.073</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.079</td>
<td align="right">0.341</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.734</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.051</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td
align="left">gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct</td>
<td align="right">0.996</td>
<td align="right">0.468</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non
eligible:Bike_lane.by.street.2011ct</td>
<td align="right">1.018</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.cnt$interval, ci.2.lmm.cnt$interval, ci.3.lmm.cnt$interval, ci.4.lmm.cnt$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = c(varfixef.cnt[2:3], varfixef.cnt[5:6]))
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<colgroup>
<col width="83%" />
<col width="8%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.922</td>
<td align="right">1.262</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.630</td>
<td align="right">0.853</td>
</tr>
<tr class="odd">
<td
align="left">gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct</td>
<td align="right">0.987</td>
<td align="right">1.006</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non
eligible:Bike_lane.by.street.2011ct</td>
<td align="right">1.008</td>
<td align="right">1.027</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-2" class="section level3" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Greenness
change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ gentrif_status_2016 * pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ gentrif_status_2016 * pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ gentrif_status_2016 * pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                       Estimate Cond. SE
## (Intercept)                                         -1.8685995 0.044404
## gentrif_status_2016Gentrified                        0.0254690 0.071685
## gentrif_status_2016Non eligible                      0.3345834 0.051061
## pct_esp_vert_2011ct                                  0.0250277 0.001115
## gentrif_status_2016Gentrified:pct_esp_vert_2011ct   -0.0002392 0.001907
## gentrif_status_2016Non eligible:pct_esp_vert_2011ct -0.0078103 0.001187
##                                                      t-value   p-value
## (Intercept)                                         -42.0815 0.000e+00
## gentrif_status_2016Gentrified                         0.3553 7.224e-01
## gentrif_status_2016Non eligible                       6.5526 5.653e-11
## pct_esp_vert_2011ct                                  22.4459 0.000e+00
## gentrif_status_2016Gentrified:pct_esp_vert_2011ct    -0.1254 9.002e-01
## gentrif_status_2016Non eligible:pct_esp_vert_2011ct  -6.5780 4.769e-11
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1354874 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.001737  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1870.149</code></pre>
<pre class="r"><code>varfixef &lt;- names(res.lmm[[&#39;fixef&#39;]])
ci.1.lmm &lt;- confint(res.lmm, varfixef[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                          -0.1151682                           0.1659180</code></pre>
<pre class="r"><code>ci.2.lmm &lt;- confint(res.lmm, varfixef[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                             0.2344347                             0.4349738</code></pre>
<pre class="r"><code>ci.3.lmm &lt;- confint(res.lmm, varfixef[5]) # Interaction</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified:pct_esp_vert_2011ct 
##                                            -0.003981102 
## upper gentrif_status_2016Gentrified:pct_esp_vert_2011ct 
##                                             0.003496054</code></pre>
<pre class="r"><code>ci.4.lmm &lt;- confint(res.lmm, varfixef[6]) # Interaction</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible:pct_esp_vert_2011ct 
##                                              -0.010141120 
## upper gentrif_status_2016Non eligible:pct_esp_vert_2011ct 
##                                              -0.005482627</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - gentrif_status_2016)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df     p_value
## p_v 52.99543  2 3.10596e-12</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-68-1.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))

g_gen_gr &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_2011ct, colour=factor(gentrif_status_2016), fill=factor(gentrif_status_2016))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  labs(colour=&#39;gentrif_status_2016&#39;, fill=&#39;gentrif_status_2016&#39;)
g_gen_gr</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-68-2.png" /><!-- --></p>
<p>Interpretation of the <code>gentrif_status_2016</code> coefficient:
<em>Gentrified</em> vs <em>Not gentrified</em> not significant for main
and interaction terms</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.154</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.026</td>
<td align="right">0.722</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.397</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.025</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified:pct_esp_vert_2011ct</td>
<td align="right">1.000</td>
<td align="right">0.900</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non
eligible:pct_esp_vert_2011ct</td>
<td align="right">0.992</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm$interval, ci.2.lmm$interval, ci.3.lmm$interval, ci.4.lmm$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = c(varfixef[2:3], varfixef[5:6]))
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.891</td>
<td align="right">1.180</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.264</td>
<td align="right">1.545</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified:pct_esp_vert_2011ct</td>
<td align="right">0.996</td>
<td align="right">1.004</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non
eligible:pct_esp_vert_2011ct</td>
<td align="right">0.990</td>
<td align="right">0.995</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-2" class="section level3" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Canopy (trees)
change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ gentrif_status_2016 * pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ gentrif_status_2016 * pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ gentrif_status_2016 * pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                           Estimate Cond. SE
## (Intercept)                                              -2.676737 0.055544
## gentrif_status_2016Gentrified                             0.098183 0.083628
## gentrif_status_2016Non eligible                           0.359658 0.060765
## pct_esp_vert_high_2011ct                                  0.057789 0.002788
## gentrif_status_2016Gentrified:pct_esp_vert_high_2011ct   -0.004519 0.004292
## gentrif_status_2016Non eligible:pct_esp_vert_high_2011ct -0.020183 0.002914
##                                                          t-value   p-value
## (Intercept)                                              -48.192 0.000e+00
## gentrif_status_2016Gentrified                              1.174 2.404e-01
## gentrif_status_2016Non eligible                            5.919 3.242e-09
## pct_esp_vert_high_2011ct                                  20.727 0.000e+00
## gentrif_status_2016Gentrified:pct_esp_vert_high_2011ct    -1.053 2.923e-01
## gentrif_status_2016Non eligible:pct_esp_vert_high_2011ct  -6.925 4.357e-12
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1381568 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.009658  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1728.153</code></pre>
<pre class="r"><code>varfixef &lt;- names(res.lmm[[&#39;fixef&#39;]])
ci.1.lmm &lt;- confint(res.lmm, varfixef[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                         -0.06627735                          0.26181849</code></pre>
<pre class="r"><code>ci.2.lmm &lt;- confint(res.lmm, varfixef[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                             0.2399986                             0.4790137</code></pre>
<pre class="r"><code>ci.3.lmm &lt;- confint(res.lmm, varfixef[5]) # Interaction</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified:pct_esp_vert_high_2011ct 
##                                                 -0.012930470 
## upper gentrif_status_2016Gentrified:pct_esp_vert_high_2011ct 
##                                                  0.003900121</code></pre>
<pre class="r"><code>ci.4.lmm &lt;- confint(res.lmm, varfixef[6]) # Interaction</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible:pct_esp_vert_high_2011ct 
##                                                    -0.02589034 
## upper gentrif_status_2016Non eligible:pct_esp_vert_high_2011ct 
##                                                    -0.01443352</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - gentrif_status_2016)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 38.79234  2 3.770078e-09</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-70-1.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))

g_gen_tc &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_high_2011ct, colour=factor(gentrif_status_2016), fill=factor(gentrif_status_2016))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  labs(colour=&#39;gentrif_status_2016&#39;, fill=&#39;gentrif_status_2016&#39;)
g_gen_tc</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-70-2.png" /><!-- --></p>
<p>Interpretation of the <code>gentrif_status_2016</code> coefficient:
<em>Gentrified</em> vs <em>Not gentrified</em> not significant for main
and interaction terms</p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<colgroup>
<col width="80%" />
<col width="8%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.069</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.103</td>
<td align="right">0.240</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.433</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.059</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td
align="left">gentrif_status_2016Gentrified:pct_esp_vert_high_2011ct</td>
<td align="right">0.995</td>
<td align="right">0.292</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non
eligible:pct_esp_vert_high_2011ct</td>
<td align="right">0.980</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm$interval, ci.2.lmm$interval, ci.3.lmm$interval, ci.4.lmm$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = c(varfixef[2:3], varfixef[5:6]))
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<colgroup>
<col width="82%" />
<col width="8%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.936</td>
<td align="right">1.299</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.271</td>
<td align="right">1.614</td>
</tr>
<tr class="odd">
<td
align="left">gentrif_status_2016Gentrified:pct_esp_vert_high_2011ct</td>
<td align="right">0.987</td>
<td align="right">1.004</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non
eligible:pct_esp_vert_high_2011ct</td>
<td align="right">0.974</td>
<td align="right">0.986</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="association-between-ses-and-ui-ses-as-categories"
class="section level1" number="9">
<h1><span class="header-section-number">9</span> Association between SES
and UI | SES as categories</h1>
<p>Following Yan and Behzad‚Äôs request, the exact same models as above
are run, this time using SES quintiles as categories instead of ordinal
values.</p>
<div id="ui-vs-pampalon-material-1" class="section level2 tabset"
number="9.1">
<h2 class="tabset"><span class="header-section-number">9.1</span> UI vs
Pampalon | material</h2>
<div id="bike-lane-length-change-hurdle-3" class="section level3"
number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Bike lane length
change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ factor(wSCOREMAT.2011.Q) * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ factor(wSCOREMAT.2011.Q) * 
##     Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                                       Estimate  Cond. SE
## (Intercept)                                            -16.483 7.180e+00
## factor(wSCOREMAT.2011.Q)2                                5.201 8.214e+00
## factor(wSCOREMAT.2011.Q)3                               17.903 9.130e+00
## factor(wSCOREMAT.2011.Q)4                                2.931 8.945e+00
## factor(wSCOREMAT.2011.Q)5                                1.451 8.323e+00
## Bike_lane.by.street.2011ct                             168.423 2.158e+03
## factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct  -155.627 2.158e+03
## factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct 56236.419 4.760e+05
## factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct   841.898 3.062e+04
## factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct  -155.071 2.158e+03
##                                                       t-value p-value
## (Intercept)                                          -2.29558 0.02170
## factor(wSCOREMAT.2011.Q)2                             0.63316 0.52663
## factor(wSCOREMAT.2011.Q)3                             1.96094 0.04989
## factor(wSCOREMAT.2011.Q)4                             0.32768 0.74315
## factor(wSCOREMAT.2011.Q)5                             0.17433 0.86161
## Bike_lane.by.street.2011ct                            0.07805 0.93779
## factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct -0.07212 0.94251
## factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct  0.11816 0.90594
## factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct  0.02749 0.97807
## factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct -0.07186 0.94271
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1078022 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  498  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -143.1668
## linear predictor estimation did not converge; increase &#39;control.HLfit$max.iter.mean&#39; above 200</code></pre>
<pre class="r"><code># Not converging...
# ci.lmm.zero.2 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)2&#39;)
# ci.lmm.zero.3 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)3&#39;)
# ci.lmm.zero.4 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)4&#39;)
# ci.lmm.zero.5 &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)5&#39;)
# ci.lmm.zero.2.i &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct&#39;)
# ci.lmm.zero.3.i &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct&#39;)
# ci.lmm.zero.4.i &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct&#39;)
# ci.lmm.zero.5.i &lt;- confint(res.lmm.zero, &#39;factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct&#39;)

# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                                              lower
## (Intercept)                                          -3.055615e+01
## factor(wSCOREMAT.2011.Q)2                            -1.089895e+01
## factor(wSCOREMAT.2011.Q)3                             8.901569e-03
## factor(wSCOREMAT.2011.Q)4                            -1.460124e+01
## factor(wSCOREMAT.2011.Q)5                            -1.486250e+01
## Bike_lane.by.street.2011ct                           -4.061065e+03
## factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct -4.385193e+03
## factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct -8.766095e+05
## factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct -5.917831e+04
## factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct -4.384575e+03
##                                                              upper
## (Intercept)                                              -2.409851
## factor(wSCOREMAT.2011.Q)2                                21.300974
## factor(wSCOREMAT.2011.Q)3                                35.796957
## factor(wSCOREMAT.2011.Q)4                                20.463609
## factor(wSCOREMAT.2011.Q)5                                17.764523
## Bike_lane.by.street.2011ct                             4397.911820
## factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct   4073.939045
## factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct 989082.306917
## factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct  60862.105457
## factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct   4074.433660</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-c-1.png" /><!-- --></p>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ factor(wSCOREMAT.2011.Q) * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ factor(wSCOREMAT.2011.Q) * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                        Estimate Cond. SE
## (Intercept)                                          -2.6530976 0.079798
## factor(wSCOREMAT.2011.Q)2                            -0.0476478 0.097618
## factor(wSCOREMAT.2011.Q)3                            -0.2787912 0.103109
## factor(wSCOREMAT.2011.Q)4                            -0.1176220 0.103883
## factor(wSCOREMAT.2011.Q)5                             0.0906718 0.106665
## Bike_lane.by.street.2011ct                            0.0513281 0.004010
## factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct  0.0001476 0.005746
## factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct  0.0205741 0.006444
## factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct  0.0051395 0.006053
## factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct -0.0070841 0.006645
##                                                        t-value  p-value
## (Intercept)                                          -33.24763 0.000000
## factor(wSCOREMAT.2011.Q)2                             -0.48811 0.625475
## factor(wSCOREMAT.2011.Q)3                             -2.70385 0.006854
## factor(wSCOREMAT.2011.Q)4                             -1.13226 0.257526
## factor(wSCOREMAT.2011.Q)5                              0.85006 0.395290
## Bike_lane.by.street.2011ct                            12.80005 0.000000
## factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct   0.02569 0.979502
## factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct   3.19275 0.001409
## factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct   0.84907 0.395841
## factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct  -1.06606 0.286396
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1503834 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1098  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1807.782</code></pre>
<pre class="r"><code>ci.lmm.cnt.2 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2 upper factor(wSCOREMAT.2011.Q)2 
##                      -0.2395054                       0.1445945</code></pre>
<pre class="r"><code>ci.lmm.cnt.3 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3 upper factor(wSCOREMAT.2011.Q)3 
##                     -0.48169049                     -0.07601927</code></pre>
<pre class="r"><code>ci.lmm.cnt.4 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4 upper factor(wSCOREMAT.2011.Q)4 
##                     -0.32219660                      0.08648441</code></pre>
<pre class="r"><code>ci.lmm.cnt.5 &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5 upper factor(wSCOREMAT.2011.Q)5 
##                      -0.1190407                       0.3005133</code></pre>
<pre class="r"><code>ci.lmm.cnt.2.i &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct 
##                                                -0.01118639 
## upper factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct 
##                                                 0.01143479</code></pre>
<pre class="r"><code>ci.lmm.cnt.3.i &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct 
##                                                0.007897454 
## upper factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct 
##                                                0.033255825</code></pre>
<pre class="r"><code>ci.lmm.cnt.4.i &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct 
##                                               -0.006763394 
## upper factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct 
##                                                0.017055012</code></pre>
<pre class="r"><code>ci.lmm.cnt.5.i &lt;- confint(res.lmm.cnt, &#39;factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct 
##                                               -0.020247629 
## upper factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct 
##                                                0.005898912</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-c-2.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
.t &lt;- clean_bei.cnt$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm.cnt))
.t &lt;- filter(.t, wSCOREMAT.2011.Q %in% c(1, 3)) # Keeping only significant interaction terms

g_mat_bk.hrdl.categ &lt;- ggplot(.t, aes(y=100*predict/street_length.hm, x=Bike_lane.by.street.2011ct, colour=factor(wSCOREMAT.2011.Q), fill=factor(wSCOREMAT.2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl[c(1, 3)]) +
  scale_fill_manual(values = qtl[c(1, 3)]) +
  labs(colour=&#39;wSCOREMAT.2011.Q&#39;, fill=&#39;wSCOREMAT.2011.Q&#39;)
g_mat_bk.hrdl.categ</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-c-3.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3925.897</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<colgroup>
<col width="71%" />
<col width="17%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.000000e+00</td>
<td align="right">0.022</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">1.814560e+02</td>
<td align="right">0.527</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">5.958588e+07</td>
<td align="right">0.050</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">1.875000e+01</td>
<td align="right">0.743</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">4.267000e+00</td>
<td align="right">0.862</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.397593e+73</td>
<td align="right">0.938</td>
</tr>
<tr class="odd">
<td
align="left">factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct</td>
<td align="right">0.000000e+00</td>
<td align="right">0.943</td>
</tr>
<tr class="even">
<td
align="left">factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct</td>
<td align="right">Inf</td>
<td align="right">0.906</td>
</tr>
<tr class="odd">
<td
align="left">factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct</td>
<td align="right">Inf</td>
<td align="right">0.978</td>
</tr>
<tr class="even">
<td
align="left">factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct</td>
<td align="right">0.000000e+00</td>
<td align="right">0.943</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.070</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.953</td>
<td align="right">0.625</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.757</td>
<td align="right">0.007</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.889</td>
<td align="right">0.258</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">1.095</td>
<td align="right">0.395</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.053</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td
align="left">factor(wSCOREMAT.2011.Q)2:Bike_lane.by.street.2011ct</td>
<td align="right">1.000</td>
<td align="right">0.980</td>
</tr>
<tr class="even">
<td
align="left">factor(wSCOREMAT.2011.Q)3:Bike_lane.by.street.2011ct</td>
<td align="right">1.021</td>
<td align="right">0.001</td>
</tr>
<tr class="odd">
<td
align="left">factor(wSCOREMAT.2011.Q)4:Bike_lane.by.street.2011ct</td>
<td align="right">1.005</td>
<td align="right">0.396</td>
</tr>
<tr class="even">
<td
align="left">factor(wSCOREMAT.2011.Q)5:Bike_lane.by.street.2011ct</td>
<td align="right">0.993</td>
<td align="right">0.286</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q.2 = round(exp(ci.lmm.cnt.2$interval), 3),
           wSCOREMAT.2011.Q.3 = round(exp(ci.lmm.cnt.3$interval), 3),
           wSCOREMAT.2011.Q.4 = round(exp(ci.lmm.cnt.4$interval), 3),
           wSCOREMAT.2011.Q.5 = round(exp(ci.lmm.cnt.5$interval), 3),
           `wSCOREMAT.2011.Q.2:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.2.i$interval), 3),
           `wSCOREMAT.2011.Q.3:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.3.i$interval), 3),
           `wSCOREMAT.2011.Q.4:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.4.i$interval), 3),
           `wSCOREMAT.2011.Q.5:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.5.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2</td>
<td align="right">0.787</td>
<td align="right">1.156</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3</td>
<td align="right">0.618</td>
<td align="right">0.927</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4</td>
<td align="right">0.725</td>
<td align="right">1.090</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5</td>
<td align="right">0.888</td>
<td align="right">1.351</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2.Bike_lane.by.street.2011ct</td>
<td align="right">0.989</td>
<td align="right">1.012</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3.Bike_lane.by.street.2011ct</td>
<td align="right">1.008</td>
<td align="right">1.034</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4.Bike_lane.by.street.2011ct</td>
<td align="right">0.993</td>
<td align="right">1.017</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5.Bike_lane.by.street.2011ct</td>
<td align="right">0.980</td>
<td align="right">1.006</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-3" class="section level3" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> Greenness
change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ factor(wSCOREMAT.2011.Q)* pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ factor(wSCOREMAT.2011.Q) * pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                 Estimate  Cond. SE  t-value
## (Intercept)                                   -1.5735884 0.0426297 -36.9130
## factor(wSCOREMAT.2011.Q)2                     -0.0322855 0.0560597  -0.5759
## factor(wSCOREMAT.2011.Q)3                     -0.0088856 0.0576215  -0.1542
## factor(wSCOREMAT.2011.Q)4                     -0.0836334 0.0635746  -1.3155
## factor(wSCOREMAT.2011.Q)5                     -0.4068993 0.0790521  -5.1472
## pct_esp_vert_2011ct                            0.0177927 0.0006874  25.8849
## factor(wSCOREMAT.2011.Q)2:pct_esp_vert_2011ct  0.0006060 0.0009295   0.6520
## factor(wSCOREMAT.2011.Q)3:pct_esp_vert_2011ct  0.0002387 0.0009717   0.2457
## factor(wSCOREMAT.2011.Q)4:pct_esp_vert_2011ct  0.0019576 0.0012456   1.5716
## factor(wSCOREMAT.2011.Q)5:pct_esp_vert_2011ct  0.0111026 0.0021491   5.1662
##                                                 p-value
## (Intercept)                                   0.000e+00
## factor(wSCOREMAT.2011.Q)2                     5.647e-01
## factor(wSCOREMAT.2011.Q)3                     8.774e-01
## factor(wSCOREMAT.2011.Q)4                     1.883e-01
## factor(wSCOREMAT.2011.Q)5                     2.644e-07
## pct_esp_vert_2011ct                           0.000e+00
## factor(wSCOREMAT.2011.Q)2:pct_esp_vert_2011ct 5.144e-01
## factor(wSCOREMAT.2011.Q)3:pct_esp_vert_2011ct 8.059e-01
## factor(wSCOREMAT.2011.Q)4:pct_esp_vert_2011ct 1.160e-01
## factor(wSCOREMAT.2011.Q)5:pct_esp_vert_2011ct 2.389e-07
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##    1.rho 
## 0.135745 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.001909  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1882.725</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2 upper factor(wSCOREMAT.2011.Q)2 
##                     -0.14232696                      0.07780193</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3 upper factor(wSCOREMAT.2011.Q)3 
##                      -0.1221221                       0.1043164</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4 upper factor(wSCOREMAT.2011.Q)4 
##                     -0.20886313                      0.04177754</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5 upper factor(wSCOREMAT.2011.Q)5 
##                      -0.5626444                      -0.2516544</code></pre>
<pre class="r"><code>ci.lmm.2.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)2:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2:pct_esp_vert_2011ct 
##                                        -0.001222176 
## upper factor(wSCOREMAT.2011.Q)2:pct_esp_vert_2011ct 
##                                         0.002430290</code></pre>
<pre class="r"><code>ci.lmm.3.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)3:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3:pct_esp_vert_2011ct 
##                                        -0.001672635 
## upper factor(wSCOREMAT.2011.Q)3:pct_esp_vert_2011ct 
##                                         0.002145888</code></pre>
<pre class="r"><code>ci.lmm.4.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)4:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4:pct_esp_vert_2011ct 
##                                        -0.000493686 
## upper factor(wSCOREMAT.2011.Q)4:pct_esp_vert_2011ct 
##                                         0.004403640</code></pre>
<pre class="r"><code>ci.lmm.5.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)5:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5:pct_esp_vert_2011ct 
##                                         0.006886857 
## upper factor(wSCOREMAT.2011.Q)5:pct_esp_vert_2011ct 
##                                         0.015320786</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(wSCOREMAT.2011.Q))
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##     chi2_LR df      p_value
## p_v 31.4152  4 2.518781e-06</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-73-1.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))
.t &lt;- filter(.t, wSCOREMAT.2011.Q %in% c(1, 4, 5)) # Keeping only significant interaction terms

g_mat_gr.categ &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_2011ct, colour=factor(wSCOREMAT.2011.Q), fill=factor(wSCOREMAT.2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl[c(1, 4, 5)]) +
  scale_fill_manual(values = qtl[c(1, 4, 5)]) +
  labs(colour=&#39;wSCOREMAT.2011.Q&#39;, fill=&#39;wSCOREMAT.2011.Q&#39;)
g_mat_gr.categ</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-73-2.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.207</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.968</td>
<td align="right">0.565</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.991</td>
<td align="right">0.877</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.920</td>
<td align="right">0.188</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.666</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.018</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)2:pct_esp_vert_2011ct</td>
<td align="right">1.001</td>
<td align="right">0.514</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)3:pct_esp_vert_2011ct</td>
<td align="right">1.000</td>
<td align="right">0.806</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)4:pct_esp_vert_2011ct</td>
<td align="right">1.002</td>
<td align="right">0.116</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)5:pct_esp_vert_2011ct</td>
<td align="right">1.011</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code># LRT of main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(wSCOREMAT.2011.Q))</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre><code>## If the &#39;RSpectra&#39; package were installed, an extreme eigenvalue computation could be faster.</code></pre>
<pre class="r"><code>LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##     chi2_LR df      p_value
## p_v 31.4152  4 2.518781e-06</code></pre>
<pre class="r"><code># CI
data.frame(wSCOREMAT.2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           wSCOREMAT.2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           wSCOREMAT.2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           wSCOREMAT.2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           `wSCOREMAT.2011.Q.2:pct_esp_vert_2011ct` = round(exp(ci.lmm.2.i$interval), 3),
           `wSCOREMAT.2011.Q.3:pct_esp_vert_2011ct` = round(exp(ci.lmm.3.i$interval), 3),
           `wSCOREMAT.2011.Q.4:pct_esp_vert_2011ct` = round(exp(ci.lmm.4.i$interval), 3),
           `wSCOREMAT.2011.Q.5:pct_esp_vert_2011ct` = round(exp(ci.lmm.5.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2</td>
<td align="right">0.867</td>
<td align="right">1.081</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3</td>
<td align="right">0.885</td>
<td align="right">1.110</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4</td>
<td align="right">0.812</td>
<td align="right">1.043</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5</td>
<td align="right">0.570</td>
<td align="right">0.778</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2.pct_esp_vert_2011ct</td>
<td align="right">0.999</td>
<td align="right">1.002</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3.pct_esp_vert_2011ct</td>
<td align="right">0.998</td>
<td align="right">1.002</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4.pct_esp_vert_2011ct</td>
<td align="right">1.000</td>
<td align="right">1.004</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5.pct_esp_vert_2011ct</td>
<td align="right">1.007</td>
<td align="right">1.015</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-3" class="section level3" number="9.1.3">
<h3><span class="header-section-number">9.1.3</span> Canopy (trees)
change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ wSCOREMAT.2011.Q * pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ factor(wSCOREMAT.2011.Q) * pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ factor(wSCOREMAT.2011.Q) * pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                     Estimate Cond. SE t-value
## (Intercept)                                        -2.178717 0.048382 -45.032
## factor(wSCOREMAT.2011.Q)2                          -0.175408 0.065599  -2.674
## factor(wSCOREMAT.2011.Q)3                          -0.208580 0.068404  -3.049
## factor(wSCOREMAT.2011.Q)4                          -0.346805 0.073626  -4.710
## factor(wSCOREMAT.2011.Q)5                          -0.770442 0.091522  -8.418
## pct_esp_vert_high_2011ct                            0.033510 0.001367  24.510
## factor(wSCOREMAT.2011.Q)2:pct_esp_vert_high_2011ct  0.007049 0.002179   3.236
## factor(wSCOREMAT.2011.Q)3:pct_esp_vert_high_2011ct  0.007039 0.002433   2.893
## factor(wSCOREMAT.2011.Q)4:pct_esp_vert_high_2011ct  0.015787 0.003052   5.172
## factor(wSCOREMAT.2011.Q)5:pct_esp_vert_high_2011ct  0.043246 0.005403   8.004
##                                                      p-value
## (Intercept)                                        0.000e+00
## factor(wSCOREMAT.2011.Q)2                          7.496e-03
## factor(wSCOREMAT.2011.Q)3                          2.294e-03
## factor(wSCOREMAT.2011.Q)4                          2.473e-06
## factor(wSCOREMAT.2011.Q)5                          0.000e+00
## pct_esp_vert_high_2011ct                           0.000e+00
## factor(wSCOREMAT.2011.Q)2:pct_esp_vert_high_2011ct 1.213e-03
## factor(wSCOREMAT.2011.Q)3:pct_esp_vert_high_2011ct 3.812e-03
## factor(wSCOREMAT.2011.Q)4:pct_esp_vert_high_2011ct 2.310e-07
## factor(wSCOREMAT.2011.Q)5:pct_esp_vert_high_2011ct 1.221e-15
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1380071 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.008885  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1717.103</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2 upper factor(wSCOREMAT.2011.Q)2 
##                     -0.30426404                     -0.04677546</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3 upper factor(wSCOREMAT.2011.Q)3 
##                     -0.34270904                     -0.07404558</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4 upper factor(wSCOREMAT.2011.Q)4 
##                      -0.4911884                      -0.2022148</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5 upper factor(wSCOREMAT.2011.Q)5 
##                      -0.9503425                      -0.5903152</code></pre>
<pre class="r"><code>ci.lmm.2.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)2:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)2:pct_esp_vert_high_2011ct 
##                                              0.002780478 
## upper factor(wSCOREMAT.2011.Q)2:pct_esp_vert_high_2011ct 
##                                              0.011350195</code></pre>
<pre class="r"><code>ci.lmm.3.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)3:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)3:pct_esp_vert_high_2011ct 
##                                              0.002265316 
## upper factor(wSCOREMAT.2011.Q)3:pct_esp_vert_high_2011ct 
##                                              0.011835143</code></pre>
<pre class="r"><code>ci.lmm.4.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)4:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)4:pct_esp_vert_high_2011ct 
##                                               0.00978752 
## upper factor(wSCOREMAT.2011.Q)4:pct_esp_vert_high_2011ct 
##                                               0.02176672</code></pre>
<pre class="r"><code>ci.lmm.5.i &lt;- confint(res.lmm, &#39;factor(wSCOREMAT.2011.Q)5:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(wSCOREMAT.2011.Q)5:pct_esp_vert_high_2011ct 
##                                               0.03257925 
## upper factor(wSCOREMAT.2011.Q)5:pct_esp_vert_high_2011ct 
##                                               0.05380575</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(wSCOREMAT.2011.Q))
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 72.03801  4 8.437695e-15</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-75-1.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))

g_mat_tc.categ &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_high_2011ct, colour=factor(wSCOREMAT.2011.Q), fill=factor(wSCOREMAT.2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl) +
  scale_fill_manual(values = qtl) +
  labs(colour=&#39;wSCOREMAT.2011.Q&#39;, fill=&#39;wSCOREMAT.2011.Q&#39;)
g_mat_tc.categ</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-75-2.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.113</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.839</td>
<td align="right">0.007</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.812</td>
<td align="right">0.002</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.707</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.463</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.034</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)2:pct_esp_vert_high_2011ct</td>
<td align="right">1.007</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)3:pct_esp_vert_high_2011ct</td>
<td align="right">1.007</td>
<td align="right">0.004</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)4:pct_esp_vert_high_2011ct</td>
<td align="right">1.016</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)5:pct_esp_vert_high_2011ct</td>
<td align="right">1.044</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code># LRT of main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(wSCOREMAT.2011.Q))</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre class="r"><code>LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 72.03801  4 8.437695e-15</code></pre>
<pre class="r"><code># CI
data.frame(wSCOREMAT.2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           wSCOREMAT.2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           wSCOREMAT.2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           wSCOREMAT.2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           `wSCOREMAT.2011.Q.2:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.2.i$interval), 3),
           `wSCOREMAT.2011.Q.3:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.3.i$interval), 3),
           `wSCOREMAT.2011.Q.4:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.4.i$interval), 3),
           `wSCOREMAT.2011.Q.5:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.5.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2</td>
<td align="right">0.738</td>
<td align="right">0.954</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3</td>
<td align="right">0.710</td>
<td align="right">0.929</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4</td>
<td align="right">0.612</td>
<td align="right">0.817</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5</td>
<td align="right">0.387</td>
<td align="right">0.554</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.2.pct_esp_vert_high_2011ct</td>
<td align="right">1.003</td>
<td align="right">1.011</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.3.pct_esp_vert_high_2011ct</td>
<td align="right">1.002</td>
<td align="right">1.012</td>
</tr>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q.4.pct_esp_vert_high_2011ct</td>
<td align="right">1.010</td>
<td align="right">1.022</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q.5.pct_esp_vert_high_2011ct</td>
<td align="right">1.033</td>
<td align="right">1.055</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-visible-minority-1" class="section level2 tabset"
number="9.2">
<h2 class="tabset"><span class="header-section-number">9.2</span> UI vs
Visible minority</h2>
<div id="bike-lane-length-change-hurdle-4" class="section level3"
number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> Bike lane length
change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ factor(vis_minority_2011.Q) * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial(), 
                 init=list(lambda=NaN)) # Outer optimization not working, forcing inner iterative solving...
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ factor(vis_minority_2011.Q) * 
##     Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of lambda and corrPars by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                                          Estimate Cond. SE
## (Intercept)                                              -4.03121   0.4151
## factor(vis_minority_2011.Q)2                              0.49245   0.6069
## factor(vis_minority_2011.Q)3                              0.08307   0.5586
## factor(vis_minority_2011.Q)4                             -1.21989   0.6146
## factor(vis_minority_2011.Q)5                             -1.36352   0.5304
## Bike_lane.by.street.2011ct                               27.43237  65.5769
## factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct 183.00464 593.7771
## factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct -26.29922  65.5808
## factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct 241.46726 515.0612
## factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct -26.18221  65.5785
##                                                         t-value p-value
## (Intercept)                                             -9.7112 0.00000
## factor(vis_minority_2011.Q)2                             0.8115 0.41710
## factor(vis_minority_2011.Q)3                             0.1487 0.88178
## factor(vis_minority_2011.Q)4                            -1.9847 0.04718
## factor(vis_minority_2011.Q)5                            -2.5709 0.01014
## Bike_lane.by.street.2011ct                               0.4183 0.67571
## factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct  0.3082 0.75793
## factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct -0.4010 0.68841
## factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct  0.4688 0.63920
## factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct -0.3992 0.68971
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1017696 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.46  
##              --- Coefficients for log(lambda):
##  Group        Term Estimate Cond.SE
##  ct_no (Intercept)   0.3788  0.2124
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -149.7761
## lambda leverages numerically 1 were replaced by 1- 1e-16 (as controlled by option &#39;regul_lev_lambda&#39;) 
## Estimates did not converge; increase control.HLfit&#39;s &#39;max.iter&#39; above 200 (see help(&#39;control.HLfit&#39;) for details).</code></pre>
<pre class="r"><code># Not converging...
# ci.lmm.zero.2 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)2&#39;)
# ci.lmm.zero.3 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)3&#39;)
# ci.lmm.zero.4 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)4&#39;)
# ci.lmm.zero.5 &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)5&#39;)
# ci.lmm.zero.2.i &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct&#39;)
# ci.lmm.zero.3.i &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct&#39;)
# ci.lmm.zero.4.i &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct&#39;)
# ci.lmm.zero.5.i &lt;- confint(res.lmm.zero, &#39;factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct&#39;)

# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                                                lower
## (Intercept)                                               -4.8448055
## factor(vis_minority_2011.Q)2                              -0.6969807
## factor(vis_minority_2011.Q)3                              -1.0117421
## factor(vis_minority_2011.Q)4                              -2.4245573
## factor(vis_minority_2011.Q)5                              -2.4030200
## Bike_lane.by.street.2011ct                              -101.0960324
## factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct -980.7770294
## factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct -154.8352497
## factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct -768.0340895
## factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct -154.7138061
##                                                                 upper
## (Intercept)                                               -3.21760575
## factor(vis_minority_2011.Q)2                               1.68187532
## factor(vis_minority_2011.Q)3                               1.17788175
## factor(vis_minority_2011.Q)4                              -0.01521942
## factor(vis_minority_2011.Q)5                              -0.32402160
## Bike_lane.by.street.2011ct                               155.96077711
## factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct 1346.78630390
## factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct  102.23681873
## factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct 1250.96861348
## factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct  102.34938275</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.zero, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-2c-1.png" /><!-- --></p>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ factor(vis_minority_2011.Q) * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ factor(vis_minority_2011.Q) * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                          Estimate Cond. SE
## (Intercept)                                             -2.649646 0.081505
## factor(vis_minority_2011.Q)2                            -0.078942 0.098767
## factor(vis_minority_2011.Q)3                            -0.056722 0.103763
## factor(vis_minority_2011.Q)4                            -0.224426 0.107144
## factor(vis_minority_2011.Q)5                             0.019550 0.110105
## Bike_lane.by.street.2011ct                               0.052566 0.004523
## factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct  0.003060 0.005958
## factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct  0.002600 0.006880
## factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct  0.012985 0.006902
## factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct -0.007357 0.007015
##                                                          t-value p-value
## (Intercept)                                             -32.5091 0.00000
## factor(vis_minority_2011.Q)2                             -0.7993 0.42413
## factor(vis_minority_2011.Q)3                             -0.5466 0.58462
## factor(vis_minority_2011.Q)4                             -2.0946 0.03620
## factor(vis_minority_2011.Q)5                              0.1776 0.85907
## Bike_lane.by.street.2011ct                               11.6222 0.00000
## factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct   0.5137 0.60750
## factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct   0.3779 0.70551
## factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct   1.8813 0.05993
## factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct  -1.0487 0.29430
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##    1.rho 
## 0.150484 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1137  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1809.391</code></pre>
<pre class="r"><code>ci.lmm.cnt.2 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2 upper factor(vis_minority_2011.Q)2 
##                         -0.2734080                          0.1152141</code></pre>
<pre class="r"><code>ci.lmm.cnt.3 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3 upper factor(vis_minority_2011.Q)3 
##                         -0.2610830                          0.1472212</code></pre>
<pre class="r"><code>ci.lmm.cnt.4 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4 upper factor(vis_minority_2011.Q)4 
##                        -0.43590616                        -0.01402546</code></pre>
<pre class="r"><code>ci.lmm.cnt.5 &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5 upper factor(vis_minority_2011.Q)5 
##                         -0.1971876                          0.2360893</code></pre>
<pre class="r"><code>ci.lmm.cnt.2.i &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct 
##                                                  -0.008659156 
## upper factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct 
##                                                   0.014789833</code></pre>
<pre class="r"><code>ci.lmm.cnt.3.i &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct 
##                                                   -0.01092843 
## upper factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct 
##                                                    0.01614586</code></pre>
<pre class="r"><code>ci.lmm.cnt.4.i &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct 
##                                                 -0.0005690632 
## upper factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct 
##                                                  0.0266062522</code></pre>
<pre class="r"><code>ci.lmm.cnt.5.i &lt;- confint(res.lmm.cnt, &#39;factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct 
##                                                  -0.021248713 
## upper factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct 
##                                                   0.006356913</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm.cnt, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-2c-2.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
.t &lt;- clean_bei.cnt$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm.cnt))
.t &lt;- filter(.t, vis_minority_2011.Q %in% c(1, 4)) # Keeping only significant interaction terms

g_vis_bk.hrdl.categ &lt;- ggplot(.t, aes(y=100*predict/street_length.hm, x=Bike_lane.by.street.2011ct, colour=factor(vis_minority_2011.Q), fill=factor(vis_minority_2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl[c(1, 4)]) +
  scale_fill_manual(values = qtl[c(1, 4)]) +
  labs(colour=&#39;vis_minority_2011.Q&#39;, fill=&#39;vis_minority_2011.Q&#39;)
g_vis_bk.hrdl.categ</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/test-hurdle-2c-3.png" /><!-- --></p>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3942.335</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<colgroup>
<col width="71%" />
<col width="17%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">1.800000e-02</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">1.636000e+00</td>
<td align="right">0.417</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">1.087000e+00</td>
<td align="right">0.882</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">2.950000e-01</td>
<td align="right">0.047</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">2.560000e-01</td>
<td align="right">0.010</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">8.198378e+11</td>
<td align="right">0.676</td>
</tr>
<tr class="odd">
<td
align="left">factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct</td>
<td align="right">3.005413e+79</td>
<td align="right">0.758</td>
</tr>
<tr class="even">
<td
align="left">factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct</td>
<td align="right">0.000000e+00</td>
<td align="right">0.688</td>
</tr>
<tr class="odd">
<td
align="left">factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct</td>
<td align="right">7.377334e+104</td>
<td align="right">0.639</td>
</tr>
<tr class="even">
<td
align="left">factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct</td>
<td align="right">0.000000e+00</td>
<td align="right">0.690</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<colgroup>
<col width="80%" />
<col width="8%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.071</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">0.924</td>
<td align="right">0.424</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">0.945</td>
<td align="right">0.585</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.799</td>
<td align="right">0.036</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">1.020</td>
<td align="right">0.859</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.054</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td
align="left">factor(vis_minority_2011.Q)2:Bike_lane.by.street.2011ct</td>
<td align="right">1.003</td>
<td align="right">0.607</td>
</tr>
<tr class="even">
<td
align="left">factor(vis_minority_2011.Q)3:Bike_lane.by.street.2011ct</td>
<td align="right">1.003</td>
<td align="right">0.706</td>
</tr>
<tr class="odd">
<td
align="left">factor(vis_minority_2011.Q)4:Bike_lane.by.street.2011ct</td>
<td align="right">1.013</td>
<td align="right">0.060</td>
</tr>
<tr class="even">
<td
align="left">factor(vis_minority_2011.Q)5:Bike_lane.by.street.2011ct</td>
<td align="right">0.993</td>
<td align="right">0.294</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q.2 = round(exp(ci.lmm.cnt.2$interval), 3),
           vis_minority_2011.Q.3 = round(exp(ci.lmm.cnt.3$interval), 3),
           vis_minority_2011.Q.4 = round(exp(ci.lmm.cnt.4$interval), 3),
           vis_minority_2011.Q.5 = round(exp(ci.lmm.cnt.5$interval), 3),
           `vis_minority_2011.Q.2:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.2.i$interval), 3),
           `vis_minority_2011.Q.3:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.3.i$interval), 3),
           `vis_minority_2011.Q.4:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.4.i$interval), 3),
           `vis_minority_2011.Q.5:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.cnt.5.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2</td>
<td align="right">0.761</td>
<td align="right">1.122</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3</td>
<td align="right">0.770</td>
<td align="right">1.159</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4</td>
<td align="right">0.647</td>
<td align="right">0.986</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5</td>
<td align="right">0.821</td>
<td align="right">1.266</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2.Bike_lane.by.street.2011ct</td>
<td align="right">0.991</td>
<td align="right">1.015</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3.Bike_lane.by.street.2011ct</td>
<td align="right">0.989</td>
<td align="right">1.016</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4.Bike_lane.by.street.2011ct</td>
<td align="right">0.999</td>
<td align="right">1.027</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5.Bike_lane.by.street.2011ct</td>
<td align="right">0.979</td>
<td align="right">1.006</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-4" class="section level3" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> Greenness
change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ vis_minority_2011.Q * pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ factor(vis_minority_2011.Q) * pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ factor(vis_minority_2011.Q) * pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                    Estimate  Cond. SE  t-value
## (Intercept)                                      -1.5641341 0.0422445 -37.0258
## factor(vis_minority_2011.Q)2                     -0.0548760 0.0559928  -0.9801
## factor(vis_minority_2011.Q)3                     -0.0572034 0.0641486  -0.8917
## factor(vis_minority_2011.Q)4                     -0.0810112 0.0558706  -1.4500
## factor(vis_minority_2011.Q)5                     -0.2437760 0.0632134  -3.8564
## pct_esp_vert_2011ct                               0.0176047 0.0006826  25.7925
## factor(vis_minority_2011.Q)2:pct_esp_vert_2011ct  0.0009851 0.0009238   1.0664
## factor(vis_minority_2011.Q)3:pct_esp_vert_2011ct  0.0014117 0.0012208   1.1564
## factor(vis_minority_2011.Q)4:pct_esp_vert_2011ct  0.0014061 0.0009762   1.4404
## factor(vis_minority_2011.Q)5:pct_esp_vert_2011ct  0.0051993 0.0012986   4.0038
##                                                    p-value
## (Intercept)                                      0.000e+00
## factor(vis_minority_2011.Q)2                     3.271e-01
## factor(vis_minority_2011.Q)3                     3.725e-01
## factor(vis_minority_2011.Q)4                     1.471e-01
## factor(vis_minority_2011.Q)5                     1.151e-04
## pct_esp_vert_2011ct                              0.000e+00
## factor(vis_minority_2011.Q)2:pct_esp_vert_2011ct 2.863e-01
## factor(vis_minority_2011.Q)3:pct_esp_vert_2011ct 2.475e-01
## factor(vis_minority_2011.Q)4:pct_esp_vert_2011ct 1.497e-01
## factor(vis_minority_2011.Q)5:pct_esp_vert_2011ct 6.233e-05
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1345657 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002057  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1889.365</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2 upper factor(vis_minority_2011.Q)2 
##                        -0.16461043                         0.05568929</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3 upper factor(vis_minority_2011.Q)3 
##                         -0.1831642                          0.0693866</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4 upper factor(vis_minority_2011.Q)4 
##                        -0.19064003                         0.02960391</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5 upper factor(vis_minority_2011.Q)5 
##                         -0.3677580                         -0.1195351</code></pre>
<pre class="r"><code>ci.lmm.2.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)2:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2:pct_esp_vert_2011ct 
##                                          -0.0008399776 
## upper factor(vis_minority_2011.Q)2:pct_esp_vert_2011ct 
##                                           0.0027952612</code></pre>
<pre class="r"><code>ci.lmm.3.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)3:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3:pct_esp_vert_2011ct 
##                                           -0.000991913 
## upper factor(vis_minority_2011.Q)3:pct_esp_vert_2011ct 
##                                            0.003807898</code></pre>
<pre class="r"><code>ci.lmm.4.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)4:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4:pct_esp_vert_2011ct 
##                                          -0.0005154984 
## upper factor(vis_minority_2011.Q)4:pct_esp_vert_2011ct 
##                                           0.0033230989</code></pre>
<pre class="r"><code>ci.lmm.5.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)5:pct_esp_vert_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5:pct_esp_vert_2011ct 
##                                            0.002653799 
## upper factor(vis_minority_2011.Q)5:pct_esp_vert_2011ct 
##                                            0.007760336</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(vis_minority_2011.Q))
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df     p_value
## p_v 16.07472  4 0.002920527</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-78-1.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))
.t &lt;- filter(.t, vis_minority_2011.Q %in% c(1, 2, 3, 4, 5)) # Keeping only significant interaction terms (all significant)

g_vis_gr.categ &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_2011ct, colour=factor(vis_minority_2011.Q), fill=factor(vis_minority_2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl[c(1, 2, 3, 4, 5)]) +
  scale_fill_manual(values = qtl[c(1, 2, 3, 4, 5)]) +
  labs(colour=&#39;vis_minority_2011.Q&#39;, fill=&#39;vis_minority_2011.Q&#39;)
g_vis_gr.categ</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-78-2.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.209</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">0.947</td>
<td align="right">0.327</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">0.944</td>
<td align="right">0.373</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.922</td>
<td align="right">0.147</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.784</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.018</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)2:pct_esp_vert_2011ct</td>
<td align="right">1.001</td>
<td align="right">0.286</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)3:pct_esp_vert_2011ct</td>
<td align="right">1.001</td>
<td align="right">0.248</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)4:pct_esp_vert_2011ct</td>
<td align="right">1.001</td>
<td align="right">0.150</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)5:pct_esp_vert_2011ct</td>
<td align="right">1.005</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code># LRT of main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(vis_minority_2011.Q))</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre class="r"><code>LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df     p_value
## p_v 16.07472  4 0.002920527</code></pre>
<pre class="r"><code># CI
data.frame(vis_minority_2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           vis_minority_2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           vis_minority_2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           vis_minority_2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           `vis_minority_2011.Q.2:pct_esp_vert_2011ct` = round(exp(ci.lmm.2.i$interval), 3),
           `vis_minority_2011.Q.3:pct_esp_vert_2011ct` = round(exp(ci.lmm.3.i$interval), 3),
           `vis_minority_2011.Q.4:pct_esp_vert_2011ct` = round(exp(ci.lmm.4.i$interval), 3),
           `vis_minority_2011.Q.5:pct_esp_vert_2011ct` = round(exp(ci.lmm.5.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2</td>
<td align="right">0.848</td>
<td align="right">1.057</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3</td>
<td align="right">0.833</td>
<td align="right">1.072</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4</td>
<td align="right">0.826</td>
<td align="right">1.030</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5</td>
<td align="right">0.692</td>
<td align="right">0.887</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2.pct_esp_vert_2011ct</td>
<td align="right">0.999</td>
<td align="right">1.003</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3.pct_esp_vert_2011ct</td>
<td align="right">0.999</td>
<td align="right">1.004</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4.pct_esp_vert_2011ct</td>
<td align="right">0.999</td>
<td align="right">1.003</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5.pct_esp_vert_2011ct</td>
<td align="right">1.003</td>
<td align="right">1.008</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-4" class="section level3" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> Canopy (trees)
change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ vis_minority_2011.Q * pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ factor(vis_minority_2011.Q) * pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ factor(vis_minority_2011.Q) * pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                        Estimate Cond. SE
## (Intercept)                                           -2.268054 0.053294
## factor(vis_minority_2011.Q)2                          -0.089607 0.068156
## factor(vis_minority_2011.Q)3                           0.037427 0.071195
## factor(vis_minority_2011.Q)4                          -0.264702 0.069932
## factor(vis_minority_2011.Q)5                          -0.345748 0.080989
## pct_esp_vert_high_2011ct                               0.036459 0.001653
## factor(vis_minority_2011.Q)2:pct_esp_vert_high_2011ct  0.002923 0.002281
## factor(vis_minority_2011.Q)3:pct_esp_vert_high_2011ct -0.001599 0.002657
## factor(vis_minority_2011.Q)4:pct_esp_vert_high_2011ct  0.010308 0.002581
## factor(vis_minority_2011.Q)5:pct_esp_vert_high_2011ct  0.016413 0.003426
##                                                        t-value   p-value
## (Intercept)                                           -42.5576 0.000e+00
## factor(vis_minority_2011.Q)2                           -1.3147 1.886e-01
## factor(vis_minority_2011.Q)3                            0.5257 5.991e-01
## factor(vis_minority_2011.Q)4                           -3.7851 1.536e-04
## factor(vis_minority_2011.Q)5                           -4.2691 1.963e-05
## pct_esp_vert_high_2011ct                               22.0546 0.000e+00
## factor(vis_minority_2011.Q)2:pct_esp_vert_high_2011ct   1.2815 2.000e-01
## factor(vis_minority_2011.Q)3:pct_esp_vert_high_2011ct  -0.6019 5.472e-01
## factor(vis_minority_2011.Q)4:pct_esp_vert_high_2011ct   3.9945 6.482e-05
## factor(vis_minority_2011.Q)5:pct_esp_vert_high_2011ct   4.7911 1.659e-06
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1380284 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.0105  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1737.259</code></pre>
<pre class="r"><code>ci.lmm.2 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)2&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2 upper factor(vis_minority_2011.Q)2 
##                        -0.22331594                         0.04414993</code></pre>
<pre class="r"><code>ci.lmm.3 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)3&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3 upper factor(vis_minority_2011.Q)3 
##                         -0.1024562                          0.1771123</code></pre>
<pre class="r"><code>ci.lmm.4 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)4&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4 upper factor(vis_minority_2011.Q)4 
##                         -0.4018329                         -0.1268827</code></pre>
<pre class="r"><code>ci.lmm.5 &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)5&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5 upper factor(vis_minority_2011.Q)5 
##                         -0.5047667                         -0.1869938</code></pre>
<pre class="r"><code>ci.lmm.2.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)2:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)2:pct_esp_vert_high_2011ct 
##                                                 -0.00155326 
## upper factor(vis_minority_2011.Q)2:pct_esp_vert_high_2011ct 
##                                                  0.00741236</code></pre>
<pre class="r"><code>ci.lmm.3.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)3:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)3:pct_esp_vert_high_2011ct 
##                                                -0.006814108 
## upper factor(vis_minority_2011.Q)3:pct_esp_vert_high_2011ct 
##                                                 0.003635254</code></pre>
<pre class="r"><code>ci.lmm.4.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)4:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)4:pct_esp_vert_high_2011ct 
##                                                 0.005238727 
## upper factor(vis_minority_2011.Q)4:pct_esp_vert_high_2011ct 
##                                                 0.015391462</code></pre>
<pre class="r"><code>ci.lmm.5.i &lt;- confint(res.lmm, &#39;factor(vis_minority_2011.Q)5:pct_esp_vert_high_2011ct&#39;)</code></pre>
<pre><code>## lower factor(vis_minority_2011.Q)5:pct_esp_vert_high_2011ct 
##                                                 0.009689296 
## upper factor(vis_minority_2011.Q)5:pct_esp_vert_high_2011ct 
##                                                 0.023137153</code></pre>
<pre class="r"><code># Testing main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(vis_minority_2011.Q))
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 35.80911  4 3.167508e-07</code></pre>
<pre class="r"><code>if (plot.resid) {
  simout &lt;- simulateResiduals(fittedModel = res.lmm, plot = F)
  plot(simout)
}</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-80-1.png" /><!-- --></p>
<pre class="r"><code># Plotting interaction
.t &lt;- clean_bei$df
.t[&quot;predict&quot;] &lt;- as.vector(predict(res.lmm))
.t &lt;- filter(.t, vis_minority_2011.Q %in% c(1, 2, 5)) # Keeping only significant interaction terms

g_vis_tc.categ &lt;- ggplot(.t, aes(y=100*predict/ct_area_hct, x=pct_esp_vert_high_2011ct, colour=factor(vis_minority_2011.Q), fill=factor(vis_minority_2011.Q))) + 
  geom_smooth(method = &quot;lm&quot;, alpha=.1) +
  scale_color_manual(values = qtl[c(1, 4, 5)]) +
  scale_fill_manual(values = qtl[c(1, 4, 5)]) +
  labs(colour=&#39;vis_minority_2011.Q&#39;, fill=&#39;vis_minority_2011.Q&#39;)
g_vis_tc.categ</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-80-2.png" /><!-- --></p>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.104</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">0.914</td>
<td align="right">0.189</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">1.038</td>
<td align="right">0.599</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.767</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.708</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.037</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td
align="left">factor(vis_minority_2011.Q)2:pct_esp_vert_high_2011ct</td>
<td align="right">1.003</td>
<td align="right">0.200</td>
</tr>
<tr class="even">
<td
align="left">factor(vis_minority_2011.Q)3:pct_esp_vert_high_2011ct</td>
<td align="right">0.998</td>
<td align="right">0.547</td>
</tr>
<tr class="odd">
<td
align="left">factor(vis_minority_2011.Q)4:pct_esp_vert_high_2011ct</td>
<td align="right">1.010</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td
align="left">factor(vis_minority_2011.Q)5:pct_esp_vert_high_2011ct</td>
<td align="right">1.017</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code># LRT of main effect
res.lmm.0 &lt;- update(res.lmm, . ~ . - factor(vis_minority_2011.Q))</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre class="r"><code>LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##      chi2_LR df      p_value
## p_v 35.80911  4 3.167508e-07</code></pre>
<pre class="r"><code># CI
data.frame(vis_minority_2011.Q.2 = round(exp(ci.lmm.2$interval), 3),
           vis_minority_2011.Q.3 = round(exp(ci.lmm.3$interval), 3),
           vis_minority_2011.Q.4 = round(exp(ci.lmm.4$interval), 3),
           vis_minority_2011.Q.5 = round(exp(ci.lmm.5$interval), 3),
           `vis_minority_2011.Q.2:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.2.i$interval), 3),
           `vis_minority_2011.Q.3:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.3.i$interval), 3),
           `vis_minority_2011.Q.4:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.4.i$interval), 3),
           `vis_minority_2011.Q.5:pct_esp_vert_high_2011ct` = round(exp(ci.lmm.5.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2</td>
<td align="right">0.800</td>
<td align="right">1.045</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3</td>
<td align="right">0.903</td>
<td align="right">1.194</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4</td>
<td align="right">0.669</td>
<td align="right">0.881</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5</td>
<td align="right">0.604</td>
<td align="right">0.829</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.2.pct_esp_vert_high_2011ct</td>
<td align="right">0.998</td>
<td align="right">1.007</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.3.pct_esp_vert_high_2011ct</td>
<td align="right">0.993</td>
<td align="right">1.004</td>
</tr>
<tr class="odd">
<td align="left">vis_minority_2011.Q.4.pct_esp_vert_high_2011ct</td>
<td align="right">1.005</td>
<td align="right">1.016</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q.5.pct_esp_vert_high_2011ct</td>
<td align="right">1.010</td>
<td align="right">1.023</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-gentrified-ct-1" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> UI vs gentrified
CT</h2>
<p>No new models here, as <code>gentrified</code> variable is already
used as a pure categorical variable.</p>
</div>
</div>
<div id="association-between-ses-and-ui-main-effect-no-interaction"
class="section level1" number="10">
<h1><span class="header-section-number">10</span> Association between
SES and UI | Main effect, no interaction</h1>
<p>As discussed with Yan and Behzad, we rerun the UI models, without the
interaction term <span class="math inline">\(SES \times
UC_{2011}\)</span></p>
<div id="ui-vs-pampalon-material-2" class="section level2 tabset"
number="10.1">
<h2 class="tabset"><span class="header-section-number">10.1</span> UI vs
Pampalon | material</h2>
<div id="bike-lane-length-change-hurdle-5" class="section level3"
number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> Bike lane length
change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q + Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ wSCOREMAT.2011.Q + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                  data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ wSCOREMAT.2011.Q + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                             Estimate Cond. SE  t-value   p-value
## (Intercept)                -4.906789   0.8597 -5.70724 1.148e-08
## wSCOREMAT.2011.Q           -0.005991   0.2083 -0.02875 9.771e-01
## Bike_lane.by.street.2011ct  2.496219   0.6977  3.57772 3.466e-04
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377135 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  5.772  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -149.7328</code></pre>
<pre class="r"><code># ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;wSCOREMAT.2011.Q&#39;) # Not converging
# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                 lower      upper
## (Intercept)                -6.5918648 -3.2217139
## wSCOREMAT.2011.Q           -0.4143297  0.4023487
## Bike_lane.by.street.2011ct  1.1287296  3.8637093</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                             Estimate Cond. SE  t-value p-value
## (Intercept)                -2.722506 0.070049 -38.8656  0.0000
## wSCOREMAT.2011.Q            0.002719 0.016920   0.1607  0.8723
## Bike_lane.by.street.2011ct  0.054524 0.002209  24.6837  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1502777 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1159  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1816.928</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.03059490             0.03598532</code></pre>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3943.321</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.007</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.994</td>
<td align="right">0.977</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">12.137</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero %&gt;% 
  data.frame() %&gt;% 
  slice(2) %&gt;%
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.661</td>
<td align="right">1.495</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.066</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">1.003</td>
<td align="right">0.872</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.056</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm.cnt$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.97</td>
<td align="right">1.037</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-5" class="section level3" number="10.1.2">
<h3><span class="header-section-number">10.1.2</span> Greenness
change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ wSCOREMAT.2011.Q + pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ wSCOREMAT.2011.Q + pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ wSCOREMAT.2011.Q + pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                      Estimate  Cond. SE  t-value p-value
## (Intercept)         -1.622719 0.0303317 -53.4992  0.0000
## wSCOREMAT.2011.Q    -0.002903 0.0053591  -0.5417  0.5881
## pct_esp_vert_2011ct  0.018799 0.0003916  48.0014  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1345859 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002185  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1899.339</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;wSCOREMAT.2011.Q&quot;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##           -0.013557419            0.007725433</code></pre>
<pre class="r"><code># Wald-test p-value for wSCOREMAT.2011.Q close to threshold, using LRT to improve accuracy
res.lmm.0 &lt;- update(res.lmm, . ~ . -wSCOREMAT.2011.Q)
LRT(res.lmm.0, res.lmm)</code></pre>
<pre><code>##       chi2_LR df   p_value
## p_v 0.2863924  1 0.5925417</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.197</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.997</td>
<td align="right">0.588</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.019</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.987</td>
<td align="right">1.008</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-5" class="section level3" number="10.1.3">
<h3><span class="header-section-number">10.1.3</span> Canopy (trees)
change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ wSCOREMAT.2011.Q + pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ wSCOREMAT.2011.Q + pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ wSCOREMAT.2011.Q + pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                          Estimate Cond. SE t-value p-value
## (Intercept)              -2.33139 0.044977 -51.835  0.0000
## wSCOREMAT.2011.Q         -0.01165 0.009365  -1.244  0.2136
## pct_esp_vert_high_2011ct  0.03993 0.001018  39.225  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1378725 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.01264  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1759.457</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;wSCOREMAT.2011.Q&quot;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##           -0.030003749            0.006781971</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.097</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.988</td>
<td align="right">0.214</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.041</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wSCOREMAT.2011.Q</td>
<td align="right">0.97</td>
<td align="right">1.007</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-visible-minority-2" class="section level2 tabset"
number="10.2">
<h2 class="tabset"><span class="header-section-number">10.2</span> UI vs
Visible minority</h2>
<div id="bike-lane-length-change-hurdle-6" class="section level3"
number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Bike lane length
change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q + Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ vis_minority_2011.Q + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ vis_minority_2011.Q + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                            Estimate Cond. SE t-value  p-value
## (Intercept)                 -2.9916   0.9255  -3.232 0.001227
## vis_minority_2011.Q         -0.5414   0.2350  -2.303 0.021253
## Bike_lane.by.street.2011ct   2.8972   0.8300   3.491 0.000482
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1378848 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  7.162  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -145.4916</code></pre>
<pre class="r"><code># ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;vis_minority_2011.Q&#39;) # Not converging
# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                               lower       upper
## (Intercept)                -4.80556 -1.17771579
## vis_minority_2011.Q        -1.00202 -0.08072928
## Bike_lane.by.street.2011ct  1.27042  4.52402891</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                            Estimate Cond. SE  t-value p-value
## (Intercept)                -2.66800 0.071599 -37.2630  0.0000
## vis_minority_2011.Q        -0.01460 0.017654  -0.8272  0.4081
## Bike_lane.by.street.2011ct  0.05455 0.002242  24.3299  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1504809 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1157  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1813.783</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.04943779                0.02007654</code></pre>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3928.549</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.050</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.582</td>
<td align="right">0.021</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">18.124</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero %&gt;% 
  data.frame() %&gt;% 
  slice(2) %&gt;%
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.367</td>
<td align="right">0.922</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.069</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.986</td>
<td align="right">0.408</td>
</tr>
<tr class="odd">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.056</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm.cnt$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.952</td>
<td align="right">1.02</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-6" class="section level3" number="10.2.2">
<h3><span class="header-section-number">10.2.2</span> Greenness
change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ vis_minority_2011.Q + pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ vis_minority_2011.Q + pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ vis_minority_2011.Q + pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                      Estimate  Cond. SE  t-value p-value
## (Intercept)         -1.630217 0.0282565 -57.6936  0.0000
## vis_minority_2011.Q -0.001778 0.0050107  -0.3548  0.7227
## pct_esp_vert_2011ct  0.018876 0.0003778  49.9585  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1352612 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002193  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1898.979</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;vis_minority_2011.Q&quot;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##              -0.011608925               0.008189943</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.196</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.998</td>
<td align="right">0.723</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.019</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.988</td>
<td align="right">1.008</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-6" class="section level3" number="10.2.3">
<h3><span class="header-section-number">10.2.3</span> Canopy (trees)
change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ vis_minority_2011.Q + pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ vis_minority_2011.Q + pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ vis_minority_2011.Q + pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                           Estimate  Cond. SE t-value p-value
## (Intercept)              -2.368415 0.0425083 -55.716  0.0000
## vis_minority_2011.Q      -0.002105 0.0090337  -0.233  0.8158
## pct_esp_vert_high_2011ct  0.040422 0.0009895  40.850  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1380839 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.01276  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1758.026</code></pre>
<pre class="r"><code>ci.lmm &lt;- confint(res.lmm, &quot;vis_minority_2011.Q&quot;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.01982851                0.01565770</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.094</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.998</td>
<td align="right">0.816</td>
</tr>
<tr class="odd">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.041</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vis_minority_2011.Q</td>
<td align="right">0.98</td>
<td align="right">1.016</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-gentrified-ct-2" class="section level2 tabset"
number="10.3">
<h2 class="tabset"><span class="header-section-number">10.3</span> UI vs
gentrified CT</h2>
<p>Gentrified CT between 2011 and 2016</p>
<div id="bike-lane-length-change-hurdle-7" class="section level3"
number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> Bike lane length
change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ gentrif_status_2016 + Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ gentrif_status_2016 + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ gentrif_status_2016 + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE t-value   p-value
## (Intercept)                      -4.4608   0.5702 -7.8231 5.107e-15
## gentrif_status_2016Gentrified    -0.3921   0.6452 -0.6077 5.434e-01
## gentrif_status_2016Non eligible  -0.9083   0.7571 -1.1998 2.302e-01
## Bike_lane.by.street.2011ct        2.8642   0.7980  3.5894 3.315e-04
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1380079 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  6.455  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -147.1315</code></pre>
<pre class="r"><code># NB: not converging
# varfixef.zero &lt;- names(res.lmm.zero[[&#39;fixef&#39;]])
# ci.1.lmm.zero &lt;- confint(res.lmm.zero, varfixef.zero[2])
# ci.2.lmm.zero &lt;- confint(res.lmm.zero, varfixef.zero[3])
# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                     lower      upper
## (Intercept)                     -5.578455 -3.3432414
## gentrif_status_2016Gentrified   -1.656717  0.8725468
## gentrif_status_2016Non eligible -2.392228  0.5755491
## Bike_lane.by.street.2011ct       1.300214  4.4281772</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ gentrif_status_2016 + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ gentrif_status_2016 + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE  t-value p-value
## (Intercept)                     -2.67951  0.05235 -51.1890 0.00000
## gentrif_status_2016Gentrified    0.02021  0.05293   0.3819 0.70253
## gentrif_status_2016Non eligible -0.09996  0.05202  -1.9214 0.05468
## Bike_lane.by.street.2011ct       0.05481  0.00221  24.8031 0.00000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1503184 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1135  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1811.428</code></pre>
<pre class="r"><code>varfixef.cnt &lt;- names(res.lmm.cnt[[&#39;fixef&#39;]])
ci.1.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                          -0.0841205                           0.1243222</code></pre>
<pre class="r"><code>ci.2.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                          -0.202529320                           0.002429003</code></pre>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3929.12</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.012</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.676</td>
<td align="right">0.543</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.403</td>
<td align="right">0.230</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">17.535</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero %&gt;% 
  data.frame() %&gt;% 
  slice(2) %&gt;%
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)</code></pre>
<table>
<caption>Zero model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.191</td>
<td align="right">2.393</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.069</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.020</td>
<td align="right">0.703</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.905</td>
<td align="right">0.055</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.056</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.cnt$interval, ci.2.lmm.cnt$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef.cnt[2:3])
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Count model confidence interval&quot;)</code></pre>
<table>
<caption>Count model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.919</td>
<td align="right">1.132</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.817</td>
<td align="right">1.002</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-7" class="section level3" number="10.3.2">
<h3><span class="header-section-number">10.3.2</span> Greenness
change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ gentrif_status_2016 + pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ gentrif_status_2016 + pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ gentrif_status_2016 + pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                  Estimate  Cond. SE  t-value p-value
## (Intercept)                     -1.637763 0.0222381 -73.6466  0.0000
## gentrif_status_2016Gentrified    0.003574 0.0216208   0.1653  0.8687
## gentrif_status_2016Non eligible  0.010172 0.0180015   0.5651  0.5720
## pct_esp_vert_2011ct              0.018792 0.0004276  43.9433  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1354899 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002185  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1898.879</code></pre>
<pre class="r"><code>varfixef &lt;- names(res.lmm[[&#39;fixef&#39;]])
ci.1.lmm &lt;- confint(res.lmm, varfixef[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                         -0.03886172                          0.04589248</code></pre>
<pre class="r"><code>ci.2.lmm &lt;- confint(res.lmm, varfixef[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                           -0.02532631                            0.04554155</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.194</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.004</td>
<td align="right">0.869</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">1.010</td>
<td align="right">0.572</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.019</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm$interval, ci.2.lmm$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef[2:3])
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.962</td>
<td align="right">1.047</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.975</td>
<td align="right">1.047</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-7" class="section level3" number="10.3.3">
<h3><span class="header-section-number">10.3.3</span> Canopy (trees)
change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ gentrif_status_2016 + pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ gentrif_status_2016 + pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ gentrif_status_2016 + pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE  t-value p-value
## (Intercept)                     -2.37842 0.031676 -75.0859  0.0000
## gentrif_status_2016Gentrified    0.02462 0.033736   0.7298  0.4655
## gentrif_status_2016Non eligible -0.02071 0.028880  -0.7171  0.4733
## pct_esp_vert_high_2011ct         0.04091 0.000996  41.0757  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1380259 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.01266  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1757.065</code></pre>
<pre class="r"><code>varfixef &lt;- names(res.lmm[[&#39;fixef&#39;]])
ci.1.lmm &lt;- confint(res.lmm, varfixef[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                         -0.04175084                          0.09068032</code></pre>
<pre class="r"><code>ci.2.lmm &lt;- confint(res.lmm, varfixef[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                           -0.07739748                            0.03596469</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.093</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">1.025</td>
<td align="right">0.466</td>
</tr>
<tr class="odd">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.980</td>
<td align="right">0.473</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.042</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm$interval, ci.2.lmm$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef[2:3])
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Model confidence interval&quot;)</code></pre>
<table>
<caption>Model confidence interval</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gentrif_status_2016Gentrified</td>
<td align="right">0.959</td>
<td align="right">1.095</td>
</tr>
<tr class="even">
<td align="left">gentrif_status_2016Non eligible</td>
<td align="right">0.926</td>
<td align="right">1.037</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div
id="association-between-ses-and-ui-main-effect-no-interaction-ses-as-categories"
class="section level1" number="11">
<h1><span class="header-section-number">11</span> Association between
SES and UI | Main effect, no interaction, SES as categories</h1>
<p>As discussed with Yan and Behzad, we rerun the UI models, without the
interaction term <span class="math inline">\(SES \times
UC_{2011}\)</span>, SES as categories instead of continuous</p>
<div id="ui-vs-pampalon-material-3" class="section level2 tabset"
number="11.1">
<h2 class="tabset"><span class="header-section-number">11.1</span> UI vs
Pampalon | material</h2>
<div id="bike-lane-length-change-hurdle-8" class="section level3"
number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> Bike lane length
change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ factor(wSCOREMAT.2011.Q) + Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ factor(wSCOREMAT.2011.Q) + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ factor(wSCOREMAT.2011.Q) + 
##     Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                            Estimate Cond. SE t-value p-value
## (Intercept)                -14.3794    8.735 -1.6463 0.09971
## factor(wSCOREMAT.2011.Q)2   16.1506    9.929  1.6267 0.10380
## factor(wSCOREMAT.2011.Q)3   14.6687   10.294  1.4250 0.15417
## factor(wSCOREMAT.2011.Q)4    4.3183    9.986  0.4324 0.66544
## factor(wSCOREMAT.2011.Q)5   -0.9537    9.489 -0.1005 0.91994
## Bike_lane.by.street.2011ct  16.7156    7.414  2.2547 0.02415
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1340855 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  569.9  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -142.6482
## linear predictor estimation did not converge; increase &#39;control.HLfit$max.iter.mean&#39; above 200</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ factor(wSCOREMAT.2011.Q) + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ factor(wSCOREMAT.2011.Q) + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                            Estimate Cond. SE  t-value p-value
## (Intercept)                -2.69690 0.064285 -41.9520  0.0000
## factor(wSCOREMAT.2011.Q)2  -0.03216 0.062899  -0.5113  0.6091
## factor(wSCOREMAT.2011.Q)3  -0.04030 0.065192  -0.6182  0.5364
## factor(wSCOREMAT.2011.Q)4  -0.04942 0.067039  -0.7372  0.4610
## factor(wSCOREMAT.2011.Q)5   0.03424 0.074919   0.4570  0.6476
## Bike_lane.by.street.2011ct  0.05463 0.002214  24.6792  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##    1.rho 
## 0.150297 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1155  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1815.939</code></pre>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3933.174</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.000</td>
<td align="right">0.100</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">10330558.642</td>
<td align="right">0.104</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">2347044.671</td>
<td align="right">0.154</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">75.062</td>
<td align="right">0.665</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.385</td>
<td align="right">0.920</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">18176045.354</td>
<td align="right">0.024</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.067</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">0.968</td>
<td align="right">0.609</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">0.960</td>
<td align="right">0.536</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">0.952</td>
<td align="right">0.461</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">1.035</td>
<td align="right">0.648</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.056</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-8" class="section level3" number="11.1.2">
<h3><span class="header-section-number">11.1.2</span> Greenness
change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ factor(wSCOREMAT.2011.Q) + pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ factor(wSCOREMAT.2011.Q) + pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ factor(wSCOREMAT.2011.Q) + pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                            Estimate  Cond. SE  t-value p-value
## (Intercept)               -1.626912 0.0267689 -60.7762  0.0000
## factor(wSCOREMAT.2011.Q)2  0.004070 0.0170448   0.2388  0.8113
## factor(wSCOREMAT.2011.Q)3  0.008822 0.0179864   0.4905  0.6238
## factor(wSCOREMAT.2011.Q)4  0.014715 0.0204090   0.7210  0.4709
## factor(wSCOREMAT.2011.Q)5 -0.036032 0.0249055  -1.4468  0.1480
## pct_esp_vert_2011ct        0.018693 0.0003924  47.6384  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1337871 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002114  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1897.025</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.197</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">1.004</td>
<td align="right">0.811</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">1.009</td>
<td align="right">0.624</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">1.015</td>
<td align="right">0.471</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.965</td>
<td align="right">0.148</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.019</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-8" class="section level3" number="11.1.3">
<h3><span class="header-section-number">11.1.3</span> Canopy (trees)
change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ factor(wSCOREMAT.2011.Q) + pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ factor(wSCOREMAT.2011.Q) + pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ factor(wSCOREMAT.2011.Q) + pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                            Estimate Cond. SE  t-value p-value
## (Intercept)               -2.370144 0.040176 -58.9944 0.00000
## factor(wSCOREMAT.2011.Q)2  0.037919 0.030519   1.2425 0.21405
## factor(wSCOREMAT.2011.Q)3  0.009507 0.033036   0.2878 0.77352
## factor(wSCOREMAT.2011.Q)4  0.024478 0.035691   0.6858 0.49283
## factor(wSCOREMAT.2011.Q)5 -0.077360 0.042906  -1.8030 0.07138
## pct_esp_vert_high_2011ct   0.039904 0.001009  39.5516 0.00000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1378561 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.01214  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1755.557</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.093</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)2</td>
<td align="right">1.039</td>
<td align="right">0.214</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)3</td>
<td align="right">1.010</td>
<td align="right">0.774</td>
</tr>
<tr class="even">
<td align="left">factor(wSCOREMAT.2011.Q)4</td>
<td align="right">1.025</td>
<td align="right">0.493</td>
</tr>
<tr class="odd">
<td align="left">factor(wSCOREMAT.2011.Q)5</td>
<td align="right">0.926</td>
<td align="right">0.071</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.041</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-visible-minority-3" class="section level2 tabset"
number="11.2">
<h2 class="tabset"><span class="header-section-number">11.2</span> UI vs
Visible minority</h2>
<div id="bike-lane-length-change-hurdle-9" class="section level3"
number="11.2.1">
<h3><span class="header-section-number">11.2.1</span> Bike lane length
change (hurdle)</h3>
<p>Bike lane length change</p>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ factor(vis_minority_2011.Q) + Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ factor(vis_minority_2011.Q) + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ factor(vis_minority_2011.Q) + 
##     Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                              Estimate Cond. SE t-value   p-value
## (Intercept)                   -5.0321    1.117 -4.5031 6.697e-06
## factor(vis_minority_2011.Q)2   1.7194    1.302  1.3201 1.868e-01
## factor(vis_minority_2011.Q)3   1.0259    1.215  0.8445 3.984e-01
## factor(vis_minority_2011.Q)4   0.1324    1.261  0.1050 9.164e-01
## factor(vis_minority_2011.Q)5  -1.6462    1.236 -1.3317 1.830e-01
## Bike_lane.by.street.2011ct     3.2119    0.993  3.2345 1.218e-03
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1378518 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  10.44  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -143.3408</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ factor(vis_minority_2011.Q) + Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ factor(vis_minority_2011.Q) + Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                              Estimate Cond. SE  t-value p-value
## (Intercept)                  -2.67529 0.063059 -42.4251  0.0000
## factor(vis_minority_2011.Q)2 -0.03757 0.060202  -0.6241  0.5325
## factor(vis_minority_2011.Q)3 -0.02383 0.064355  -0.3702  0.7112
## factor(vis_minority_2011.Q)4 -0.07706 0.068068  -1.1321  0.2576
## factor(vis_minority_2011.Q)5 -0.04812 0.076711  -0.6272  0.5305
## Bike_lane.by.street.2011ct    0.05465 0.002247  24.3249  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1504718 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1155  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1813.409</code></pre>
<pre class="r"><code># AIC
AIC(res.lmm.zero)
AIC(res.lmm.cnt)

# Combined AIC
&quot;Combined Hurdle AIC:&quot;</code></pre>
<pre><code>## [1] &quot;Combined Hurdle AIC:&quot;</code></pre>
<pre class="r"><code>-2 * res.lmm.zero$APHLs$p_v - 2 * res.lmm.cnt$APHLs$p_v + 2 * Reduce(sum, res.lmm.cnt$dfs)</code></pre>
<pre><code>## [1] 3929.499</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)</code></pre>
<table>
<caption>Zero model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.007</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">5.581</td>
<td align="right">0.187</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">2.790</td>
<td align="right">0.398</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">1.142</td>
<td align="right">0.916</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.193</td>
<td align="right">0.183</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">24.827</td>
<td align="right">0.001</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>Count model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.069</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">0.963</td>
<td align="right">0.533</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">0.976</td>
<td align="right">0.711</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.926</td>
<td align="right">0.258</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.953</td>
<td align="right">0.531</td>
</tr>
<tr class="even">
<td align="left">Bike_lane.by.street.2011ct</td>
<td align="right">1.056</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
<div id="greenness-change-9" class="section level3" number="11.2.2">
<h3><span class="header-section-number">11.2.2</span> Greenness
change</h3>
<p>Measuring canopy (<em>i.e.</em> greenness ~ grass &amp; trees) ratio
within CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_2017ct ~ factor(vis_minority_2011.Q) + pct_esp_vert_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_2017ct ~ factor(vis_minority_2011.Q) + pct_esp_vert_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_2017ct ~ factor(vis_minority_2011.Q) + pct_esp_vert_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                Estimate Cond. SE   t-value p-value
## (Intercept)                  -1.6409261 0.026010 -63.08876  0.0000
## factor(vis_minority_2011.Q)2  0.0038859 0.017299   0.22463  0.8223
## factor(vis_minority_2011.Q)3  0.0249982 0.019765   1.26478  0.2060
## factor(vis_minority_2011.Q)4  0.0004811 0.018957   0.02538  0.9798
## factor(vis_minority_2011.Q)5 -0.0124081 0.022800  -0.54422  0.5863
## pct_esp_vert_2011ct           0.0189164 0.000381  49.64342  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1353623 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.002188  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1897.455</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.194</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">1.004</td>
<td align="right">0.822</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">1.025</td>
<td align="right">0.206</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">1.000</td>
<td align="right">0.980</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.988</td>
<td align="right">0.586</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_2011ct</td>
<td align="right">1.019</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
<div id="canopy-trees-change-9" class="section level3" number="11.2.3">
<h3><span class="header-section-number">11.2.3</span> Canopy (trees)
change</h3>
<p>Measuring high canopy (<em>i.e.</em> trees only) ratio within
CT/buffer in 2011 (in %) at the Census tract level</p>
<pre class="r"><code>f &lt;- area_esp_vert_high_2017ct ~ factor(vis_minority_2011.Q) + pct_esp_vert_high_2011ct + offset(log(ct_area_hct))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

res.lmm &lt;- fitme(area_esp_vert_high_2017ct ~ factor(vis_minority_2011.Q) + pct_esp_vert_high_2011ct + offset(log(ct_area_hct)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = poisson())
smy &lt;- summary(res.lmm, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: area_esp_vert_high_2017ct ~ factor(vis_minority_2011.Q) + pct_esp_vert_high_2011ct + 
##     offset(log(ct_area_hct)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                               Estimate  Cond. SE   t-value p-value
## (Intercept)                  -2.377969 0.0380198 -62.54557  0.0000
## factor(vis_minority_2011.Q)2 -0.001729 0.0309577  -0.05586  0.9555
## factor(vis_minority_2011.Q)3  0.038080 0.0337279   1.12903  0.2589
## factor(vis_minority_2011.Q)4 -0.019030 0.0346832  -0.54869  0.5832
## factor(vis_minority_2011.Q)5 -0.003218 0.0395372  -0.08138  0.9351
## pct_esp_vert_high_2011ct      0.040455 0.0009863  41.01615  0.0000
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1380789 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.01257  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1756.459</code></pre>
<p>Transforming the model coefficients:</p>
<pre class="r"><code>smy.bt &lt;- data.frame(smy$beta_table)
round(exp(res.lmm[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Model transformed coeffs&quot;)</code></pre>
<table>
<caption>Model transformed coeffs</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fixef</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.093</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)2</td>
<td align="right">0.998</td>
<td align="right">0.955</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)3</td>
<td align="right">1.039</td>
<td align="right">0.259</td>
</tr>
<tr class="even">
<td align="left">factor(vis_minority_2011.Q)4</td>
<td align="right">0.981</td>
<td align="right">0.583</td>
</tr>
<tr class="odd">
<td align="left">factor(vis_minority_2011.Q)5</td>
<td align="right">0.997</td>
<td align="right">0.935</td>
</tr>
<tr class="even">
<td align="left">pct_esp_vert_high_2011ct</td>
<td align="right">1.041</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ui-vs-gentrified-ct-3" class="section level2 tabset"
number="11.3">
<h2 class="tabset"><span class="header-section-number">11.3</span> UI vs
gentrified CT</h2>
<p>No new models here, as <code>gentrified</code> variable is already
used as a pure categorical variable.</p>
</div>
</div>
<div id="tables-and-figures" class="section level1" number="12">
<h1><span class="header-section-number">12</span> Tables and
figures</h1>
<div id="ses-map-and-inset-map" class="section level2" number="12.1">
<h2><span class="header-section-number">12.1</span> SES map and inset
map</h2>
<pre class="r"><code># inset map
csd_data &lt;- get_census(dataset=&#39;CA16&#39;, regions=list(PR=&#39;24&#39;), level=&#39;CSD&#39;, geo_format = &quot;sf&quot;) %&gt;%
  mutate(interact_aoi = (CD_UID %in% c(2466, 2465, 2458)) &amp; !(GeoUID %in% c(2458033, 2458037)),
         interact_name = case_when(CD_UID == 2466 ~ &#39;Montr√©al&#39;,
                                   TRUE ~ str_remove(name, &quot; \\([[:upper:]-]+\\)&quot;)))
pr_data &lt;- get_census(dataset = &#39;CA16&#39;, regions=list(C=&#39;1&#39;), level = &#39;PR&#39;, geo_format = &quot;sf&quot;)

inset_lim &lt;- st_bbox(st_transform(filter(CT16, interact_aoi), st_crs(4326)))
# inset_map &lt;- ggplot() +
#   geom_sf(data = csd_data, aes(fill=factor(interact_aoi)), color = NA, show.legend = F) +
#   scale_fill_manual(values = c(&quot;TRUE&quot; = &quot;light blue&quot;, &quot;FALSE&quot; = &quot;gray&quot;), labels=NULL) +
#   coord_sf(xlim = c(-77, -69), ylim = c(45, 49), crs = st_crs(4326), default_crs = st_crs(4326), expand = FALSE) +
#   theme(axis.text=element_text(size=15), axis.title.x=element_blank(), axis.title.y=element_blank()) +
#   scale_x_continuous(breaks = seq(-76, -70, by = 2)) +
#   scale_y_continuous(breaks = seq(45.5, 49, by = 1)) 
# inset_map &lt;- inset_map + 
#   annotate(&quot;rect&quot;, xmin = inset_lim[&#39;xmin&#39;], ymin = inset_lim[&#39;ymin&#39;], xmax = inset_lim[&#39;xmax&#39;], ymax = inset_lim[&#39;ymax&#39;], fill = NA, color = &quot;black&quot;, size = 1) +
#   annotate(&quot;text&quot;, label = &quot;Quebec, Canada&quot;, x = (-77 - 69) / 2, y = (45 + 49)/2, size = 8)

exp_fact = 1.05
inset_map &lt;- ggplot() +
  geom_sf(data = pr_data, color = &quot;black&quot;, show.legend = F) +
  coord_sf(xlim = c(-55, -140), ylim = c(40, 75), crs = st_crs(4326), default_crs = st_crs(4326), expand = FALSE) +
  theme(axis.text=element_text(size=15), axis.title.x=element_blank(), axis.title.y=element_blank()) +
  scale_x_continuous(breaks = seq(-130, -60, by = 20)) +
  scale_y_continuous(breaks = seq(45, 70, by = 10)) 
inset_map &lt;- inset_map + 
  annotate(&quot;rect&quot;, 
           xmin = inset_lim[&#39;xmin&#39;] - exp_fact * (inset_lim[&#39;xmax&#39;] - inset_lim[&#39;xmin&#39;]), 
           ymin = inset_lim[&#39;ymin&#39;] - exp_fact * (inset_lim[&#39;ymax&#39;] - inset_lim[&#39;ymin&#39;]), 
           xmax = inset_lim[&#39;xmax&#39;] + exp_fact * (inset_lim[&#39;xmax&#39;] - inset_lim[&#39;xmin&#39;]), 
           ymax = inset_lim[&#39;ymax&#39;] + exp_fact * (inset_lim[&#39;ymax&#39;] - inset_lim[&#39;ymin&#39;]), 
           fill = NA, color = &quot;red&quot;, size = 2)

  
# SES map
.ses_data_sf &lt;- CT16 %&gt;%
  inner_join(bei_df_aoi, by = c(&quot;GeoUID&quot; = &quot;CT_UID&quot;))

.ses_data &lt;- bi_class(.ses_data_sf, x = vis_minority_2011, y = wSCOREMAT.2011, style = &quot;quantile&quot;, dim = 3)
ses_map &lt;- ggplot() + 
  geom_sf(data = .ses_data, mapping = aes(fill = bi_class), color = &quot;white&quot;, size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = &quot;Brown&quot;, dim = 3) +
  geom_sf_label(data = filter(csd_data, (GeoUID == &quot;2466023&quot;) | ((CD_UID %in% c(&quot;2465&quot;, &quot;2458&quot;)) &amp; !(GeoUID %in% c(2458033, 2458037)))),
                aes(label=interact_name), check_overlap = T, size = 8) + 
  scalebar(data = .ses_data, dist = 5, dist_unit = &quot;km&quot;, transform = F) +
  theme(panel.background = element_rect(fill = &quot;white&quot;),
        axis.ticks = element_blank(),
        axis.text = element_blank(),
        axis.title = element_blank(),
        panel.grid = element_blank())
ses_legend &lt;- bi_legend(pal = &quot;Brown&quot;,
                    dim = 3,
                    xlab = &quot;Visible Minority &quot;,
                    ylab = &quot;Material deprivation &quot;,
                    size = 14)
ggdraw() +
  draw_plot(ses_map, 0, 0, 1, 1) +
  draw_plot(ses_legend, 0.8, .75, 0.2, 0.2) +
  draw_plot(inset_map, 0.02, .7, 0.25, 0.25)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_img/SES_map.png" /></p>
</div>
<div id="maps-of-bec-and-bei" class="section level2" number="12.2">
<h2><span class="header-section-number">12.2</span> Maps of BEC and
BEI</h2>
<div id="greenness-10" class="section level3" number="12.2.1">
<h3><span class="header-section-number">12.2.1</span> Greenness</h3>
<pre class="r"><code># Bike
g_bec_bike &lt;- ggplot() +
   geom_sf(data=filter(bike_lane_changes, interact_aoi), mapping = aes(fill=as.numeric(Bike_lane.by.street.2011ct)), lwd = 0) +
  scale_fill_distiller(name = &quot;Bike lane to\nstreet length (%)&quot;, palette = &quot;YlGn&quot;, direction = 1) + 
   geom_sf(data=filter(CT16, interact_aoi), fill=NA, color=&quot;gray&quot;, size=.2, alpha=0.2) + 
  ggnewscale::new_scale_fill() +
  geom_sf(data=filter(bike_lane_changes, interact_aoi), mapping = aes(fill=factor(units::drop_units(Bike_lane.by.street.2011ct) == 0)), lwd = 0.1) +
  scale_fill_manual(name=&quot;No bike lane in CT&quot;, values = c(&quot;TRUE&quot; = &quot;white&quot;), labels=NULL, na.translate = FALSE) +
  labs(title = &quot;Normalized bike lane length in 2011&quot;)


g_bei_bike &lt;- ggplot() +
  geom_sf(data=filter(bike_lane_changes, interact_aoi), mapping = aes(fill=as.numeric(Bike_lane_diff.by.street.2011.2016ct)), lwd=0) +
   geom_sf(data=filter(CT16, interact_aoi), fill=NA, color=&quot;gray&quot;, size=.2, alpha=0.2) + 
  scale_fill_gradient2(name = &quot;Change in normalized\nbike lane (%)&quot;)+ 
  labs(title = &quot;Bike lane change between 2011 and 2016&quot;)

# Green space
g_bec_green &lt;- ggplot() +
   geom_sf(data=inner_join(filter(CT16, interact_aoi), esp_vert_ct, by=&quot;GeoUID&quot;), mapping = aes(fill=as.numeric(pct_esp_vert_2011)), lwd = 0) +
   geom_sf(data=filter(CT16, interact_aoi), fill=NA, color=&quot;gray&quot;, size=.2, alpha=0.2) + 
  scale_fill_distiller(name = &quot;Greenspace (%)&quot;, palette = &quot;YlGn&quot;, direction = 1)+ 
  labs(title = &quot;A) Proportion of greenspace in 2011&quot;)

g_bei_green &lt;- ggplot() +
   geom_sf(data=inner_join(filter(CT16, interact_aoi), esp_vert_ct, by=&quot;GeoUID&quot;), mapping = aes(fill=as.numeric(pct_esp_vert_diff_2011.2017)), lwd = 0) +
   geom_sf(data=filter(CT16, interact_aoi), fill=NA, color=&quot;gray&quot;, size=.2, alpha=0.2) + 
  scale_fill_gradient2(name = &quot;Greenspace\nchange (%)&quot;)+ 
  #scale_fill_steps2(name = &quot;Greenspace\nchange (%)&quot;, nice.breaks=T) + 
  labs(title = &quot;C) Greenspace change between 2011 and 2017&quot;)

# Trees
g_bec_tree &lt;- ggplot() +
   geom_sf(data=inner_join(filter(CT16, interact_aoi), esp_vert_ct, by=&quot;GeoUID&quot;), mapping = aes(fill=as.numeric(pct_esp_vert_high_2011)), lwd = 0) +
   geom_sf(data=filter(CT16, interact_aoi), fill=NA, color=&quot;gray&quot;, size=.2, alpha=0.2) + 
  scale_fill_distiller(name = &quot;Tree canopy (%)&quot;, palette = &quot;YlGn&quot;, direction = 1)+ 
  labs(title = &quot;B) Proportion of tree canopy in 2011&quot;)

g_bei_tree &lt;- ggplot() +
   geom_sf(data=inner_join(filter(CT16, interact_aoi), esp_vert_ct, by=&quot;GeoUID&quot;), mapping = aes(fill=as.numeric(pct_esp_vert_diff_high_2011.2017)), lwd = 0) +
   geom_sf(data=filter(CT16, interact_aoi), fill=NA, color=&quot;gray&quot;, size=.2, alpha=0.2) + 
  scale_fill_gradient2(name = &quot;Tree canopy\nchange (%)&quot;)+ 
  labs(title = &quot;D) Tree canopy change between 2011 and 2017&quot;)

# Create grid of maps
pcol1 &lt;- plot_grid(
  #g_bec_bike + theme_void(), 
  g_bec_green + theme_void(), 
  g_bec_tree + theme_void(),
  align = &quot;vh&quot;,
  #labels = c(&quot;A&quot;, &quot;B&quot;),
  #hjust = -1,
  ncol = 1
)

pcol2 &lt;- plot_grid(
 #g_bei_bike + theme_void(), 
  g_bei_green + theme_void(), 
  g_bei_tree + theme_void(),
  align = &quot;vh&quot;,
  #labels = c(&quot;C&quot;, &quot;D&quot;),
  #hjust = -1,
  ncol = 1
)

# output all graphs
plot_grid(pcol1, pcol2, nrow=1)</code></pre>
<p><img src="BEI_equity_paper.final.aoiOK_img/BEC-BEI_maps.png" /></p>
</div>
<div id="bike-lanes-original-version" class="section level3"
number="12.2.2">
<h3><span class="header-section-number">12.2.2</span> Bike lanes
(original version)</h3>
<pre class="r"><code># Create grid of maps
plot_grid(
  g_bec_bike + theme_void(), 
  g_bei_bike + theme_void(),
  align = &quot;vh&quot;,
  labels = c(&quot;A&quot;, &quot;B&quot;),
  hjust = -30,
  ncol = 1
)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_img/BEC-BEI_maps.bikes.png" /></p>
</div>
<div id="bike-lanes-response-to-reviewer-2023-08-29"
class="section level3" number="12.2.3">
<h3><span class="header-section-number">12.2.3</span> Bike lanes
(response to reviewer | 2023-08-29)</h3>
<blockquote>
<p>Figure 1 might be made more informative as a bivariate map with
presence of bike infrastructure vs material deprivation or visible
minority quintile (biscale) to highlight the relationship between the
two and potentially having the border of gentrifiable gentrifying and
not gentrifying tracts in different colors as well.</p>
</blockquote>
<p>Building 2 biscale maps (bike infra vs.¬†mat. depriv. / bike infra
vs.¬†min. vis.) + 1 map bike infra + gentrif + 1 map bike infra
change.</p>
<pre class="r"><code>.bike_data_sf &lt;- CT16 %&gt;%
  inner_join(bei_df_aoi, by = c(&quot;GeoUID&quot; = &quot;CT_UID&quot;))

# biscale map A: bike infra in 2011 vs. material deprivation
.bike_A &lt;- bi_class(.bike_data_sf, x = Bike_lane.by.street.2011ct, y = wSCOREMAT.2011, style = &quot;quantile&quot;, dim = 3)</code></pre>
<pre><code>## Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): var
## has missing values, omitted in finding classes</code></pre>
<pre class="r"><code>.bike_map_A &lt;- ggplot() + 
  geom_sf(data = .bike_A, mapping = aes(fill = bi_class), color = &quot;white&quot;, size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = &quot;Brown&quot;, dim = 3) +
  theme(panel.background = element_rect(fill = &quot;white&quot;),
        axis.ticks = element_blank(),
        axis.text = element_blank(),
        axis.title = element_blank(),
        panel.grid = element_blank())
.bike_legend_A &lt;- bi_legend(pal = &quot;Brown&quot;,
                    dim = 3,
                    xlab = &quot;Bike lane ratio &quot;,
                    ylab = &quot;Material deprivation &quot;,
                    size = 14)
bike_map_A &lt;- ggdraw() +
  draw_plot(.bike_map_A, 0, 0, 1, 1) +
  draw_plot(.bike_legend_A, 0, .65, 0.25, 0.25)

# biscale map A: bike infra in 2011 vs. % visible minority
.bike_B &lt;- bi_class(.bike_data_sf, x = Bike_lane.by.street.2011ct, y = vis_minority_2011, style = &quot;quantile&quot;, dim = 3)</code></pre>
<pre><code>## Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): var
## has missing values, omitted in finding classes</code></pre>
<pre class="r"><code>.bike_map_B &lt;- ggplot() + 
  geom_sf(data = .bike_B, mapping = aes(fill = bi_class), color = &quot;white&quot;, size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = &quot;GrPink&quot;, dim = 3) +
  theme(panel.background = element_rect(fill = &quot;white&quot;),
        axis.ticks = element_blank(),
        axis.text = element_blank(),
        axis.title = element_blank(),
        panel.grid = element_blank())
.bike_legend_B &lt;- bi_legend(pal = &quot;GrPink&quot;,
                    dim = 3,
                    xlab = &quot;Bike lane ratio &quot;,
                    ylab = &quot;% Visible minority &quot;,
                    size = 14)
bike_map_B &lt;- ggdraw(clip = &quot;on&quot;) +
  draw_plot(.bike_map_B, 0, 0, 1, 1) +
  draw_plot(.bike_legend_B, 0, .65, 0.25, 0.25)

# bike infra vs. gentrified CTs
bike_map_C &lt;- ggplot() +
   geom_sf(data=.bike_data_sf, mapping = aes(fill=as.numeric(Bike_lane.by.street.2011ct)), lwd = 0) +
  scale_fill_distiller(name = &quot;Bike lane to\nstreet length (%)&quot;, palette = &quot;YlGn&quot;, direction = 1, guide = guide_colourbar(order = 1)) + 
   geom_sf(data=filter(CT16, interact_aoi), fill=NA, color=&quot;gray&quot;, size=.2, alpha=0.2) + 
  ggnewscale::new_scale_fill() +
  geom_sf(data=.bike_data_sf, mapping = aes(fill=factor(Bike_lane.by.street.2011ct == 0)), lwd = 0.1) +
  scale_fill_manual(name=&quot;No bike lane in CT&quot;, values = c(&quot;TRUE&quot; = &quot;white&quot;), labels=NULL, na.translate = FALSE, guide = guide_legend(order = 2)) +
  geom_sf(data=.bike_data_sf, mapping = aes(color=factor(gentrified_2016_2011),), lwd = 0.8, fill=NA) +
  scale_color_manual(name=&quot;Gentrified CT \nin 2016&quot;, values = c(&quot;TRUE&quot; = &quot;red&quot;), labels=NULL, na.translate = FALSE, guide = guide_legend(order = 3)) +
  theme(panel.background = element_rect(fill = &quot;white&quot;),
        legend.text=element_text(size=14),
        legend.title = element_text(size=15),
        legend.position = &quot;bottom&quot;,
        axis.ticks = element_blank(),
        axis.text = element_blank(),
        axis.title = element_blank(),
        panel.grid = element_blank())

bike_map_D &lt;- ggplot() +
  geom_sf(data=.bike_data_sf, mapping = aes(fill=as.numeric(Bike_lane_diff.by.street.2011.2016ct)), lwd=0) +
   geom_sf(data=filter(CT16, interact_aoi), fill=NA, color=&quot;gray&quot;, size=.2, alpha=0.2) + 
  scale_fill_gradient2(name = &quot;Change in normalized\nbike lane (%)&quot;)+ 
  theme(panel.background = element_rect(fill = &quot;white&quot;),
        legend.text=element_text(size=14),
        legend.title = element_text(size=15),
        legend.position = &quot;bottom&quot;,
        axis.ticks = element_blank(),
        axis.text = element_blank(),
        axis.title = element_blank(),
        panel.grid = element_blank())

# Combine plots
prow1 &lt;- plot_grid(
  bike_map_A, bike_map_B,
  align = &quot;vh&quot;,
  labels = c(&quot;A) Bike lane to street length (%) vs. Material deprivation&quot;, &quot;B) Bike lane to street length (%) vs. Visible Minority (%)&quot;),
  label_size = 18,
  #label_y = .9,
  hjust = -0.1,
  nrow = 1
)

prow2 &lt;- plot_grid(
  bike_map_C, bike_map_D,
  align = &quot;vh&quot;,
  labels = c(&quot;C) Bike lane to street length (%) vs. gentrified Census Tracts&quot;, &quot;D) Bike lane change between 2011 and 2016&quot;),
  label_size = 18,
  #label_y = .9,
  hjust = -0.1,
  nrow = 1
)

plot_grid(prow1, prow2, ncol = 1)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_files/figure-html/unnamed-chunk-112-1.png" /><!-- --></p>
<p><img src="BEI_equity_paper.final.aoiOK_img/bike_obj1.2.png" /></p>
</div>
</div>
<div id="ses-and-bei-outcomes" class="section level2" number="12.3">
<h2><span class="header-section-number">12.3</span> SES and BEI
outcomes</h2>
<pre class="r"><code># Extract SES and BEI in 2011
.tab1_2011 &lt;- bei_df_aoi %&gt;%
  transmute(year = &quot;2011&quot;,
            zone = zone,
            CT_UID = CT_UID,
            Population = Population,
            `Material score` = wSCOREMAT.2011,
            `% visible minorities` = vis_minority_2011,
            `gentrified` = gentrified_2016_2011,
            `Bike lane` = Bike_lane_total.2011ct &gt; 0,
            `No bike lane` = Bike_lane_total.2011ct == 0,
            `Bike lane length (hm)` = Bike_lane_total.2011ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2011ct,
            `Green space area (ha)` = area_esp_vert_2011ct,
            `% green space within CT` = pct_esp_vert_2011ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2011ct,
            `% tree canopy within CT` = pct_esp_vert_high_2011ct)

# Extract SES and BEI in 2016
.tab1_2016 &lt;- bei_df_aoi %&gt;%
  transmute(year = &quot;2016&quot;,
            zone = zone,
            CT_UID = CT_UID,
            `Bike lane` = Bike_lane_total.2016ct &gt; 0,
            `No bike lane` = Bike_lane_total.2016ct == 0,
            `Bike lane length (hm)` = Bike_lane_total.2016ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2016ct,
            `Green space area (ha)` = area_esp_vert_2017ct,
            `% green space within CT` = pct_esp_vert_2017ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2017ct,
            `% tree canopy within CT` = pct_esp_vert_high_2017ct)

.tab1_med &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year) %&gt;%
  summarize(across(where(is.numeric), median, na.rm=TRUE), 
            `% gentrified` = 100 * sum(`gentrified`, na.rm = TRUE) / n(),
            `Bike lane presence` = sum(`Bike lane`),
            `Bike lane absence` = sum(`No bike lane`))</code></pre>
<pre><code>## Warning: There was 1 warning in `summarize()`.
## ‚Ñπ In argument: `across(where(is.numeric), median, na.rm = TRUE)`.
## ‚Ñπ In group 1: `year = &quot;2011&quot;`.
## Caused by warning:
## ! The `...` argument of `across()` is deprecated as of dplyr 1.1.0.
## Supply arguments directly to `.fns` through an anonymous function instead.
## 
##   # Previously
##   across(a:b, mean, na.rm = TRUE)
## 
##   # Now
##   across(a:b, \(x) mean(x, na.rm = TRUE))</code></pre>
<pre class="r"><code>.tab1_p25 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.25, na.rm=TRUE))
.tab1_p75 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.75, na.rm=TRUE))
tab1 &lt;- inner_join(.tab1_med, .tab1_p25, by=&quot;year&quot;, suffix = c(&quot;&quot;, &quot; p25&quot;)) %&gt;%
  inner_join(.tab1_p75, by=&quot;year&quot;, suffix = c(&quot;&quot;, &quot; p75&quot;)) %&gt;%
  transmute(year = year,
            Population = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                   TRUE ~ paste0(round(`Population`,1), &quot; (&quot;, round(`Population p25`,1), &quot; - &quot;, round(`Population p75`,1), &quot;)&quot;)),
            `Material score` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                         TRUE ~ paste0(round(`Material score`,3), &quot; (&quot;, round(`Material score p25`,3), &quot; - &quot;, round(`Material score p75`,3), &quot;)&quot;)),
            `% visible minorities` = case_when(is.na(`% visible minorities`) ~ &quot;&quot;, 
                                               TRUE ~ paste0(round(`% visible minorities`,1), &quot; (&quot;, round(`% visible minorities p25`,1), &quot; - &quot;, round(`% visible minorities p75`,1), &quot;)&quot;)),
            `% gentrified CTs` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                           TRUE ~ as.character(round(`% gentrified`, 1))),
            `Bike lane presence (N)` = as.character(`Bike lane presence`),
            `Bike lane absence (N)` = as.character(`Bike lane absence`),
            `Bike lane length (hm)` = paste0(round(`Bike lane length (hm)`,1), &quot; (&quot;, round(`Bike lane length (hm) p25`,1), &quot; - &quot;, round(`Bike lane length (hm) p75`,1), &quot;)&quot;),
            `% Bike lane to streets` = paste0(round(`% Bike lane to streets`,1), &quot; (&quot;, round(`% Bike lane to streets p25`,1), &quot; - &quot;, round(`% Bike lane to streets p75`,1), &quot;)&quot;),
            `Green space area (ha)` = paste0(round(`Green space area (ha)`,1), &quot; (&quot;, round(`Green space area (ha) p25`,1), &quot; - &quot;, round(`Green space area (ha) p75`,1), &quot;)&quot;),
            `% green space within CT` = paste0(round(`% green space within CT`,1), &quot; (&quot;, round(`% green space within CT p25`,1), &quot; - &quot;, round(`% green space within CT p75`,1), &quot;)&quot;),
            `Tree canopy area (ha)` = paste0(round(`Tree canopy area (ha)`,1), &quot; (&quot;, round(`Tree canopy area (ha) p25`,1), &quot; - &quot;, round(`Tree canopy area (ha) p75`,1), &quot;)&quot;),
            `% tree canopy within CT` = paste0(round(`% tree canopy within CT`,1), &quot; (&quot;, round(`% tree canopy within CT p25`,1), &quot; - &quot;, round(`% tree canopy within CT p75`,1), &quot;)&quot;)) %&gt;%
  tibble::column_to_rownames(&quot;year&quot;) %&gt;%
  t() %&gt;% 
  as.data.frame()

tab1 %&gt;% knitr::kable() %&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
2011
</th>
<th style="text-align:left;">
2016
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Population
</td>
<td style="text-align:left;">
3808 (2612 - 5157)
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Material score
</td>
<td style="text-align:left;">
0.007 (-0.018 - 0.032)
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% visible minorities
</td>
<td style="text-align:left;">
21.7 (14.5 - 34.5)
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% gentrified CTs
</td>
<td style="text-align:left;">
30
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane presence (N)
</td>
<td style="text-align:left;">
487
</td>
<td style="text-align:left;">
576
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane absence (N)
</td>
<td style="text-align:left;">
202
</td>
<td style="text-align:left;">
113
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane length (hm)
</td>
<td style="text-align:left;">
6.8 (0 - 18)
</td>
<td style="text-align:left;">
10.4 (2.9 - 21.4)
</td>
</tr>
<tr>
<td style="text-align:left;">
% Bike lane to streets
</td>
<td style="text-align:left;">
6.9 (0 - 14)
</td>
<td style="text-align:left;">
10.7 (3.4 - 17.9)
</td>
</tr>
<tr>
<td style="text-align:left;">
Green space area (ha)
</td>
<td style="text-align:left;">
22 (8 - 59)
</td>
<td style="text-align:left;">
25 (9 - 64)
</td>
</tr>
<tr>
<td style="text-align:left;">
% green space within CT
</td>
<td style="text-align:left;">
35.6 (24.4 - 46.7)
</td>
<td style="text-align:left;">
40.2 (29.4 - 50.4)
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree canopy area (ha)
</td>
<td style="text-align:left;">
10 (4 - 22)
</td>
<td style="text-align:left;">
12 (5 - 25)
</td>
</tr>
<tr>
<td style="text-align:left;">
% tree canopy within CT
</td>
<td style="text-align:left;">
16.4 (11.8 - 22.6)
</td>
<td style="text-align:left;">
20.2 (14.5 - 26.8)
</td>
</tr>
</tbody>
</table>
<pre class="sql"><code>WITH cnt17 AS (
    SELECT &quot;GeoUID&quot;
        ,(pvc).value, SUM((pvc).count) As total
    FROM (SELECT &quot;GeoUID&quot;
            ,ST_ValueCount(ST_Clip(rast, geometry)) As pvc
        FROM canopee2017
        JOIN ct16 ON ST_Intersects(geometry, rast)
    ) As foo
    GROUP BY &quot;GeoUID&quot;, (pvc).value
),
canopee17 AS (
    SELECT 2017 AS year, &quot;GeoUID&quot;
        ,sum(total) FILTER (WHERE value in (3, 4)) AS area_esp_vert
        ,sum(total) FILTER (WHERE value = 4) AS area_esp_vert_high
    FROM cnt17
    WHERE value &gt; 0 -- discard no data, including postgis raster no data
    GROUP BY &quot;GeoUID&quot;
),
cnt11 AS (
    SELECT &quot;GeoUID&quot;
        ,(pvc).value, SUM((pvc).count) As total
    FROM (SELECT &quot;GeoUID&quot;
            ,ST_ValueCount(ST_Clip(rast, geometry)) As pvc
        FROM canopee2011
        JOIN ct16 ON ST_Intersects(geometry, rast)
    ) As foo
    GROUP BY &quot;GeoUID&quot;, (pvc).value
),
canopee11 AS (
    SELECT 2011 AS year, &quot;GeoUID&quot;
        ,sum(total) FILTER (WHERE value in (3, 4)) AS area_esp_vert
        ,sum(total) FILTER (WHERE value = 4) AS area_esp_vert_high
    FROM cnt11
    WHERE value &gt; 0 -- discard no data, including postgis raster no data
    GROUP BY &quot;GeoUID&quot;
)
SELECT &quot;year&quot;, &quot;GeoUID&quot;
    ,st_area(geometry) ct_area -- CT area in hectares
    ,COALESCE(area_esp_vert, 0) area_esp_vert
    ,coalesce(area_esp_vert_high, 0) area_esp_vert_high
FROM ct16 JOIN canopee17 USING (&quot;GeoUID&quot;)
UNION
SELECT &quot;year&quot;, &quot;GeoUID&quot;
    ,st_area(geometry) ct_area -- CT area in hectares
    ,COALESCE(area_esp_vert, 0) area_esp_vert
    ,coalesce(area_esp_vert_high, 0) area_esp_vert_high
FROM ct16 JOIN canopee11 USING (&quot;GeoUID&quot;)
</code></pre>
<pre class="r"><code># Computing the global proportion of greenspace/tree canopy for the area
esp_vert_ct_m %&gt;%
  group_by(year) %&gt;%
  summarize(`area_esp_vert (km2)` = sum(area_esp_vert) / 1000000,
            `area_esp_vert_high (km2)` = sum(area_esp_vert_high) / 1000000,
            `esp_vert (%)` = 100 * sum(area_esp_vert) / sum(ct_area),
            `esp_vert_high (%)` = 100 * sum(area_esp_vert_high) / sum(ct_area)) %&gt;%
  knitr::kable(digits = 1) %&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
area_esp_vert (km2)
</th>
<th style="text-align:right;">
area_esp_vert_high (km2)
</th>
<th style="text-align:right;">
esp_vert (%)
</th>
<th style="text-align:right;">
esp_vert_high (%)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
2468.8
</td>
<td style="text-align:right;">
909.7
</td>
<td style="text-align:right;">
57.4
</td>
<td style="text-align:right;">
21.1
</td>
</tr>
<tr>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2829.9
</td>
<td style="text-align:right;">
957.4
</td>
<td style="text-align:right;">
65.8
</td>
<td style="text-align:right;">
22.3
</td>
</tr>
</tbody>
</table>
<div id="by-q1-q5" class="section level3" number="12.3.1">
<h3><span class="header-section-number">12.3.1</span> By Q1 / Q5</h3>
<p>We look at Urban conditions in 2011 and 2016 within Q1 and Q5 of 2011
equity metrics</p>
<pre class="r"><code># Extract SES and BEI in 2011
.tab1_2011 &lt;- bei_df_aoi %&gt;%
  filter(wSCOREMAT.2011.Q %in% c(1, 5) ) %&gt;%
  transmute(year = &quot;2011&quot;,
            quintile = case_when(wSCOREMAT.2011.Q == 1 ~ &quot;Q1 Deprivation&quot;,
                                 wSCOREMAT.2011.Q == 5 ~ &quot;Q5 Deprivation&quot;),
            zone = zone,
            CT_UID = CT_UID,
            Population = Population,
            `Material score` = wSCOREMAT.2011,
            `% visible minorities` = vis_minority_2011,
            `gentrified` = gentrified_2016_2011,
            `Bike lane` = Bike_lane_total.2011ct &gt; 0,
            `Bike lane length (hm)` = Bike_lane_total.2011ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2011ct,
            `Green space area (ha)` = area_esp_vert_2011ct,
            `% green space within CT` = pct_esp_vert_2011ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2011ct,
            `% tree canopy within CT` = pct_esp_vert_high_2011ct)

# Extract SES and BEI in 2016
.tab1_2016 &lt;- bei_df_aoi %&gt;%
  filter(wSCOREMAT.2011.Q %in% c(1, 5) ) %&gt;%
  transmute(year = &quot;2016&quot;,
            quintile = case_when(wSCOREMAT.2011.Q == 1 ~ &quot;Q1 Deprivation&quot;,
                                 wSCOREMAT.2011.Q == 5 ~ &quot;Q5 Deprivation&quot;),
            zone = zone,
            CT_UID = CT_UID,
            `Bike lane` = Bike_lane_total.2016ct &gt; 0,
            `Bike lane length (hm)` = Bike_lane_total.2016ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2016ct,
            `Green space area (ha)` = area_esp_vert_2017ct,
            `% green space within CT` = pct_esp_vert_2017ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2017ct,
            `% tree canopy within CT` = pct_esp_vert_high_2017ct)

.tab1_med &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), median, na.rm=TRUE), 
            `% gentrified` = 100 * sum(`gentrified`, na.rm = TRUE) / n(),
            `Bike lane presence` = sum(`Bike lane`),
            `Bike lane absence` = n() - sum(`Bike lane`))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>.tab1_p25 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.25, na.rm=TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>.tab1_p75 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.75, na.rm=TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>tab1 &lt;- inner_join(.tab1_med, .tab1_p25, by=c(&quot;year&quot;, &quot;quintile&quot;), suffix = c(&quot;&quot;, &quot; p25&quot;)) %&gt;%
  inner_join(.tab1_p75, by=c(&quot;year&quot;, &quot;quintile&quot;), suffix = c(&quot;&quot;, &quot; p75&quot;)) %&gt;%
  transmute(year.quintile = paste(year, quintile),
            Population = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                   TRUE ~ paste0(round(`Population`,1), &quot; (&quot;, round(`Population p25`,1), &quot; - &quot;, round(`Population p75`,1), &quot;)&quot;)),
            `Material score` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                         TRUE ~ paste0(round(`Material score`,3), &quot; (&quot;, round(`Material score p25`,3), &quot; - &quot;, round(`Material score p75`,3), &quot;)&quot;)),
            `% visible minorities` = case_when(is.na(`% visible minorities`) ~ &quot;&quot;, 
                                               TRUE ~ paste0(round(`% visible minorities`,1), &quot; (&quot;, round(`% visible minorities p25`,1), &quot; - &quot;, round(`% visible minorities p75`,1), &quot;)&quot;)),
            `% gentrified CTs` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                           TRUE ~ as.character(round(`% gentrified`, 1))),
            `Bike lane presence (N)` = as.character(`Bike lane presence`),
            `Bike lane absence (N)` = as.character(`Bike lane absence`),
            `Bike lane length (hm)` = paste0(round(`Bike lane length (hm)`,1), &quot; (&quot;, round(`Bike lane length (hm) p25`,1), &quot; - &quot;, round(`Bike lane length (hm) p75`,1), &quot;)&quot;),
            `% Bike lane to streets` = paste0(round(`% Bike lane to streets`,1), &quot; (&quot;, round(`% Bike lane to streets p25`,1), &quot; - &quot;, round(`% Bike lane to streets p75`,1), &quot;)&quot;),
            `Green space area (ha)` = paste0(round(`Green space area (ha)`,1), &quot; (&quot;, round(`Green space area (ha) p25`,1), &quot; - &quot;, round(`Green space area (ha) p75`,1), &quot;)&quot;),
            `% green space within CT` = paste0(round(`% green space within CT`,1), &quot; (&quot;, round(`% green space within CT p25`,1), &quot; - &quot;, round(`% green space within CT p75`,1), &quot;)&quot;),
            `Tree canopy area (ha)` = paste0(round(`Tree canopy area (ha)`,1), &quot; (&quot;, round(`Tree canopy area (ha) p25`,1), &quot; - &quot;, round(`Tree canopy area (ha) p75`,1), &quot;)&quot;),
            `% tree canopy within CT` = paste0(round(`% tree canopy within CT`,1), &quot; (&quot;, round(`% tree canopy within CT p25`,1), &quot; - &quot;, round(`% tree canopy within CT p75`,1), &quot;)&quot;)) %&gt;%
  tibble::column_to_rownames(&quot;year.quintile&quot;) %&gt;%
  t() %&gt;% 
  as.data.frame()

tab1 %&gt;% knitr::kable() %&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
2011 Q1 Deprivation
</th>
<th style="text-align:left;">
2011 Q5 Deprivation
</th>
<th style="text-align:left;">
2016 Q1 Deprivation
</th>
<th style="text-align:left;">
2016 Q5 Deprivation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
year
</td>
<td style="text-align:left;">
2011
</td>
<td style="text-align:left;">
2011
</td>
<td style="text-align:left;">
2016
</td>
<td style="text-align:left;">
2016
</td>
</tr>
<tr>
<td style="text-align:left;">
Population
</td>
<td style="text-align:left;">
3092 (1999 - 4873.5)
</td>
<td style="text-align:left;">
3946 (2991.5 - 5229)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Material score
</td>
<td style="text-align:left;">
-0.044 (-0.061 - -0.034)
</td>
<td style="text-align:left;">
0.054 (0.045 - 0.071)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% visible minorities
</td>
<td style="text-align:left;">
15.7 (9.3 - 22.3)
</td>
<td style="text-align:left;">
37.5 (25.8 - 54.5)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% gentrified CTs
</td>
<td style="text-align:left;">
15.6
</td>
<td style="text-align:left;">
40.7
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane presence (N)
</td>
<td style="text-align:left;">
99
</td>
<td style="text-align:left;">
75
</td>
<td style="text-align:left;">
110
</td>
<td style="text-align:left;">
96
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane absence (N)
</td>
<td style="text-align:left;">
36
</td>
<td style="text-align:left;">
60
</td>
<td style="text-align:left;">
25
</td>
<td style="text-align:left;">
39
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane length (hm)
</td>
<td style="text-align:left;">
6.9 (0 - 22.2)
</td>
<td style="text-align:left;">
1.7 (0 - 9.1)
</td>
<td style="text-align:left;">
9.6 (2.4 - 24.6)
</td>
<td style="text-align:left;">
5.6 (0 - 12.5)
</td>
</tr>
<tr>
<td style="text-align:left;">
% Bike lane to streets
</td>
<td style="text-align:left;">
7.6 (0 - 16.5)
</td>
<td style="text-align:left;">
1.3 (0 - 9.8)
</td>
<td style="text-align:left;">
11.5 (3.2 - 21)
</td>
<td style="text-align:left;">
8 (0 - 15.3)
</td>
</tr>
<tr>
<td style="text-align:left;">
Green space area (ha)
</td>
<td style="text-align:left;">
20 (4.5 - 88.5)
</td>
<td style="text-align:left;">
15 (7 - 25)
</td>
<td style="text-align:left;">
25 (5.5 - 93.5)
</td>
<td style="text-align:left;">
17 (8 - 28.5)
</td>
</tr>
<tr>
<td style="text-align:left;">
% green space within CT
</td>
<td style="text-align:left;">
41.1 (24.4 - 53)
</td>
<td style="text-align:left;">
28.8 (20.8 - 35.2)
</td>
<td style="text-align:left;">
47.1 (29.8 - 57)
</td>
<td style="text-align:left;">
32.9 (25 - 40.8)
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree canopy area (ha)
</td>
<td style="text-align:left;">
12 (3 - 41)
</td>
<td style="text-align:left;">
7 (3.5 - 10)
</td>
<td style="text-align:left;">
15 (4 - 47)
</td>
<td style="text-align:left;">
8 (4.5 - 12)
</td>
</tr>
<tr>
<td style="text-align:left;">
% tree canopy within CT
</td>
<td style="text-align:left;">
22 (14.6 - 34.2)
</td>
<td style="text-align:left;">
12.5 (8.8 - 15.9)
</td>
<td style="text-align:left;">
27.9 (19 - 37.4)
</td>
<td style="text-align:left;">
15.8 (10.4 - 19.7)
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Extract SES and BEI in 2011
.tab1_2011 &lt;- bei_df_aoi %&gt;%
  filter(vis_minority_2011.Q %in% c(1, 5) ) %&gt;%
  transmute(year = &quot;2011&quot;,
            quintile = case_when(vis_minority_2011.Q == 1 ~ &quot;Q1 Vis. Minorities&quot;,
                                 vis_minority_2011.Q == 5 ~ &quot;Q5 Vis. Minorities&quot;),
            zone = zone,
            CT_UID = CT_UID,
            Population = Population,
            `Material score` = wSCOREMAT.2011,
            `% visible minorities` = vis_minority_2011,
            `gentrified` = gentrified_2016_2011,
            `Bike lane` = Bike_lane_total.2011ct &gt; 0,
            `Bike lane length (hm)` = Bike_lane_total.2011ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2011ct,
            `Green space area (ha)` = area_esp_vert_2011ct,
            `% green space within CT` = pct_esp_vert_2011ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2011ct,
            `% tree canopy within CT` = pct_esp_vert_high_2011ct)

# Extract SES and BEI in 2016
.tab1_2016 &lt;- bei_df_aoi %&gt;%
  filter(vis_minority_2011.Q %in% c(1, 5) ) %&gt;%
  transmute(year = &quot;2016&quot;,
            quintile = case_when(vis_minority_2011.Q == 1 ~ &quot;Q1 Vis. Minorities&quot;,
                                 vis_minority_2011.Q == 5 ~ &quot;Q5 Vis. Minorities&quot;),
            zone = zone,
            CT_UID = CT_UID,
            `Bike lane` = Bike_lane_total.2016ct &gt; 0,
            `Bike lane length (hm)` = Bike_lane_total.2016ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2016ct,
            `Green space area (ha)` = area_esp_vert_2017ct,
            `% green space within CT` = pct_esp_vert_2017ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2017ct,
            `% tree canopy within CT` = pct_esp_vert_high_2017ct)

.tab1_med &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), median, na.rm=TRUE), 
            `% gentrified` = 100 * sum(`gentrified`, na.rm = TRUE) / n(),
            `Bike lane presence` = sum(`Bike lane`),
            `Bike lane absence` = n() - sum(`Bike lane`))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>.tab1_p25 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.25, na.rm=TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>.tab1_p75 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.75, na.rm=TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>tab1 &lt;- inner_join(.tab1_med, .tab1_p25, by=c(&quot;year&quot;, &quot;quintile&quot;), suffix = c(&quot;&quot;, &quot; p25&quot;)) %&gt;%
  inner_join(.tab1_p75, by=c(&quot;year&quot;, &quot;quintile&quot;), suffix = c(&quot;&quot;, &quot; p75&quot;)) %&gt;%
  transmute(year.quintile = paste(year, quintile),
            Population = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                   TRUE ~ paste0(round(`Population`,1), &quot; (&quot;, round(`Population p25`,1), &quot; - &quot;, round(`Population p75`,1), &quot;)&quot;)),
            `Material score` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                         TRUE ~ paste0(round(`Material score`,3), &quot; (&quot;, round(`Material score p25`,3), &quot; - &quot;, round(`Material score p75`,3), &quot;)&quot;)),
            `% visible minorities` = case_when(is.na(`% visible minorities`) ~ &quot;&quot;, 
                                               TRUE ~ paste0(round(`% visible minorities`,1), &quot; (&quot;, round(`% visible minorities p25`,1), &quot; - &quot;, round(`% visible minorities p75`,1), &quot;)&quot;)),
            `% gentrified CTs` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                           TRUE ~ as.character(round(`% gentrified`, 1))),
            `Bike lane presence (N)` = as.character(`Bike lane presence`),
            `Bike lane absence (N)` = as.character(`Bike lane absence`),
            `Bike lane length (hm)` = paste0(round(`Bike lane length (hm)`,1), &quot; (&quot;, round(`Bike lane length (hm) p25`,1), &quot; - &quot;, round(`Bike lane length (hm) p75`,1), &quot;)&quot;),
            `% Bike lane to streets` = paste0(round(`% Bike lane to streets`,1), &quot; (&quot;, round(`% Bike lane to streets p25`,1), &quot; - &quot;, round(`% Bike lane to streets p75`,1), &quot;)&quot;),
            `Green space area (ha)` = paste0(round(`Green space area (ha)`,1), &quot; (&quot;, round(`Green space area (ha) p25`,1), &quot; - &quot;, round(`Green space area (ha) p75`,1), &quot;)&quot;),
            `% green space within CT` = paste0(round(`% green space within CT`,1), &quot; (&quot;, round(`% green space within CT p25`,1), &quot; - &quot;, round(`% green space within CT p75`,1), &quot;)&quot;),
            `Tree canopy area (ha)` = paste0(round(`Tree canopy area (ha)`,1), &quot; (&quot;, round(`Tree canopy area (ha) p25`,1), &quot; - &quot;, round(`Tree canopy area (ha) p75`,1), &quot;)&quot;),
            `% tree canopy within CT` = paste0(round(`% tree canopy within CT`,1), &quot; (&quot;, round(`% tree canopy within CT p25`,1), &quot; - &quot;, round(`% tree canopy within CT p75`,1), &quot;)&quot;)) %&gt;%
  tibble::column_to_rownames(&quot;year.quintile&quot;) %&gt;%
  t() %&gt;% 
  as.data.frame()

tab1 %&gt;% knitr::kable() %&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
2011 Q1 Vis. Minorities
</th>
<th style="text-align:left;">
2011 Q5 Vis. Minorities
</th>
<th style="text-align:left;">
2016 Q1 Vis. Minorities
</th>
<th style="text-align:left;">
2016 Q5 Vis. Minorities
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
year
</td>
<td style="text-align:left;">
2011
</td>
<td style="text-align:left;">
2011
</td>
<td style="text-align:left;">
2016
</td>
<td style="text-align:left;">
2016
</td>
</tr>
<tr>
<td style="text-align:left;">
Population
</td>
<td style="text-align:left;">
3016 (2123.5 - 4213)
</td>
<td style="text-align:left;">
4193 (3395.5 - 5644)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Material score
</td>
<td style="text-align:left;">
-0.018 (-0.042 - 0.013)
</td>
<td style="text-align:left;">
0.037 (0.013 - 0.063)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% visible minorities
</td>
<td style="text-align:left;">
9.1 (7.4 - 11.1)
</td>
<td style="text-align:left;">
48.8 (43 - 58.2)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% gentrified CTs
</td>
<td style="text-align:left;">
32.6
</td>
<td style="text-align:left;">
29.6
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane presence (N)
</td>
<td style="text-align:left;">
98
</td>
<td style="text-align:left;">
74
</td>
<td style="text-align:left;">
116
</td>
<td style="text-align:left;">
92
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane absence (N)
</td>
<td style="text-align:left;">
37
</td>
<td style="text-align:left;">
61
</td>
<td style="text-align:left;">
19
</td>
<td style="text-align:left;">
43
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane length (hm)
</td>
<td style="text-align:left;">
8.4 (0 - 21.6)
</td>
<td style="text-align:left;">
1.7 (0 - 9.7)
</td>
<td style="text-align:left;">
10.9 (4.3 - 27.8)
</td>
<td style="text-align:left;">
5.2 (0 - 14.5)
</td>
</tr>
<tr>
<td style="text-align:left;">
% Bike lane to streets
</td>
<td style="text-align:left;">
8.1 (0 - 14.5)
</td>
<td style="text-align:left;">
1.1 (0 - 8.3)
</td>
<td style="text-align:left;">
12.9 (6 - 20.5)
</td>
<td style="text-align:left;">
6.6 (0 - 14.3)
</td>
</tr>
<tr>
<td style="text-align:left;">
Green space area (ha)
</td>
<td style="text-align:left;">
20 (6 - 78)
</td>
<td style="text-align:left;">
16 (7.5 - 33.5)
</td>
<td style="text-align:left;">
21 (7 - 83.5)
</td>
<td style="text-align:left;">
19 (9.5 - 37.5)
</td>
</tr>
<tr>
<td style="text-align:left;">
% green space within CT
</td>
<td style="text-align:left;">
37.4 (25.2 - 53)
</td>
<td style="text-align:left;">
30.4 (23.1 - 38.2)
</td>
<td style="text-align:left;">
41.4 (31.9 - 56.9)
</td>
<td style="text-align:left;">
35.8 (26.9 - 44.6)
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree canopy area (ha)
</td>
<td style="text-align:left;">
12 (3 - 39.5)
</td>
<td style="text-align:left;">
7 (4 - 15.5)
</td>
<td style="text-align:left;">
12 (4 - 44.5)
</td>
<td style="text-align:left;">
10 (4 - 17.5)
</td>
</tr>
<tr>
<td style="text-align:left;">
% tree canopy within CT
</td>
<td style="text-align:left;">
18.3 (14.5 - 29.9)
</td>
<td style="text-align:left;">
14.5 (8.4 - 20.4)
</td>
<td style="text-align:left;">
23.3 (18 - 34.8)
</td>
<td style="text-align:left;">
17.4 (9.9 - 24)
</td>
</tr>
</tbody>
</table>
</div>
<div id="by-gentrification-status" class="section level3"
number="12.3.2">
<h3><span class="header-section-number">12.3.2</span> By gentrification
status</h3>
<pre class="r"><code># Extract SES and BEI in 2011
.tab1_2011 &lt;- bei_df_aoi %&gt;%
  filter(!is.na(gentrif_status_2016)) %&gt;%
  transmute(year = &quot;2011&quot;,
            quintile = gentrif_status_2016,
            zone = zone,
            CT_UID = CT_UID,
            Population = Population,
            `Material score` = wSCOREMAT.2011,
            `% visible minorities` = vis_minority_2011,
            `gentrified` = gentrified_2016_2011,
            `Bike lane` = Bike_lane_total.2011ct &gt; 0,
            `Bike lane length (hm)` = Bike_lane_total.2011ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2011ct,
            `Green space area (ha)` = area_esp_vert_2011ct,
            `% green space within CT` = pct_esp_vert_2011ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2011ct,
            `% tree canopy within CT` = pct_esp_vert_high_2011ct)

# Extract SES and BEI in 2016
.tab1_2016 &lt;- bei_df_aoi %&gt;%
  filter(!is.na(gentrif_status_2016)) %&gt;%
  transmute(year = &quot;2016&quot;,
            quintile = gentrif_status_2016,
            zone = zone,
            CT_UID = CT_UID,
            `Bike lane` = Bike_lane_total.2016ct &gt; 0,
            `Bike lane length (hm)` = Bike_lane_total.2016ct/100,
            `% Bike lane to streets` = Bike_lane.by.street.2016ct,
            `Green space area (ha)` = area_esp_vert_2017ct,
            `% green space within CT` = pct_esp_vert_2017ct,
            `Tree canopy area (ha)` = area_esp_vert_high_2017ct,
            `% tree canopy within CT` = pct_esp_vert_high_2017ct)

.tab1_med &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), median, na.rm=TRUE), 
            `% gentrified` = 100 * sum(`gentrified`, na.rm = TRUE) / n(),
            `Bike lane presence` = sum(`Bike lane`),
            `Bike lane absence` = n() - sum(`Bike lane`))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>.tab1_p25 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.25, na.rm=TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>.tab1_p75 &lt;- bind_rows(.tab1_2011, .tab1_2016) %&gt;%
  group_by(year, quintile) %&gt;%
  summarize(across(where(is.numeric), quantile, probs=.75, na.rm=TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>tab1 &lt;- inner_join(.tab1_med, .tab1_p25, by=c(&quot;year&quot;, &quot;quintile&quot;), suffix = c(&quot;&quot;, &quot; p25&quot;)) %&gt;%
  inner_join(.tab1_p75, by=c(&quot;year&quot;, &quot;quintile&quot;), suffix = c(&quot;&quot;, &quot; p75&quot;)) %&gt;%
  transmute(year.quintile = paste(year, quintile),
            Population = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                   TRUE ~ paste0(round(`Population`,1), &quot; (&quot;, round(`Population p25`,1), &quot; - &quot;, round(`Population p75`,1), &quot;)&quot;)),
            `Material score` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                         TRUE ~ paste0(round(`Material score`,3), &quot; (&quot;, round(`Material score p25`,3), &quot; - &quot;, round(`Material score p75`,3), &quot;)&quot;)),
            `% visible minorities` = case_when(is.na(`% visible minorities`) ~ &quot;&quot;, 
                                               TRUE ~ paste0(round(`% visible minorities`,1), &quot; (&quot;, round(`% visible minorities p25`,1), &quot; - &quot;, round(`% visible minorities p75`,1), &quot;)&quot;)),
            `% gentrified CTs` = case_when(year == &quot;2016&quot; ~ &quot;&quot;, 
                                           TRUE ~ as.character(round(`% gentrified`, 1))),
            `Bike lane presence (N)` = as.character(`Bike lane presence`),
            `Bike lane absence (N)` = as.character(`Bike lane absence`),
            `Bike lane length (hm)` = paste0(round(`Bike lane length (hm)`,1), &quot; (&quot;, round(`Bike lane length (hm) p25`,1), &quot; - &quot;, round(`Bike lane length (hm) p75`,1), &quot;)&quot;),
            `% Bike lane to streets` = paste0(round(`% Bike lane to streets`,1), &quot; (&quot;, round(`% Bike lane to streets p25`,1), &quot; - &quot;, round(`% Bike lane to streets p75`,1), &quot;)&quot;),
            `Green space area (ha)` = paste0(round(`Green space area (ha)`,1), &quot; (&quot;, round(`Green space area (ha) p25`,1), &quot; - &quot;, round(`Green space area (ha) p75`,1), &quot;)&quot;),
            `% green space within CT` = paste0(round(`% green space within CT`,1), &quot; (&quot;, round(`% green space within CT p25`,1), &quot; - &quot;, round(`% green space within CT p75`,1), &quot;)&quot;),
            `Tree canopy area (ha)` = paste0(round(`Tree canopy area (ha)`,1), &quot; (&quot;, round(`Tree canopy area (ha) p25`,1), &quot; - &quot;, round(`Tree canopy area (ha) p75`,1), &quot;)&quot;),
            `% tree canopy within CT` = paste0(round(`% tree canopy within CT`,1), &quot; (&quot;, round(`% tree canopy within CT p25`,1), &quot; - &quot;, round(`% tree canopy within CT p75`,1), &quot;)&quot;)) %&gt;%
  tibble::column_to_rownames(&quot;year.quintile&quot;) %&gt;%
  t() %&gt;% 
  as.data.frame()

tab1 %&gt;% knitr::kable() %&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
2011 Not gentrified
</th>
<th style="text-align:left;">
2011 Gentrified
</th>
<th style="text-align:left;">
2011 Non eligible
</th>
<th style="text-align:left;">
2016 Not gentrified
</th>
<th style="text-align:left;">
2016 Gentrified
</th>
<th style="text-align:left;">
2016 Non eligible
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
year
</td>
<td style="text-align:left;">
2011
</td>
<td style="text-align:left;">
2011
</td>
<td style="text-align:left;">
2011
</td>
<td style="text-align:left;">
2016
</td>
<td style="text-align:left;">
2016
</td>
<td style="text-align:left;">
2016
</td>
</tr>
<tr>
<td style="text-align:left;">
Population
</td>
<td style="text-align:left;">
3833.5 (2732.5 - 5212.2)
</td>
<td style="text-align:left;">
3176 (2257.5 - 4510.5)
</td>
<td style="text-align:left;">
4276 (3232.2 - 5528.5)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Material score
</td>
<td style="text-align:left;">
0.024 (0.001 - 0.046)
</td>
<td style="text-align:left;">
0.018 (-0.004 - 0.039)
</td>
<td style="text-align:left;">
-0.016 (-0.042 - 0.007)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% visible minorities
</td>
<td style="text-align:left;">
28.2 (17.5 - 43.4)
</td>
<td style="text-align:left;">
21.1 (13.9 - 32.4)
</td>
<td style="text-align:left;">
19.9 (12.3 - 29.1)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
% gentrified CTs
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane presence (N)
</td>
<td style="text-align:left;">
142
</td>
<td style="text-align:left;">
129
</td>
<td style="text-align:left;">
205
</td>
<td style="text-align:left;">
176
</td>
<td style="text-align:left;">
170
</td>
<td style="text-align:left;">
219
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane absence (N)
</td>
<td style="text-align:left;">
80
</td>
<td style="text-align:left;">
78
</td>
<td style="text-align:left;">
41
</td>
<td style="text-align:left;">
46
</td>
<td style="text-align:left;">
37
</td>
<td style="text-align:left;">
27
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike lane length (hm)
</td>
<td style="text-align:left;">
4.2 (0 - 13.2)
</td>
<td style="text-align:left;">
3.7 (0 - 11)
</td>
<td style="text-align:left;">
14.7 (3 - 31.5)
</td>
<td style="text-align:left;">
7.8 (2 - 16.2)
</td>
<td style="text-align:left;">
7.9 (2.4 - 15.3)
</td>
<td style="text-align:left;">
17.3 (6.8 - 35.3)
</td>
</tr>
<tr>
<td style="text-align:left;">
% Bike lane to streets
</td>
<td style="text-align:left;">
5.8 (0 - 12.1)
</td>
<td style="text-align:left;">
5.6 (0 - 14.5)
</td>
<td style="text-align:left;">
7.5 (1.7 - 13.6)
</td>
<td style="text-align:left;">
9.6 (3 - 17.2)
</td>
<td style="text-align:left;">
13.4 (3.9 - 20)
</td>
<td style="text-align:left;">
9.7 (3.8 - 16.1)
</td>
</tr>
<tr>
<td style="text-align:left;">
Green space area (ha)
</td>
<td style="text-align:left;">
17 (7.2 - 28)
</td>
<td style="text-align:left;">
9 (4 - 22)
</td>
<td style="text-align:left;">
66 (35.2 - 119.8)
</td>
<td style="text-align:left;">
19 (9 - 30.8)
</td>
<td style="text-align:left;">
10 (5 - 24.5)
</td>
<td style="text-align:left;">
69 (40 - 123.8)
</td>
</tr>
<tr>
<td style="text-align:left;">
% green space within CT
</td>
<td style="text-align:left;">
31.4 (22.7 - 38.7)
</td>
<td style="text-align:left;">
27.5 (20.7 - 35.2)
</td>
<td style="text-align:left;">
48.2 (40.3 - 57.9)
</td>
<td style="text-align:left;">
36.5 (27.1 - 43.3)
</td>
<td style="text-align:left;">
32.8 (25.6 - 40.5)
</td>
<td style="text-align:left;">
51.2 (44.2 - 60.3)
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree canopy area (ha)
</td>
<td style="text-align:left;">
8 (4 - 12)
</td>
<td style="text-align:left;">
5 (3 - 10)
</td>
<td style="text-align:left;">
24 (14 - 52.8)
</td>
<td style="text-align:left;">
9 (5 - 15)
</td>
<td style="text-align:left;">
6 (4 - 12)
</td>
<td style="text-align:left;">
28 (16 - 58.8)
</td>
</tr>
<tr>
<td style="text-align:left;">
% tree canopy within CT
</td>
<td style="text-align:left;">
15.2 (11.6 - 19.7)
</td>
<td style="text-align:left;">
15.2 (11.4 - 19.5)
</td>
<td style="text-align:left;">
20.6 (12.9 - 30.5)
</td>
<td style="text-align:left;">
19.1 (13.6 - 23.6)
</td>
<td style="text-align:left;">
19.4 (15 - 23.8)
</td>
<td style="text-align:left;">
24.3 (15.2 - 34.8)
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="interactions-in-ui-associations" class="section level2"
number="12.4">
<h2><span class="header-section-number">12.4</span> Interactions in UI
associations</h2>
<div id="continuous-ses-variables" class="section level3"
number="12.4.1">
<h3><span class="header-section-number">12.4.1</span> Continuous SES
variables</h3>
<p><em>NB</em> Update 2023-01-17: we graph gentrification separately
now</p>
<pre class="r"><code>base_size_all = 20
# extract the legend from one of the plots
legend.row1 &lt;- get_legend(
  # create some space to the left of the legend
  g_mat_gr + labs(colour=&#39;Material score\n(Quintiles)&#39;, fill=&#39;Material score\n(Quintiles)&#39;) + theme(legend.box.margin = margin(0, 0, 0, 12)) + theme_classic(base_size = base_size_all)
)

prow1.1 &lt;- plot_grid(
  g_mat_bk.hrdl + xlab(&quot;% Bike lane to streets 2011&quot;) + ylab(&quot;% Bike lane to streets 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_mat_gr + xlab(&quot;% green space within CT 2011&quot;) + ylab(&quot;% green space within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_mat_tc + xlab(&quot;% tree canopy within CT 2011&quot;) + ylab(&quot;% tree canopy within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  align = &quot;vh&quot;,
  labels = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;),
  hjust = -1,
  nrow = 1
)

prow1 &lt;- plot_grid(prow1.1, legend.row1, rel_widths = c(3, .4))

# extract the legend from one of the plots
legend.row2 &lt;- get_legend(
  # create some space to the left of the legend
  g_vis_gr + labs(colour=&#39;Visible minorities\n(Quintiles)&#39;, fill=&#39;Visible minorities\n(Quintiles)&#39;) + theme(legend.box.margin = margin(0, 0, 0, 12)) + theme_classic(base_size = base_size_all)
)

prow2.1 &lt;- plot_grid(
  g_vis_bk.hrdl + xlab(&quot;% Bike lane to streets 2011&quot;) + ylab(&quot;% Bike lane to streets 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_vis_gr + xlab(&quot;% green space within CT 2011&quot;) + ylab(&quot;% green space within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_vis_tc + xlab(&quot;% tree canopy within CT 2011&quot;) + ylab(&quot;% tree canopy within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  align = &quot;vh&quot;,
  labels = c(&quot;D&quot;, &quot;E&quot;, &quot;F&quot;),
  hjust = -1,
  nrow = 1
)

prow2 &lt;- plot_grid(prow2.1, legend.row2, rel_widths = c(3, .4))

# output all graphs
plot_grid(prow1, prow2, ncol=1)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_img/cont_interactions.png" /></p>
<pre class="r"><code>base_size_all = 20

# extract the legend from one of the plots
legend.row3 &lt;- get_legend(
  # create some space to the left of the legend
  g_gen_gr + labs(colour=&#39;Gentrified&#39;, fill=&#39;Gentrified&#39;) + theme(legend.box.margin = margin(0, 0, 0, 12)) + theme_classic(base_size = base_size_all)
)

prow3.1 &lt;- plot_grid(
  g_gen_bk.hrdl + xlab(&quot;% Bike lane to streets 2011&quot;) + ylab(&quot;% Bike lane to streets 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_gen_gr + xlab(&quot;% green space within CT 2011&quot;) + ylab(&quot;% green space within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_gen_tc + xlab(&quot;% tree canopy within CT 2011&quot;) + ylab(&quot;% tree canopy within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  align = &quot;vh&quot;,
  labels = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;),
  hjust = -1,
  nrow = 1
)

plot_grid(prow3.1, legend.row3, rel_widths = c(3, .4))</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_img/cont_interactions_bike.png" /></p>
</div>
<div id="categorical-ses-variables" class="section level3"
number="12.4.2">
<h3><span class="header-section-number">12.4.2</span> Categorical SES
variables</h3>
<pre class="r"><code>base_size_all = 20
# extract the legend from one of the plots
legend.row1 &lt;- get_legend(
  # create some space to the left of the legend
  g_mat_tc.categ + labs(colour=&#39;Material score\n(Quintiles) as\ncategorical variables&#39;, fill=&#39;Material score\n(Quintiles) as\ncategorical variables&#39;) + theme(legend.box.margin = margin(0, 0, 0, 12))+ theme_classic(base_size = base_size_all)
)

prow1.1 &lt;- plot_grid(
  g_mat_bk.hrdl.categ + xlab(&quot;% Bike lane to streets 2011&quot;) + ylab(&quot;% Bike lane to streets 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_mat_gr.categ + xlab(&quot;% green space within CT 2011&quot;) + ylab(&quot;% green space within CT 2016&quot;)  + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_mat_tc.categ + xlab(&quot;% tree canopy within CT 2011&quot;) + ylab(&quot;% tree canopy within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  align = &quot;vh&quot;,
  labels = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;),
  hjust = -1,
  nrow = 1
)

prow1 &lt;- plot_grid(prow1.1, legend.row1, rel_widths = c(3, .4))

# extract the legend from one of the plots
legend.row2 &lt;- get_legend(
  # create some space to the left of the legend
  g_vis_gr.categ + labs(colour=&#39;Visible minorities\n(Quintiles) as\ncategorical variables&#39;, fill=&#39;Visible minorities\n(Quintiles) as\ncategorical variables&#39;) + theme(legend.box.margin = margin(0, 0, 0, 12))+ theme_classic(base_size = base_size_all)
)

prow2.1 &lt;- plot_grid(
  g_vis_bk.hrdl.categ + xlab(&quot;% Bike lane to streets 2011&quot;) + ylab(&quot;% Bike lane to streets 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_vis_gr.categ + xlab(&quot;% green space within CT 2011&quot;) + ylab(&quot;% green space within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  g_vis_tc.categ + xlab(&quot;% tree canopy within CT 2011&quot;) + ylab(&quot;% tree canopy within CT 2016&quot;) + theme_classic(base_size = base_size_all) + theme(legend.position = &quot;none&quot;),
  align = &quot;vh&quot;,
  labels = c(&quot;D&quot;, &quot;E&quot;, &quot;F&quot;),
  hjust = -1,
  nrow = 1
)

prow2 &lt;- plot_grid(prow2.1, legend.row2, rel_widths = c(3, .4))

# output all graphs
plot_grid(prow1, prow2, ncol=1)</code></pre>
<p><img
src="BEI_equity_paper.final.aoiOK_img/disc_interactions.png" /></p>
</div>
</div>
</div>
<div id="ultimate-checksresponses-to-ssmph-reviewers"
class="section level1" number="13">
<h1><span class="header-section-number">13</span> Ultimate
checks/responses to SSMPH reviewers</h1>
<div id="reviewer-1" class="section level2" number="13.1">
<h2><span class="header-section-number">13.1</span> Reviewer #1:</h2>
<blockquote>
<p>Thank you to the authors for their thorough response to the comments
received. Overall the paper and its contribution are clearly presented
and the additional/revised figures help further strengthen provide
framing for the findings.</p>
<p>To the inquiry regarding providing evidence of their methodological
contribution, I appreciate the authors response that ‚ÄúDue to the
fundamental differences in the nature of our data and the suitability of
the models, a direct comparison between the hurdle model and regular OLS
would not provide meaningful insights. The choice of the hurdle model
was driven by the specific characteristics of our dataset, allowing us
to account for the unique challenges posed by the skewed distribution.‚Äù
However, given the methodological contribution, showing how it allows
the authors to draw more rigorous inference might also be accompanied by
showing how different (or similar?) the results and conclusion would
have been if using OLS, not accounting appropriately for the structure
of the data using the spatial hurdle modeling appraoch (in an
appendix).</p>
</blockquote>
<div
id="association-between-ses-measures-and-cycling-infrastructure-in-2011"
class="section level3" number="13.1.1">
<h3><span class="header-section-number">13.1.1</span> Association
between SES measures and cycling infrastructure in 2011</h3>
<p>Rerunning the model, this time a simple OLS, not Hurdle model, see
table 2 in paper</p>
<div id="ols-no-spatial-structure" class="section level4 tabset"
number="13.1.1.1">
<h4 class="tabset"><span class="header-section-number">13.1.1.1</span>
OLS, no spatial structure</h4>
<div id="material-deprivation-pampalon" class="section level5"
number="13.1.1.1.1">
<h5><span class="header-section-number">13.1.1.1.1</span> Material
deprivation (Pampalon)</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  tidy_df(CT16, f)

res.lmm.ols &lt;- fitme(Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_length.hm)),
                 data = clean_bei.cnt$df,
                 family = Poisson())
smy.ols &lt;- summary(res.lmm.ols, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_length.hm))
## Estimation of fixed effects by ML.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                  Estimate Cond. SE t-value p-value
## (Intercept)       -2.1278  0.02304  -92.34       0
## wSCOREMAT.2011.Q  -0.1016  0.00795  -12.78       0
##  ------------- Likelihood values  -------------
##                         logLik
## logL               : -5019.799</code></pre>
<pre class="r"><code>ci.lmm.ols &lt;- confint(res.lmm.ols, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##             -0.1172278             -0.0860624</code></pre>
<pre class="r"><code># transformed coef
smy.ols.bt &lt;- data.frame(smy.ols$beta_table)
round(exp(res.lmm.ols[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.ols.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;OLS transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.119
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.903
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.ols$interval), 3)%&gt;%
  data.frame(wSCOREMAT.2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;OLS confidence interval&quot;) %&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.889
</td>
<td style="text-align:right;">
0.918
</td>
</tr>
</tbody>
</table>
</div>
<div id="visble-minority" class="section level5" number="13.1.1.1.2">
<h5><span class="header-section-number">13.1.1.1.2</span> Visble
minority</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  tidy_df(CT16, f)

res.lmm.ols &lt;- fitme(Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_length.hm)),
                 data = clean_bei.cnt$df,
                 family = Poisson())
smy.ols &lt;- summary(res.lmm.ols, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_length.hm))
## Estimation of fixed effects by ML.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                     Estimate Cond. SE t-value p-value
## (Intercept)          -2.0281 0.023148  -87.61       0
## vis_minority_2011.Q  -0.1376 0.007762  -17.73       0
##  ------------- Likelihood values  -------------
##                         logLik
## logL               : -4855.509</code></pre>
<pre class="r"><code>ci.lmm.ols &lt;- confint(res.lmm.ols, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##                -0.1528602                -0.1224336</code></pre>
<pre class="r"><code># transformed coef
smy.ols.bt &lt;- data.frame(smy.ols$beta_table)
round(exp(res.lmm.ols[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.ols.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;OLS transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.132
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.871
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.ols$interval), 3)%&gt;%
  data.frame(vis_minority_2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;OLS confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.858
</td>
<td style="text-align:right;">
0.885
</td>
</tr>
</tbody>
</table>
</div>
<div id="gentrification-1" class="section level5" number="13.1.1.1.3">
<h5><span class="header-section-number">13.1.1.1.3</span>
Gentrification</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  tidy_df(CT16, f)

res.lmm.ols &lt;- fitme(Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_length.hm)),
                 data = clean_bei.cnt$df,
                 family = Poisson())
smy.ols &lt;- summary(res.lmm.ols, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_length.hm))
## Estimation of fixed effects by ML.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE  t-value   p-value
## (Intercept)                      -2.5631  0.02303 -111.283 0.000e+00
## gentrif_status_2016Gentrified     0.1266  0.03473    3.646 2.660e-04
## gentrif_status_2016Non eligible   0.2173  0.02667    8.149 3.331e-16
##  ------------- Likelihood values  -------------
##                         logLik
## logL               : -4980.032</code></pre>
<pre class="r"><code># transformed coef
smy.ols.bt &lt;- data.frame(smy.ols$beta_table)
round(exp(res.lmm.ols[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.ols.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;OLS transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.077
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
1.135
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
1.243
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>varfixef.ols &lt;- names(res.lmm.ols[[&#39;fixef&#39;]])
ci.1.lmm.ols &lt;- confint(res.lmm.ols, varfixef.ols[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                           0.0584701                           0.1946228</code></pre>
<pre class="r"><code>ci.2.lmm.ols &lt;- confint(res.lmm.ols, varfixef.ols[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                             0.1652792                             0.2698287</code></pre>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.ols$interval, ci.2.lmm.ols$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef.ols[2:3])
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;OLS model confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
1.06
</td>
<td style="text-align:right;">
1.215
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
1.18
</td>
<td style="text-align:right;">
1.310
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ols-with-spatial-structure" class="section level4 tabset"
number="13.1.1.2">
<h4 class="tabset"><span class="header-section-number">13.1.1.2</span>
OLS, with spatial structure</h4>
<div id="material-deprivation-pampalon-1" class="section level5"
number="13.1.1.2.1">
<h5><span class="header-section-number">13.1.1.2.1</span> Material
deprivation (Pampalon)</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  tidy_df(CT16, f)

res.lmm.ols &lt;- fitme(Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei$nbmatx,
                 family = Poisson())</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre class="r"><code>smy.ols &lt;- summary(res.lmm.ols, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                  Estimate Cond. SE t-value  p-value
## (Intercept)        -2.426  0.19433 -12.485 0.000000
## wSCOREMAT.2011.Q   -0.160  0.05119  -3.125 0.001778
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1367436 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.602  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2182.148</code></pre>
<pre class="r"><code>ci.lmm.ols &lt;- confint(res.lmm.ols, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.26194844            -0.05922203</code></pre>
<pre class="r"><code># transformed coef
smy.ols.bt &lt;- data.frame(smy.ols$beta_table)
round(exp(res.lmm.ols[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.ols.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;OLS transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.088
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.852
</td>
<td style="text-align:right;">
0.002
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.ols$interval), 3)%&gt;%
  data.frame(wSCOREMAT.2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;OLS confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.77
</td>
<td style="text-align:right;">
0.942
</td>
</tr>
</tbody>
</table>
</div>
<div id="visble-minority-1" class="section level5" number="13.1.1.2.2">
<h5><span class="header-section-number">13.1.1.2.2</span> Visble
minority</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  tidy_df(CT16, f)

res.lmm.ols &lt;- fitme(Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei$nbmatx,
                 family = Poisson())</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre class="r"><code>smy.ols &lt;- summary(res.lmm.ols, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                     Estimate Cond. SE t-value  p-value
## (Intercept)          -2.5160  0.18782 -13.396 0.000000
## vis_minority_2011.Q  -0.1459  0.05203  -2.803 0.005061
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1360156 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.604  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2179.939</code></pre>
<pre class="r"><code>ci.lmm.ols &lt;- confint(res.lmm.ols, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.24945704               -0.04294361</code></pre>
<pre class="r"><code># transformed coef
smy.ols.bt &lt;- data.frame(smy.ols$beta_table)
round(exp(res.lmm.ols[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.ols.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;OLS transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.081
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.864
</td>
<td style="text-align:right;">
0.005
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.ols$interval), 3)%&gt;%
  data.frame(vis_minority_2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;OLS confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.779
</td>
<td style="text-align:right;">
0.958
</td>
</tr>
</tbody>
</table>
</div>
<div id="gentrification-2" class="section level5" number="13.1.1.2.3">
<h5><span class="header-section-number">13.1.1.2.3</span>
Gentrification</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  tidy_df(CT16, f)

res.lmm.ols &lt;- fitme(Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei$nbmatx,
                 family = Poisson())</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre class="r"><code>smy.ols &lt;- summary(res.lmm.ols, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                   Estimate Cond. SE    t-value p-value
## (Intercept)                     -2.9936037   0.1498 -19.983823  0.0000
## gentrif_status_2016Gentrified    0.0006944   0.1511   0.004597  0.9963
## gentrif_status_2016Non eligible  0.1339336   0.1579   0.848312  0.3963
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1364974 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.628  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2183.358</code></pre>
<pre class="r"><code># transformed coef
smy.ols.bt &lt;- data.frame(smy.ols$beta_table)
round(exp(res.lmm.ols[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.ols.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;OLS transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.050
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
1.001
</td>
<td style="text-align:right;">
0.996
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
1.143
</td>
<td style="text-align:right;">
0.396
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>varfixef.ols &lt;- names(res.lmm.ols[[&#39;fixef&#39;]])
ci.1.lmm.ols &lt;- confint(res.lmm.ols, varfixef.ols[2])</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                          -0.2986122                           0.2997257</code></pre>
<pre class="r"><code>ci.2.lmm.ols &lt;- confint(res.lmm.ols, varfixef.ols[3])</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                            -0.1783749                             0.4479967</code></pre>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.ols$interval, ci.2.lmm.ols$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef.ols[2:3])
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;OLS model confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
0.742
</td>
<td style="text-align:right;">
1.349
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
0.837
</td>
<td style="text-align:right;">
1.565
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="cycling-infrastructure-change-between-2011-and-2016"
class="section level3" number="13.1.2">
<h3><span class="header-section-number">13.1.2</span> Cycling
infrastructure change between 2011 and 2016</h3>
<p>Rerunning the model, this time a simple OLS, not Hurdle model, see
table 3 in paper</p>
<div id="ols-no-spatial-structure-1" class="section level4 tabset"
number="13.1.2.1">
<h4 class="tabset"><span class="header-section-number">13.1.2.1</span>
OLS, no spatial structure</h4>
<div id="material-deprivation-pampalon-2" class="section level5"
number="13.1.2.1.1">
<h5><span class="header-section-number">13.1.2.1.1</span> Material
deprivation (Pampalon)</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  tidy_df(CT16, f)

res.lmm.ols &lt;- fitme(Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm)),
                 data = clean_bei.cnt$df,
                 family = Poisson())
smy.ols &lt;- summary(res.lmm.ols, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm))
## Estimation of fixed effects by ML.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                              Estimate  Cond. SE t-value
## (Intercept)                                 -2.706490 0.0345360 -78.367
## wSCOREMAT.2011.Q                            -0.061191 0.0113309  -5.400
## Bike_lane.by.street.2011ct                   0.049843 0.0016993  29.332
## wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct  0.003582 0.0005951   6.019
##                                               p-value
## (Intercept)                                 0.000e+00
## wSCOREMAT.2011.Q                            6.649e-08
## Bike_lane.by.street.2011ct                  0.000e+00
## wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct 1.753e-09
##  ------------- Likelihood values  -------------
##                         logLik
## logL               : -2817.677</code></pre>
<pre class="r"><code>ci.lmm.ols &lt;- confint(res.lmm.ols, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.08341679            -0.03900060</code></pre>
<pre class="r"><code>ci.lmm.ols.i &lt;- confint(res.lmm.ols, &#39;wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct 
##                                       0.002413276 
## upper wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct 
##                                       0.004745909</code></pre>
<pre class="r"><code># transformed coef
smy.ols.bt &lt;- data.frame(smy.ols$beta_table)
round(exp(res.lmm.ols[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.ols.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;OLS transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.067
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.941
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.051
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.004
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm.ols$interval), 3),
           `wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.ols.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;OLS confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.920
</td>
<td style="text-align:right;">
0.962
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q.Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.002
</td>
<td style="text-align:right;">
1.005
</td>
</tr>
</tbody>
</table>
</div>
<div id="visble-minority-2" class="section level5" number="13.1.2.1.2">
<h5><span class="header-section-number">13.1.2.1.2</span> Visble
minority</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  tidy_df(CT16, f)

res.lmm.ols &lt;- fitme(Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm)),
                 data = clean_bei.cnt$df,
                 family = Poisson())
smy.ols &lt;- summary(res.lmm.ols, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm))
## Estimation of fixed effects by ML.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                 Estimate  Cond. SE t-value
## (Intercept)                                    -2.734011 0.0361439 -75.642
## vis_minority_2011.Q                            -0.051459 0.0111556  -4.613
## Bike_lane.by.street.2011ct                      0.050928 0.0018546  27.460
## vis_minority_2011.Q:Bike_lane.by.street.2011ct  0.003402 0.0006271   5.425
##                                                  p-value
## (Intercept)                                    0.000e+00
## vis_minority_2011.Q                            3.971e-06
## Bike_lane.by.street.2011ct                     0.000e+00
## vis_minority_2011.Q:Bike_lane.by.street.2011ct 5.805e-08
##  ------------- Likelihood values  -------------
##                         logLik
## logL               : -2813.203</code></pre>
<pre class="r"><code>ci.lmm.ols &lt;- confint(res.lmm.ols, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.07332440               -0.02959536</code></pre>
<pre class="r"><code>ci.lmm.ols.i &lt;- confint(res.lmm.ols, &#39;vis_minority_2011.Q:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q:Bike_lane.by.street.2011ct 
##                                          0.002169860 
## upper vis_minority_2011.Q:Bike_lane.by.street.2011ct 
##                                          0.004627999</code></pre>
<pre class="r"><code># transformed coef
smy.ols.bt &lt;- data.frame(smy.ols$beta_table)
round(exp(res.lmm.ols[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.ols.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;OLS transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.065
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.950
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.052
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q:Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.003
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm.ols$interval), 3),
           `vis_minority_2011.Q:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.ols.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;OLS confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.929
</td>
<td style="text-align:right;">
0.971
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q.Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.002
</td>
<td style="text-align:right;">
1.005
</td>
</tr>
</tbody>
</table>
</div>
<div id="gentrification-3" class="section level5" number="13.1.2.1.3">
<h5><span class="header-section-number">13.1.2.1.3</span>
Gentrification</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  tidy_df(CT16, f)

res.lmm.ols &lt;- fitme(Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + offset(log(street_length.hm)),
                 data = clean_bei.cnt$df,
                 family = Poisson())
smy.ols &lt;- summary(res.lmm.ols, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm))
## Estimation of fixed effects by ML.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                              Estimate Cond. SE
## (Intercept)                                                -2.8833229 0.030588
## gentrif_status_2016Gentrified                               0.2043971 0.046415
## gentrif_status_2016Non eligible                            -0.0652290 0.037394
## Bike_lane.by.street.2011ct                                  0.0608116 0.001808
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct   -0.0069020 0.002675
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct  0.0009612 0.002129
##                                                             t-value   p-value
## (Intercept)                                                -94.2622 0.000e+00
## gentrif_status_2016Gentrified                                4.4037 1.064e-05
## gentrif_status_2016Non eligible                             -1.7444 8.110e-02
## Bike_lane.by.street.2011ct                                  33.6286 0.000e+00
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct    -2.5802 9.874e-03
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct   0.4514 6.517e-01
##  ------------- Likelihood values  -------------
##                         logLik
## logL               : -2802.945</code></pre>
<pre class="r"><code># transformed coef
smy.ols.bt &lt;- data.frame(smy.ols$beta_table)
round(exp(res.lmm.ols[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.ols.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;OLS transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.056
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
1.227
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
0.937
</td>
<td style="text-align:right;">
0.081
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.063
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
0.993
</td>
<td style="text-align:right;">
0.010
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.001
</td>
<td style="text-align:right;">
0.652
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>varfixef.ols &lt;- names(res.lmm.ols[[&#39;fixef&#39;]])
ci.1.lmm.ols &lt;- confint(res.lmm.ols, varfixef.ols[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                           0.1133021                           0.2952548</code></pre>
<pre class="r"><code>ci.2.lmm.ols &lt;- confint(res.lmm.ols, varfixef.ols[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                          -0.138370816                           0.008216581</code></pre>
<pre class="r"><code>ci.3.lmm.ols &lt;- confint(res.lmm.ols, varfixef.ols[5])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct 
##                                                   -0.012145077 
## upper gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct 
##                                                   -0.001658562</code></pre>
<pre class="r"><code>ci.4.lmm.ols &lt;- confint(res.lmm.ols, varfixef.ols[6])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct 
##                                                     -0.003191322 
## upper gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct 
##                                                      0.005156547</code></pre>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.ols$interval, ci.2.lmm.ols$interval, ci.3.lmm.ols$interval, ci.4.lmm.ols$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = c(varfixef.ols[2:3], varfixef.ols[5:6]))
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;OLS model confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
1.120
</td>
<td style="text-align:right;">
1.343
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
0.871
</td>
<td style="text-align:right;">
1.008
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
0.988
</td>
<td style="text-align:right;">
0.998
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
0.997
</td>
<td style="text-align:right;">
1.005
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ols-with-spatial-structure-1" class="section level4 tabset"
number="13.1.2.2">
<h4 class="tabset"><span class="header-section-number">13.1.2.2</span>
OLS, with spatial structure</h4>
<div id="material-deprivation-pampalon-3" class="section level5"
number="13.1.2.2.1">
<h5><span class="header-section-number">13.1.2.2.1</span> Material
deprivation (Pampalon)</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  tidy_df(CT16, f)

res.lmm.ols &lt;- fitme(Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei$nbmatx,
                 family = Poisson())</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre class="r"><code>smy.ols &lt;- summary(res.lmm.ols, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                             Estimate Cond. SE  t-value p-value
## (Intercept)                                 -3.05132 0.115485 -26.4218  0.0000
## wSCOREMAT.2011.Q                            -0.03886 0.031239  -1.2438  0.2136
## Bike_lane.by.street.2011ct                   0.07091 0.006307  11.2433  0.0000
## wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct  0.00189 0.001943   0.9728  0.3307
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1372808 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.3055  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2199.864</code></pre>
<pre class="r"><code>ci.lmm.ols &lt;- confint(res.lmm.ols, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.10043673             0.02257305</code></pre>
<pre class="r"><code>ci.lmm.ols.i &lt;- confint(res.lmm.ols, &#39;wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct 
##                                      -0.001939311 
## upper wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct 
##                                       0.005713841</code></pre>
<pre class="r"><code># transformed coef
smy.ols.bt &lt;- data.frame(smy.ols$beta_table)
round(exp(res.lmm.ols[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.ols.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;OLS transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.047
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.962
</td>
<td style="text-align:right;">
0.214
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.073
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.002
</td>
<td style="text-align:right;">
0.331
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm.ols$interval), 3),
           `wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.ols.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;OLS confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.904
</td>
<td style="text-align:right;">
1.023
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q.Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
0.998
</td>
<td style="text-align:right;">
1.006
</td>
</tr>
</tbody>
</table>
</div>
<div id="visble-minority-3" class="section level5" number="13.1.2.2.2">
<h5><span class="header-section-number">13.1.2.2.2</span> Visble
minority</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  tidy_df(CT16, f)

res.lmm.ols &lt;- fitme(Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei$nbmatx,
                 family = Poisson())</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre class="r"><code>smy.ols &lt;- summary(res.lmm.ols, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                 Estimate Cond. SE t-value
## (Intercept)                                    -2.888622 0.114371 -25.256
## vis_minority_2011.Q                            -0.092549 0.031891  -2.902
## Bike_lane.by.street.2011ct                      0.062613 0.006510   9.619
## vis_minority_2011.Q:Bike_lane.by.street.2011ct  0.004925 0.002028   2.429
##                                                 p-value
## (Intercept)                                    0.000000
## vis_minority_2011.Q                            0.003707
## Bike_lane.by.street.2011ct                     0.000000
## vis_minority_2011.Q:Bike_lane.by.street.2011ct 0.015153
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1372909 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.3022  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2193.294</code></pre>
<pre class="r"><code>ci.lmm.ols &lt;- confint(res.lmm.ols, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.15571695               -0.02983686</code></pre>
<pre class="r"><code>ci.lmm.ols.i &lt;- confint(res.lmm.ols, &#39;vis_minority_2011.Q:Bike_lane.by.street.2011ct&#39;)</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre><code>## lower vis_minority_2011.Q:Bike_lane.by.street.2011ct 
##                                         0.0009398724 
## upper vis_minority_2011.Q:Bike_lane.by.street.2011ct 
##                                         0.0089365529</code></pre>
<pre class="r"><code># transformed coef
smy.ols.bt &lt;- data.frame(smy.ols$beta_table)
round(exp(res.lmm.ols[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.ols.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;OLS transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.056
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.912
</td>
<td style="text-align:right;">
0.004
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.065
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q:Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.005
</td>
<td style="text-align:right;">
0.015
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm.ols$interval), 3),
           `vis_minority_2011.Q:Bike_lane.by.street.2011ct` = round(exp(ci.lmm.ols.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;OLS confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.856
</td>
<td style="text-align:right;">
0.971
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q.Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.001
</td>
<td style="text-align:right;">
1.009
</td>
</tr>
</tbody>
</table>
</div>
<div id="gentrification-4" class="section level5" number="13.1.2.2.3">
<h5><span class="header-section-number">13.1.2.2.3</span>
Gentrification</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + offset(log(street_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi, CT16, f)

# Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi %&gt;%
  tidy_df(CT16, f)

res.lmm.ols &lt;- fitme(Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + offset(log(street_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei$nbmatx,
                 family = Poisson())</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre class="r"><code>smy.ols &lt;- summary(res.lmm.ols, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street.2011ct + 
##     offset(log(street_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                             Estimate Cond. SE
## (Intercept)                                                -3.061543 0.085535
## gentrif_status_2016Gentrified                              -0.018205 0.099395
## gentrif_status_2016Non eligible                            -0.268090 0.101418
## Bike_lane.by.street.2011ct                                  0.072666 0.004811
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct   -0.001654 0.006705
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct  0.014399 0.006769
##                                                             t-value  p-value
## (Intercept)                                                -35.7929 0.000000
## gentrif_status_2016Gentrified                               -0.1832 0.854670
## gentrif_status_2016Non eligible                             -2.6434 0.008207
## Bike_lane.by.street.2011ct                                  15.1044 0.000000
## gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct    -0.2468 0.805097
## gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct   2.1271 0.033412
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1374791 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.2981  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -2193.279</code></pre>
<pre class="r"><code># transformed coef
smy.ols.bt &lt;- data.frame(smy.ols$beta_table)
round(exp(res.lmm.ols[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.ols.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;OLS transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.047
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
0.982
</td>
<td style="text-align:right;">
0.855
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
0.765
</td>
<td style="text-align:right;">
0.008
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.075
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
0.998
</td>
<td style="text-align:right;">
0.805
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.015
</td>
<td style="text-align:right;">
0.033
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>varfixef.ols &lt;- names(res.lmm.ols[[&#39;fixef&#39;]])
ci.1.lmm.ols &lt;- confint(res.lmm.ols, varfixef.ols[2])</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                          -0.2148631                           0.1770832</code></pre>
<pre class="r"><code>ci.2.lmm.ols &lt;- confint(res.lmm.ols, varfixef.ols[3])</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                           -0.46815596                           -0.06876478</code></pre>
<pre class="r"><code>ci.3.lmm.ols &lt;- confint(res.lmm.ols, varfixef.ols[5])</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct 
##                                                    -0.01482994 
## upper gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct 
##                                                     0.01157858</code></pre>
<pre class="r"><code>ci.4.lmm.ols &lt;- confint(res.lmm.ols, varfixef.ols[6])</code></pre>
<pre><code>## Warning in .sym_checked(adjMatrix, &quot;adjMatrix&quot;): Forcing colnames(mMatrix) &lt;-
## rownames(mMatrix) before calling isSymmetric().</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct 
##                                                      0.001099075 
## upper gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct 
##                                                      0.027764041</code></pre>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.ols$interval, ci.2.lmm.ols$interval, ci.3.lmm.ols$interval, ci.4.lmm.ols$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = c(varfixef.ols[2:3], varfixef.ols[5:6]))
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;OLS model confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
OLS model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
0.807
</td>
<td style="text-align:right;">
1.194
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
0.626
</td>
<td style="text-align:right;">
0.934
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified:Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
0.985
</td>
<td style="text-align:right;">
1.012
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible:Bike_lane.by.street.2011ct
</td>
<td style="text-align:right;">
1.001
</td>
<td style="text-align:right;">
1.028
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="reviewer-3" class="section level2" number="13.2">
<h2><span class="header-section-number">13.2</span> Reviewer #3:</h2>
<blockquote>
<p>I commend the authors for their comprehensive response to reviewer
comments. I only have two remaining observations: 1. Regarding the
inclusion of ineligible streets as offsets, I question the rationale
behind this choice. It‚Äôs worth noting that the offset serves as a
denominator, and by incorporating ineligible streets, it effectively
inflates the denominator for census tracts with highways. Given that the
latter areas generally exhibit lower socioeconomic status (SES), this
decision could introduce bias into the results. 2. While the argument
for modeling material deprivation as ‚Äúcontinuous quintiles‚Äù is
defensible, I find it challenging to justify a similar approach for
‚ÄúVisible minorities.‚Äù Once again, I want to express my appreciation for
the outstanding work you‚Äôve done!</p>
</blockquote>
<div id="ses-differences-for-ct-with-vs-without-highways"
class="section level3" number="13.2.1">
<h3><span class="header-section-number">13.2.1</span> SES differences
for CT with vs without highways</h3>
<pre class="r"><code># Extract highways and other ineligible connections
.hwy &lt;- reseau  %&gt;%
  filter(ClsRte %in% c(&quot;Autoroute&quot;, &quot;Liaison maritime&quot;)) %&gt;%
  transmute(hwy = TRUE)

# Flag CTs with ineligible streets/connections
.ct_hwy &lt;- CT16 %&gt;%
  transmute(CT_UID = GeoUID) %&gt;%
  st_join(.hwy, largest = T) %&gt;%
  as.data.frame()</code></pre>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout
## all geometries</code></pre>
<pre class="r"><code># Join flag back into data
ses_anova_check &lt;- bei_df_aoi %&gt;% 
  left_join(.ct_hwy, by =&quot;CT_UID&quot;) %&gt;%
  select(CT_UID, wSCOREMAT.2011, vis_minority_2011, hwy) %&gt;%
  mutate(hwy = factor(coalesce(hwy, FALSE)))
ses_anova_check</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["CT_UID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["wSCOREMAT.2011"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["vis_minority_2011"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["hwy"],"name":[4],"type":["fct"],"align":["left"]}],"data":[{"1":"4620001.00","2":"1.886948e-02","3":"8.949416","4":"FALSE"},{"1":"4620002.00","2":"4.140888e-02","3":"11.184211","4":"FALSE"},{"1":"4620003.00","2":"1.828800e-02","3":"14.760746","4":"FALSE"},{"1":"4620004.00","2":"2.707231e-02","3":"12.755906","4":"FALSE"},{"1":"4620005.00","2":"2.010919e-02","3":"9.017713","4":"FALSE"},{"1":"4620006.00","2":"4.268265e-02","3":"18.955732","4":"FALSE"},{"1":"4620007.00","2":"1.871945e-02","3":"20.229682","4":"TRUE"},{"1":"4620008.00","2":"-5.219047e-03","3":"11.734694","4":"TRUE"},{"1":"4620009.00","2":"3.416935e-02","3":"13.481481","4":"TRUE"},{"1":"4620010.00","2":"2.106993e-02","3":"15.540541","4":"TRUE"},{"1":"4620011.00","2":"1.386159e-02","3":"20.964912","4":"TRUE"},{"1":"4620012.01","2":"1.716952e-02","3":"20.964361","4":"FALSE"},{"1":"4620012.02","2":"5.449158e-02","3":"29.554140","4":"FALSE"},{"1":"4620013.00","2":"8.107426e-03","3":"11.064278","4":"FALSE"},{"1":"4620014.01","2":"7.185748e-03","3":"25.740319","4":"FALSE"},{"1":"4620014.02","2":"NaN","3":"NA","4":"FALSE"},{"1":"4620015.00","2":"3.207137e-02","3":"11.082803","4":"FALSE"},{"1":"4620016.00","2":"2.693205e-02","3":"18.117647","4":"FALSE"},{"1":"4620017.00","2":"1.786309e-02","3":"8.076010","4":"FALSE"},{"1":"4620018.00","2":"2.760174e-02","3":"7.751938","4":"FALSE"},{"1":"4620019.00","2":"4.849414e-02","3":"7.741935","4":"FALSE"},{"1":"4620021.00","2":"8.110744e-02","3":"14.406780","4":"FALSE"},{"1":"4620022.00","2":"6.201719e-02","3":"12.374582","4":"FALSE"},{"1":"4620023.00","2":"5.635984e-02","3":"11.290323","4":"FALSE"},{"1":"4620024.00","2":"5.956556e-02","3":"11.025145","4":"FALSE"},{"1":"4620025.00","2":"4.448843e-02","3":"15.451389","4":"FALSE"},{"1":"4620026.00","2":"4.829285e-02","3":"10.503282","4":"FALSE"},{"1":"4620027.00","2":"4.373971e-02","3":"15.094340","4":"FALSE"},{"1":"4620028.00","2":"1.895145e-02","3":"8.673469","4":"FALSE"},{"1":"4620029.00","2":"3.533986e-02","3":"13.900709","4":"FALSE"},{"1":"4620030.00","2":"1.130048e-02","3":"24.876442","4":"FALSE"},{"1":"4620031.00","2":"-1.493202e-03","3":"19.960080","4":"FALSE"},{"1":"4620032.00","2":"-8.497943e-03","3":"14.473684","4":"FALSE"},{"1":"4620033.00","2":"2.825956e-02","3":"17.302053","4":"FALSE"},{"1":"4620034.00","2":"7.046239e-02","3":"32.800000","4":"FALSE"},{"1":"4620035.00","2":"1.189351e-02","3":"20.149254","4":"FALSE"},{"1":"4620036.00","2":"-5.036849e-03","3":"19.592875","4":"FALSE"},{"1":"4620037.00","2":"3.309686e-02","3":"22.073579","4":"FALSE"},{"1":"4620038.00","2":"6.339468e-02","3":"31.794872","4":"FALSE"},{"1":"4620039.00","2":"9.119776e-03","3":"16.433566","4":"FALSE"},{"1":"4620040.00","2":"3.096533e-02","3":"NA","4":"FALSE"},{"1":"4620041.00","2":"9.878516e-03","3":"23.493976","4":"TRUE"},{"1":"4620042.00","2":"-6.316206e-03","3":"12.637363","4":"FALSE"},{"1":"4620043.00","2":"3.916978e-02","3":"21.084337","4":"TRUE"},{"1":"4620044.00","2":"-4.144016e-03","3":"21.323529","4":"FALSE"},{"1":"4620045.00","2":"6.038657e-03","3":"11.307420","4":"FALSE"},{"1":"4620046.00","2":"4.139731e-03","3":"20.654912","4":"FALSE"},{"1":"4620047.00","2":"1.882577e-02","3":"26.388889","4":"FALSE"},{"1":"4620048.00","2":"5.269686e-03","3":"13.861386","4":"FALSE"},{"1":"4620049.00","2":"-4.143838e-03","3":"13.779528","4":"FALSE"},{"1":"4620050.00","2":"1.977957e-02","3":"36.842105","4":"FALSE"},{"1":"4620051.00","2":"-4.896203e-02","3":"19.215686","4":"FALSE"},{"1":"4620052.00","2":"1.512667e-02","3":"30.219780","4":"FALSE"},{"1":"4620053.00","2":"-5.624607e-02","3":"21.649485","4":"FALSE"},{"1":"4620054.00","2":"-1.271549e-01","3":"12.209302","4":"TRUE"},{"1":"4620055.01","2":"-7.688440e-02","3":"22.171946","4":"TRUE"},{"1":"4620055.02","2":"-9.290279e-02","3":"17.088608","4":"TRUE"},{"1":"4620056.00","2":"5.100190e-03","3":"47.892720","4":"TRUE"},{"1":"4620057.00","2":"NaN","3":"71.052632","4":"TRUE"},{"1":"4620058.00","2":"6.649208e-03","3":"48.888889","4":"TRUE"},{"1":"4620059.00","2":"-7.168579e-02","3":"24.163569","4":"FALSE"},{"1":"4620060.00","2":"1.487709e-01","3":"72.036474","4":"FALSE"},{"1":"4620061.00","2":"-4.458484e-02","3":"28.448276","4":"FALSE"},{"1":"4620062.00","2":"-4.313911e-02","3":"47.683924","4":"TRUE"},{"1":"4620063.00","2":"NaN","3":"27.419355","4":"TRUE"},{"1":"4620064.00","2":"-2.158426e-04","3":"61.224490","4":"FALSE"},{"1":"4620065.01","2":"-1.332535e-02","3":"65.754438","4":"FALSE"},{"1":"4620065.02","2":"-2.574461e-02","3":"47.656250","4":"FALSE"},{"1":"4620066.01","2":"-1.037966e-02","3":"61.261261","4":"TRUE"},{"1":"4620066.02","2":"1.404830e-02","3":"48.633880","4":"TRUE"},{"1":"4620067.00","2":"2.371961e-02","3":"48.396501","4":"TRUE"},{"1":"4620068.00","2":"1.232930e-01","3":"81.658291","4":"TRUE"},{"1":"4620069.01","2":"-4.561679e-02","3":"39.299611","4":"TRUE"},{"1":"4620069.02","2":"NaN","3":"39.299611","4":"FALSE"},{"1":"4620070.01","2":"-1.618364e-01","3":"17.058824","4":"TRUE"},{"1":"4620070.02","2":"-1.190462e-01","3":"17.058824","4":"TRUE"},{"1":"4620071.00","2":"NaN","3":"NA","4":"TRUE"},{"1":"4620072.00","2":"6.223945e-02","3":"21.142857","4":"TRUE"},{"1":"4620073.00","2":"3.830902e-02","3":"28.340081","4":"FALSE"},{"1":"4620074.00","2":"2.240462e-02","3":"15.405777","4":"TRUE"},{"1":"4620075.00","2":"4.509562e-02","3":"31.386861","4":"FALSE"},{"1":"4620076.00","2":"2.377840e-02","3":"36.738703","4":"FALSE"},{"1":"4620077.00","2":"5.420230e-02","3":"54.482759","4":"FALSE"},{"1":"4620078.00","2":"-2.391860e-02","3":"35.496689","4":"FALSE"},{"1":"4620079.00","2":"1.756681e-02","3":"24.469274","4":"FALSE"},{"1":"4620080.00","2":"-1.297464e-04","3":"15.476190","4":"FALSE"},{"1":"4620081.00","2":"-2.148620e-03","3":"17.966102","4":"TRUE"},{"1":"4620082.00","2":"4.801053e-02","3":"20.984456","4":"TRUE"},{"1":"4620083.00","2":"2.217218e-02","3":"13.488372","4":"FALSE"},{"1":"4620084.00","2":"2.372805e-02","3":"27.446301","4":"TRUE"},{"1":"4620085.00","2":"6.090660e-02","3":"26.582278","4":"TRUE"},{"1":"4620086.00","2":"1.688917e-02","3":"17.219388","4":"TRUE"},{"1":"4620087.00","2":"6.002639e-02","3":"30.147059","4":"FALSE"},{"1":"4620088.00","2":"2.956358e-02","3":"16.407355","4":"FALSE"},{"1":"4620089.00","2":"2.649061e-02","3":"19.168357","4":"FALSE"},{"1":"4620090.00","2":"3.370923e-02","3":"25.806452","4":"FALSE"},{"1":"4620091.00","2":"NaN","3":"NA","4":"FALSE"},{"1":"4620092.00","2":"4.445275e-02","3":"22.366149","4":"FALSE"},{"1":"4620093.00","2":"4.595781e-02","3":"18.560000","4":"FALSE"},{"1":"4620094.01","2":"2.640427e-02","3":"46.273546","4":"TRUE"},{"1":"4620094.02","2":"NaN","3":"NA","4":"TRUE"},{"1":"4620095.00","2":"-5.181749e-02","3":"26.005362","4":"TRUE"},{"1":"4620096.00","2":"-3.427288e-02","3":"18.693694","4":"TRUE"},{"1":"4620097.01","2":"1.342901e-02","3":"41.021548","4":"FALSE"},{"1":"4620097.02","2":"1.931639e-02","3":"51.011561","4":"FALSE"},{"1":"4620098.00","2":"-5.661257e-03","3":"33.302583","4":"FALSE"},{"1":"4620099.00","2":"-1.704713e-02","3":"35.154185","4":"FALSE"},{"1":"4620100.01","2":"-2.399836e-03","3":"37.639752","4":"FALSE"},{"1":"4620100.02","2":"1.869475e-02","3":"44.540230","4":"FALSE"},{"1":"4620101.01","2":"4.269259e-02","3":"46.380368","4":"FALSE"},{"1":"4620101.02","2":"4.712086e-02","3":"62.583222","4":"FALSE"},{"1":"4620102.00","2":"-4.665289e-02","3":"22.303922","4":"FALSE"},{"1":"4620103.00","2":"-4.874190e-02","3":"8.074534","4":"FALSE"},{"1":"4620104.00","2":"-6.948956e-02","3":"10.091743","4":"FALSE"},{"1":"4620105.00","2":"-5.423905e-02","3":"11.278195","4":"FALSE"},{"1":"4620106.00","2":"-4.297484e-02","3":"30.748663","4":"TRUE"},{"1":"4620107.00","2":"-2.586619e-02","3":"51.612903","4":"TRUE"},{"1":"4620108.00","2":"-7.128286e-02","3":"17.063492","4":"TRUE"},{"1":"4620109.00","2":"-2.790885e-02","3":"34.939759","4":"TRUE"},{"1":"4620110.00","2":"-2.128646e-02","3":"39.304813","4":"TRUE"},{"1":"4620111.00","2":"1.555518e-02","3":"45.154020","4":"TRUE"},{"1":"4620112.01","2":"5.677669e-02","3":"62.859980","4":"TRUE"},{"1":"4620112.02","2":"4.312002e-02","3":"66.081871","4":"TRUE"},{"1":"4620113.00","2":"-3.317515e-03","3":"49.491212","4":"TRUE"},{"1":"4620114.00","2":"-7.229962e-02","3":"24.630542","4":"FALSE"},{"1":"4620115.01","2":"-5.682820e-02","3":"29.975430","4":"FALSE"},{"1":"4620115.02","2":"-1.671635e-02","3":"40.835465","4":"FALSE"},{"1":"4620116.00","2":"-5.406791e-04","3":"54.418605","4":"FALSE"},{"1":"4620117.00","2":"6.315153e-02","3":"80.622010","4":"FALSE"},{"1":"4620118.00","2":"5.357118e-02","3":"72.121896","4":"FALSE"},{"1":"4620119.00","2":"7.477464e-02","3":"91.240310","4":"FALSE"},{"1":"4620120.01","2":"3.836197e-02","3":"71.428571","4":"TRUE"},{"1":"4620120.02","2":"-5.726282e-02","3":"20.000000","4":"FALSE"},{"1":"4620121.00","2":"-5.790348e-02","3":"22.739726","4":"FALSE"},{"1":"4620122.00","2":"6.175952e-02","3":"78.676471","4":"FALSE"},{"1":"4620123.00","2":"-1.160238e-02","3":"49.878148","4":"FALSE"},{"1":"4620124.00","2":"2.972110e-02","3":"51.551724","4":"FALSE"},{"1":"4620125.00","2":"-2.067744e-02","3":"20.063442","4":"FALSE"},{"1":"4620126.00","2":"-7.036375e-02","3":"21.657754","4":"FALSE"},{"1":"4620127.01","2":"-1.928639e-02","3":"39.772727","4":"FALSE"},{"1":"4620127.02","2":"NaN","3":"NA","4":"FALSE"},{"1":"4620128.00","2":"-9.257078e-02","3":"15.745856","4":"FALSE"},{"1":"4620129.01","2":"-7.602333e-02","3":"30.392157","4":"FALSE"},{"1":"4620129.02","2":"-7.290960e-02","3":"37.516869","4":"FALSE"},{"1":"4620130.00","2":"-3.450506e-02","3":"41.891892","4":"FALSE"},{"1":"4620131.00","2":"-4.313463e-02","3":"47.029703","4":"FALSE"},{"1":"4620132.00","2":"-3.109120e-02","3":"33.942857","4":"FALSE"},{"1":"4620133.00","2":"-2.424037e-02","3":"20.502092","4":"FALSE"},{"1":"4620134.00","2":"-1.004153e-01","3":"20.441989","4":"FALSE"},{"1":"4620135.00","2":"-4.056340e-02","3":"8.181818","4":"FALSE"},{"1":"4620136.00","2":"-1.225934e-02","3":"20.740741","4":"FALSE"},{"1":"4620137.00","2":"1.563704e-04","3":"28.571429","4":"FALSE"},{"1":"4620138.00","2":"-2.413590e-02","3":"15.424165","4":"FALSE"},{"1":"4620139.00","2":"-1.528997e-02","3":"17.472699","4":"FALSE"},{"1":"4620140.00","2":"-4.584174e-02","3":"9.259259","4":"FALSE"},{"1":"4620141.00","2":"-4.277633e-02","3":"7.668712","4":"FALSE"},{"1":"4620142.00","2":"-2.038803e-02","3":"19.141914","4":"FALSE"},{"1":"4620143.00","2":"-3.652301e-02","3":"14.189189","4":"FALSE"},{"1":"4620144.00","2":"-5.206863e-02","3":"15.701220","4":"FALSE"},{"1":"4620145.00","2":"NaN","3":"NA","4":"FALSE"},{"1":"4620146.00","2":"-4.373855e-02","3":"15.673289","4":"FALSE"},{"1":"4620147.00","2":"-3.053257e-02","3":"8.778626","4":"FALSE"},{"1":"4620148.00","2":"-3.981136e-02","3":"15.957447","4":"FALSE"},{"1":"4620149.00","2":"-2.978953e-02","3":"15.548282","4":"FALSE"},{"1":"4620150.00","2":"-1.144404e-02","3":"13.596491","4":"FALSE"},{"1":"4620151.00","2":"-4.259148e-02","3":"6.000000","4":"FALSE"},{"1":"4620152.00","2":"-1.635031e-02","3":"5.211726","4":"FALSE"},{"1":"4620153.00","2":"-1.731164e-02","3":"21.656051","4":"FALSE"},{"1":"4620154.00","2":"-1.779652e-02","3":"7.317073","4":"FALSE"},{"1":"4620155.00","2":"-2.360144e-02","3":"4.985337","4":"FALSE"},{"1":"4620156.00","2":"-2.902026e-02","3":"3.957784","4":"FALSE"},{"1":"4620157.00","2":"-2.320428e-02","3":"7.311321","4":"FALSE"},{"1":"4620158.00","2":"-3.484098e-02","3":"7.711443","4":"FALSE"},{"1":"4620159.00","2":"-5.346808e-02","3":"5.177112","4":"FALSE"},{"1":"4620160.00","2":"-4.517675e-02","3":"12.312312","4":"FALSE"},{"1":"4620161.00","2":"1.230532e-02","3":"29.362881","4":"FALSE"},{"1":"4620162.00","2":"-2.827585e-02","3":"11.371237","4":"FALSE"},{"1":"4620163.00","2":"-1.706293e-02","3":"18.076285","4":"FALSE"},{"1":"4620164.00","2":"-5.173025e-02","3":"22.047244","4":"FALSE"},{"1":"4620165.00","2":"-6.115694e-03","3":"9.188034","4":"FALSE"},{"1":"4620166.00","2":"-2.521413e-02","3":"NA","4":"FALSE"},{"1":"4620167.00","2":"5.946501e-03","3":"15.650407","4":"FALSE"},{"1":"4620168.00","2":"1.824862e-02","3":"7.050093","4":"FALSE"},{"1":"4620169.00","2":"4.516511e-03","3":"13.333333","4":"FALSE"},{"1":"4620170.00","2":"2.020920e-02","3":"14.420804","4":"FALSE"},{"1":"4620171.00","2":"-9.430387e-03","3":"17.583732","4":"FALSE"},{"1":"4620172.00","2":"-3.249273e-02","3":"21.136364","4":"FALSE"},{"1":"4620173.00","2":"-4.229235e-02","3":"16.666667","4":"FALSE"},{"1":"4620174.00","2":"-2.994837e-02","3":"10.617284","4":"FALSE"},{"1":"4620175.00","2":"-8.184464e-02","3":"9.367089","4":"FALSE"},{"1":"4620176.00","2":"-4.156821e-02","3":"12.337662","4":"FALSE"},{"1":"4620177.00","2":"-4.312052e-02","3":"11.063830","4":"FALSE"},{"1":"4620178.00","2":"-2.056926e-02","3":"7.391304","4":"FALSE"},{"1":"4620179.00","2":"1.598180e-02","3":"11.878453","4":"FALSE"},{"1":"4620180.00","2":"2.682913e-02","3":"15.574964","4":"FALSE"},{"1":"4620181.00","2":"1.586244e-02","3":"13.661972","4":"FALSE"},{"1":"4620182.00","2":"6.887229e-03","3":"5.660377","4":"FALSE"},{"1":"4620183.00","2":"2.121042e-02","3":"10.321101","4":"FALSE"},{"1":"4620184.00","2":"6.066948e-03","3":"7.573150","4":"FALSE"},{"1":"4620185.00","2":"1.135986e-02","3":"17.590822","4":"FALSE"},{"1":"4620186.00","2":"4.065030e-02","3":"26.244344","4":"FALSE"},{"1":"4620187.01","2":"3.044253e-03","3":"25.557809","4":"FALSE"},{"1":"4620187.03","2":"-8.392001e-04","3":"20.600858","4":"FALSE"},{"1":"4620187.04","2":"-2.773336e-02","3":"20.282543","4":"FALSE"},{"1":"4620188.01","2":"1.891620e-03","3":"26.840855","4":"FALSE"},{"1":"4620188.02","2":"-1.788529e-03","3":"23.586745","4":"FALSE"},{"1":"4620189.00","2":"NaN","3":"NA","4":"FALSE"},{"1":"4620190.01","2":"-5.441461e-04","3":"21.229868","4":"FALSE"},{"1":"4620190.02","2":"-4.212550e-02","3":"3.980892","4":"FALSE"},{"1":"4620191.00","2":"-1.983252e-03","3":"22.809917","4":"TRUE"},{"1":"4620192.00","2":"1.609835e-03","3":"17.600000","4":"TRUE"},{"1":"4620193.00","2":"1.126146e-02","3":"21.227621","4":"FALSE"},{"1":"4620194.00","2":"2.177651e-02","3":"20.103538","4":"FALSE"},{"1":"4620195.01","2":"-2.185792e-02","3":"21.284404","4":"FALSE"},{"1":"4620195.02","2":"3.439366e-02","3":"29.855072","4":"FALSE"},{"1":"4620195.03","2":"1.200742e-02","3":"26.713710","4":"FALSE"},{"1":"4620196.00","2":"7.555069e-03","3":"19.702602","4":"FALSE"},{"1":"4620197.00","2":"1.439445e-02","3":"25.941873","4":"FALSE"},{"1":"4620198.00","2":"2.815420e-02","3":"19.509704","4":"FALSE"},{"1":"4620199.00","2":"3.938765e-02","3":"21.032505","4":"FALSE"},{"1":"4620200.00","2":"3.662138e-02","3":"27.116705","4":"FALSE"},{"1":"4620201.00","2":"2.699768e-02","3":"29.866270","4":"FALSE"},{"1":"4620202.00","2":"2.706885e-04","3":"14.898689","4":"FALSE"},{"1":"4620203.00","2":"-3.621432e-02","3":"8.856089","4":"FALSE"},{"1":"4620204.00","2":"-1.837701e-02","3":"10.694184","4":"FALSE"},{"1":"4620205.00","2":"-2.122598e-02","3":"5.797101","4":"FALSE"},{"1":"4620206.00","2":"8.257211e-03","3":"3.944773","4":"FALSE"},{"1":"4620207.00","2":"5.852715e-03","3":"18.750000","4":"FALSE"},{"1":"4620208.00","2":"-1.854155e-02","3":"9.894737","4":"FALSE"},{"1":"4620209.00","2":"1.304739e-02","3":"24.651163","4":"FALSE"},{"1":"4620210.00","2":"-3.750372e-03","3":"18.503401","4":"FALSE"},{"1":"4620211.00","2":"-3.221033e-03","3":"10.690423","4":"FALSE"},{"1":"4620212.00","2":"-1.592945e-02","3":"17.255717","4":"FALSE"},{"1":"4620213.00","2":"-2.328143e-02","3":"12.660944","4":"FALSE"},{"1":"4620214.00","2":"-2.114133e-04","3":"18.750000","4":"FALSE"},{"1":"4620215.00","2":"7.076644e-03","3":"22.222222","4":"FALSE"},{"1":"4620216.00","2":"-1.788742e-03","3":"15.277778","4":"FALSE"},{"1":"4620217.00","2":"1.966547e-02","3":"22.762646","4":"FALSE"},{"1":"4620218.00","2":"7.317886e-03","3":"21.366025","4":"FALSE"},{"1":"4620219.00","2":"3.240130e-02","3":"29.000000","4":"FALSE"},{"1":"4620220.00","2":"8.034751e-02","3":"61.120690","4":"FALSE"},{"1":"4620221.00","2":"1.006983e-01","3":"61.496063","4":"FALSE"},{"1":"4620222.00","2":"9.282443e-02","3":"57.563588","4":"FALSE"},{"1":"4620223.01","2":"1.023606e-01","3":"70.796460","4":"TRUE"},{"1":"4620223.02","2":"9.627128e-02","3":"69.312977","4":"FALSE"},{"1":"4620224.00","2":"1.051911e-01","3":"63.355049","4":"TRUE"},{"1":"4620225.00","2":"1.999639e-02","3":"25.274725","4":"TRUE"},{"1":"4620226.00","2":"-3.550625e-03","3":"13.366337","4":"TRUE"},{"1":"4620227.00","2":"1.116663e-02","3":"14.838710","4":"FALSE"},{"1":"4620228.00","2":"-9.401860e-03","3":"12.772586","4":"FALSE"},{"1":"4620229.00","2":"NaN","3":"NA","4":"FALSE"},{"1":"4620230.00","2":"-5.960288e-03","3":"16.348774","4":"FALSE"},{"1":"4620231.00","2":"-1.157508e-02","3":"13.888889","4":"FALSE"},{"1":"4620232.00","2":"-2.687562e-02","3":"19.781931","4":"FALSE"},{"1":"4620233.00","2":"2.045710e-02","3":"25.190840","4":"FALSE"},{"1":"4620234.00","2":"2.103327e-02","3":"38.268793","4":"FALSE"},{"1":"4620235.00","2":"-4.831387e-03","3":"12.324930","4":"FALSE"},{"1":"4620236.00","2":"-1.806453e-02","3":"16.619718","4":"FALSE"},{"1":"4620237.00","2":"-9.645293e-03","3":"14.098361","4":"TRUE"},{"1":"4620238.00","2":"-8.008953e-03","3":"17.381974","4":"TRUE"},{"1":"4620239.00","2":"3.534561e-02","3":"34.073252","4":"TRUE"},{"1":"4620240.00","2":"5.130996e-02","3":"38.647343","4":"TRUE"},{"1":"4620241.00","2":"4.473004e-02","3":"46.099291","4":"TRUE"},{"1":"4620242.00","2":"4.895688e-02","3":"37.277147","4":"FALSE"},{"1":"4620243.00","2":"5.469768e-02","3":"41.454082","4":"FALSE"},{"1":"4620244.00","2":"7.628412e-03","3":"20.476190","4":"FALSE"},{"1":"4620245.00","2":"-6.949352e-03","3":"23.561151","4":"FALSE"},{"1":"4620247.00","2":"1.785568e-03","3":"14.253394","4":"FALSE"},{"1":"4620249.00","2":"1.533946e-02","3":"28.872367","4":"TRUE"},{"1":"4620250.00","2":"3.732197e-02","3":"39.168766","4":"TRUE"},{"1":"4620251.01","2":"4.329457e-02","3":"47.626113","4":"TRUE"},{"1":"4620251.02","2":"6.821014e-02","3":"57.815443","4":"TRUE"},{"1":"4620252.00","2":"7.875468e-02","3":"51.397206","4":"FALSE"},{"1":"4620253.00","2":"7.273072e-02","3":"52.253756","4":"TRUE"},{"1":"4620254.00","2":"5.767783e-02","3":"52.429668","4":"TRUE"},{"1":"4620256.00","2":"9.393032e-02","3":"66.883117","4":"TRUE"},{"1":"4620257.00","2":"1.032092e-01","3":"61.580087","4":"FALSE"},{"1":"4620258.00","2":"9.505215e-02","3":"72.625128","4":"FALSE"},{"1":"4620259.00","2":"1.043224e-01","3":"69.942197","4":"FALSE"},{"1":"4620260.00","2":"6.682592e-02","3":"55.921053","4":"FALSE"},{"1":"4620261.00","2":"8.371795e-02","3":"64.623468","4":"FALSE"},{"1":"4620262.00","2":"9.069030e-02","3":"62.350381","4":"FALSE"},{"1":"4620263.00","2":"6.535001e-02","3":"54.420922","4":"FALSE"},{"1":"4620264.01","2":"-8.551231e-03","3":"24.709302","4":"FALSE"},{"1":"4620264.02","2":"-9.957970e-03","3":"28.087649","4":"TRUE"},{"1":"4620265.00","2":"-2.199990e-03","3":"22.107675","4":"TRUE"},{"1":"4620266.00","2":"8.852001e-03","3":"30.880000","4":"TRUE"},{"1":"4620267.00","2":"5.871711e-02","3":"48.545303","4":"TRUE"},{"1":"4620268.01","2":"1.502245e-02","3":"39.966833","4":"TRUE"},{"1":"4620268.02","2":"3.703276e-02","3":"73.805855","4":"TRUE"},{"1":"4620268.03","2":"NaN","3":"NA","4":"TRUE"},{"1":"4620269.00","2":"1.502709e-02","3":"52.664975","4":"FALSE"},{"1":"4620270.00","2":"-1.280556e-02","3":"30.955121","4":"FALSE"},{"1":"4620271.00","2":"-2.074820e-02","3":"16.589147","4":"FALSE"},{"1":"4620272.00","2":"6.958607e-03","3":"35.246996","4":"FALSE"},{"1":"4620273.00","2":"2.661639e-02","3":"26.395349","4":"FALSE"},{"1":"4620274.00","2":"3.802778e-02","3":"29.769737","4":"FALSE"},{"1":"4620275.00","2":"5.369859e-03","3":"26.574307","4":"FALSE"},{"1":"4620276.00","2":"-3.485301e-03","3":"25.832492","4":"TRUE"},{"1":"4620277.00","2":"-6.577769e-05","3":"34.886818","4":"TRUE"},{"1":"4620278.00","2":"1.280898e-03","3":"20.438799","4":"FALSE"},{"1":"4620279.00","2":"-1.806699e-02","3":"22.867738","4":"FALSE"},{"1":"4620280.00","2":"-1.404972e-02","3":"29.213483","4":"FALSE"},{"1":"4620281.00","2":"-4.598000e-02","3":"13.223140","4":"FALSE"},{"1":"4620282.00","2":"3.488958e-02","3":"38.663484","4":"FALSE"},{"1":"4620283.01","2":"3.851936e-02","3":"25.271739","4":"TRUE"},{"1":"4620283.02","2":"7.692313e-03","3":"33.272395","4":"TRUE"},{"1":"4620284.00","2":"-6.780329e-03","3":"30.813953","4":"TRUE"},{"1":"4620285.00","2":"2.532792e-02","3":"40.929809","4":"TRUE"},{"1":"4620286.00","2":"5.015392e-02","3":"57.572907","4":"TRUE"},{"1":"4620287.01","2":"4.757733e-02","3":"70.836718","4":"FALSE"},{"1":"4620287.02","2":"-3.118702e-02","3":"31.498829","4":"FALSE"},{"1":"4620288.00","2":"-5.260220e-02","3":"20.300752","4":"FALSE"},{"1":"4620290.01","2":"3.004108e-02","3":"20.750552","4":"FALSE"},{"1":"4620290.02","2":"3.735713e-02","3":"23.499577","4":"FALSE"},{"1":"4620290.03","2":"3.849961e-02","3":"34.016888","4":"FALSE"},{"1":"4620290.04","2":"4.416636e-02","3":"35.066865","4":"FALSE"},{"1":"4620290.05","2":"-3.114989e-03","3":"22.592593","4":"TRUE"},{"1":"4620290.06","2":"5.578880e-02","3":"38.522427","4":"FALSE"},{"1":"4620290.07","2":"2.464252e-02","3":"23.096130","4":"FALSE"},{"1":"4620290.08","2":"2.631758e-02","3":"26.092233","4":"FALSE"},{"1":"4620290.09","2":"5.376019e-02","3":"36.950147","4":"FALSE"},{"1":"4620291.01","2":"2.763749e-02","3":"47.447073","4":"FALSE"},{"1":"4620291.03","2":"5.530016e-03","3":"18.985976","4":"TRUE"},{"1":"4620291.04","2":"1.518681e-02","3":"30.733945","4":"FALSE"},{"1":"4620300.00","2":"3.718662e-02","3":"38.095238","4":"TRUE"},{"1":"4620301.00","2":"1.640065e-02","3":"27.152989","4":"TRUE"},{"1":"4620302.00","2":"5.668284e-02","3":"12.014134","4":"FALSE"},{"1":"4620303.00","2":"4.629933e-02","3":"16.629213","4":"TRUE"},{"1":"4620304.00","2":"4.314506e-02","3":"29.359431","4":"FALSE"},{"1":"4620305.00","2":"6.626430e-03","3":"25.135870","4":"FALSE"},{"1":"4620306.00","2":"3.587117e-02","3":"19.699812","4":"FALSE"},{"1":"4620307.00","2":"3.674093e-02","3":"15.781711","4":"FALSE"},{"1":"4620308.00","2":"7.200050e-02","3":"NA","4":"FALSE"},{"1":"4620309.00","2":"9.380085e-05","3":"18.959108","4":"FALSE"},{"1":"4620310.00","2":"1.385614e-02","3":"8.797654","4":"FALSE"},{"1":"4620311.00","2":"3.289402e-02","3":"8.233732","4":"FALSE"},{"1":"4620312.00","2":"6.376059e-03","3":"6.864275","4":"FALSE"},{"1":"4620313.00","2":"5.892271e-03","3":"7.774390","4":"FALSE"},{"1":"4620314.00","2":"2.618454e-03","3":"7.740586","4":"FALSE"},{"1":"4620315.00","2":"NaN","3":"NA","4":"FALSE"},{"1":"4620316.00","2":"-4.231869e-02","3":"4.522613","4":"FALSE"},{"1":"4620317.02","2":"-4.949152e-02","3":"29.085223","4":"TRUE"},{"1":"4620317.03","2":"-8.222783e-02","3":"20.144753","4":"TRUE"},{"1":"4620317.04","2":"-7.106407e-02","3":"29.879679","4":"FALSE"},{"1":"4620320.00","2":"1.204600e-02","3":"16.261062","4":"FALSE"},{"1":"4620321.00","2":"2.284353e-02","3":"14.310954","4":"FALSE"},{"1":"4620322.02","2":"9.509568e-03","3":"22.733424","4":"FALSE"},{"1":"4620322.03","2":"2.590757e-02","3":"23.326134","4":"FALSE"},{"1":"4620322.04","2":"-2.874007e-03","3":"17.508418","4":"FALSE"},{"1":"4620323.00","2":"9.357093e-03","3":"15.145631","4":"FALSE"},{"1":"4620324.01","2":"3.386158e-02","3":"32.420591","4":"FALSE"},{"1":"4620324.02","2":"3.591259e-02","3":"48.037383","4":"FALSE"},{"1":"4620325.01","2":"4.161436e-02","3":"47.138965","4":"FALSE"},{"1":"4620325.02","2":"3.353833e-02","3":"44.530644","4":"FALSE"},{"1":"4620325.03","2":"4.399177e-02","3":"42.243767","4":"FALSE"},{"1":"4620325.05","2":"4.022959e-03","3":"35.510204","4":"FALSE"},{"1":"4620325.06","2":"-3.596020e-03","3":"25.120192","4":"FALSE"},{"1":"4620326.01","2":"5.061758e-02","3":"34.380454","4":"FALSE"},{"1":"4620326.02","2":"2.840144e-02","3":"36.666667","4":"FALSE"},{"1":"4620326.03","2":"4.556043e-02","3":"48.785425","4":"FALSE"},{"1":"4620327.00","2":"2.923089e-02","3":"35.676810","4":"FALSE"},{"1":"4620328.00","2":"7.659345e-02","3":"46.035806","4":"TRUE"},{"1":"4620329.00","2":"2.184044e-02","3":"34.444444","4":"FALSE"},{"1":"4620330.00","2":"4.576210e-02","3":"31.324111","4":"TRUE"},{"1":"4620340.00","2":"-3.759400e-02","3":"11.625616","4":"TRUE"},{"1":"4620350.00","2":"-5.206278e-02","3":"17.551963","4":"TRUE"},{"1":"4620351.00","2":"-5.310128e-02","3":"20.977597","4":"FALSE"},{"1":"4620352.00","2":"-6.062018e-02","3":"27.659574","4":"TRUE"},{"1":"4620353.00","2":"-6.505225e-02","3":"10.580205","4":"FALSE"},{"1":"4620354.00","2":"-1.055685e-01","3":"9.546166","4":"FALSE"},{"1":"4620355.00","2":"-1.220605e-01","3":"8.664260","4":"FALSE"},{"1":"4620356.00","2":"-1.026667e-01","3":"12.082262","4":"FALSE"},{"1":"4620360.00","2":"-1.022279e-01","3":"12.299465","4":"FALSE"},{"1":"4620361.00","2":"-7.176245e-02","3":"24.230769","4":"FALSE"},{"1":"4620362.00","2":"-6.102743e-02","3":"7.114625","4":"FALSE"},{"1":"4620363.00","2":"-5.432457e-02","3":"5.226131","4":"FALSE"},{"1":"4620364.00","2":"-1.824275e-02","3":"7.325383","4":"FALSE"},{"1":"4620365.00","2":"-3.023054e-02","3":"10.707804","4":"FALSE"},{"1":"4620366.00","2":"-7.261820e-02","3":"9.861933","4":"FALSE"},{"1":"4620367.00","2":"-6.021547e-02","3":"9.023486","4":"FALSE"},{"1":"4620370.00","2":"-6.944386e-02","3":"8.811189","4":"FALSE"},{"1":"4620380.00","2":"-2.423352e-02","3":"21.568627","4":"FALSE"},{"1":"4620381.00","2":"2.719909e-02","3":"29.534110","4":"FALSE"},{"1":"4620382.01","2":"-4.136282e-02","3":"8.575581","4":"FALSE"},{"1":"4620382.02","2":"-1.588175e-02","3":"18.959913","4":"FALSE"},{"1":"4620383.01","2":"-2.137497e-02","3":"17.833333","4":"FALSE"},{"1":"4620383.02","2":"-2.298795e-02","3":"8.023873","4":"FALSE"},{"1":"4620385.00","2":"-4.329400e-02","3":"14.675768","4":"FALSE"},{"1":"4620390.00","2":"1.749854e-02","3":"6.593407","4":"TRUE"},{"1":"4620391.00","2":"3.926129e-02","3":"10.862620","4":"FALSE"},{"1":"4620392.00","2":"-7.129528e-03","3":"12.222222","4":"FALSE"},{"1":"4620393.00","2":"2.443180e-02","3":"19.960474","4":"TRUE"},{"1":"4620394.00","2":"4.999597e-02","3":"24.813154","4":"TRUE"},{"1":"4620395.01","2":"1.130532e-01","3":"37.821782","4":"TRUE"},{"1":"4620395.02","2":"2.514321e-02","3":"35.914894","4":"TRUE"},{"1":"4620395.03","2":"-8.143219e-03","3":"20.394737","4":"TRUE"},{"1":"4620396.00","2":"-2.849203e-02","3":"11.611785","4":"FALSE"},{"1":"4620397.00","2":"-1.796996e-02","3":"11.139565","4":"TRUE"},{"1":"4620400.00","2":"-4.414173e-02","3":"20.609137","4":"FALSE"},{"1":"4620401.00","2":"-8.714750e-02","3":"14.743590","4":"FALSE"},{"1":"4620402.00","2":"-9.901456e-03","3":"47.328244","4":"TRUE"},{"1":"4620403.00","2":"-7.885109e-02","3":"19.919920","4":"TRUE"},{"1":"4620404.00","2":"-7.818707e-02","3":"18.782791","4":"TRUE"},{"1":"4620410.01","2":"2.283791e-02","3":"47.118959","4":"FALSE"},{"1":"4620410.02","2":"-5.281187e-03","3":"34.326923","4":"FALSE"},{"1":"4620410.03","2":"2.728519e-02","3":"58.666667","4":"TRUE"},{"1":"4620412.00","2":"3.928004e-03","3":"51.879699","4":"TRUE"},{"1":"4620413.01","2":"-1.780679e-02","3":"26.335878","4":"FALSE"},{"1":"4620413.02","2":"2.137264e-02","3":"49.612403","4":"TRUE"},{"1":"4620415.03","2":"8.936005e-03","3":"43.478261","4":"FALSE"},{"1":"4620415.04","2":"2.695044e-02","3":"43.688255","4":"FALSE"},{"1":"4620415.05","2":"-4.225943e-02","3":"35.604900","4":"TRUE"},{"1":"4620415.06","2":"-5.327720e-02","3":"35.446429","4":"TRUE"},{"1":"4620416.01","2":"7.853732e-03","3":"41.595092","4":"FALSE"},{"1":"4620416.02","2":"3.253530e-02","3":"48.489666","4":"FALSE"},{"1":"4620417.01","2":"4.432664e-02","3":"58.677686","4":"FALSE"},{"1":"4620417.02","2":"9.434105e-02","3":"87.356322","4":"FALSE"},{"1":"4620418.00","2":"-2.919321e-03","3":"43.309222","4":"TRUE"},{"1":"4620419.00","2":"6.901486e-02","3":"83.797217","4":"FALSE"},{"1":"4620420.00","2":"1.319152e-02","3":"42.653509","4":"FALSE"},{"1":"4620421.01","2":"4.892316e-02","3":"68.061089","4":"TRUE"},{"1":"4620421.02","2":"3.899170e-02","3":"61.022806","4":"FALSE"},{"1":"4620430.00","2":"-2.115942e-02","3":"21.758050","4":"TRUE"},{"1":"4620431.00","2":"-2.152089e-02","3":"25.414365","4":"TRUE"},{"1":"4620432.00","2":"-3.786867e-02","3":"7.777778","4":"TRUE"},{"1":"4620433.00","2":"-8.620730e-03","3":"30.142857","4":"TRUE"},{"1":"4620440.00","2":"NaN","3":"NA","4":"TRUE"},{"1":"4620450.00","2":"-3.807217e-02","3":"8.148678","4":"TRUE"},{"1":"4620451.00","2":"-1.563259e-02","3":"12.222222","4":"TRUE"},{"1":"4620452.00","2":"-2.006488e-02","3":"21.307692","4":"TRUE"},{"1":"4620453.01","2":"-2.129671e-02","3":"15.068493","4":"FALSE"},{"1":"4620453.02","2":"-1.580498e-02","3":"40.440324","4":"TRUE"},{"1":"4620460.00","2":"-6.230362e-02","3":"7.230047","4":"TRUE"},{"1":"4620461.00","2":"-2.623405e-02","3":"9.230769","4":"TRUE"},{"1":"4620462.01","2":"-4.394469e-02","3":"12.103175","4":"FALSE"},{"1":"4620462.02","2":"-5.366761e-02","3":"10.851419","4":"TRUE"},{"1":"4620470.01","2":"-3.582170e-02","3":"17.051630","4":"TRUE"},{"1":"4620470.03","2":"-4.142474e-02","3":"19.051960","4":"TRUE"},{"1":"4620470.04","2":"-3.819069e-03","3":"24.037185","4":"TRUE"},{"1":"4620470.05","2":"-3.342715e-02","3":"26.629213","4":"TRUE"},{"1":"4620480.00","2":"-4.584842e-02","3":"10.052219","4":"TRUE"},{"1":"4620490.00","2":"-1.614093e-02","3":"13.900415","4":"TRUE"},{"1":"4620491.00","2":"-2.839090e-02","3":"8.463252","4":"TRUE"},{"1":"4620500.00","2":"-6.019502e-02","3":"6.521739","4":"TRUE"},{"1":"4620511.01","2":"-1.106225e-02","3":"27.917981","4":"TRUE"},{"1":"4620511.02","2":"3.617621e-02","3":"58.196721","4":"TRUE"},{"1":"4620512.02","2":"-1.097734e-02","3":"30.102623","4":"FALSE"},{"1":"4620512.03","2":"-3.346725e-02","3":"34.615385","4":"FALSE"},{"1":"4620512.04","2":"1.037956e-02","3":"42.161339","4":"FALSE"},{"1":"4620513.01","2":"2.308663e-02","3":"58.123791","4":"FALSE"},{"1":"4620513.02","2":"2.475331e-02","3":"42.544987","4":"FALSE"},{"1":"4620514.01","2":"-1.100816e-02","3":"34.963504","4":"FALSE"},{"1":"4620514.02","2":"-2.936997e-03","3":"38.919778","4":"FALSE"},{"1":"4620515.01","2":"-1.070142e-02","3":"29.737336","4":"FALSE"},{"1":"4620515.02","2":"-2.068300e-02","3":"35.545557","4":"FALSE"},{"1":"4620515.03","2":"-1.566362e-02","3":"31.358382","4":"FALSE"},{"1":"4620515.04","2":"6.135264e-04","3":"39.171123","4":"FALSE"},{"1":"4620520.02","2":"3.444740e-02","3":"50.593161","4":"FALSE"},{"1":"4620520.03","2":"1.774863e-02","3":"54.801536","4":"FALSE"},{"1":"4620520.04","2":"1.981935e-02","3":"48.383501","4":"FALSE"},{"1":"4620521.01","2":"1.755104e-03","3":"34.983854","4":"FALSE"},{"1":"4620521.04","2":"-2.222512e-02","3":"23.833168","4":"FALSE"},{"1":"4620521.05","2":"-3.693162e-02","3":"23.424370","4":"FALSE"},{"1":"4620521.06","2":"-3.085306e-02","3":"27.441406","4":"FALSE"},{"1":"4620521.07","2":"-2.142869e-02","3":"34.016888","4":"FALSE"},{"1":"4620522.01","2":"-1.676487e-02","3":"26.478495","4":"FALSE"},{"1":"4620522.02","2":"-1.060566e-02","3":"31.586207","4":"FALSE"},{"1":"4620523.00","2":"-1.279389e-02","3":"31.726908","4":"FALSE"},{"1":"4620530.00","2":"-9.866992e-03","3":"28.960818","4":"FALSE"},{"1":"4620540.00","2":"8.207373e-03","3":"24.336973","4":"FALSE"},{"1":"4620550.02","2":"-1.514045e-02","3":"13.715278","4":"FALSE"},{"1":"4620550.03","2":"-4.006279e-02","3":"18.364198","4":"FALSE"},{"1":"4620550.04","2":"-2.075073e-02","3":"17.958783","4":"FALSE"},{"1":"4620570.00","2":"4.794388e-02","3":"15.138889","4":"TRUE"},{"1":"4620580.01","2":"1.852843e-02","3":"9.876543","4":"FALSE"},{"1":"4620580.02","2":"-2.283587e-02","3":"8.981002","4":"FALSE"},{"1":"4620580.03","2":"-6.799089e-05","3":"6.217617","4":"FALSE"},{"1":"4620581.01","2":"3.206722e-02","3":"18.008658","4":"FALSE"},{"1":"4620581.02","2":"2.424176e-02","3":"20.454545","4":"FALSE"},{"1":"4620582.01","2":"3.115621e-02","3":"9.565217","4":"FALSE"},{"1":"4620582.02","2":"2.657208e-02","3":"16.944908","4":"FALSE"},{"1":"4620583.00","2":"3.130257e-02","3":"14.968153","4":"FALSE"},{"1":"4620584.00","2":"4.796992e-02","3":"8.939394","4":"FALSE"},{"1":"4620585.01","2":"4.058894e-03","3":"3.960396","4":"TRUE"},{"1":"4620585.02","2":"3.716666e-02","3":"9.849521","4":"TRUE"},{"1":"4620590.01","2":"2.110138e-02","3":"30.019120","4":"TRUE"},{"1":"4620590.02","2":"6.474697e-02","3":"37.816456","4":"TRUE"},{"1":"4620591.01","2":"-1.122448e-02","3":"21.072797","4":"TRUE"},{"1":"4620591.02","2":"2.271839e-02","3":"26.355612","4":"TRUE"},{"1":"4620592.00","2":"2.410229e-02","3":"28.621170","4":"TRUE"},{"1":"4620593.01","2":"-1.199996e-02","3":"6.611570","4":"TRUE"},{"1":"4620593.02","2":"2.712438e-02","3":"29.204545","4":"TRUE"},{"1":"4620594.01","2":"2.303988e-02","3":"26.315789","4":"TRUE"},{"1":"4620594.02","2":"-1.427075e-03","3":"23.695055","4":"TRUE"},{"1":"4620600.01","2":"3.648440e-02","3":"33.812010","4":"TRUE"},{"1":"4620600.02","2":"5.194756e-02","3":"51.612903","4":"FALSE"},{"1":"4620600.03","2":"5.430083e-02","3":"39.609236","4":"TRUE"},{"1":"4620601.01","2":"4.199684e-02","3":"39.150228","4":"FALSE"},{"1":"4620601.02","2":"2.610478e-02","3":"45.410037","4":"FALSE"},{"1":"4620602.01","2":"3.871042e-02","3":"27.729885","4":"TRUE"},{"1":"4620602.02","2":"6.012976e-02","3":"39.298893","4":"TRUE"},{"1":"4620603.01","2":"6.199626e-02","3":"34.039548","4":"TRUE"},{"1":"4620603.02","2":"2.795114e-02","3":"32.791328","4":"TRUE"},{"1":"4620603.03","2":"6.994069e-02","3":"54.403409","4":"FALSE"},{"1":"4620604.01","2":"1.119712e-02","3":"22.691706","4":"FALSE"},{"1":"4620604.02","2":"7.360515e-02","3":"39.641657","4":"FALSE"},{"1":"4620604.03","2":"6.021962e-02","3":"34.697218","4":"FALSE"},{"1":"4620604.04","2":"2.976036e-02","3":"31.804281","4":"FALSE"},{"1":"4620604.05","2":"5.091978e-02","3":"40.298507","4":"FALSE"},{"1":"4620605.01","2":"4.547113e-02","3":"32.111437","4":"TRUE"},{"1":"4620605.02","2":"5.971777e-03","3":"19.950739","4":"FALSE"},{"1":"4620605.03","2":"5.712038e-02","3":"34.589041","4":"FALSE"},{"1":"4620605.04","2":"4.527296e-02","3":"31.837161","4":"FALSE"},{"1":"4620605.05","2":"1.629636e-02","3":"23.486683","4":"TRUE"},{"1":"4620610.01","2":"8.388828e-02","3":"39.689579","4":"FALSE"},{"1":"4620610.02","2":"5.547924e-02","3":"37.120360","4":"FALSE"},{"1":"4620610.03","2":"6.014540e-02","3":"27.208122","4":"FALSE"},{"1":"4620610.04","2":"9.024601e-02","3":"49.936789","4":"FALSE"},{"1":"4620610.05","2":"1.017360e-01","3":"53.855279","4":"FALSE"},{"1":"4620610.06","2":"6.053941e-02","3":"47.635727","4":"FALSE"},{"1":"4620610.07","2":"1.033611e-01","3":"36.742934","4":"FALSE"},{"1":"4620611.01","2":"4.998178e-02","3":"36.654804","4":"FALSE"},{"1":"4620611.02","2":"7.372163e-02","3":"44.171220","4":"FALSE"},{"1":"4620612.00","2":"7.888875e-02","3":"54.469607","4":"FALSE"},{"1":"4620613.00","2":"7.515559e-02","3":"52.779733","4":"FALSE"},{"1":"4620614.00","2":"4.743723e-02","3":"40.528634","4":"FALSE"},{"1":"4620615.00","2":"6.345647e-02","3":"55.953447","4":"FALSE"},{"1":"4620616.00","2":"7.817204e-02","3":"50.837989","4":"FALSE"},{"1":"4620617.01","2":"5.258017e-02","3":"38.526119","4":"FALSE"},{"1":"4620617.02","2":"4.060542e-02","3":"33.802817","4":"FALSE"},{"1":"4620618.00","2":"4.304455e-02","3":"35.093168","4":"FALSE"},{"1":"4620619.00","2":"4.915347e-02","3":"25.803311","4":"FALSE"},{"1":"4620625.01","2":"3.349426e-02","3":"23.450586","4":"FALSE"},{"1":"4620625.02","2":"1.982731e-02","3":"34.910394","4":"FALSE"},{"1":"4620626.00","2":"8.932707e-03","3":"27.606339","4":"TRUE"},{"1":"4620627.00","2":"1.722937e-02","3":"16.148532","4":"TRUE"},{"1":"4620628.01","2":"8.354080e-03","3":"21.176471","4":"FALSE"},{"1":"4620628.02","2":"-1.761503e-02","3":"20.189702","4":"FALSE"},{"1":"4620629.00","2":"-2.267640e-03","3":"19.501466","4":"TRUE"},{"1":"4620630.01","2":"-1.928871e-02","3":"12.244898","4":"TRUE"},{"1":"4620630.02","2":"-2.861468e-02","3":"9.811695","4":"TRUE"},{"1":"4620631.00","2":"-9.935283e-03","3":"18.181818","4":"TRUE"},{"1":"4620632.01","2":"4.864254e-03","3":"16.949153","4":"TRUE"},{"1":"4620632.02","2":"1.211369e-02","3":"23.291925","4":"TRUE"},{"1":"4620632.03","2":"-1.866157e-03","3":"11.693548","4":"TRUE"},{"1":"4620632.04","2":"-8.338008e-03","3":"15.633609","4":"TRUE"},{"1":"4620633.00","2":"-1.002542e-02","3":"14.536585","4":"TRUE"},{"1":"4620634.00","2":"6.768881e-03","3":"19.896194","4":"FALSE"},{"1":"4620635.00","2":"2.766024e-02","3":"24.086758","4":"FALSE"},{"1":"4620636.00","2":"2.993894e-02","3":"23.750905","4":"FALSE"},{"1":"4620637.01","2":"2.307848e-02","3":"28.024194","4":"TRUE"},{"1":"4620637.02","2":"3.117798e-03","3":"22.033898","4":"FALSE"},{"1":"4620638.01","2":"2.219743e-03","3":"25.674419","4":"FALSE"},{"1":"4620638.02","2":"1.128631e-02","3":"25.495050","4":"FALSE"},{"1":"4620638.03","2":"3.892115e-02","3":"29.217604","4":"FALSE"},{"1":"4620638.04","2":"4.065215e-02","3":"25.793328","4":"FALSE"},{"1":"4620639.00","2":"-8.564667e-03","3":"15.458276","4":"FALSE"},{"1":"4620640.00","2":"9.566641e-03","3":"22.318841","4":"TRUE"},{"1":"4620641.01","2":"8.344589e-03","3":"19.452663","4":"FALSE"},{"1":"4620641.02","2":"-8.957130e-03","3":"27.568493","4":"TRUE"},{"1":"4620642.00","2":"1.546030e-02","3":"29.181005","4":"TRUE"},{"1":"4620643.01","2":"-2.420542e-02","3":"33.975241","4":"TRUE"},{"1":"4620643.02","2":"-1.070450e-02","3":"13.842482","4":"TRUE"},{"1":"4620643.03","2":"2.223490e-02","3":"21.122740","4":"FALSE"},{"1":"4620644.00","2":"1.960647e-02","3":"32.661290","4":"TRUE"},{"1":"4620645.00","2":"5.463675e-02","3":"23.003802","4":"FALSE"},{"1":"4620646.01","2":"7.410163e-02","3":"36.734694","4":"FALSE"},{"1":"4620646.02","2":"3.263982e-02","3":"22.664835","4":"FALSE"},{"1":"4620646.03","2":"2.571382e-02","3":"14.560000","4":"FALSE"},{"1":"4620647.01","2":"-3.767540e-02","3":"4.237288","4":"FALSE"},{"1":"4620647.02","2":"2.850312e-02","3":"22.239264","4":"FALSE"},{"1":"4620648.00","2":"5.705239e-02","3":"28.851816","4":"FALSE"},{"1":"4620649.01","2":"2.875347e-02","3":"29.566855","4":"TRUE"},{"1":"4620649.02","2":"4.777813e-02","3":"17.451524","4":"TRUE"},{"1":"4620650.01","2":"4.654483e-02","3":"19.134396","4":"FALSE"},{"1":"4620650.02","2":"5.913962e-02","3":"27.493606","4":"FALSE"},{"1":"4620650.04","2":"9.847378e-03","3":"26.294416","4":"TRUE"},{"1":"4620650.05","2":"2.779572e-02","3":"26.294416","4":"FALSE"},{"1":"4620651.01","2":"2.398625e-02","3":"27.688604","4":"TRUE"},{"1":"4620651.02","2":"1.348600e-02","3":"33.608402","4":"TRUE"},{"1":"4620652.01","2":"-3.249523e-02","3":"18.323587","4":"TRUE"},{"1":"4620652.04","2":"-3.231772e-03","3":"17.661098","4":"FALSE"},{"1":"4620652.06","2":"-1.605789e-02","3":"15.404365","4":"FALSE"},{"1":"4620652.07","2":"-1.890307e-02","3":"18.710493","4":"TRUE"},{"1":"4620652.08","2":"-1.657554e-02","3":"22.627737","4":"TRUE"},{"1":"4620652.09","2":"1.184462e-02","3":"40.672074","4":"TRUE"},{"1":"4620653.00","2":"-6.503567e-02","3":"4.901961","4":"FALSE"},{"1":"4620654.00","2":"-1.200119e-01","3":"0.000000","4":"TRUE"},{"1":"4620655.01","2":"2.493388e-02","3":"5.237515","4":"FALSE"},{"1":"4620655.02","2":"1.266149e-02","3":"20.420889","4":"FALSE"},{"1":"4620656.01","2":"1.033759e-02","3":"17.601246","4":"TRUE"},{"1":"4620656.03","2":"3.188639e-03","3":"16.730524","4":"TRUE"},{"1":"4620656.04","2":"-3.137735e-05","3":"26.190476","4":"FALSE"},{"1":"4620657.01","2":"4.172071e-03","3":"18.244170","4":"TRUE"},{"1":"4620657.02","2":"8.209790e-03","3":"16.417910","4":"FALSE"},{"1":"4620657.03","2":"1.499860e-02","3":"30.396476","4":"TRUE"},{"1":"4620658.01","2":"1.619696e-02","3":"15.366705","4":"TRUE"},{"1":"4620658.02","2":"1.221902e-02","3":"14.843750","4":"FALSE"},{"1":"4620658.03","2":"-6.253473e-03","3":"14.754098","4":"TRUE"},{"1":"4620659.04","2":"-4.317477e-02","3":"16.834171","4":"FALSE"},{"1":"4620659.05","2":"-3.144872e-02","3":"9.759450","4":"TRUE"},{"1":"4620659.06","2":"2.240035e-03","3":"9.090909","4":"TRUE"},{"1":"4620659.08","2":"-1.247640e-02","3":"18.876755","4":"FALSE"},{"1":"4620659.09","2":"-8.136894e-03","3":"31.723027","4":"TRUE"},{"1":"4620659.10","2":"-4.174327e-02","3":"21.493902","4":"FALSE"},{"1":"4620659.11","2":"-7.189108e-03","3":"11.458333","4":"FALSE"},{"1":"4620660.01","2":"-7.816672e-03","3":"17.789757","4":"FALSE"},{"1":"4620660.02","2":"2.769330e-03","3":"25.714286","4":"FALSE"},{"1":"4620660.03","2":"-1.138843e-02","3":"11.424440","4":"FALSE"},{"1":"4620661.01","2":"5.534879e-04","3":"17.300832","4":"FALSE"},{"1":"4620661.03","2":"-4.836792e-03","3":"17.817372","4":"FALSE"},{"1":"4620661.04","2":"2.089292e-03","3":"21.444201","4":"FALSE"},{"1":"4620662.00","2":"7.801453e-03","3":"10.740355","4":"TRUE"},{"1":"4620825.02","2":"3.021829e-03","3":"29.252577","4":"TRUE"},{"1":"4620825.03","2":"3.454790e-02","3":"31.478261","4":"TRUE"},{"1":"4620825.04","2":"1.856002e-02","3":"44.981413","4":"TRUE"},{"1":"4620825.05","2":"1.639479e-02","3":"32.600000","4":"TRUE"},{"1":"4620825.06","2":"-7.733499e-03","3":"34.710744","4":"FALSE"},{"1":"4620825.07","2":"-2.753325e-02","3":"34.710744","4":"TRUE"},{"1":"4620825.08","2":"-4.667415e-02","3":"34.710744","4":"TRUE"},{"1":"4620826.02","2":"-1.769055e-02","3":"26.427061","4":"TRUE"},{"1":"4620826.05","2":"-4.056653e-03","3":"45.750000","4":"TRUE"},{"1":"4620826.06","2":"2.029941e-02","3":"47.283951","4":"TRUE"},{"1":"4620826.07","2":"-1.641552e-02","3":"33.458177","4":"TRUE"},{"1":"4620826.08","2":"-2.624729e-02","3":"29.629630","4":"TRUE"},{"1":"4620826.09","2":"-2.411084e-02","3":"51.734540","4":"TRUE"},{"1":"4620826.10","2":"-1.787444e-02","3":"49.592170","4":"TRUE"},{"1":"4620826.11","2":"4.996909e-03","3":"32.462687","4":"FALSE"},{"1":"4620826.13","2":"-1.459104e-02","3":"45.000000","4":"FALSE"},{"1":"4620826.14","2":"-2.413602e-02","3":"46.019108","4":"TRUE"},{"1":"4620856.00","2":"1.183711e-02","3":"11.049724","4":"FALSE"},{"1":"4620857.01","2":"1.230072e-02","3":"15.228426","4":"FALSE"},{"1":"4620857.02","2":"2.167318e-02","3":"12.303981","4":"FALSE"},{"1":"4620857.06","2":"-3.904193e-03","3":"12.749350","4":"FALSE"},{"1":"4620857.07","2":"-8.481935e-03","3":"13.380282","4":"TRUE"},{"1":"4620857.08","2":"2.931593e-03","3":"7.388664","4":"TRUE"},{"1":"4620857.09","2":"-3.297937e-02","3":"14.811032","4":"FALSE"},{"1":"4620857.10","2":"1.124521e-04","3":"8.482143","4":"TRUE"},{"1":"4620857.11","2":"9.887560e-03","3":"12.579618","4":"FALSE"},{"1":"4620857.12","2":"4.940109e-03","3":"12.133333","4":"FALSE"},{"1":"4620858.01","2":"1.512297e-02","3":"12.970711","4":"FALSE"},{"1":"4620858.02","2":"2.866809e-02","3":"22.623829","4":"FALSE"},{"1":"4620858.04","2":"5.969863e-03","3":"20.140987","4":"FALSE"},{"1":"4620858.05","2":"1.124355e-02","3":"15.284553","4":"TRUE"},{"1":"4620859.00","2":"4.498418e-02","3":"31.894934","4":"FALSE"},{"1":"4620860.01","2":"5.299740e-03","3":"18.337218","4":"FALSE"},{"1":"4620860.02","2":"6.598404e-03","3":"25.000000","4":"FALSE"},{"1":"4620861.00","2":"5.381196e-03","3":"13.912375","4":"FALSE"},{"1":"4620862.00","2":"-5.851373e-02","3":"11.026616","4":"TRUE"},{"1":"4620863.01","2":"-4.591202e-02","3":"13.505311","4":"TRUE"},{"1":"4620863.02","2":"-6.129351e-02","3":"7.019143","4":"TRUE"},{"1":"4620864.00","2":"-6.373878e-02","3":"4.351852","4":"TRUE"},{"1":"4620865.00","2":"3.737630e-02","3":"10.427807","4":"FALSE"},{"1":"4620866.00","2":"3.422371e-02","3":"6.143345","4":"FALSE"},{"1":"4620867.00","2":"2.453142e-02","3":"12.500000","4":"FALSE"},{"1":"4620868.01","2":"2.365698e-02","3":"14.575972","4":"FALSE"},{"1":"4620868.02","2":"5.424039e-02","3":"15.716912","4":"FALSE"},{"1":"4620869.00","2":"1.820389e-02","3":"8.249158","4":"FALSE"},{"1":"4620870.01","2":"4.319255e-02","3":"17.507003","4":"FALSE"},{"1":"4620870.02","2":"2.097009e-02","3":"20.971302","4":"FALSE"},{"1":"4620871.01","2":"3.189614e-02","3":"18.655693","4":"FALSE"},{"1":"4620871.02","2":"1.396234e-02","3":"19.804401","4":"FALSE"},{"1":"4620872.00","2":"2.607548e-02","3":"18.536991","4":"FALSE"},{"1":"4620873.01","2":"7.563434e-02","3":"17.360285","4":"FALSE"},{"1":"4620873.02","2":"3.897970e-02","3":"10.628019","4":"FALSE"},{"1":"4620874.00","2":"4.825286e-02","3":"21.711900","4":"FALSE"},{"1":"4620875.00","2":"3.337843e-02","3":"17.170626","4":"FALSE"},{"1":"4620876.01","2":"8.127926e-02","3":"16.564417","4":"FALSE"},{"1":"4620876.04","2":"-7.885629e-03","3":"13.328197","4":"FALSE"},{"1":"4620876.05","2":"-1.674069e-02","3":"9.749492","4":"FALSE"},{"1":"4620876.06","2":"1.899453e-02","3":"21.012658","4":"FALSE"},{"1":"4620876.07","2":"5.984560e-03","3":"15.815085","4":"FALSE"},{"1":"4620877.01","2":"-4.864839e-02","3":"7.443366","4":"FALSE"},{"1":"4620877.02","2":"-2.232462e-03","3":"14.897260","4":"FALSE"},{"1":"4620878.00","2":"4.318128e-02","3":"13.757700","4":"FALSE"},{"1":"4620879.01","2":"3.783133e-02","3":"11.827957","4":"FALSE"},{"1":"4620879.02","2":"-2.716937e-02","3":"6.811989","4":"FALSE"},{"1":"4620880.00","2":"2.437729e-03","3":"12.899106","4":"FALSE"},{"1":"4620881.01","2":"3.532665e-02","3":"8.658009","4":"FALSE"},{"1":"4620881.02","2":"3.484679e-02","3":"11.884058","4":"FALSE"},{"1":"4620882.00","2":"2.915662e-02","3":"16.406250","4":"FALSE"},{"1":"4620883.00","2":"-5.045806e-03","3":"9.576837","4":"TRUE"},{"1":"4620884.01","2":"-1.103465e-02","3":"49.920000","4":"TRUE"},{"1":"4620884.02","2":"-2.918304e-02","3":"6.069803","4":"TRUE"},{"1":"4620885.00","2":"-1.264637e-02","3":"12.307692","4":"TRUE"},{"1":"4620886.01","2":"-3.507309e-02","3":"6.782334","4":"TRUE"},{"1":"4620886.02","2":"-6.362352e-02","3":"6.070288","4":"FALSE"},{"1":"4620886.03","2":"-1.518800e-03","3":"11.150442","4":"TRUE"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code># Check anova wSCOREMAT.2011
aov.wSCORTEMAT &lt;- aov(wSCOREMAT.2011 ~ hwy, data=ses_anova_check)
summary(aov.wSCORTEMAT)</code></pre>
<pre><code>##              Df Sum Sq  Mean Sq F value Pr(&gt;F)  
## hwy           1 0.0077 0.007690   4.715 0.0303 *
## Residuals   673 1.0977 0.001631                 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 14 observations deleted due to missingness</code></pre>
<pre class="r"><code># Check anova vis_minority_2011
aov.vis_minority &lt;- aov(vis_minority_2011 ~ hwy, data=ses_anova_check)
summary(aov.vis_minority)</code></pre>
<pre><code>##              Df Sum Sq Mean Sq F value  Pr(&gt;F)   
## hwy           1   1716  1715.8   6.776 0.00944 **
## Residuals   673 170405   253.2                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 14 observations deleted due to missingness</code></pre>
<p>CT that intersect with highways are indeed significantly different
from others in terms of material deprivation (<em>p &lt; .05</em>) and
visible minority (<em>p &lt; 0.01</em>)</p>
</div>
<div id="effect-of-incorporating-ineligible-streets"
class="section level3" number="13.2.2">
<h3><span class="header-section-number">13.2.2</span> Effect of
incorporating ineligible streets</h3>
<p>In the models described in the paper, all the streets/roads are used
as denominator. We check the effect of discarding the highways (which
are the only road category forbidden to cycles) on the model
outputs.</p>
<pre class="r"><code>compute_streetlength_eligible_by_area &lt;- function(sf_areas) {
  # Compute length of streets within each area.
  # HIGHWAYS AND MARITIME ROUTE REMOVED
  # --
  # Parameters:
  #   - sf_areas: sf class object defining the areas of interest, must have a GeoUID field

  # Compute intersection of streets with areas
  bk &lt;- reseau  %&gt;%
    st_cast(&quot;MULTILINESTRING&quot;) %&gt;% # Get rid of a few MULTICURVE geometries
    filter(!ClsRte %in% c(&quot;Autoroute&quot;, &quot;Liaison maritime&quot;)) %&gt;%
    st_intersection(sf_areas) %&gt;%
    mutate(street_eligible_length = st_length(.)) %&gt;%
    as.data.frame() %&gt;%
    group_by(GeoUID) %&gt;%
    summarise(street_eligible_length = sum(street_eligible_length)) %&gt;%
    ungroup()
  
  # Merge back into original sf_areas
  bk &lt;- sf_areas %&gt;%
    mutate(shape_area_km2 = units::set_units(st_area(.), &#39;km^2&#39;)) %&gt;%
    left_join(bk)
  
  # Replace NA by 0
  bk[is.na(bk)] &lt;- 0
  
  return(bk)
}


# Compute total street length within CT/buffer
street_eligible_length_by_CT16 &lt;- compute_streetlength_eligible_by_area(CT16) %&gt;%
  as.data.frame() %&gt;%
  select(GeoUID, street_eligible_length) %&gt;% 
  units::drop_units()</code></pre>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout
## all geometries</code></pre>
<pre><code>## Joining with `by = join_by(GeoUID)`</code></pre>
<pre class="r"><code># Join to bei_df_aoi
bei_df_aoi2 &lt;- bei_df_aoi %&gt;%
  left_join(street_eligible_length_by_CT16, by = c(&quot;CT_UID&quot; = &quot;GeoUID&quot;)) %&gt;%
  mutate(street_eligible_length.hm = street_eligible_length / 100,
         Bike_lane.by.street_eligible.2011ct = 100 * Bike_lane_total.2011ct / street_eligible_length)</code></pre>
<div
id="association-between-ses-measures-and-cycling-infrastructure-in-2011-1"
class="section level4 tabset" number="13.2.2.1">
<h4 class="tabset"><span class="header-section-number">13.2.2.1</span>
Association between SES measures and cycling infrastructure in 2011</h4>
<p>See original table 2 in paper</p>
<div id="material-deprivation" class="section level5"
number="13.2.2.1.1">
<h5><span class="header-section-number">13.2.2.1.1</span> Material
deprivation</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_eligible_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi2, CT16, f)

# Zero model
res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2011ct != 0) ~ wSCOREMAT.2011.Q + offset(log(street_eligible_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2011ct != 0) ~ wSCOREMAT.2011.Q + offset(log(street_eligible_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                  Estimate Cond. SE t-value   p-value
## (Intercept)        -2.434  0.35357  -6.883 5.850e-12
## wSCOREMAT.2011.Q   -0.221  0.09115  -2.425 1.532e-02
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377106 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.386  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -353.1707</code></pre>
<pre class="r"><code>ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.42683498            -0.03582074</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi2 %&gt;%
  filter(Bike_lane_total.hm.2011ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_eligible_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ wSCOREMAT.2011.Q + offset(log(street_eligible_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                  Estimate Cond. SE t-value p-value
## (Intercept)      -2.01037  0.09291  -21.64  0.0000
## wSCOREMAT.2011.Q -0.06087  0.02754   -2.21  0.0271
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##    1.rho 
## 0.123069 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.3764  
## # of obs: 454; # of groups: ct_no, 454 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1651.377</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##           -0.115600382           -0.006548408</code></pre>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Zero model transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.088
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.802
</td>
<td style="text-align:right;">
0.015
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.zero$interval), 3)%&gt;%
  data.frame(wSCOREMAT.2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Zero model confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Zero model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.653
</td>
<td style="text-align:right;">
0.965
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Count model transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.134
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.941
</td>
<td style="text-align:right;">
0.027
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.cnt$interval), 3)%&gt;%
  data.frame(wSCOREMAT.2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Count model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.891
</td>
<td style="text-align:right;">
0.993
</td>
</tr>
</tbody>
</table>
</div>
<div id="visible-minority" class="section level5" number="13.2.2.1.2">
<h5><span class="header-section-number">13.2.2.1.2</span> Visible
minority</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_eligible_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi2, CT16, f)

# Zero model
res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2011ct != 0) ~ vis_minority_2011.Q + offset(log(street_eligible_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2011ct != 0) ~ vis_minority_2011.Q + offset(log(street_eligible_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                     Estimate Cond. SE t-value   p-value
## (Intercept)           -2.556  0.32862  -7.778 7.438e-15
## vis_minority_2011.Q   -0.207  0.08857  -2.337 1.946e-02
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377199 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.289  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -353.5217</code></pre>
<pre class="r"><code>ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.39786128               -0.02644614</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi2 %&gt;%
  filter(Bike_lane_total.hm.2011ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_eligible_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ vis_minority_2011.Q + offset(log(street_eligible_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                     Estimate Cond. SE t-value p-value
## (Intercept)         -2.00810  0.09283 -21.632 0.00000
## vis_minority_2011.Q -0.06486  0.02809  -2.309 0.02092
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1190548 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.373  
## # of obs: 454; # of groups: ct_no, 454 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1646.344</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;vis_minority_2011.Q&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##              -0.120372301              -0.009540319</code></pre>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Zero model transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.078
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.813
</td>
<td style="text-align:right;">
0.019
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.zero$interval), 3)%&gt;%
  data.frame(vis_minority_2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Zero model confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Zero model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.672
</td>
<td style="text-align:right;">
0.974
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Count model transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.134
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.937
</td>
<td style="text-align:right;">
0.021
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>round(exp(ci.lmm.cnt$interval), 3)%&gt;%
  data.frame(vis_minority_2011.Q = ., row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Count model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.887
</td>
<td style="text-align:right;">
0.991
</td>
</tr>
</tbody>
</table>
</div>
<div id="gentrification-5" class="section level5" number="13.2.2.1.3">
<h5><span class="header-section-number">13.2.2.1.3</span>
Gentrification</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_eligible_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi2, CT16, f)

# Zero model
res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2011ct != 0) ~ gentrif_status_2016 + offset(log(street_eligible_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2011ct != 0) ~ gentrif_status_2016 + offset(log(street_eligible_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE  t-value p-value
## (Intercept)                     -3.25615   0.2350 -13.8576  0.0000
## gentrif_status_2016Gentrified    0.04963   0.2689   0.1846  0.8536
## gentrif_status_2016Non eligible  0.24533   0.2954   0.8304  0.4063
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##    1.rho 
## 0.137767 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  1.427  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -355.7058</code></pre>
<pre class="r"><code>varfixef.zero &lt;- names(res.lmm.zero[[&#39;fixef&#39;]])
ci.1.lmm.zero &lt;- confint(res.lmm.zero, varfixef.zero[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                          -0.5314992                           0.6192396</code></pre>
<pre class="r"><code>ci.2.lmm.zero &lt;- confint(res.lmm.zero, varfixef.zero[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                            -0.3586730                             0.8790736</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi2 %&gt;%
  filter(Bike_lane_total.hm.2011ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_eligible_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2011ct ~ gentrif_status_2016 + offset(log(street_eligible_length.hm)) + 
##     adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                 Estimate Cond. SE t-value p-value
## (Intercept)                     -2.22564  0.06832 -32.578  0.0000
## gentrif_status_2016Gentrified    0.10346  0.08949   1.156  0.2476
## gentrif_status_2016Non eligible -0.01024  0.08458  -0.121  0.9037
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1117999 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.3806  
## # of obs: 454; # of groups: ct_no, 454 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1648.118</code></pre>
<pre class="r"><code>varfixef.cnt &lt;- names(res.lmm.cnt[[&#39;fixef&#39;]])
ci.1.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                         -0.07642384                          0.28480006</code></pre>
<pre class="r"><code>ci.2.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                            -0.1774238                             0.1583218</code></pre>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Zero model transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.039
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
1.051
</td>
<td style="text-align:right;">
0.854
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
1.278
</td>
<td style="text-align:right;">
0.406
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.zero$interval, ci.2.lmm.zero$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef.zero[2:3])
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Zero model confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Zero model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
0.588
</td>
<td style="text-align:right;">
1.858
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
0.699
</td>
<td style="text-align:right;">
2.409
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)</code></pre>
<table>
<caption>
Count model transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.108
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
1.109
</td>
<td style="text-align:right;">
0.248
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
0.990
</td>
<td style="text-align:right;">
0.904
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.cnt$interval, ci.2.lmm.cnt$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = varfixef.cnt[2:3]) 
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Count model confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Count model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
0.926
</td>
<td style="text-align:right;">
1.329
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
0.837
</td>
<td style="text-align:right;">
1.172
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cycling-infrastructure-change-between-2011-and-2016-1"
class="section level4 tabset" number="13.2.2.2">
<h4 class="tabset"><span class="header-section-number">13.2.2.2</span>
Cycling infrastructure change between 2011 and 2016</h4>
<div id="material-deprivation-1" class="section level5"
number="13.2.2.2.1">
<h5><span class="header-section-number">13.2.2.2.1</span> Material
Deprivation</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street_eligible.2011ct + offset(log(street_eligible_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi2, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ wSCOREMAT.2011.Q * Bike_lane.by.street_eligible.2011ct + offset(log(street_eligible_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial()) #, verbose=c(TRACE=TRUE), init=list(lambda=NaN))
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ wSCOREMAT.2011.Q * Bike_lane.by.street_eligible.2011ct + 
##     offset(log(street_eligible_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                                      Estimate Cond. SE  t-value
## (Intercept)                                          -4.93041   0.8467 -5.82280
## wSCOREMAT.2011.Q                                      0.01749   0.2060  0.08489
## Bike_lane.by.street_eligible.2011ct                   2.97375   2.0798  1.42982
## wSCOREMAT.2011.Q:Bike_lane.by.street_eligible.2011ct -0.20072   0.5092 -0.39420
##                                                        p-value
## (Intercept)                                          5.787e-09
## wSCOREMAT.2011.Q                                     9.323e-01
## Bike_lane.by.street_eligible.2011ct                  1.528e-01
## wSCOREMAT.2011.Q:Bike_lane.by.street_eligible.2011ct 6.934e-01
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1377144 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  5.323  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -149.2391</code></pre>
<pre class="r"><code>#ci.lmm.zero &lt;- confint(res.lmm.zero, &#39;wSCOREMAT.2011.Q&#39;) # Not converging
#ci.lmm.zero.i &lt;- confint(res.lmm.zero, &#39;wSCOREMAT.2011.Q:Bike_lane.by.street.2011ct&#39;)
# Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                                          lower      upper
## (Intercept)                                          -6.589999 -3.2708278
## wSCOREMAT.2011.Q                                     -0.386321  0.4213023
## Bike_lane.by.street_eligible.2011ct                  -1.102605  7.0501016
## wSCOREMAT.2011.Q:Bike_lane.by.street_eligible.2011ct -1.198678  0.7972455</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi2 %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street_eligible.2011ct + offset(log(street_eligible_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ wSCOREMAT.2011.Q * Bike_lane.by.street_eligible.2011ct + 
##     offset(log(street_eligible_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                        Estimate Cond. SE
## (Intercept)                                          -2.649e+00 0.086079
## wSCOREMAT.2011.Q                                     -3.413e-03 0.024088
## Bike_lane.by.street_eligible.2011ct                   5.165e-02 0.004375
## wSCOREMAT.2011.Q:Bike_lane.by.street_eligible.2011ct -3.077e-06 0.001383
##                                                         t-value p-value
## (Intercept)                                          -30.768910  0.0000
## wSCOREMAT.2011.Q                                      -0.141683  0.8873
## Bike_lane.by.street_eligible.2011ct                   11.806326  0.0000
## wSCOREMAT.2011.Q:Bike_lane.by.street_eligible.2011ct  -0.002225  0.9982
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1502606 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1049  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1802.038</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;wSCOREMAT.2011.Q&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q upper wSCOREMAT.2011.Q 
##            -0.05074088             0.04400920</code></pre>
<pre class="r"><code>ci.lmm.cnt.i &lt;- confint(res.lmm.cnt, &#39;wSCOREMAT.2011.Q:Bike_lane.by.street_eligible.2011ct&#39;)</code></pre>
<pre><code>## lower wSCOREMAT.2011.Q:Bike_lane.by.street_eligible.2011ct 
##                                               -0.002734451 
## upper wSCOREMAT.2011.Q:Bike_lane.by.street_eligible.2011ct 
##                                                0.002709321</code></pre>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Zero model transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
1.018
</td>
<td style="text-align:right;">
0.932
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
19.565
</td>
<td style="text-align:right;">
0.153
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q:Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
0.818
</td>
<td style="text-align:right;">
0.693
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero[c(2,4),] %&gt;% 
  data.frame() %&gt;% 
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Zero model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.680
</td>
<td style="text-align:right;">
1.524
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q:Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
0.302
</td>
<td style="text-align:right;">
2.219
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Count model transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.071
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.997
</td>
<td style="text-align:right;">
0.887
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
1.053
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q:Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.998
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(wSCOREMAT.2011.Q = round(exp(ci.lmm.cnt$interval), 3),
           `wSCOREMAT.2011.Q:Bike_lane.by.street_eligible.2011ct` = round(exp(ci.lmm.cnt.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Count model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q
</td>
<td style="text-align:right;">
0.951
</td>
<td style="text-align:right;">
1.045
</td>
</tr>
<tr>
<td style="text-align:left;">
wSCOREMAT.2011.Q.Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
0.997
</td>
<td style="text-align:right;">
1.003
</td>
</tr>
</tbody>
</table>
</div>
<div id="visible-minority-1" class="section level5" number="13.2.2.2.2">
<h5><span class="header-section-number">13.2.2.2.2</span> Visible
minority</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street_eligible.2011ct + offset(log(street_eligible_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi2, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ vis_minority_2011.Q * Bike_lane.by.street_eligible.2011ct + offset(log(street_eligible_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ vis_minority_2011.Q * Bike_lane.by.street_eligible.2011ct + 
##     offset(log(street_eligible_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                                         Estimate Cond. SE
## (Intercept)                                              -3.1507   0.8836
## vis_minority_2011.Q                                      -0.4775   0.2240
## Bike_lane.by.street_eligible.2011ct                       3.8708   3.4831
## vis_minority_2011.Q:Bike_lane.by.street_eligible.2011ct  -0.3393   0.8151
##                                                         t-value   p-value
## (Intercept)                                             -3.5659 0.0003626
## vis_minority_2011.Q                                     -2.1318 0.0330225
## Bike_lane.by.street_eligible.2011ct                      1.1113 0.2664419
## vis_minority_2011.Q:Bike_lane.by.street_eligible.2011ct -0.4162 0.6772318
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1378844 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  6.259  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                        logLik
## logL       (p_v(h)): -145.237</code></pre>
<pre class="r"><code># Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                                              lower       upper
## (Intercept)                                             -4.8824596 -1.41893727
## vis_minority_2011.Q                                     -0.9164322 -0.03848807
## Bike_lane.by.street_eligible.2011ct                     -2.9560405 10.69763470
## vis_minority_2011.Q:Bike_lane.by.street_eligible.2011ct -1.9369475  1.25835202</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi2 %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street_eligible.2011ct + offset(log(street_eligible_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ vis_minority_2011.Q * Bike_lane.by.street_eligible.2011ct + 
##     offset(log(street_eligible_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                           Estimate Cond. SE
## (Intercept)                                             -2.6318511 0.087191
## vis_minority_2011.Q                                     -0.0086383 0.024889
## Bike_lane.by.street_eligible.2011ct                      0.0525235 0.004477
## vis_minority_2011.Q:Bike_lane.by.street_eligible.2011ct -0.0002721 0.001432
##                                                          t-value p-value
## (Intercept)                                             -30.1850  0.0000
## vis_minority_2011.Q                                      -0.3471  0.7285
## Bike_lane.by.street_eligible.2011ct                      11.7314  0.0000
## vis_minority_2011.Q:Bike_lane.by.street_eligible.2011ct  -0.1900  0.8493
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1504691 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.1048  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1798.773</code></pre>
<pre class="r"><code>ci.lmm.cnt &lt;- confint(res.lmm.cnt, &#39;vis_minority_2011.Q&#39;) # Not converging</code></pre>
<pre><code>## lower vis_minority_2011.Q upper vis_minority_2011.Q 
##               -0.05761405                0.04030489</code></pre>
<pre class="r"><code>ci.lmm.cnt.i &lt;- confint(res.lmm.cnt, &#39;vis_minority_2011.Q:Bike_lane.by.street_eligible.2011ct&#39;)</code></pre>
<pre><code>## lower vis_minority_2011.Q:Bike_lane.by.street_eligible.2011ct 
##                                                  -0.003099669 
## upper vis_minority_2011.Q:Bike_lane.by.street_eligible.2011ct 
##                                                   0.002535831</code></pre>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Zero model transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.043
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.620
</td>
<td style="text-align:right;">
0.033
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
47.981
</td>
<td style="text-align:right;">
0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q:Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
0.712
</td>
<td style="text-align:right;">
0.677
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero[c(2,4),] %&gt;% 
  data.frame() %&gt;% 
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Zero model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.400
</td>
<td style="text-align:right;">
0.962
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q:Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
0.144
</td>
<td style="text-align:right;">
3.520
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Count model transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.072
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.991
</td>
<td style="text-align:right;">
0.729
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
1.054
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q:Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.849
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame(vis_minority_2011.Q = round(exp(ci.lmm.cnt$interval), 3),
           `vis_minority_2011.Q:Bike_lane.by.street_eligible.2011ct` = round(exp(ci.lmm.cnt.i$interval), 3),
           row.names = c(&#39;lower&#39;, &#39;upper&#39;)) %&gt;% t() %&gt;%
  knitr::kable(caption=&quot;Count model confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Count model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q
</td>
<td style="text-align:right;">
0.944
</td>
<td style="text-align:right;">
1.041
</td>
</tr>
<tr>
<td style="text-align:left;">
vis_minority_2011.Q.Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
0.997
</td>
<td style="text-align:right;">
1.003
</td>
</tr>
</tbody>
</table>
</div>
<div id="gentrification-6" class="section level5" number="13.2.2.2.3">
<h5><span class="header-section-number">13.2.2.2.3</span>
Gentrification</h5>
<pre class="r"><code>f &lt;- Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street_eligible.2011ct + offset(log(street_eligible_length.hm))

clean_bei &lt;- tidy_df(bei_df_aoi2, CT16, f)

res.lmm.zero &lt;- fitme(I(Bike_lane_total.hm.2016ct != 0) ~ gentrif_status_2016 * Bike_lane.by.street_eligible.2011ct + offset(log(street_eligible_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei$df, adjMatrix = clean_bei$nbmatx,
                 family = binomial())
smy.zero &lt;- summary(res.lmm.zero, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: I(Bike_lane_total.hm.2016ct != 0) ~ gentrif_status_2016 * Bike_lane.by.street_eligible.2011ct + 
##     offset(log(street_eligible_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: binomial( link = logit ) 
##  ------------ Fixed effects (beta) ------------
##                                                                      Estimate
## (Intercept)                                                           -4.8375
## gentrif_status_2016Gentrified                                          0.1836
## gentrif_status_2016Non eligible                                       -0.5146
## Bike_lane.by.street_eligible.2011ct                                  526.0141
## gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct   -524.2370
## gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct -523.3454
##                                                                      Cond. SE
## (Intercept)                                                            0.5608
## gentrif_status_2016Gentrified                                          0.6311
## gentrif_status_2016Non eligible                                        0.7489
## Bike_lane.by.street_eligible.2011ct                                 9509.5390
## gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct   9509.5393
## gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct 9509.5393
##                                                                      t-value
## (Intercept)                                                         -8.62628
## gentrif_status_2016Gentrified                                        0.29099
## gentrif_status_2016Non eligible                                     -0.68709
## Bike_lane.by.street_eligible.2011ct                                  0.05531
## gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct   -0.05513
## gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct -0.05503
##                                                                     p-value
## (Intercept)                                                          0.0000
## gentrif_status_2016Gentrified                                        0.7711
## gentrif_status_2016Non eligible                                      0.4920
## Bike_lane.by.street_eligible.2011ct                                  0.9559
## gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct    0.9560
## gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct  0.9561
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##    1.rho 
## 0.137965 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  5.69  
## # of obs: 673; # of groups: ct_no, 673 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -142.5194</code></pre>
<pre class="r"><code># Manually compute CI (see https://stats.stackexchange.com/questions/512789/converting-between-confidence-interval-and-standard-error)
bt &lt;- smy.zero$beta_table
lower &lt;- bt[,1] - bt[,2] * 1.959964
names(lower) &lt;- paste(&#39;lower&#39;, names(lower))
upper &lt;- bt[,1] + bt[,2] * 1.959964
names(upper) &lt;- paste(&#39;upper&#39;, names(upper))
ci.lmm.zero &lt;- cbind(lower, upper)
rownames(ci.lmm.zero) &lt;- rownames(bt)
print(ci.lmm.zero)</code></pre>
<pre><code>##                                                                             lower
## (Intercept)                                                             -5.936664
## gentrif_status_2016Gentrified                                           -1.053302
## gentrif_status_2016Non eligible                                         -1.982374
## Bike_lane.by.street_eligible.2011ct                                 -18112.339916
## gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct   -19162.591685
## gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct -19161.700010
##                                                                             upper
## (Intercept)                                                            -3.7384069
## gentrif_status_2016Gentrified                                           1.4205922
## gentrif_status_2016Non eligible                                         0.9532504
## Bike_lane.by.street_eligible.2011ct                                 19164.3682004
## gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct   18114.1177703
## gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct 18115.0091821</code></pre>
<pre class="r"><code># Count model (Poisson)
clean_bei.cnt &lt;- bei_df_aoi2 %&gt;%
  filter(Bike_lane_total.hm.2016ct != 0) %&gt;%
  tidy_df(CT16, f)

res.lmm.cnt &lt;- fitme(Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street_eligible.2011ct + offset(log(street_eligible_length.hm)) + adjacency(1|ct_no),
                 data = clean_bei.cnt$df, adjMatrix = clean_bei.cnt$nbmatx,
                 family = Tpoisson())
smy.cnt &lt;- summary(res.lmm.cnt, details = c(p_value=&quot;Wald&quot;))</code></pre>
<pre><code>## formula: Bike_lane_total.hm.2016ct ~ gentrif_status_2016 * Bike_lane.by.street_eligible.2011ct + 
##     offset(log(street_eligible_length.hm)) + adjacency(1 | ct_no)
## Estimation of corrPars and lambda by ML (p_v approximation of logL).
## Estimation of fixed effects by ML (p_v approximation of logL).
## Estimation of lambda by &#39;outer&#39; ML, maximizing logL.
## family: 0-truncated poisson( link = log ) 
##  ------------ Fixed effects (beta) ------------
##                                                                      Estimate
## (Intercept)                                                         -2.584194
## gentrif_status_2016Gentrified                                        0.099641
## gentrif_status_2016Non eligible                                     -0.261089
## Bike_lane.by.street_eligible.2011ct                                  0.047760
## gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct   -0.004286
## gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct  0.013355
##                                                                     Cond. SE
## (Intercept)                                                         0.059602
## gentrif_status_2016Gentrified                                       0.079288
## gentrif_status_2016Non eligible                                     0.075625
## Bike_lane.by.street_eligible.2011ct                                 0.003392
## gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct   0.004840
## gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct 0.004538
##                                                                      t-value
## (Intercept)                                                         -43.3575
## gentrif_status_2016Gentrified                                         1.2567
## gentrif_status_2016Non eligible                                      -3.4524
## Bike_lane.by.street_eligible.2011ct                                  14.0786
## gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct    -0.8855
## gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct   2.9429
##                                                                       p-value
## (Intercept)                                                         0.0000000
## gentrif_status_2016Gentrified                                       0.2088609
## gentrif_status_2016Non eligible                                     0.0005556
## Bike_lane.by.street_eligible.2011ct                                 0.0000000
## gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct   0.3758659
## gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct 0.0032511
##  --------------- Random effects ---------------
## Family: gaussian( link = identity ) 
##                    --- Correlation parameters:
##     1.rho 
## 0.1502555 
##            --- Variance parameters (&#39;lambda&#39;):
## lambda = var(u) for u ~ Gaussian; 
##    ct_no  :  0.09793  
## # of obs: 549; # of groups: ct_no, 549 
##  ------------- Likelihood values  -------------
##                         logLik
## logL       (p_v(h)): -1788.383</code></pre>
<pre class="r"><code>varfixef.cnt &lt;- names(res.lmm.cnt[[&#39;fixef&#39;]])
ci.1.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[2])</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified upper gentrif_status_2016Gentrified 
##                         -0.05668553                          0.25531869</code></pre>
<pre class="r"><code>ci.2.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[3])</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible upper gentrif_status_2016Non eligible 
##                            -0.4103537                            -0.1124970</code></pre>
<pre class="r"><code>ci.3.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[5]) # Interaction</code></pre>
<pre><code>## lower gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct 
##                                                             -0.01379026 
## upper gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct 
##                                                              0.00525206</code></pre>
<pre class="r"><code>ci.4.lmm.cnt &lt;- confint(res.lmm.cnt, varfixef.cnt[6]) # Interaction</code></pre>
<pre><code>## lower gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct 
##                                                               0.004460068 
## upper gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct 
##                                                               0.022338115</code></pre>
<pre class="r"><code># Zero model
smy.zero.bt &lt;- data.frame(smy.zero$beta_table)
round(exp(res.lmm.zero[[&quot;fixef&quot;]]), 3) %&gt;% 
  data.frame(fixef = ., p.value = round(smy.zero.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Zero model transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Zero model transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
8.000000e-03
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
1.202000e+00
</td>
<td style="text-align:right;">
0.771
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
5.980000e-01
</td>
<td style="text-align:right;">
0.492
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
2.786374e+228
</td>
<td style="text-align:right;">
0.956
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.956
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.956
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ci.lmm.zero[c(2,3,5,6),] %&gt;% 
  data.frame() %&gt;% 
  exp() %&gt;% 
  knitr::kable(caption=&quot;Zero model confidence interval&quot;, digits=3)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Zero model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
0.349
</td>
<td style="text-align:right;">
4.140
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
0.138
</td>
<td style="text-align:right;">
2.594
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
Inf
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
Inf
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Count model
smy.cnt.bt &lt;- data.frame(smy.cnt$beta_table)
round(exp(res.lmm.cnt[[&quot;fixef&quot;]]), 3) %&gt;%
  data.frame(fixef = ., p.value = round(smy.cnt.bt$p.value, 3)) %&gt;%
  knitr::kable(caption=&quot;Count model transformed coeffs&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Count model transformed coeffs
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fixef
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.075
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
1.105
</td>
<td style="text-align:right;">
0.209
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
0.770
</td>
<td style="text-align:right;">
0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
1.049
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
0.996
</td>
<td style="text-align:right;">
0.376
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
1.013
</td>
<td style="text-align:right;">
0.003
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>.ci.exp &lt;- rbind(ci.1.lmm.cnt$interval, ci.2.lmm.cnt$interval, ci.3.lmm.cnt$interval, ci.4.lmm.cnt$interval) %&gt;% 
  exp() %&gt;% round(., 3) %&gt;%
  data.frame(., row.names = c(varfixef.cnt[2:3], varfixef.cnt[5:6]))
names(.ci.exp) &lt;- c(&quot;lower&quot;, &quot;upper&quot;)
knitr::kable(.ci.exp, caption=&quot;Count model confidence interval&quot;)%&gt;%
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Count model confidence interval
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified
</td>
<td style="text-align:right;">
0.945
</td>
<td style="text-align:right;">
1.291
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible
</td>
<td style="text-align:right;">
0.663
</td>
<td style="text-align:right;">
0.894
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Gentrified:Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
0.986
</td>
<td style="text-align:right;">
1.005
</td>
</tr>
<tr>
<td style="text-align:left;">
gentrif_status_2016Non eligible:Bike_lane.by.street_eligible.2011ct
</td>
<td style="text-align:right;">
1.004
</td>
<td style="text-align:right;">
1.023
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="annexes" class="section level1" number="14">
<h1><span class="header-section-number">14</span> Annexes</h1>
<pre><code>## R version 4.3.2 (2023-10-31 ucrt)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows Server 2022 x64 (build 20348)
## 
## Matrix products: default
## 
## 
## locale:
## [1] LC_COLLATE=English_Canada.utf8  LC_CTYPE=English_Canada.utf8   
## [3] LC_MONETARY=English_Canada.utf8 LC_NUMERIC=C                   
## [5] LC_TIME=English_Canada.utf8    
## 
## time zone: America/Toronto
## tzcode source: internal
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] e1071_1.7-14      cancensus_0.5.6   rcompanion_2.4.34 stringr_1.5.1    
##  [5] DHARMa_0.4.6      stargazer_5.2.3   spaMM_4.4.16      spatialreg_1.3-1 
##  [9] spdep_1.3-1       spData_2.3.0      lme4_1.1-35.1     Matrix_1.6-4     
## [13] cowplot_1.1.2     biscale_1.0.0     openxlsx_4.2.5.2  RPostgres_1.4.6  
## [17] DBI_1.2.0         ggspatial_1.1.9   ggmap_4.0.0       ggplot2_3.4.4    
## [21] stars_0.6-4       abind_1.4-5       sf_1.0-15         tidyr_1.3.0      
## [25] dplyr_1.1.4      
## 
## loaded via a namespace (and not attached):
##   [1] RColorBrewer_1.1-3  libcoin_1.0-10      rstudioapi_0.15.0  
##   [4] jsonlite_1.8.8      wk_0.9.1            magrittr_2.0.3     
##   [7] TH.data_1.1-2       modeltools_0.2-23   farver_2.1.1       
##  [10] nloptr_2.0.3        rmarkdown_2.25      vctrs_0.6.5        
##  [13] minqa_1.2.6         webshot_0.5.5       forcats_1.0.0      
##  [16] htmltools_0.5.7     cellranger_1.1.0    s2_1.1.6           
##  [19] LearnBayes_2.15.1   sass_0.4.8          KernSmooth_2.23-22 
##  [22] bslib_0.6.1         plyr_1.8.9          sandwich_3.1-0     
##  [25] rootSolve_1.8.2.4   zoo_1.8-12          lubridate_1.9.3    
##  [28] cachem_1.0.8        lifecycle_1.0.4     pkgconfig_2.0.3    
##  [31] R6_2.5.1            fastmap_1.1.1       digest_0.6.33      
##  [34] Exact_3.2           numDeriv_2016.8-1.1 ggnewscale_0.4.9   
##  [37] colorspace_2.1-0    labeling_0.4.3      fansi_1.0.6        
##  [40] timechange_0.2.0    httr_1.4.7          compiler_4.3.2     
##  [43] proxy_0.4-27        bit64_4.0.5         withr_2.5.2        
##  [46] backports_1.4.1     highr_0.10          MASS_7.3-60        
##  [49] classInt_0.4-10     gld_2.6.6           tools_4.3.2        
##  [52] units_0.8-5         lmtest_0.9-40       zip_2.3.0          
##  [55] glue_1.6.2          nlme_3.1-164        grid_4.3.2         
##  [58] checkmate_2.3.1     generics_0.1.3      gtable_0.3.4       
##  [61] tzdb_0.4.0          nortest_1.0-4       class_7.3-22       
##  [64] data.table_1.14.10  lmom_3.0            hms_1.1.3          
##  [67] xml2_1.3.5          sp_2.1-2            coin_1.4-3         
##  [70] utf8_1.2.4          pillar_1.9.0        vroom_1.6.5        
##  [73] splines_4.3.2       lattice_0.22-5      survival_3.5-7     
##  [76] bit_4.0.5           deldir_2.0-2        ROI_1.0-1          
##  [79] tidyselect_1.2.0    registry_0.5-1      pbapply_1.7-2      
##  [82] knitr_1.45          svglite_2.1.3       stats4_4.3.2       
##  [85] xfun_0.41           expm_0.999-8        matrixStats_1.2.0  
##  [88] stringi_1.8.3       geojsonsf_2.0.3     yaml_2.3.8         
##  [91] boot_1.3-28.1       kableExtra_1.3.4    evaluate_0.23      
##  [94] codetools_0.2-19    tibble_3.2.1        multcompView_0.1-9 
##  [97] cli_3.6.2           systemfonts_1.0.5   DescTools_0.99.52  
## [100] munsell_0.5.0       jquerylib_0.1.4     Rcpp_1.0.11        
## [103] readxl_1.4.3        coda_0.19-4         png_0.1-8          
## [106] parallel_4.3.2      readr_2.1.4         blob_1.2.4         
## [109] jpeg_0.1-10         bitops_1.0-7        viridisLite_0.4.2  
## [112] mvtnorm_1.2-4       slam_0.1-50         scales_1.3.0       
## [115] purrr_1.0.2         crayon_1.5.2        rlang_1.1.2        
## [118] rvest_1.0.3         multcomp_1.4-25</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
